<?xml version="1.0" encoding="utf-8" ?>
<SqlCmd>

  <!--// Table: BG_M_USER -->
  <BG_M_USER>
    <SELECT001>
      SELECT US.USER_ID, US.USER_NAME, US.PASSWORD, US.PERSON_IN_CHARGE_NO, US.EMAIL, US.EXPIRE_FLAG, UL.*
      FROM BG_M_USER AS US LEFT JOIN BG_M_USER_LEVEL AS UL ON US.USER_LEVEL_ID = UL.USER_LEVEL_ID
      WHERE US.USER_ID = '@UserId'
      ORDER BY US.USER_ID
    </SELECT001>
    <SELECT002>
      SELECT US.USER_ID, US.USER_NAME, US.PASSWORD, UL.USER_LEVEL_NAME, US.PERSON_IN_CHARGE_NO, US.EMAIL,
      CASE US.EXPIRE_FLAG WHEN 1 THEN 'Yes' ELSE 'No' END  AS EXPIRED,
      US.CREATE_USER_ID AS [Create User ID],
      US.CREATE_DATE AS [Create Date],
      US.UPDATE_USER_ID AS [Update User ID],
      US.UPDATE_DATE AS [Update Date]
      FROM BG_M_USER AS US LEFT JOIN BG_M_USER_LEVEL AS UL ON US.USER_LEVEL_ID = UL.USER_LEVEL_ID
      @Where
      ORDER BY US.USER_LEVEL_ID
    </SELECT002>
    <SELECT003>
      SELECT *, PERSON_IN_CHARGE_NO + ' : ' + PERSON_IN_CHARGE_NAME AS PERSON_IN_CHARGE_NAME2 FROM BG_M_PERSON_IN_CHARGE
      ORDER BY PERSON_IN_CHARGE_NO
    </SELECT003>
    <SELECT004>
      SELECT * FROM BG_M_USER_LEVEL
      ORDER BY USER_LEVEL_ID
    </SELECT004>
    <SELECT005>
      SELECT * FROM BG_M_USER
      ORDER BY USER_ID
    </SELECT005>
    <SELECT006>
      SELECT US.USER_ID, US.USER_NAME, US.EMAIL, UL.* FROM BG_M_USER AS US LEFT JOIN BG_M_USER_LEVEL AS UL ON
      US.USER_LEVEL_ID = UL.USER_LEVEL_ID
      WHERE US.EXPIRE_FLAG = 0 AND US.PERSON_IN_CHARGE_NO = '@UserPic'
      ORDER BY USER_ID
    </SELECT006>
    <SELECT007>
      SELECT US.USER_ID, US.USER_NAME, US.EMAIL, UL.* FROM BG_M_USER AS US LEFT JOIN BG_M_USER_LEVEL AS UL ON
      US.USER_LEVEL_ID = UL.USER_LEVEL_ID
      WHERE US.EXPIRE_FLAG = 0 AND US.PERSON_IN_CHARGE_NO LIKE '@UserPic%'
      ORDER BY USER_ID
    </SELECT007>
    <SELECT008>
      SELECT DISTINCT US.EMAIL FROM BG_M_USER AS US LEFT JOIN BG_M_USER_LEVEL AS UL ON
      US.USER_LEVEL_ID = UL.USER_LEVEL_ID
      WHERE US.EXPIRE_FLAG = 0 AND UL.APPROVE = 'Y' AND
      (US.PERSON_IN_CHARGE_NO = '@UserPic' OR US.PERSON_IN_CHARGE_NO IN
      (SELECT PIC_PARENT_NO FROM BG_M_CHILD_PIC WHERE PIC_CHILD_NO = '@UserPic'))
    </SELECT008>
    <SELECT009>
      SELECT DISTINCT US.EMAIL FROM BG_M_USER AS US LEFT JOIN BG_M_USER_LEVEL AS UL ON
      US.USER_LEVEL_ID = UL.USER_LEVEL_ID
      WHERE US.EXPIRE_FLAG = 0 AND UL.SUBMIT = 'Y' AND US.PERSON_IN_CHARGE_NO LIKE '@UserPic%'
    </SELECT009>
    <SELECT010>
      SELECT DISTINCT US.EMAIL FROM BG_M_USER AS US LEFT JOIN BG_M_USER_LEVEL AS UL ON
      US.USER_LEVEL_ID = UL.USER_LEVEL_ID
      WHERE US.EXPIRE_FLAG = 0 AND UL.APPROVE = 'Y'
    </SELECT010>
    <SELECT011>
      SELECT UL.*, US.USER_NAME AS LOGIN_USER_NAME
      FROM BG_T_USER_LOGIN AS UL LEFT JOIN BG_M_USER AS US ON UL.LOGIN_USER_ID = US.USER_ID
      WHERE UL.PERSON_IN_CHARGE_NO = '@UserPIC'
    </SELECT011>
    <SELECT012>
      SELECT UL.PERSON_IN_CHARGE_NO, UL.PERSON_IN_CHARGE_NO + ' : ' + PIC.PERSON_IN_CHARGE_NAME AS PIC_NAME
      FROM BG_T_USER_LOGIN AS UL LEFT JOIN BG_M_PERSON_IN_CHARGE AS PIC ON UL.PERSON_IN_CHARGE_NO = PIC.PERSON_IN_CHARGE_NO
      ORDER BY UL.PERSON_IN_CHARGE_NO
    </SELECT012>
    <SELECT013>
      SELECT USER_LEVEL_ID, USER_LEVEL_NAME As [User Level],
      ENTRY, SUBMIT, APPROVE, ADJUST, AUTH1, AUTH2, IMPORT, EXPORT, MASTER, SYSTEM, [VIEW], DIRECT_INPUT,
      UPDATE_USER_ID As [Update User ID], UPDATE_DATE As [Update Date]
      FROM BG_M_USER_LEVEL
      @Where
      ORDER BY USER_LEVEL_ID
    </SELECT013>
    <SELECT014>
      SELECT * FROM BG_T_USER_LOGIN WHERE LOGIN_USER_ID = '@UserID'
    </SELECT014>
    <SELECT015>
      SELECT MAX(USER_LEVEL_ID) AS USER_LEVEL_ID FROM BG_M_USER_LEVEL
    </SELECT015>
    <INSERT001>
      INSERT INTO BG_M_USER (USER_ID, USER_LEVEL_ID, USER_NAME, PASSWORD, PERSON_IN_CHARGE_NO, EMAIL, EXPIRE_FLAG, CREATE_USER_ID, UPDATE_USER_ID)
      VALUES ('@UserId1', @UserLevel, '@UserName', '@Password', '@UserPIC', '@Email', @ExpireFlg, '@UserId2', '@UserId2')
    </INSERT001>
    <INSERT002>
      INSERT INTO BG_T_USER_LOGIN (PERSON_IN_CHARGE_NO, LOGIN_USER_ID)
      VALUES ('@UserPIC','@UserId')
    </INSERT002>
    <INSERT003>
      INSERT INTO BG_M_USER_LEVEL (USER_LEVEL_ID,USER_LEVEL_NAME,[ENTRY],SUBMIT,APPROVE,ADJUST,AUTH1,AUTH2,IMPORT,EXPORT, [MASTER],[SYSTEM], [VIEW],DIRECT_INPUT,CREATE_USER_ID,UPDATE_USER_ID)
      VALUES (  '@UserLevel', '@UserLevelName','@Entry', '@Submit', '@Approve','@Adjust','@Auth1','@Auth2','@Import','@Export', '@Master','@System', '@View','@DirectInput','@UserId','@UserId')
    </INSERT003>
    <UPDATE001>
      UPDATE BG_M_USER SET PASSWORD = '@Password', UPDATE_USER_ID = '@UserId', UPDATE_DATE = GetDate()
      WHERE USER_ID = '@UserId'
    </UPDATE001>
    <UPDATE002>
      UPDATE BG_M_USER SET
      USER_LEVEL_ID = @UserLevel,
      USER_NAME = '@UserName',
      PASSWORD = '@Password',
      PERSON_IN_CHARGE_NO = '@UserPIC',
      EMAIL = '@Email',
      EXPIRE_FLAG = @ExpireFlg,
      UPDATE_USER_ID = '@UserId2', UPDATE_DATE = GetDate()
      WHERE USER_ID = '@UserId1'
    </UPDATE002>
    <UPDATE003>
      UPDATE BG_M_USER_LEVEL SET
      USER_LEVEL_NAME = '@UserLevelName',
      [ENTRY] = '@Entry',
      SUBMIT = '@Submit',
      APPROVE = '@Approve',
      ADJUST = '@Adjust',
      AUTH1 = '@Auth1',
      AUTH2 = '@Auth2',
      IMPORT = '@Import',
      EXPORT = '@Export',
      [MASTER] = '@Master',
      [SYSTEM] = '@System',
      [VIEW] = '@View',
      DIRECT_INPUT = '@DirectInput',
      UPDATE_USER_ID = '@UserId', UPDATE_DATE = GetDate()
      WHERE USER_LEVEL_ID = '@UserLevel'
    </UPDATE003>
    <DELETE001>
      DELETE FROM BG_T_USER_LOGIN
      WHERE PERSON_IN_CHARGE_NO = '@UserPIC' AND LOGIN_USER_ID = '@UserId'
    </DELETE001>
    <DELETE002>
      DELETE FROM BG_T_USER_LOGIN
      WHERE PERSON_IN_CHARGE_NO = '@UserPIC'
    </DELETE002>
    <DELETE003>
      DELETE FROM BG_M_USER_LEVEL
      WHERE USER_LEVEL_ID = '@UserLevel'
    </DELETE003>
  </BG_M_USER>

  <!--// Table: BG_M_BUDGET_ORDER -->
  <BG_M_BUDGET_ORDER>
    <SELECT001>
      SELECT BO.BUDGET_ORDER_NO, BO.BUDGET_ORDER_NAME, AC.ACCOUNT_NO, AC.ACCOUNT_NAME, BO.COST, BO.COST_TYPE,
      DP.DEPT_NO, DP.DEPT_NAME, PIC.PERSON_IN_CHARGE_NO, PIC.PERSON_IN_CHARGE_NAME
      FROM BG_M_BUDGET_ORDER AS BO
      LEFT JOIN BG_M_ACCOUNT AS AC ON BO.ACCOUNT_NO = AC.ACCOUNT_NO
      LEFT JOIN BG_M_DEPT AS DP ON BO.DEPT_NO = DP.DEPT_NO
      LEFT JOIN BG_M_PERSON_IN_CHARGE AS PIC ON BO.PERSON_IN_CHARGE_NO = PIC.PERSON_IN_CHARGE_NO
      WHERE BO.ACTIVE_FLAG = 1 AND BO.BUDGET_TYPE = '@BudgetType' AND BO.PERSON_IN_CHARGE_NO = '@UserPIC'
    </SELECT001>
    <SELECT002>
      SELECT BO.BUDGET_ORDER_NO,
      BO.BUDGET_ORDER_NAME,
      CASE BO.BUDGET_TYPE WHEN 'E' THEN 'Expense'
      WHEN 'A' THEN 'Asset'
      ELSE NULL END [BUDGET_TYPE],
      BO.ACCOUNT_NO,
      BO.COST_CENTER,
      CASE BO.COST WHEN '2' THEN 'Admin'
      WHEN '1' THEN 'FC'
      ELSE NULL END [COST],
      CASE BO.COST_TYPE WHEN '1' THEN 'Fixed Cost'
      WHEN '2' THEN 'Variable Cost'
      ELSE NULL END [COST_TYPE],
      BO.ASSET_GROUP_NO,
      BO.DEPT_NO,
      BO.PERSON_IN_CHARGE_NO,
      BO.ACTIVE_FLAG,
      BO.REMARKS,
      BO.CREATE_USER_ID,
      BO.CREATE_DATE,
      BO.UPDATE_USER_ID,
      BO.UPDATE_DATE,
      CASE BO.EXPENSE_TYPE WHEN '1' THEN 'Labor Expense'
      WHEN '2' THEN 'Variable Expense'
      WHEN '3' THEN 'Fixed Expense'
      ELSE NULL END [EXPENSE_TYPE],
      BO.PIC_SHOW_FLAG
      FROM BG_M_BUDGET_ORDER AS BO
      @Where
      ORDER BY BO.BUDGET_TYPE DESC, BO.BUDGET_ORDER_NO
    </SELECT002>
    <SELECT003>
      SELECT BO.BUDGET_ORDER_NO FROM BG_M_BUDGET_ORDER AS BO WHERE BO.BUDGET_ORDER_NO = '@P_BG_ORDER_NO'
    </SELECT003>
   
    <SELECT004>
      SELECT DISTINCT(BGOR.PERSON_IN_CHARGE_NO) AS PERSON_IN_CHARGE_NO,
      BGOR.PIC_SHOW_FLAG,
      PIC.PERSON_IN_CHARGE_NAME,
      BGOR.PERSON_IN_CHARGE_NO + ' : ' + PIC.PERSON_IN_CHARGE_NAME AS PIC_DISPLAY
      FROM BG_M_BUDGET_ORDER AS BGOR
      LEFT OUTER JOIN BG_M_PERSON_IN_CHARGE AS PIC ON
      BGOR.PERSON_IN_CHARGE_NO = PIC.PERSON_IN_CHARGE_NO
      ORDER BY BGOR.PIC_SHOW_FLAG
    </SELECT004>
    <SELECT005>
      SELECT DISTINCT PERSON_IN_CHARGE_NO
      FROM BG_M_BUDGET_ORDER
      WHERE ACTIVE_FLAG = 1 AND BUDGET_TYPE = '@BudgetType'
    </SELECT005>
    <SELECT006>
      SELECT DISTINCT PERSON_IN_CHARGE_NO
      FROM BG_M_BUDGET_ORDER
      WHERE ACTIVE_FLAG = 1 AND BUDGET_TYPE = '@BudgetType' AND
      (PERSON_IN_CHARGE_NO LIKE '@UserPIC%' OR PERSON_IN_CHARGE_NO IN (SELECT PIC_CHILD_NO AS PERSON_IN_CHARGE_NO
      FROM BG_M_CHILD_PIC WHERE PIC_PARENT_NO = '@UserPIC'))
    </SELECT006>
    <SELECT007>
      SELECT BUDGET_ORDER_NO, BUDGET_ORDER_NO + ' - ' + BUDGET_ORDER_NAME [BUDGET_TEXT]
      FROM BG_M_BUDGET_ORDER
      WHERE BUDGET_TYPE = 'E'
    </SELECT007>
    <SELECT008_1>
      SELECT
      C.PERSON_IN_CHARGE_NO
      ,C.PERSON_IN_CHARGE_NAME
      ,O.PIC_SHOW_FLAG
      ,MAX(O.COST_TYPE) AS COST_TYPE
      ,SUM(ISNULL(D.M@month,0.00)) AS B_M
      ,SUM(ISNULL(U.M@month,0.00)) AS A_M
    </SELECT008_1>
    <SELECT008_2>
      FROM dbo.BG_M_BUDGET_ORDER O
      INNER JOIN dbo.BG_M_PERSON_IN_CHARGE C
      ON C.PERSON_IN_CHARGE_NO=O.PERSON_IN_CHARGE_NO
      LEFT OUTER JOIN
      (
      SELECT MAX(BUDGET_ORDER_NO) AS BUDGET_ORDER_NO,
      BUDGET_YEAR,
      PERIOD_TYPE,
      MAX(REV_NO) AS REV_NO,
    </SELECT008_2>
    <SELECT008_3>
      FROM BG_T_BUDGET_DATA
      WHERE BUDGET_YEAR = @year AND PERIOD_TYPE = @period
      GROUP BY BUDGET_YEAR, PERIOD_TYPE
      )AS D ON
      O.BUDGET_ORDER_NO = D.BUDGET_ORDER_NO
      LEFT OUTER JOIN dbo.BG_T_UPLOAD_DATA U
      ON O.BUDGET_ORDER_NO= U.BUDGET_ORDER_NO AND
      U.BUDGET_YEAR = @year AND
      U.DATA_TYPE = 2
      WHERE O.BUDGET_TYPE='E'
      AND O.ACTIVE_FLAG = 1
      GROUP BY C.PERSON_IN_CHARGE_NO, C.PERSON_IN_CHARGE_NAME,O.PIC_SHOW_FLAG
    </SELECT008_3>
    <SELECT009>
      SELECT DISTINCT
      BGOR.PERSON_IN_CHARGE_NO AS PERSON_IN_CHARGE_NO,
      PIC.PERSON_IN_CHARGE_NAME,
      BGOR.PERSON_IN_CHARGE_NO + ' : ' + PIC.PERSON_IN_CHARGE_NAME AS PIC_NAME
      FROM BG_M_BUDGET_ORDER AS BGOR LEFT OUTER JOIN BG_M_PERSON_IN_CHARGE AS PIC
      ON BGOR.PERSON_IN_CHARGE_NO = PIC.PERSON_IN_CHARGE_NO
      WHERE BGOR.ACTIVE_FLAG = 1 AND BGOR.BUDGET_TYPE = '@BudgetType' AND
      BGOR.PERSON_IN_CHARGE_NO
      NOT IN
      (SELECT PERSON_IN_CHARGE_NO FROM BG_T_BUDGET_HEADER
      WHERE BUDGET_YEAR = @BudgetYear AND PERIOD_TYPE = @PeriodType AND BUDGET_TYPE = '@BudgetType' AND
      REV_NO = @RevNo AND STATUS &lt;&gt; @Status
      AND PROJECT_NO = @ProjectNo
      AND PERSON_IN_CHARGE_NO NOT IN
      (
      SELECT  DISTINCT(ORD.PERSON_IN_CHARGE_NO)
      FROM BG_T_BUDGET_DATA_REINPUT REI
      INNER JOIN  dbo.BG_M_BUDGET_ORDER  ORD ON ORD.BUDGET_ORDER_NO = REI.BUDGET_ORDER_NO AND ORD.BUDGET_TYPE = '@BudgetType'
      WHERE REI.BUDGET_YEAR = @BudgetYear
      AND REI.PERIOD_TYPE = @PeriodType
      AND REI.REV_NO = @RevNo
      AND REI.ITEM_STATUS = @Status
      AND REI.PROJECT_NO = @ProjectNo
      )
      )
      ORDER BY BGOR.PERSON_IN_CHARGE_NO
    </SELECT009>
    <SELECT010>
      SELECT DISTINCT
      BGOR.PERSON_IN_CHARGE_NO AS PERSON_IN_CHARGE_NO,
      PIC.PERSON_IN_CHARGE_NAME,
      BGOR.PERSON_IN_CHARGE_NO + ' : ' + PIC.PERSON_IN_CHARGE_NAME AS PIC_NAME
      FROM BG_M_BUDGET_ORDER AS BGOR LEFT OUTER JOIN BG_M_PERSON_IN_CHARGE AS PIC
      ON BGOR.PERSON_IN_CHARGE_NO = PIC.PERSON_IN_CHARGE_NO
      WHERE BGOR.ACTIVE_FLAG = 1 AND BGOR.BUDGET_TYPE = '@BudgetType' AND BGOR.PERSON_IN_CHARGE_NO LIKE '@UserPIC%'
      ORDER BY BGOR.PERSON_IN_CHARGE_NO
    </SELECT010>
    <SELECT011>
      SELECT BO.BUDGET_ORDER_NO, BO.BUDGET_ORDER_NAME, AC.ACCOUNT_NO, AC.ACCOUNT_NAME, BO.COST, BO.COST_TYPE,
      DP.DEPT_NO, DP.DEPT_NAME, PIC.PERSON_IN_CHARGE_NO, PIC.PERSON_IN_CHARGE_NAME
      FROM BG_M_BUDGET_ORDER AS BO
      LEFT JOIN BG_M_ACCOUNT AS AC ON BO.ACCOUNT_NO = AC.ACCOUNT_NO
      LEFT JOIN BG_M_DEPT AS DP ON BO.DEPT_NO = DP.DEPT_NO
      LEFT JOIN BG_M_PERSON_IN_CHARGE AS PIC ON BO.PERSON_IN_CHARGE_NO = PIC.PERSON_IN_CHARGE_NO
      WHERE BO.ACTIVE_FLAG = 1 AND BO.BUDGET_TYPE = '@BudgetType'
    </SELECT011>
    <SELECT012>
      SELECT BUDGET_ORDER_NO
      FROM BG_M_BUDGET_ORDER
      WHERE BUDGET_TYPE = 'E' AND ACCOUNT_NO = '@AccountNo'
    </SELECT012>
    <SELECT013>
      SELECT BO.BUDGET_ORDER_NO, BO.BUDGET_ORDER_NAME, AC.ACCOUNT_NO, AC.ACCOUNT_NAME, BO.COST, BO.COST_TYPE,
      DP.DEPT_NO, DP.DEPT_NAME, PIC.PERSON_IN_CHARGE_NO, PIC.PERSON_IN_CHARGE_NAME
      FROM BG_M_BUDGET_ORDER AS BO
      LEFT JOIN BG_M_ACCOUNT AS AC ON BO.ACCOUNT_NO = AC.ACCOUNT_NO
      LEFT JOIN BG_M_DEPT AS DP ON BO.DEPT_NO = DP.DEPT_NO
      LEFT JOIN BG_M_PERSON_IN_CHARGE AS PIC ON BO.PERSON_IN_CHARGE_NO = PIC.PERSON_IN_CHARGE_NO
      WHERE BO.ACTIVE_FLAG = 1 AND BO.BUDGET_TYPE = '@BudgetType' AND BO.PERSON_IN_CHARGE_NO = '@UserPIC' AND
      BO.BUDGET_ORDER_NO NOT IN (SELECT DISTINCT BUDGET_ORDER_NO FROM BG_T_BUDGET_DATA
      WHERE BUDGET_YEAR = @BudgetYear AND PERIOD_TYPE = @PeriodType AND REV_NO = @RevNo AND PROJECT_NO = @ProjectNo)
    </SELECT013>
    <SELECT014>
      SELECT BO.BUDGET_ORDER_NO, BO.BUDGET_ORDER_NAME, AC.ACCOUNT_NO, AC.ACCOUNT_NAME, BO.COST, BO.COST_TYPE,
      DP.DEPT_NO, DP.DEPT_NAME, PIC.PERSON_IN_CHARGE_NO, PIC.PERSON_IN_CHARGE_NAME
      FROM BG_M_BUDGET_ORDER AS BO
      LEFT JOIN BG_M_ACCOUNT AS AC ON BO.ACCOUNT_NO = AC.ACCOUNT_NO
      LEFT JOIN BG_M_DEPT AS DP ON BO.DEPT_NO = DP.DEPT_NO
      LEFT JOIN BG_M_PERSON_IN_CHARGE AS PIC ON BO.PERSON_IN_CHARGE_NO = PIC.PERSON_IN_CHARGE_NO
      WHERE BO.ACTIVE_FLAG = 1 AND BO.BUDGET_TYPE = '@BudgetType' AND
      BO.BUDGET_ORDER_NO NOT IN (SELECT DISTINCT BUDGET_ORDER_NO FROM BG_T_BUDGET_DATA
      WHERE BUDGET_YEAR = @BudgetYear AND PERIOD_TYPE = @PeriodType AND REV_NO = @RevNo AND PROJECT_NO = @ProjectNo)
    </SELECT014>
    <SELECT015>
      SELECT DISTINCT PIC_SHOW_FLAG FROM BG_M_BUDGET_ORDER
      WHERE  PERSON_IN_CHARGE_NO = '@UserPIC'
    </SELECT015>
    <SELECT016>
      SELECT BUDGET_TYPE FROM BG_M_BUDGET_ORDER WHERE BUDGET_ORDER_NO = '@OrderNo'
    </SELECT016>
    <SELECT017>
      SELECT BO.BUDGET_ORDER_NO,PERSON_IN_CHARGE_NO FROM BG_M_BUDGET_ORDER AS BO WHERE BO.BUDGET_ORDER_NO = '@P_BG_ORDER_NO'
    </SELECT017>
    <UPDATE001>
      UPDATE [BG_M_BUDGET_ORDER]
      SET [BUDGET_ORDER_NAME] = '@P_BG_ORDER_NAME'
      ,[BUDGET_TYPE] = '@P_BG_TYPE'
      ,[ACCOUNT_NO] = '@P_ACCOUNT_NO'
      ,[COST_CENTER] = '@P_COST_CENTER'
      ,[COST_TYPE] = @P_COST_TYPE
      ,[COST] = @P_COST
      ,[ASSET_GROUP_NO] = @P_ASSET_GROUP_NO
      ,[DEPT_NO] = '@P_DEPT_NO'
      ,[PERSON_IN_CHARGE_NO] = '@P_PERSON_IN_CHARGE'
      ,[ACTIVE_FLAG] = '@P_ACTIVE_FLAG'
      ,[EXPENSE_TYPE] = '@P_EXPENSE_TYPE'
      ,[PIC_SHOW_FLAG] = '@P_PIC_SHOW_FLAG'
      ,[UPDATE_USER_ID] = '@P_UPDATE_USER_ID'
      ,[UPDATE_DATE] = GETDATE()
      ,[REMARKS] = '@P_REMARKS'
      WHERE [BUDGET_ORDER_NO] = '@P_BG_ORDER_NO'
    </UPDATE001>
    <UPDATE002>
      UPDATE [BG_M_BUDGET_ORDER]
      SET [PIC_SHOW_FLAG] = '@P_PIC_SHOW_FLAG'
      ,[UPDATE_USER_ID] = '@P_UPDATE_USER_ID'
      ,[UPDATE_DATE] = GETDATE()
      WHERE [PERSON_IN_CHARGE_NO] = '@P_PERSON_IN_CHARGE'
    </UPDATE002>
    <INSERT001>
      INSERT INTO [BG_M_BUDGET_ORDER]
      ([BUDGET_ORDER_NO],[BUDGET_ORDER_NAME],[BUDGET_TYPE]
      ,[ACCOUNT_NO],[COST_CENTER],[COST_TYPE]
      ,[COST],[ASSET_GROUP_NO],[DEPT_NO]
      ,[PERSON_IN_CHARGE_NO],[EXPENSE_TYPE]
      ,[PIC_SHOW_FLAG],[ACTIVE_FLAG]
      ,[CREATE_USER_ID],[CREATE_DATE]
      ,[UPDATE_USER_ID],[UPDATE_DATE]
      ,REMARKS)
      VALUES('@P_BG_ORDER_NO', '@P_BG_ORDER_NAME','@P_BG_TYPE'
      ,'@P_ACCOUNT_NO','@P_COST_CENTER',@P_COST_TYPE
      ,@P_COST,@P_ASSET_GROUP_NO,'@P_DEPT_NO'
      ,'@P_PERSON_IN_CHARGE','@P_EXPENSE_TYPE'
      ,'@P_PIC_SHOW_FLAG','@P_ACTIVE_FLAG'
      ,'@P_CREATE_USER_ID',GETDATE()
      ,'@P_CREATE_USER_ID',GETDATE()
      ,'@P_REMARKS')
    </INSERT001>
    <DELETE001>
      DELETE FROM BG_M_BUDGET_ORDER
      WHERE BUDGET_ORDER_NO = '@P_BG_ORDER_NO'
    </DELETE001>
  </BG_M_BUDGET_ORDER>

  <!--// Table: BG_T_BUDGET_DATA -->
  <BG_T_BUDGET_DATA>
    <SELECT001>
      SELECT
      BD.*,
      (BD.M1+BD.M2+BD.M3+BD.M4+BD.M5+BD.M6) AS H1,
      (BD.M7+BD.M8+BD.M9+BD.M10+BD.M11+BD.M12) AS H2,
      (BD.M1+BD.M2+BD.M3+BD.M4+BD.M5+BD.M6+BD.M7+BD.M8+BD.M9+BD.M10+BD.M11+BD.M12) AS Y1,
      BO.BUDGET_ORDER_NAME,
      AC.ACCOUNT_NO, AC.ACCOUNT_NAME,
      BO.COST, BO.COST_TYPE, DP.DEPT_NO, DP.DEPT_NAME,
      PIC.PERSON_IN_CHARGE_NO, PIC.PERSON_IN_CHARGE_NAME,
      ISNULL(MTP.RRT2,0) AS MTP_RRT1,

      --(ISNULL((SELECT ISNULL(ISNULL(M10,0)+ISNULL(M11,0)+ISNULL(M12,0),0)
      --FROM BG_T_BUDGET_DATA
      --WHERE BUDGET_YEAR = (@BudgetYear-1)
      --AND PERIOD_TYPE = 2
      --AND REV_NO = (SELECT MAX(REV_NO) AS REV_NO FROM BG_T_BUDGET_DATA WHERE BUDGET_YEAR = (@BudgetYear-1) AND PERIOD_TYPE = 2 AND PROJECT_NO = @ProjectNo)
      --AND PROJECT_NO = @ProjectNo
      --AND BUDGET_ORDER_NO = BD.BUDGET_ORDER_NO),0)+
      --ISNULL((SELECT ISNULL(M7,0)+ISNULL(M8,0)+ISNULL(M9,0)
      --FROM BG_T_UPLOAD_DATA
      --WHERE BUDGET_YEAR = (@BudgetYear-1)
      --AND PERIOD_TYPE = 2
      --AND PROJECT_NO = @ProjectNo
      --AND DATA_TYPE = 2
      --AND BUDGET_ORDER_NO = BD.BUDGET_ORDER_NO),0)) AS IMP2
      (ISNULL((SELECT ISNULL(ISNULL(M10,0)+ISNULL(M11,0)+ISNULL(M12,0),0)
      FROM BG_T_BUDGET_DATA
      WHERE BUDGET_YEAR = (@BudgetYear-1)
      AND PERIOD_TYPE = 2
      AND REV_NO = @RefEstRevNo
      AND PROJECT_NO = @RefEstProjectNo
      AND BUDGET_ORDER_NO = BD.BUDGET_ORDER_NO),0) +
      ISNULL((SELECT ISNULL(M7,0)+ISNULL(M8,0)+ISNULL(M9,0)
      FROM BG_T_UPLOAD_DATA
      WHERE BUDGET_YEAR = (@BudgetYear-1)
      AND PERIOD_TYPE = 2
      AND PROJECT_NO = @RefEstProjectNo
      AND DATA_TYPE = 2
      AND BUDGET_ORDER_NO = BD.BUDGET_ORDER_NO),0)) AS IMP2

      FROM
      BG_T_BUDGET_DATA AS BD
      LEFT JOIN BG_M_BUDGET_ORDER AS BO ON BD.BUDGET_ORDER_NO = BO.BUDGET_ORDER_NO
      LEFT JOIN BG_M_ACCOUNT AS AC ON BO.ACCOUNT_NO = AC.ACCOUNT_NO
      LEFT JOIN BG_M_DEPT AS DP ON BO.DEPT_NO = DP.DEPT_NO
      LEFT JOIN BG_M_PERSON_IN_CHARGE AS PIC ON BO.PERSON_IN_CHARGE_NO = PIC.PERSON_IN_CHARGE_NO
      --LEFT JOIN BG_T_BUDGET_DATA AS MTP ON BD.BUDGET_ORDER_NO = MTP.BUDGET_ORDER_NO AND MTP.BUDGET_YEAR=(@BudgetYear-1) AND MTP.PERIOD_TYPE = 10 AND MTP.PROJECT_NO = @MtpProjectNo AND MTP.REV_NO = '@MtpRevNo'
      LEFT JOIN BG_T_BUDGET_DATA AS MTP ON BD.BUDGET_ORDER_NO = MTP.BUDGET_ORDER_NO AND MTP.BUDGET_YEAR=@RefBudgetYear AND MTP.PERIOD_TYPE = @RefPeriodType AND MTP.PROJECT_NO = @RefProjectNo AND MTP.REV_NO = @RefRevNo

      WHERE
      BD.BUDGET_YEAR = @BudgetYear AND BD.PERIOD_TYPE = @PeriodType AND BO.BUDGET_TYPE = '@BudgetType' AND BD.REV_NO = @RevNo AND BD.PROJECT_NO = @ProjectNo AND
      BO.PERSON_IN_CHARGE_NO = '@UserPIC' AND BO.ACTIVE_FLAG = 1
      AND BD.BUDGET_ORDER_NO NOT IN
      (
      SELECT BUDGET_ORDER_NO
      FROM [dbo].[BG_T_BUDGET_DATA_REINPUT]
      WHERE BUDGET_YEAR = @BudgetYear
      AND PERIOD_TYPE = @PeriodType
      AND REV_NO = @RevNo
      AND PROJECT_NO = @ProjectNo
      )
      ORDER BY BD.BUDGET_ORDER_NO
    </SELECT001>
    <SELECT001_1>
      SELECT
      BD.*,
      (BD.M1+BD.M2+BD.M3+BD.M4+BD.M5+BD.M6) AS H1,
      (BD.M7+BD.M8+BD.M9+BD.M10+BD.M11+BD.M12) AS H2,
      (BD.M1+BD.M2+BD.M3+BD.M4+BD.M5+BD.M6+BD.M7+BD.M8+BD.M9+BD.M10+BD.M11+BD.M12) AS Y1,
      BO.BUDGET_ORDER_NAME,
      AC.ACCOUNT_NO, AC.ACCOUNT_NAME,
      BO.COST, BO.COST_TYPE, DP.DEPT_NO, DP.DEPT_NAME,
      PIC.PERSON_IN_CHARGE_NO, PIC.PERSON_IN_CHARGE_NAME,
      ISNULL(MTP.RRT2,0) AS MTP_RRT1,

      --(ISNULL((SELECT ISNULL(ISNULL(M10,0)+ISNULL(M11,0)+ISNULL(M12,0),0)
      --FROM BG_T_BUDGET_DATA
      --WHERE BUDGET_YEAR = (@BudgetYear-1)
      --AND PERIOD_TYPE = 2
      --AND REV_NO = (SELECT MAX(REV_NO) AS REV_NO FROM BG_T_BUDGET_DATA WHERE BUDGET_YEAR = (@BudgetYear-1) AND PERIOD_TYPE = 2 AND PROJECT_NO = @ProjectNo)
      --AND PROJECT_NO = @ProjectNo
      --AND BUDGET_ORDER_NO = BD.BUDGET_ORDER_NO),0)+
      --ISNULL((SELECT ISNULL(M7,0)+ISNULL(M8,0)+ISNULL(M9,0)
      --FROM BG_T_UPLOAD_DATA
      --WHERE BUDGET_YEAR = (@BudgetYear-1)
      --AND PERIOD_TYPE = 2
      --AND PROJECT_NO = @ProjectNo
      --AND DATA_TYPE = 2
      --AND BUDGET_ORDER_NO = BD.BUDGET_ORDER_NO),0)) AS IMP2
      (ISNULL((SELECT ISNULL(ISNULL(M10,0)+ISNULL(M11,0)+ISNULL(M12,0),0)
      FROM BG_T_BUDGET_DATA
      WHERE BUDGET_YEAR = (@BudgetYear-1)
      AND PERIOD_TYPE = 2
      AND REV_NO = @RefEstRevNo
      AND PROJECT_NO = @RefEstProjectNo
      AND BUDGET_ORDER_NO = BD.BUDGET_ORDER_NO),0) +
      ISNULL((SELECT ISNULL(M7,0)+ISNULL(M8,0)+ISNULL(M9,0)
      FROM BG_T_UPLOAD_DATA
      WHERE BUDGET_YEAR = (@BudgetYear-1)
      AND PERIOD_TYPE = 2
      AND PROJECT_NO = @RefEstProjectNo
      AND DATA_TYPE = 2
      AND BUDGET_ORDER_NO = BD.BUDGET_ORDER_NO),0)) AS IMP2

      FROM
      BG_T_BUDGET_DATA AS BD
      LEFT JOIN BG_M_BUDGET_ORDER AS BO ON BD.BUDGET_ORDER_NO = BO.BUDGET_ORDER_NO
      LEFT JOIN BG_M_ACCOUNT AS AC ON BO.ACCOUNT_NO = AC.ACCOUNT_NO
      LEFT JOIN BG_M_DEPT AS DP ON BO.DEPT_NO = DP.DEPT_NO
      LEFT JOIN BG_M_PERSON_IN_CHARGE AS PIC ON BO.PERSON_IN_CHARGE_NO = PIC.PERSON_IN_CHARGE_NO
      --LEFT JOIN BG_T_BUDGET_DATA AS MTP ON BD.BUDGET_ORDER_NO = MTP.BUDGET_ORDER_NO AND MTP.BUDGET_YEAR=(@BudgetYear-1) AND MTP.PERIOD_TYPE = 10 AND MTP.PROJECT_NO = @MtpProjectNo AND MTP.REV_NO = '@MtpRevNo'
      LEFT JOIN BG_T_BUDGET_DATA AS MTP ON BD.BUDGET_ORDER_NO = MTP.BUDGET_ORDER_NO AND MTP.BUDGET_YEAR=@RefBudgetYear AND MTP.PERIOD_TYPE = @RefPeriodType AND MTP.PROJECT_NO = @RefProjectNo AND MTP.REV_NO = @RefRevNo

      WHERE
      BD.BUDGET_YEAR = @BudgetYear AND BD.PERIOD_TYPE = @PeriodType AND BO.BUDGET_TYPE = '@BudgetType' AND BD.REV_NO = @RevNo AND BD.PROJECT_NO = @ProjectNo AND
      BO.PERSON_IN_CHARGE_NO = '@UserPIC' AND BO.ACTIVE_FLAG = 1
      ORDER BY BD.BUDGET_ORDER_NO
    </SELECT001_1>
    <SELECT002>
      SELECT
      BD.*,
      (BD.M1+BD.M2+BD.M3+BD.M4+BD.M5+BD.M6) AS H1,
      (BD.M7+BD.M8+BD.M9+BD.M10+BD.M11+BD.M12) AS H2,
      (BD.M1+BD.M2+BD.M3+BD.M4+BD.M5+BD.M6+BD.M7+BD.M8+BD.M9+BD.M10+BD.M11+BD.M12) AS Y1,
      BO.BUDGET_ORDER_NAME,
      AC.ACCOUNT_NO, AC.ACCOUNT_NAME,
      BO.COST, BO.COST_TYPE, DP.DEPT_NO, DP.DEPT_NAME,
      PIC.PERSON_IN_CHARGE_NO, PIC.PERSON_IN_CHARGE_NAME,
      ISNULL(MTP.RRT2,0) AS MTP_RRT1
      FROM
      BG_T_BUDGET_DATA AS BD
      LEFT JOIN BG_M_BUDGET_ORDER AS BO ON BD.BUDGET_ORDER_NO = BO.BUDGET_ORDER_NO
      LEFT JOIN BG_M_ACCOUNT AS AC ON BO.ACCOUNT_NO = AC.ACCOUNT_NO
      LEFT JOIN BG_M_DEPT AS DP ON BO.DEPT_NO = DP.DEPT_NO
      LEFT JOIN BG_M_PERSON_IN_CHARGE AS PIC ON BO.PERSON_IN_CHARGE_NO = PIC.PERSON_IN_CHARGE_NO
      --LEFT JOIN BG_T_BUDGET_DATA AS MTP ON BD.BUDGET_ORDER_NO = MTP.BUDGET_ORDER_NO AND MTP.BUDGET_YEAR=(@BudgetYear-1) AND MTP.PERIOD_TYPE = 10 AND MTP.PROJECT_NO = @MtpProjectNo AND MTP.REV_NO = '@MtpRevNo'
      LEFT JOIN BG_T_BUDGET_DATA AS MTP ON BD.BUDGET_ORDER_NO = MTP.BUDGET_ORDER_NO AND MTP.BUDGET_YEAR=@RefBudgetYear AND MTP.PERIOD_TYPE = @RefPeriodType AND MTP.PROJECT_NO = @RefProjectNo AND MTP.REV_NO = @RefRevNo
      WHERE
      BD.BUDGET_YEAR = @BudgetYear AND BD.PERIOD_TYPE = @PeriodType AND BO.BUDGET_TYPE = '@BudgetType' AND BD.REV_NO = @RevNo AND BD.PROJECT_NO = @ProjectNo AND
      BO.ACTIVE_FLAG = 1
      AND BD.BUDGET_ORDER_NO NOT IN
      (
      SELECT BUDGET_ORDER_NO
      FROM [dbo].[BG_T_BUDGET_DATA_REINPUT]
      WHERE BUDGET_YEAR = @BudgetYear
      AND PERIOD_TYPE = @PeriodType
      AND REV_NO = @RevNo
      AND PROJECT_NO = @ProjectNo
      )
      ORDER BY BD.BUDGET_ORDER_NO
    </SELECT002>
    <SELECT003>
      SELECT MAX(BD.REV_NO) FROM BG_T_BUDGET_DATA AS BD
      WHERE BD.BUDGET_YEAR = @BudgetYear AND BD.PERIOD_TYPE = @PeriodType AND BD.PROJECT_NO = @ProjectNo
    </SELECT003>
    <SELECT004_1>
      SELECT MAX_REV.*,
      ISNULL(ACTUAL_DATA.H1, 0) AS ACTUAL_FIRST_HALF,

      --ISNULL(MAX_REV.REVISE_SECOND_HALF, 0) AS REVISE_SECOND_HALF,

      ISNULL(MASTER_DATA.M1, 0) AS M1, ISNULL(MASTER_DATA.M2, 0) AS M2, ISNULL(MASTER_DATA.M3, 0) AS M3,
      ISNULL(MASTER_DATA.M4, 0) AS M4, ISNULL(MASTER_DATA.M5, 0) AS M5, ISNULL(MASTER_DATA.M6, 0) AS M6,
      (ISNULL(MASTER_DATA.M1, 0) + ISNULL(MASTER_DATA.M2, 0) + ISNULL(MASTER_DATA.M3, 0) + ISNULL(MASTER_DATA.M4, 0) + ISNULL(MASTER_DATA.M5,0) + ISNULL(MASTER_DATA.M6, 0)) AS FIRST_HALF_SUM,
      (ISNULL(MASTER_DATA.M7, 0) + ISNULL(MASTER_DATA.M8, 0) + ISNULL(MASTER_DATA.M9, 0) + ISNULL(MASTER_DATA.M10, 0) + ISNULL(MASTER_DATA.M11, 0)+ ISNULL(MASTER_DATA.M12, 0)) AS SECOND_HALF_SUM,
      (ISNULL(MASTER_DATA.M1, 0) + ISNULL(MASTER_DATA.M2, 0) + ISNULL(MASTER_DATA.M3, 0) + ISNULL(MASTER_DATA.M4, 0) + ISNULL(MASTER_DATA.M5,0) + ISNULL(MASTER_DATA.M6, 0) + ISNULL(MASTER_DATA.M7, 0) + ISNULL(MASTER_DATA.M8, 0) + ISNULL(MASTER_DATA.M9, 0) + ISNULL(MASTER_DATA.M10, 0) + ISNULL(MASTER_DATA.M11, 0)+ ISNULL(MASTER_DATA.M12, 0)) AS YEAR_SUM,

      (ISNULL(ACTUAL_DATA.H1, 0) + ISNULL(MAX_REV.REVISE_SECOND_HALF, 0)) AS LAST_YEAR_SUM,

      (ISNULL(MASTER_DATA.M1, 0) + ISNULL(MASTER_DATA.M2, 0) + ISNULL(MASTER_DATA.M3, 0) + ISNULL(MASTER_DATA.M4, 0) + ISNULL(MASTER_DATA.M5,0) + ISNULL(MASTER_DATA.M6, 0) + ISNULL(MASTER_DATA.M7, 0) + ISNULL(MASTER_DATA.M8, 0) + ISNULL(MASTER_DATA.M9, 0) + ISNULL(MASTER_DATA.M10, 0) + ISNULL(MASTER_DATA.M11, 0)+ ISNULL(MASTER_DATA.M12, 0)) - (ISNULL(ACTUAL_DATA.H1, 0) + ISNULL(MAX_REV.REVISE_SECOND_HALF, 0)) AS DIFF_YEAR,
      CASE WHEN MAX_REV.COST_TYPE = 1 THEN ISNULL(ACTUAL_DATA.H1, 0) ELSE 0 END AS ACTUAL_FIRST_HALF_FIXCOST,
      CASE WHEN MAX_REV.COST_TYPE = 2 THEN ISNULL(ACTUAL_DATA.H1, 0) ELSE 0 END AS ACTUAL_FIRST_HALF_VARIABLECOST,
      CASE WHEN MAX_REV.COST_TYPE = 1 THEN ISNULL(MAX_REV.REVISE_SECOND_HALF, 0) ELSE 0 END AS REVISE_SECOND_HALF_FIXCOST,
      CASE WHEN MAX_REV.COST_TYPE = 2 THEN ISNULL(MAX_REV.REVISE_SECOND_HALF, 0) ELSE 0 END AS REVISE_SECOND_HALF_VARIABLECOST,
      CASE WHEN MAX_REV.COST_TYPE = 1 THEN ISNULL(MASTER_DATA.M1, 0) ELSE 0 END AS M1_FIXCOST,
      CASE WHEN MAX_REV.COST_TYPE = 2 THEN ISNULL(MASTER_DATA.M1, 0) ELSE 0 END AS M1_VARIABLECOST,
      CASE WHEN MAX_REV.COST_TYPE = 1 THEN ISNULL(MASTER_DATA.M2, 0) ELSE 0 END AS M2_FIXCOST,
      CASE WHEN MAX_REV.COST_TYPE = 2 THEN ISNULL(MASTER_DATA.M2, 0) ELSE 0 END AS M2_VARIABLECOST,
      CASE WHEN MAX_REV.COST_TYPE = 1 THEN ISNULL(MASTER_DATA.M3, 0) ELSE 0 END AS M3_FIXCOST,
      CASE WHEN MAX_REV.COST_TYPE = 2 THEN ISNULL(MASTER_DATA.M3, 0) ELSE 0 END AS M3_VARIABLECOST,
      CASE WHEN MAX_REV.COST_TYPE = 1 THEN ISNULL(MASTER_DATA.M4, 0) ELSE 0 END AS M4_FIXCOST,
      CASE WHEN MAX_REV.COST_TYPE = 2 THEN ISNULL(MASTER_DATA.M4, 0) ELSE 0 END AS M4_VARIABLECOST,
      CASE WHEN MAX_REV.COST_TYPE = 1 THEN ISNULL(MASTER_DATA.M5, 0) ELSE 0 END AS M5_FIXCOST,
      CASE WHEN MAX_REV.COST_TYPE = 2 THEN ISNULL(MASTER_DATA.M5, 0) ELSE 0 END AS M5_VARIABLECOST,
      CASE WHEN MAX_REV.COST_TYPE = 1 THEN ISNULL(MASTER_DATA.M6, 0) ELSE 0 END AS M6_FIXCOST,
      CASE WHEN MAX_REV.COST_TYPE = 2 THEN ISNULL(MASTER_DATA.M6, 0) ELSE 0 END AS M6_VARIABLECOST,
      CASE WHEN MAX_REV.COST_TYPE = 1 THEN (ISNULL(MASTER_DATA.M1, 0) + ISNULL(MASTER_DATA.M2, 0) + ISNULL(MASTER_DATA.M3, 0) + ISNULL(MASTER_DATA.M4, 0) + ISNULL(MASTER_DATA.M5,0) + ISNULL(MASTER_DATA.M6, 0)) ELSE 0 END AS FIRST_HALF_FIXCOST,
      CASE WHEN MAX_REV.COST_TYPE = 2 THEN (ISNULL(MASTER_DATA.M1, 0) + ISNULL(MASTER_DATA.M2, 0) + ISNULL(MASTER_DATA.M3, 0) + ISNULL(MASTER_DATA.M4, 0) + ISNULL(MASTER_DATA.M5,0) + ISNULL(MASTER_DATA.M6, 0)) ELSE 0 END AS FIRST_HALF_VARIABLECOST,
      CASE WHEN MAX_REV.COST_TYPE = 1 THEN (ISNULL(MASTER_DATA.M7, 0) + ISNULL(MASTER_DATA.M8, 0) + ISNULL(MASTER_DATA.M9, 0) + ISNULL(MASTER_DATA.M10, 0) + ISNULL(MASTER_DATA.M11, 0)+ ISNULL(MASTER_DATA.M12, 0)) ELSE 0 END AS SECOND_HALF_FIXCOST,
      CASE WHEN MAX_REV.COST_TYPE = 2 THEN (ISNULL(MASTER_DATA.M7, 0) + ISNULL(MASTER_DATA.M8, 0) + ISNULL(MASTER_DATA.M9, 0) + ISNULL(MASTER_DATA.M10, 0) + ISNULL(MASTER_DATA.M11, 0)+ ISNULL(MASTER_DATA.M12, 0)) ELSE 0 END AS SECOND_HALF_VARIABLECOST,
      CASE WHEN MAX_REV.COST_TYPE = 1 THEN (ISNULL(MASTER_DATA.M1, 0) + ISNULL(MASTER_DATA.M2, 0) + ISNULL(MASTER_DATA.M3, 0) + ISNULL(MASTER_DATA.M4, 0) + ISNULL(MASTER_DATA.M5,0) + ISNULL(MASTER_DATA.M6, 0) + ISNULL(MASTER_DATA.M7, 0) + ISNULL(MASTER_DATA.M8, 0) + ISNULL(MASTER_DATA.M9, 0) + ISNULL(MASTER_DATA.M10, 0) + ISNULL(MASTER_DATA.M11, 0)+ ISNULL(MASTER_DATA.M12, 0)) ELSE 0 END AS YEAR_FIXCOST,
      CASE WHEN MAX_REV.COST_TYPE = 2 THEN (ISNULL(MASTER_DATA.M1, 0) + ISNULL(MASTER_DATA.M2, 0) + ISNULL(MASTER_DATA.M3, 0) + ISNULL(MASTER_DATA.M4, 0) + ISNULL(MASTER_DATA.M5,0) + ISNULL(MASTER_DATA.M6, 0) + ISNULL(MASTER_DATA.M7, 0) + ISNULL(MASTER_DATA.M8, 0) + ISNULL(MASTER_DATA.M9, 0) + ISNULL(MASTER_DATA.M10, 0) + ISNULL(MASTER_DATA.M11, 0)+ ISNULL(MASTER_DATA.M12, 0)) ELSE 0 END AS YEAR_VARIABLECOST,
      CASE WHEN MAX_REV.COST_TYPE = 1 THEN (ISNULL(ACTUAL_DATA.H1, 0) + ISNULL(MAX_REV.REVISE_SECOND_HALF, 0)) ELSE 0 END AS LAST_YEAR_SUM_FIXCOST,
      CASE WHEN MAX_REV.COST_TYPE = 2 THEN (ISNULL(ACTUAL_DATA.H1, 0) + ISNULL(MAX_REV.REVISE_SECOND_HALF, 0)) ELSE 0 END AS LAST_YEAR_SUM_VARIABLECOST,
      CASE WHEN MAX_REV.COST_TYPE = 1 THEN (ISNULL(MASTER_DATA.M1, 0) + ISNULL(MASTER_DATA.M2, 0) + ISNULL(MASTER_DATA.M3, 0) + ISNULL(MASTER_DATA.M4, 0) + ISNULL(MASTER_DATA.M5,0) + ISNULL(MASTER_DATA.M6, 0) + ISNULL(MASTER_DATA.M7, 0) + ISNULL(MASTER_DATA.M8, 0) + ISNULL(MASTER_DATA.M9, 0) + ISNULL(MASTER_DATA.M10, 0) + ISNULL(MASTER_DATA.M11, 0)+ ISNULL(MASTER_DATA.M12, 0)) - (ISNULL(ACTUAL_DATA.H1, 0) + ISNULL(MAX_REV.REVISE_SECOND_HALF, 0)) ELSE 0 END AS DIFF_YEAR_FIXCOST,
      CASE WHEN MAX_REV.COST_TYPE = 2 THEN (ISNULL(MASTER_DATA.M1, 0) + ISNULL(MASTER_DATA.M2, 0) + ISNULL(MASTER_DATA.M3, 0) + ISNULL(MASTER_DATA.M4, 0) + ISNULL(MASTER_DATA.M5,0) + ISNULL(MASTER_DATA.M6, 0) + ISNULL(MASTER_DATA.M7, 0) + ISNULL(MASTER_DATA.M8, 0) + ISNULL(MASTER_DATA.M9, 0) + ISNULL(MASTER_DATA.M10, 0) + ISNULL(MASTER_DATA.M11, 0)+ ISNULL(MASTER_DATA.M12, 0)) - (ISNULL(ACTUAL_DATA.H1, 0) + ISNULL(MAX_REV.REVISE_SECOND_HALF, 0)) ELSE 0 END AS DIFF_YEAR_VARIABLECOST
      ,ISNULL(MTP.RRT2,0) AS MTP_RRT1
      ,CASE WHEN MAX_REV.COST_TYPE = 2 THEN ISNULL(MTP.RRT2,0) ELSE 0 END AS MTP_RRT1_VARIABLECOST
      ,CASE WHEN MAX_REV.COST_TYPE = 1 THEN ISNULL(MTP.RRT2,0) ELSE 0 END AS MTP_RRT1_FIXCOST
      ,(ISNULL(MASTER_DATA.M1, 0) + ISNULL(MASTER_DATA.M2, 0) + ISNULL(MASTER_DATA.M3, 0) + ISNULL(MASTER_DATA.M4, 0) + ISNULL(MASTER_DATA.M5,0) + ISNULL(MASTER_DATA.M6, 0) + ISNULL(MASTER_DATA.M7, 0) + ISNULL(MASTER_DATA.M8, 0) + ISNULL(MASTER_DATA.M9, 0) + ISNULL(MASTER_DATA.M10, 0) + ISNULL(MASTER_DATA.M11, 0)+ ISNULL(MASTER_DATA.M12, 0)) - (ISNULL(MTP.RRT2,0)) AS DIFF_MTP
      ,CASE WHEN MAX_REV.COST_TYPE = 1 THEN (ISNULL(MASTER_DATA.M1, 0) + ISNULL(MASTER_DATA.M2, 0) + ISNULL(MASTER_DATA.M3, 0) + ISNULL(MASTER_DATA.M4, 0) + ISNULL(MASTER_DATA.M5,0) + ISNULL(MASTER_DATA.M6, 0) + ISNULL(MASTER_DATA.M7, 0) + ISNULL(MASTER_DATA.M8, 0) + ISNULL(MASTER_DATA.M9, 0) + ISNULL(MASTER_DATA.M10, 0) + ISNULL(MASTER_DATA.M11, 0)+ ISNULL(MASTER_DATA.M12, 0)) - (ISNULL(MTP.RRT2,0)) ELSE 0 END AS DIFF_MTP_FIXCOST
      ,CASE WHEN MAX_REV.COST_TYPE = 2 THEN (ISNULL(MASTER_DATA.M1, 0) + ISNULL(MASTER_DATA.M2, 0) + ISNULL(MASTER_DATA.M3, 0) + ISNULL(MASTER_DATA.M4, 0) + ISNULL(MASTER_DATA.M5,0) + ISNULL(MASTER_DATA.M6, 0) + ISNULL(MASTER_DATA.M7, 0) + ISNULL(MASTER_DATA.M8, 0) + ISNULL(MASTER_DATA.M9, 0) + ISNULL(MASTER_DATA.M10, 0) + ISNULL(MASTER_DATA.M11, 0)+ ISNULL(MASTER_DATA.M12, 0)) - (ISNULL(MTP.RRT2,0)) ELSE 0 END AS DIFF_MTP_VARIABLECOST

      ,ISNULL(MASTER_DATA.M7, 0) AS M7, ISNULL(MASTER_DATA.M8, 0) AS M8, ISNULL(MASTER_DATA.M9, 0) AS M9,
      ISNULL(MASTER_DATA.M10, 0) AS M10, ISNULL(MASTER_DATA.M11, 0) AS M11, ISNULL(MASTER_DATA.M12, 0) AS M12

      ,CASE WHEN MAX_REV.COST_TYPE = 1 THEN ISNULL(MASTER_DATA.M7, 0) ELSE 0 END AS M7_FIXCOST,
      CASE WHEN MAX_REV.COST_TYPE = 2 THEN ISNULL(MASTER_DATA.M7, 0) ELSE 0 END AS M7_VARIABLECOST,
      CASE WHEN MAX_REV.COST_TYPE = 1 THEN ISNULL(MASTER_DATA.M8, 0) ELSE 0 END AS M8_FIXCOST,
      CASE WHEN MAX_REV.COST_TYPE = 2 THEN ISNULL(MASTER_DATA.M8, 0) ELSE 0 END AS M8_VARIABLECOST,
      CASE WHEN MAX_REV.COST_TYPE = 1 THEN ISNULL(MASTER_DATA.M9, 0) ELSE 0 END AS M9_FIXCOST,
      CASE WHEN MAX_REV.COST_TYPE = 2 THEN ISNULL(MASTER_DATA.M9, 0) ELSE 0 END AS M9_VARIABLECOST,
      CASE WHEN MAX_REV.COST_TYPE = 1 THEN ISNULL(MASTER_DATA.M10, 0) ELSE 0 END AS M10_FIXCOST,
      CASE WHEN MAX_REV.COST_TYPE = 2 THEN ISNULL(MASTER_DATA.M10, 0) ELSE 0 END AS M10_VARIABLECOST,
      CASE WHEN MAX_REV.COST_TYPE = 1 THEN ISNULL(MASTER_DATA.M11, 0) ELSE 0 END AS M11_FIXCOST,
      CASE WHEN MAX_REV.COST_TYPE = 2 THEN ISNULL(MASTER_DATA.M11, 0) ELSE 0 END AS M11_VARIABLECOST,
      CASE WHEN MAX_REV.COST_TYPE = 1 THEN ISNULL(MASTER_DATA.M12, 0) ELSE 0 END AS M12_FIXCOST,
      CASE WHEN MAX_REV.COST_TYPE = 2 THEN ISNULL(MASTER_DATA.M12, 0) ELSE 0 END AS M12_VARIABLECOST

      FROM (
      SELECT BUDGET_DATA.BUDGET_ORDER_NO, BUDGET_DATA.BUDGET_YEAR, BUDGET_ORDER.COST_TYPE,
      BUDGET_DATA.PERIOD_TYPE, BUDGET_DATA.PROJECT_NO, MAX(BUDGET_DATA.REV_NO) AS REV_NO, BUDGET_ORDER.BUDGET_ORDER_NAME,
      BUDGET_ORDER.DEPT_NO, BUDGET_ORDER.PERSON_IN_CHARGE_NO AS PERSON_IN_CHARGE, PIC.PERSON_IN_CHARGE_NAME

      ,ISNULL((SELECT ISNULL(ISNULL(M10,0)+ISNULL(M11,0)+ISNULL(M12,0),0)
      FROM BG_T_BUDGET_DATA
      WHERE BUDGET_YEAR = (@YEAR-1)
      AND PERIOD_TYPE = 2
      --AND REV_NO = (SELECT MAX(REV_NO) AS REV_NO FROM BG_T_BUDGET_DATA WHERE BUDGET_YEAR = (@YEAR-1) AND PERIOD_TYPE = 2 AND PROJECT_NO = @PROJECTNO)
      --AND PROJECT_NO = @PROJECTNO
      AND REV_NO = @RefEstRevNo
      AND PROJECT_NO = @RefEstProjectNo
      AND BUDGET_ORDER_NO = BUDGET_DATA.BUDGET_ORDER_NO),0)+
      ISNULL((SELECT ISNULL(M7,0)+ISNULL(M8,0)+ISNULL(M9,0)
      FROM BG_T_UPLOAD_DATA
      WHERE BUDGET_YEAR = (@YEAR-1)
      AND PERIOD_TYPE = 2
      AND PROJECT_NO = @PROJECTNO
      AND DATA_TYPE = 2
      AND BUDGET_ORDER_NO = BUDGET_DATA.BUDGET_ORDER_NO),0) AS REVISE_SECOND_HALF

      FROM BG_T_BUDGET_DATA AS BUDGET_DATA
      INNER JOIN BG_M_BUDGET_ORDER AS BUDGET_ORDER
      ON BUDGET_ORDER.BUDGET_ORDER_NO = BUDGET_DATA.BUDGET_ORDER_NO AND BUDGET_ORDER.BUDGET_TYPE = 'E' AND BUDGET_ORDER.ACTIVE_FLAG = 1
      INNER JOIN BG_M_PERSON_IN_CHARGE AS PIC
      ON PIC.PERSON_IN_CHARGE_NO = BUDGET_ORDER.PERSON_IN_CHARGE_NO
      WHERE BUDGET_DATA.BUDGET_YEAR = @YEAR
      AND BUDGET_DATA.PERIOD_TYPE = @PERIOD
      AND BUDGET_DATA.PROJECT_NO = @PROJECTNO
      @PICCONDITION
      GROUP BY BUDGET_DATA.BUDGET_ORDER_NO, BUDGET_DATA.BUDGET_YEAR, BUDGET_DATA.PERIOD_TYPE, BUDGET_DATA.PROJECT_NO, BUDGET_ORDER.BUDGET_ORDER_NAME, BUDGET_ORDER.DEPT_NO, BUDGET_ORDER.COST_TYPE,
      BUDGET_ORDER.PERSON_IN_CHARGE_NO, PIC.PERSON_IN_CHARGE_NAME) AS MAX_REV

      INNER JOIN BG_T_BUDGET_DATA AS MASTER_DATA
      ON MAX_REV.BUDGET_YEAR = MASTER_DATA.BUDGET_YEAR
      AND MAX_REV.PERIOD_TYPE = MASTER_DATA.PERIOD_TYPE
      AND MAX_REV.PROJECT_NO = MASTER_DATA.PROJECT_NO
      AND MAX_REV.BUDGET_ORDER_NO = MASTER_DATA.BUDGET_ORDER_NO
      AND MAX_REV.REV_NO = MASTER_DATA.REV_NO

      LEFT OUTER JOIN BG_T_UPLOAD_DATA AS ACTUAL_DATA
      ON ACTUAL_DATA.BUDGET_YEAR = MAX_REV.BUDGET_YEAR - 1
      AND ACTUAL_DATA.PERIOD_TYPE = @PERIOD
      AND ACTUAL_DATA.PROJECT_NO = @PROJECTNO
      AND ACTUAL_DATA.BUDGET_ORDER_NO = MAX_REV.BUDGET_ORDER_NO
      AND ACTUAL_DATA.DATA_TYPE = 2

      LEFT OUTER JOIN BG_T_UPLOAD_DATA AS REVISE_DATA
      ON REVISE_DATA.BUDGET_YEAR = MAX_REV.BUDGET_YEAR - 1
      AND REVISE_DATA.PERIOD_TYPE = @PERIOD
      AND REVISE_DATA.PROJECT_NO = @PROJECTNO
      AND REVISE_DATA.BUDGET_ORDER_NO = MAX_REV.BUDGET_ORDER_NO
      AND REVISE_DATA.DATA_TYPE = 1

      LEFT JOIN BG_T_BUDGET_DATA AS MTP
      ON MAX_REV.BUDGET_ORDER_NO = MTP.BUDGET_ORDER_NO
      AND MTP.BUDGET_YEAR=(@YEAR-2)
      AND MTP.PERIOD_TYPE = 10
      AND MTP.PROJECT_NO = @MtpProjectNo
      AND MTP.REV_NO = @MtpRevNo
      --AND MTP.REV_NO = (SELECT ISNULL(MAX(REV_NO),1) AS MAX_REV_NO FROM BG_T_BUDGET_HEADER
      --WHERE BUDGET_YEAR = (@YEAR-1)
      --AND PERIOD_TYPE = 10 AND BUDGET_TYPE = 'E' AND PROJECT_NO = @MtpProjectNo)

      WHERE ACTUAL_DATA.H1 &lt;&gt; 0 OR MAX_REV.REVISE_SECOND_HALF &lt;&gt; 0 OR (ISNULL(MASTER_DATA.M1, 0) &lt;&gt; 0
      OR ISNULL(MASTER_DATA.M2, 0) &lt;&gt; 0 OR ISNULL(MASTER_DATA.M3, 0) &lt;&gt; 0
      OR ISNULL(MASTER_DATA.M4, 0) &lt;&gt; 0 OR ISNULL(MASTER_DATA.M5, 0) &lt;&gt; 0 OR ISNULL(MASTER_DATA.M6, 0) &lt;&gt; 0
      OR ISNULL(MASTER_DATA.M7, 0) &lt;&gt; 0 OR ISNULL(MASTER_DATA.M8, 0) &lt;&gt; 0 OR ISNULL(MASTER_DATA.M9, 0) &lt;&gt; 0
      OR ISNULL(MTP.RRT2,0) &lt;&gt; 0
      OR ISNULL(MASTER_DATA.M10, 0) &lt;&gt; 0 OR ISNULL(MASTER_DATA.M11, 0) &lt;&gt; 0 OR ISNULL(MASTER_DATA.M12, 0) &lt;&gt; 0)
      ORDER BY MAX_REV.BUDGET_ORDER_NO
    </SELECT004_1>
    <SELECT004_2>
      SELECT MAX_REV.*, ISNULL(ACTUAL_DATA.M7, 0) AS M7, ISNULL(ACTUAL_DATA.M8, 0) AS M8,
      ISNULL(ACTUAL_DATA.M9, 0) AS M9, ISNULL(MASTER_DATA.M10, 0) AS M10,
      ISNULL(MASTER_DATA.M11, 0) AS M11, ISNULL(MASTER_DATA.M12, 0) AS M12,
      CASE WHEN MAX_REV.COST_TYPE = 1 THEN ISNULL(ACTUAL_DATA.M7, 0) ELSE 0 END AS M7_FIXCOST,
      CASE WHEN MAX_REV.COST_TYPE = 2 THEN ISNULL(ACTUAL_DATA.M7, 0) ELSE 0 END AS M7_VARIABLECOST,
      CASE WHEN MAX_REV.COST_TYPE = 1 THEN ISNULL(ACTUAL_DATA.M8, 0) ELSE 0 END AS M8_FIXCOST,
      CASE WHEN MAX_REV.COST_TYPE = 2 THEN ISNULL(ACTUAL_DATA.M8, 0) ELSE 0 END AS M8_VARIABLECOST,
      CASE WHEN MAX_REV.COST_TYPE = 1 THEN ISNULL(ACTUAL_DATA.M9, 0) ELSE 0 END AS M9_FIXCOST,
      CASE WHEN MAX_REV.COST_TYPE = 2 THEN ISNULL(ACTUAL_DATA.M9, 0) ELSE 0 END AS M9_VARIABLECOST,
      CASE WHEN MAX_REV.COST_TYPE = 1 THEN ISNULL(MASTER_DATA.M10, 0) ELSE 0 END AS M10_FIXCOST,
      CASE WHEN MAX_REV.COST_TYPE = 2 THEN ISNULL(MASTER_DATA.M10, 0) ELSE 0 END AS M10_VARIABLECOST,
      CASE WHEN MAX_REV.COST_TYPE = 1 THEN ISNULL(MASTER_DATA.M11, 0) ELSE 0 END AS M11_FIXCOST,
      CASE WHEN MAX_REV.COST_TYPE = 2 THEN ISNULL(MASTER_DATA.M11, 0) ELSE 0 END AS M11_VARIABLECOST,
      CASE WHEN MAX_REV.COST_TYPE = 1 THEN ISNULL(MASTER_DATA.M12, 0) ELSE 0 END AS M12_FIXCOST,
      CASE WHEN MAX_REV.COST_TYPE = 2 THEN ISNULL(MASTER_DATA.M12, 0) ELSE 0 END AS M12_VARIABLECOST,
      ISNULL(ACTUAL_DATA.H1, 0)  AS ACTUAL_FIRST_HALF,
      (ISNULL(REVISE_BUDGET.M7, 0) + ISNULL(REVISE_BUDGET.M8, 0) + ISNULL(REVISE_BUDGET.M9, 0) + ISNULL(REVISE_BUDGET.M10, 0) + ISNULL(REVISE_BUDGET.M11,0) + ISNULL(REVISE_BUDGET.M12, 0))  AS REVISE_SECOND_HALF,
      (ISNULL(ACTUAL_DATA.M7, 0) + ISNULL(ACTUAL_DATA.M8, 0) + ISNULL(ACTUAL_DATA.M9, 0) + ISNULL(MASTER_DATA.M10, 0) + ISNULL(MASTER_DATA.M11,0) + ISNULL(MASTER_DATA.M12, 0)) AS ESTIMATE_SECOND_HALF,
      (ISNULL(ACTUAL_DATA.M7, 0) + ISNULL(ACTUAL_DATA.M8, 0) + ISNULL(ACTUAL_DATA.M9, 0) + ISNULL(MASTER_DATA.M10, 0) + ISNULL(MASTER_DATA.M11,0) + ISNULL(MASTER_DATA.M12, 0) - (ISNULL(REVISE_BUDGET.M7, 0) + ISNULL(REVISE_BUDGET.M8, 0) + ISNULL(REVISE_BUDGET.M9, 0) + ISNULL(REVISE_BUDGET.M10, 0) + ISNULL(REVISE_BUDGET.M11,0) + ISNULL(REVISE_BUDGET.M12, 0))) AS DIFFERENCE_SECOND_HALF,
      (ISNULL(ACTUAL_DATA.H1, 0) + ISNULL(ACTUAL_DATA.M7, 0) + ISNULL(ACTUAL_DATA.M8, 0) + ISNULL(ACTUAL_DATA.M9, 0) + ISNULL(MASTER_DATA.M10, 0) + ISNULL(MASTER_DATA.M11,0) + ISNULL(MASTER_DATA.M12, 0)) AS ESTIMATE_TOTAL_YEAR,
      CASE WHEN MAX_REV.COST_TYPE = 1 THEN ISNULL(ACTUAL_DATA.H1, 0) ELSE 0 END AS ACTUAL_FIRST_HALF_FIXCOST,
      CASE WHEN MAX_REV.COST_TYPE = 2 THEN ISNULL(ACTUAL_DATA.H1, 0) ELSE 0 END AS ACTUAL_FIRST_HALF_VARIABLECOST,
      CASE WHEN MAX_REV.COST_TYPE = 1 THEN (ISNULL(REVISE_BUDGET.M7, 0) + ISNULL(REVISE_BUDGET.M8, 0) + ISNULL(REVISE_BUDGET.M9, 0) + ISNULL(REVISE_BUDGET.M10, 0) + ISNULL(REVISE_BUDGET.M11,0) + ISNULL(REVISE_BUDGET.M12, 0)) ELSE 0 END AS REVISE_SECOND_HALF_FIXCOST,
      CASE WHEN MAX_REV.COST_TYPE = 2 THEN (ISNULL(REVISE_BUDGET.M7, 0) + ISNULL(REVISE_BUDGET.M8, 0) + ISNULL(REVISE_BUDGET.M9, 0) + ISNULL(REVISE_BUDGET.M10, 0) + ISNULL(REVISE_BUDGET.M11,0) + ISNULL(REVISE_BUDGET.M12, 0)) ELSE 0 END AS REVISE_SECOND_HALF_VARIABLECOST,
      CASE WHEN MAX_REV.COST_TYPE = 1 THEN (ISNULL(ACTUAL_DATA.M7, 0) + ISNULL(ACTUAL_DATA.M8, 0) + ISNULL(ACTUAL_DATA.M9, 0) + ISNULL(MASTER_DATA.M10, 0) + ISNULL(MASTER_DATA.M11,0) + ISNULL(MASTER_DATA.M12, 0)) ELSE 0 END AS ESTIMATE_SECOND_HALF_FIXCOST,
      CASE WHEN MAX_REV.COST_TYPE = 2 THEN (ISNULL(ACTUAL_DATA.M7, 0) + ISNULL(ACTUAL_DATA.M8, 0) + ISNULL(ACTUAL_DATA.M9, 0) + ISNULL(MASTER_DATA.M10, 0) + ISNULL(MASTER_DATA.M11,0) + ISNULL(MASTER_DATA.M12, 0)) ELSE 0 END AS ESTIMATE_SECOND_HALF_VARIABLECOST,
      CASE WHEN MAX_REV.COST_TYPE = 1 THEN (ISNULL(ACTUAL_DATA.M7, 0) + ISNULL(ACTUAL_DATA.M8, 0) + ISNULL(ACTUAL_DATA.M9, 0) + ISNULL(MASTER_DATA.M10, 0) + ISNULL(MASTER_DATA.M11,0) + ISNULL(MASTER_DATA.M12, 0) - (ISNULL(REVISE_BUDGET.M7, 0) + ISNULL(REVISE_BUDGET.M8, 0) + ISNULL(REVISE_BUDGET.M9, 0) + ISNULL(REVISE_BUDGET.M10, 0) + ISNULL(REVISE_BUDGET.M11,0) + ISNULL(REVISE_BUDGET.M12, 0))) ELSE 0 END AS DIFFERENCE_SECOND_HALF_FIXCOST,
      CASE WHEN MAX_REV.COST_TYPE = 2 THEN (ISNULL(ACTUAL_DATA.M7, 0) + ISNULL(ACTUAL_DATA.M8, 0) + ISNULL(ACTUAL_DATA.M9, 0) + ISNULL(MASTER_DATA.M10, 0) + ISNULL(MASTER_DATA.M11,0) + ISNULL(MASTER_DATA.M12, 0) - (ISNULL(REVISE_BUDGET.M7, 0) + ISNULL(REVISE_BUDGET.M8, 0) + ISNULL(REVISE_BUDGET.M9, 0) + ISNULL(REVISE_BUDGET.M10, 0) + ISNULL(REVISE_BUDGET.M11,0) + ISNULL(REVISE_BUDGET.M12, 0))) ELSE 0 END AS DIFFERENCE_SECOND_HALF_VARIABLECOST,
      CASE WHEN MAX_REV.COST_TYPE = 1 THEN (ISNULL(ACTUAL_DATA.H1, 0) + ISNULL(ACTUAL_DATA.M7, 0) + ISNULL(ACTUAL_DATA.M8, 0) + ISNULL(ACTUAL_DATA.M9, 0) + ISNULL(MASTER_DATA.M10, 0) + ISNULL(MASTER_DATA.M11,0) + ISNULL(MASTER_DATA.M12, 0)) ELSE 0 END AS ESTIMATE_TOTAL_YEAR_FIXCOST,
      CASE WHEN MAX_REV.COST_TYPE = 2 THEN (ISNULL(ACTUAL_DATA.H1, 0) + ISNULL(ACTUAL_DATA.M7, 0) + ISNULL(ACTUAL_DATA.M8, 0) + ISNULL(ACTUAL_DATA.M9, 0) + ISNULL(MASTER_DATA.M10, 0) + ISNULL(MASTER_DATA.M11,0) + ISNULL(MASTER_DATA.M12, 0)) ELSE 0 END AS ESTIMATE_TOTAL_YEAR_VARIABLECOST
      FROM (
      SELECT BUDGET_DATA.BUDGET_ORDER_NO, BUDGET_DATA.BUDGET_YEAR, BUDGET_ORDER.COST_TYPE,
      BUDGET_DATA.PERIOD_TYPE, BUDGET_DATA.PROJECT_NO, MAX(BUDGET_DATA.REV_NO) AS REV_NO, BUDGET_ORDER.BUDGET_ORDER_NAME,
      BUDGET_ORDER.DEPT_NO, BUDGET_ORDER.PERSON_IN_CHARGE_NO, PIC.PERSON_IN_CHARGE_NAME
      FROM BG_T_BUDGET_DATA AS BUDGET_DATA
      INNER JOIN BG_M_BUDGET_ORDER AS BUDGET_ORDER
      ON BUDGET_ORDER.BUDGET_ORDER_NO = BUDGET_DATA.BUDGET_ORDER_NO AND BUDGET_ORDER.BUDGET_TYPE = 'E' AND BUDGET_ORDER.ACTIVE_FLAG = 1
      INNER JOIN BG_M_PERSON_IN_CHARGE AS PIC
      ON PIC.PERSON_IN_CHARGE_NO = BUDGET_ORDER.PERSON_IN_CHARGE_NO
      WHERE BUDGET_DATA.BUDGET_YEAR = @YEAR
      AND BUDGET_DATA.PERIOD_TYPE = @PERIOD
      AND BUDGET_DATA.PROJECT_NO = @PROJECTNO
      @PICCONDITION
      GROUP BY BUDGET_DATA.BUDGET_ORDER_NO, BUDGET_DATA.BUDGET_YEAR, BUDGET_DATA.PERIOD_TYPE, BUDGET_DATA.PROJECT_NO, BUDGET_ORDER.BUDGET_ORDER_NAME, BUDGET_ORDER.DEPT_NO, BUDGET_ORDER.COST_TYPE,
      BUDGET_ORDER.PERSON_IN_CHARGE_NO, PIC.PERSON_IN_CHARGE_NAME) AS MAX_REV

      INNER JOIN BG_T_BUDGET_DATA AS MASTER_DATA
      ON MAX_REV.BUDGET_YEAR = MASTER_DATA.BUDGET_YEAR
      AND MASTER_DATA.PERIOD_TYPE = @PERIOD
      AND MASTER_DATA.PROJECT_NO = @PROJECTNO
      AND MAX_REV.BUDGET_ORDER_NO = MASTER_DATA.BUDGET_ORDER_NO
      AND MAX_REV.REV_NO = MASTER_DATA.REV_NO

      ---- change Revise to OB 02/05/2018
      --LEFT OUTER JOIN BG_T_UPLOAD_DATA AS REVISE_BUDGET
      --ON MAX_REV.BUDGET_YEAR = REVISE_BUDGET.BUDGET_YEAR
      ----AND REVISE_BUDGET.PERIOD_TYPE = 2
      --AND REVISE_BUDGET.PERIOD_TYPE = 1
      --AND REVISE_BUDGET.PROJECT_NO = 1
      --AND MAX_REV.BUDGET_ORDER_NO = REVISE_BUDGET.BUDGET_ORDER_NO
      --AND REVISE_BUDGET.DATA_TYPE = 1
      LEFT JOIN BG_T_BUDGET_DATA AS REVISE_BUDGET
      ON  REVISE_BUDGET.BUDGET_YEAR =  MAX_REV.BUDGET_YEAR
      AND REVISE_BUDGET.PERIOD_TYPE = 1
      AND REVISE_BUDGET.PROJECT_NO = MAX_REV.PROJECT_NO
      AND REVISE_BUDGET.BUDGET_ORDER_NO = MAX_REV.BUDGET_ORDER_NO
      AND REVISE_BUDGET.REV_NO = MAX_REV.REV_NO

      LEFT OUTER JOIN BG_T_UPLOAD_DATA AS ACTUAL_DATA
      ON ACTUAL_DATA.BUDGET_YEAR = MAX_REV.BUDGET_YEAR
      AND ACTUAL_DATA.BUDGET_ORDER_NO = MAX_REV.BUDGET_ORDER_NO
      AND ACTUAL_DATA.DATA_TYPE = 2
      AND ACTUAL_DATA.PERIOD_TYPE = @PERIOD
      AND ACTUAL_DATA.PROJECT_NO = @PROJECTNO

      WHERE ISNULL(ACTUAL_DATA.H1, 0) &lt;&gt; 0 
      OR ISNULL(REVISE_BUDGET.M7, 0) &lt;&gt; 0
      OR ISNULL(REVISE_BUDGET.M8, 0) &lt;&gt; 0
      OR ISNULL(REVISE_BUDGET.M9, 0) &lt;&gt; 0
      OR ISNULL(REVISE_BUDGET.M10, 0) &lt;&gt; 0
      OR ISNULL(REVISE_BUDGET.M11, 0) &lt;&gt; 0
      OR ISNULL(REVISE_BUDGET.M12, 0) &lt;&gt; 0
      OR ISNULL(ACTUAL_DATA.M7, 0) &lt;&gt; 0 OR ISNULL(ACTUAL_DATA.M8, 0) &lt;&gt; 0 OR
      ISNULL(ACTUAL_DATA.M9, 0) &lt;&gt; 0 OR (ISNULL(MASTER_DATA.M10, 0) &lt;&gt; 0 OR
      ISNULL(MASTER_DATA.M11, 0) &lt;&gt; 0 OR ISNULL(MASTER_DATA.M12, 0) &lt;&gt; 0)
      ORDER BY MAX_REV.BUDGET_ORDER_NO
    </SELECT004_2>
    <SELECT004_3>
      SELECT MAX_REV.*,
      --ISNULL(ORIGINAL_BUDGET.M1, 0) + ISNULL(ORIGINAL_BUDGET.M2,0) + ISNULL(ORIGINAL_BUDGET.M3,0) + ISNULL(ORIGINAL_BUDGET.M4,0) + ISNULL(ORIGINAL_BUDGET.M5,0) + ISNULL(ORIGINAL_BUDGET.M6,0) AS ORIGINAL_FIRST_HALF,
      ISNULL(ORIGINAL_BUDGET.H1,0) AS ORIGINAL_FIRST_HALF,
      ISNULL(ACTUAL_DATA.M1, 0) AS M1,
      ISNULL(ACTUAL_DATA.M2, 0) AS M2,
      ISNULL(ACTUAL_DATA.M3, 0) AS M3,
      ISNULL(MASTER_DATA.M4, 0) AS M4,
      ISNULL(MASTER_DATA.M5, 0) AS M5,
      ISNULL(MASTER_DATA.M6, 0) AS M6,
      ISNULL(ACTUAL_DATA.M1, 0) + ISNULL(ACTUAL_DATA.M2, 0) + ISNULL(ACTUAL_DATA.M3, 0) + ISNULL(MASTER_DATA.M4, 0) + ISNULL(MASTER_DATA.M5, 0) + ISNULL(MASTER_DATA.M6, 0) AS ESTIMATE_FIRST_HALF,
      ISNULL(ACTUAL_DATA.M1, 0) + ISNULL(ACTUAL_DATA.M2, 0) + ISNULL(ACTUAL_DATA.M3, 0) + ISNULL(MASTER_DATA.M4, 0) + ISNULL(MASTER_DATA.M5, 0) + ISNULL(MASTER_DATA.M6, 0) - (ISNULL(ORIGINAL_BUDGET.H1, 0)) AS DIFF_FIRST_HALF,
      ISNULL(ORIGINAL_BUDGET.H2, 0) AS ORIGINAL_SECOND_HALF,
      ISNULL(MASTER_DATA.M7, 0) AS M7, ISNULL(MASTER_DATA.M8, 0) AS M8,
      ISNULL(MASTER_DATA.M9, 0) AS M9, ISNULL(MASTER_DATA.M10, 0) AS M10,
      ISNULL(MASTER_DATA.M11, 0) AS M11, ISNULL(MASTER_DATA.M12, 0) AS M12,
      ISNULL(MASTER_DATA.M7, 0) + ISNULL(MASTER_DATA.M8, 0) + ISNULL(MASTER_DATA.M9, 0) + ISNULL(MASTER_DATA.M10, 0) + ISNULL(MASTER_DATA.M11, 0) + ISNULL(MASTER_DATA.M12, 0) AS REVISE_SECOND_HALF,
      ISNULL(MASTER_DATA.M7, 0) + ISNULL(MASTER_DATA.M8, 0) + ISNULL(MASTER_DATA.M9, 0) + ISNULL(MASTER_DATA.M10, 0) + ISNULL(MASTER_DATA.M11, 0) + ISNULL(MASTER_DATA.M12, 0) - ISNULL(ORIGINAL_BUDGET.H2, 0) AS DIFF_SECOND_HALF,
      ISNULL(ACTUAL_DATA.M1, 0) + ISNULL(ACTUAL_DATA.M2, 0) + ISNULL(ACTUAL_DATA.M3, 0) + ISNULL(MASTER_DATA.M4, 0) + ISNULL(MASTER_DATA.M5, 0) + ISNULL(MASTER_DATA.M6, 0) + ISNULL(MASTER_DATA.M7, 0) + ISNULL(MASTER_DATA.M8, 0) + ISNULL(MASTER_DATA.M9, 0) + ISNULL(MASTER_DATA.M10, 0) + ISNULL(MASTER_DATA.M11, 0) + ISNULL(MASTER_DATA.M12, 0) AS REVISE_TOTAL_YEAR,
      ISNULL(ACTUAL_DATA.M1, 0) + ISNULL(ACTUAL_DATA.M2, 0) + ISNULL(ACTUAL_DATA.M3, 0) + ISNULL(MASTER_DATA.M4, 0) + ISNULL(MASTER_DATA.M5, 0) + ISNULL(MASTER_DATA.M6, 0) - ISNULL(ORIGINAL_BUDGET.H1, 0) + (ISNULL(MASTER_DATA.M7, 0) + ISNULL(MASTER_DATA.M8, 0) + ISNULL(MASTER_DATA.M9, 0) + ISNULL(MASTER_DATA.M10, 0) + ISNULL(MASTER_DATA.M11, 0) + ISNULL(MASTER_DATA.M12, 0) - ISNULL(ORIGINAL_BUDGET.H2, 0)) AS DIFF_TOTAL_YEAR,
      ISNULL(MASTER_DATA.RRT1, 0) AS RRT1,
      ISNULL(MASTER_DATA.RRT2, 0) AS RRT2,
      ISNULL(MASTER_DATA.RRT3, 0) AS RRT3,
      ISNULL(MASTER_DATA.RRT4, 0) AS RRT4,
      ISNULL(MASTER_DATA.RRT5, 0) AS RRT5,
      CASE WHEN MAX_REV.COST_TYPE = 1 THEN ISNULL(MASTER_DATA.RRT1, 0) ELSE 0 END AS RRT1_FIXCOST,
      CASE WHEN MAX_REV.COST_TYPE = 2 THEN ISNULL(MASTER_DATA.RRT1, 0) ELSE 0 END AS RRT1_VARIABLECOST,
      CASE WHEN MAX_REV.COST_TYPE = 1 THEN ISNULL(MASTER_DATA.RRT2, 0) ELSE 0 END AS RRT2_FIXCOST,
      CASE WHEN MAX_REV.COST_TYPE = 2 THEN ISNULL(MASTER_DATA.RRT2, 0) ELSE 0 END AS RRT2_VARIABLECOST,
      CASE WHEN MAX_REV.COST_TYPE = 1 THEN ISNULL(MASTER_DATA.RRT3, 0) ELSE 0 END AS RRT3_FIXCOST,
      CASE WHEN MAX_REV.COST_TYPE = 2 THEN ISNULL(MASTER_DATA.RRT3, 0) ELSE 0 END AS RRT3_VARIABLECOST,
      CASE WHEN MAX_REV.COST_TYPE = 1 THEN ISNULL(MASTER_DATA.RRT4, 0) ELSE 0 END AS RRT4_FIXCOST,
      CASE WHEN MAX_REV.COST_TYPE = 2 THEN ISNULL(MASTER_DATA.RRT4, 0) ELSE 0 END AS RRT4_VARIABLECOST,
      CASE WHEN MAX_REV.COST_TYPE = 1 THEN ISNULL(MASTER_DATA.RRT5, 0) ELSE 0 END AS RRT5_FIXCOST,
      CASE WHEN MAX_REV.COST_TYPE = 2 THEN ISNULL(MASTER_DATA.RRT5, 0) ELSE 0 END AS RRT5_VARIABLECOST,
      CASE WHEN MAX_REV.COST_TYPE = 1 THEN ISNULL(ORIGINAL_BUDGET.H1, 0) ELSE 0 END AS ORIGINAL_FIRST_HALF_FIXCOST,
      CASE WHEN MAX_REV.COST_TYPE = 2 THEN ISNULL(ORIGINAL_BUDGET.H1, 0) ELSE 0 END AS ORIGINAL_FIRST_HALF_VARIABLECOST,
      CASE WHEN MAX_REV.COST_TYPE = 1 THEN ISNULL(ACTUAL_DATA.M1, 0) ELSE 0 END AS M1_FIXCOST,
      CASE WHEN MAX_REV.COST_TYPE = 2 THEN ISNULL(ACTUAL_DATA.M1, 0) ELSE 0 END AS M1_VARIABLECOST,
      CASE WHEN MAX_REV.COST_TYPE = 1 THEN ISNULL(ACTUAL_DATA.M2, 0) ELSE 0 END AS M2_FIXCOST,
      CASE WHEN MAX_REV.COST_TYPE = 2 THEN ISNULL(ACTUAL_DATA.M2, 0) ELSE 0 END AS M2_VARIABLECOST,
      CASE WHEN MAX_REV.COST_TYPE = 1 THEN ISNULL(ACTUAL_DATA.M3, 0) ELSE 0 END AS M3_FIXCOST,
      CASE WHEN MAX_REV.COST_TYPE = 2 THEN ISNULL(ACTUAL_DATA.M3, 0) ELSE 0 END AS M3_VARIABLECOST,
      CASE WHEN MAX_REV.COST_TYPE = 1 THEN ISNULL(MASTER_DATA.M4, 0) ELSE 0 END AS M4_FIXCOST,
      CASE WHEN MAX_REV.COST_TYPE = 2 THEN ISNULL(MASTER_DATA.M4, 0) ELSE 0 END AS M4_VARIABLECOST,
      CASE WHEN MAX_REV.COST_TYPE = 1 THEN ISNULL(MASTER_DATA.M5, 0) ELSE 0 END AS M5_FIXCOST,
      CASE WHEN MAX_REV.COST_TYPE = 2 THEN ISNULL(MASTER_DATA.M5, 0) ELSE 0 END AS M5_VARIABLECOST,
      CASE WHEN MAX_REV.COST_TYPE = 1 THEN ISNULL(MASTER_DATA.M6, 0) ELSE 0 END AS M6_FIXCOST,
      CASE WHEN MAX_REV.COST_TYPE = 2 THEN ISNULL(MASTER_DATA.M6, 0) ELSE 0 END AS M6_VARIABLECOST,
      CASE WHEN MAX_REV.COST_TYPE = 1 THEN ISNULL(ACTUAL_DATA.M1, 0) + ISNULL(ACTUAL_DATA.M2, 0) + ISNULL(ACTUAL_DATA.M3, 0) + ISNULL(MASTER_DATA.M4, 0) + ISNULL(MASTER_DATA.M5, 0) + ISNULL(MASTER_DATA.M6, 0) ELSE 0 END AS ESTIMATE_FIRST_HALF_FIXCOST,
      CASE WHEN MAX_REV.COST_TYPE = 2 THEN ISNULL(ACTUAL_DATA.M1, 0) + ISNULL(ACTUAL_DATA.M2, 0) + ISNULL(ACTUAL_DATA.M3, 0) + ISNULL(MASTER_DATA.M4, 0) + ISNULL(MASTER_DATA.M5, 0) + ISNULL(MASTER_DATA.M6, 0) ELSE 0 END AS ESTIMATE_FIRST_HALF_VARIABLECOST,
      CASE WHEN MAX_REV.COST_TYPE = 1 THEN ISNULL(ACTUAL_DATA.M1, 0) + ISNULL(ACTUAL_DATA.M2, 0) + ISNULL(ACTUAL_DATA.M3, 0) + ISNULL(MASTER_DATA.M4, 0) + ISNULL(MASTER_DATA.M5, 0) + ISNULL(MASTER_DATA.M6, 0) - ISNULL(ORIGINAL_BUDGET.H1, 0) ELSE 0 END AS DIFF_FIRST_HALF_FIXCOST,
      CASE WHEN MAX_REV.COST_TYPE = 2 THEN ISNULL(ACTUAL_DATA.M1, 0) + ISNULL(ACTUAL_DATA.M2, 0) + ISNULL(ACTUAL_DATA.M3, 0) + ISNULL(MASTER_DATA.M4, 0) + ISNULL(MASTER_DATA.M5, 0) + ISNULL(MASTER_DATA.M6, 0) - ISNULL(ORIGINAL_BUDGET.H1, 0) ELSE 0 END AS DIFF_FIRST_HALF_VARIABLECOST,
      CASE WHEN MAX_REV.COST_TYPE = 1 THEN ISNULL(ORIGINAL_BUDGET.H2,0) ELSE 0 END AS ORIGINAL_SECOND_HALF_FIXCOST,
      CASE WHEN MAX_REV.COST_TYPE = 2 THEN ISNULL(ORIGINAL_BUDGET.H2,0) ELSE 0 END AS ORIGINAL_SECOND_HALF_VARIABLECOST,
      CASE WHEN MAX_REV.COST_TYPE = 1 THEN ISNULL(MASTER_DATA.M7, 0) ELSE 0 END AS M7_FIXCOST,
      CASE WHEN MAX_REV.COST_TYPE = 2 THEN ISNULL(MASTER_DATA.M7, 0) ELSE 0 END AS M7_VARIABLECOST,
      CASE WHEN MAX_REV.COST_TYPE = 1 THEN ISNULL(MASTER_DATA.M8, 0) ELSE 0 END AS M8_FIXCOST,
      CASE WHEN MAX_REV.COST_TYPE = 2 THEN ISNULL(MASTER_DATA.M8, 0) ELSE 0 END AS M8_VARIABLECOST,
      CASE WHEN MAX_REV.COST_TYPE = 1 THEN ISNULL(MASTER_DATA.M9, 0) ELSE 0 END AS M9_FIXCOST,
      CASE WHEN MAX_REV.COST_TYPE = 2 THEN ISNULL(MASTER_DATA.M9, 0) ELSE 0 END AS M9_VARIABLECOST,
      CASE WHEN MAX_REV.COST_TYPE = 1 THEN ISNULL(MASTER_DATA.M10, 0) ELSE 0 END AS M10_FIXCOST,
      CASE WHEN MAX_REV.COST_TYPE = 2 THEN ISNULL(MASTER_DATA.M10, 0) ELSE 0 END AS M10_VARIABLECOST,
      CASE WHEN MAX_REV.COST_TYPE = 1 THEN ISNULL(MASTER_DATA.M11, 0) ELSE 0 END AS M11_FIXCOST,
      CASE WHEN MAX_REV.COST_TYPE = 2 THEN ISNULL(MASTER_DATA.M11, 0) ELSE 0 END AS M11_VARIABLECOST,
      CASE WHEN MAX_REV.COST_TYPE = 1 THEN ISNULL(MASTER_DATA.M12, 0) ELSE 0 END AS M12_FIXCOST,
      CASE WHEN MAX_REV.COST_TYPE = 2 THEN ISNULL(MASTER_DATA.M12, 0) ELSE 0 END AS M12_VARIABLECOST,
      CASE WHEN MAX_REV.COST_TYPE = 1 THEN ISNULL(MASTER_DATA.M7, 0) + ISNULL(MASTER_DATA.M8, 0) + ISNULL(MASTER_DATA.M9, 0) + ISNULL(MASTER_DATA.M10, 0) + ISNULL(MASTER_DATA.M11, 0) + ISNULL(MASTER_DATA.M12, 0) ELSE 0 END AS REVISE_SECOND_HALF_FIXCOST,
      CASE WHEN MAX_REV.COST_TYPE = 2 THEN ISNULL(MASTER_DATA.M7, 0) + ISNULL(MASTER_DATA.M8, 0) + ISNULL(MASTER_DATA.M9, 0) + ISNULL(MASTER_DATA.M10, 0) + ISNULL(MASTER_DATA.M11, 0) + ISNULL(MASTER_DATA.M12, 0) ELSE 0 END AS REVISE_SECOND_HALF_VARIABLECOST,
      CASE WHEN MAX_REV.COST_TYPE = 1 THEN ISNULL(MASTER_DATA.M7, 0) + ISNULL(MASTER_DATA.M8, 0) + ISNULL(MASTER_DATA.M9, 0) + ISNULL(MASTER_DATA.M10, 0) + ISNULL(MASTER_DATA.M11, 0) + ISNULL(MASTER_DATA.M12, 0) - ISNULL(ORIGINAL_BUDGET.H2, 0) ELSE 0 END AS DIFF_SECOND_HALF_FIXCOST,
      CASE WHEN MAX_REV.COST_TYPE = 2 THEN ISNULL(MASTER_DATA.M7, 0) + ISNULL(MASTER_DATA.M8, 0) + ISNULL(MASTER_DATA.M9, 0) + ISNULL(MASTER_DATA.M10, 0) + ISNULL(MASTER_DATA.M11, 0) + ISNULL(MASTER_DATA.M12, 0) - ISNULL(ORIGINAL_BUDGET.H2, 0) ELSE 0 END AS DIFF_SECOND_HALF_VARIABLECOST,
      CASE WHEN MAX_REV.COST_TYPE = 1 THEN ISNULL(ACTUAL_DATA.M1, 0) + ISNULL(ACTUAL_DATA.M2, 0) + ISNULL(ACTUAL_DATA.M3, 0) + ISNULL(MASTER_DATA.M4, 0) + ISNULL(MASTER_DATA.M5, 0) + ISNULL(MASTER_DATA.M6, 0) + ISNULL(MASTER_DATA.M7, 0) + ISNULL(MASTER_DATA.M8, 0) + ISNULL(MASTER_DATA.M9, 0) + ISNULL(MASTER_DATA.M10, 0) + ISNULL(MASTER_DATA.M11, 0) + ISNULL(MASTER_DATA.M12, 0) ELSE 0 END AS REVISE_TOTAL_YEAR_FIXCOST,
      CASE WHEN MAX_REV.COST_TYPE = 2 THEN ISNULL(ACTUAL_DATA.M1, 0) + ISNULL(ACTUAL_DATA.M2, 0) + ISNULL(ACTUAL_DATA.M3, 0) + ISNULL(MASTER_DATA.M4, 0) + ISNULL(MASTER_DATA.M5, 0) + ISNULL(MASTER_DATA.M6, 0) + ISNULL(MASTER_DATA.M7, 0) + ISNULL(MASTER_DATA.M8, 0) + ISNULL(MASTER_DATA.M9, 0) + ISNULL(MASTER_DATA.M10, 0) + ISNULL(MASTER_DATA.M11, 0) + ISNULL(MASTER_DATA.M12, 0) ELSE 0 END AS REVISE_TOTAL_YEAR_VARIABLECOST,
      CASE WHEN MAX_REV.COST_TYPE = 1 THEN ISNULL(ACTUAL_DATA.M1, 0) + ISNULL(ACTUAL_DATA.M2, 0) + ISNULL(ACTUAL_DATA.M3, 0) + ISNULL(MASTER_DATA.M4, 0) + ISNULL(MASTER_DATA.M5, 0) + ISNULL(MASTER_DATA.M6, 0) - ISNULL(ORIGINAL_BUDGET.H1, 0) + (ISNULL(MASTER_DATA.M7, 0) + ISNULL(MASTER_DATA.M8, 0) + ISNULL(MASTER_DATA.M9, 0) + ISNULL(MASTER_DATA.M10, 0) + ISNULL(MASTER_DATA.M11, 0) + ISNULL(MASTER_DATA.M12, 0) - ISNULL(ORIGINAL_BUDGET.H2, 0)) ELSE 0 END AS DIFF_TOTAL_YEAR_FIXCOST,
      CASE WHEN MAX_REV.COST_TYPE = 2 THEN ISNULL(ACTUAL_DATA.M1, 0) + ISNULL(ACTUAL_DATA.M2, 0) + ISNULL(ACTUAL_DATA.M3, 0) + ISNULL(MASTER_DATA.M4, 0) + ISNULL(MASTER_DATA.M5, 0) + ISNULL(MASTER_DATA.M6, 0) - ISNULL(ORIGINAL_BUDGET.H1, 0) + (ISNULL(MASTER_DATA.M7, 0) + ISNULL(MASTER_DATA.M8, 0) + ISNULL(MASTER_DATA.M9, 0) + ISNULL(MASTER_DATA.M10, 0) + ISNULL(MASTER_DATA.M11, 0) + ISNULL(MASTER_DATA.M12, 0) - ISNULL(ORIGINAL_BUDGET.H2, 0)) ELSE 0 END AS DIFF_TOTAL_YEAR_VARIABLECOST
      FROM (
      SELECT BUDGET_DATA.BUDGET_ORDER_NO, BUDGET_DATA.BUDGET_YEAR, BUDGET_ORDER.COST_TYPE,
      BUDGET_DATA.PERIOD_TYPE, BUDGET_DATA.PROJECT_NO, MAX(BUDGET_DATA.REV_NO) AS REV_NO, BUDGET_ORDER.BUDGET_ORDER_NAME,
      BUDGET_ORDER.DEPT_NO, BUDGET_ORDER.PERSON_IN_CHARGE_NO, PIC.PERSON_IN_CHARGE_NAME
      FROM BG_T_BUDGET_DATA AS BUDGET_DATA
      INNER JOIN BG_M_BUDGET_ORDER AS BUDGET_ORDER
      ON BUDGET_ORDER.BUDGET_ORDER_NO = BUDGET_DATA.BUDGET_ORDER_NO AND BUDGET_ORDER.BUDGET_TYPE = 'E' AND BUDGET_ORDER.ACTIVE_FLAG = 1
      INNER JOIN BG_M_PERSON_IN_CHARGE AS PIC
      ON PIC.PERSON_IN_CHARGE_NO = BUDGET_ORDER.PERSON_IN_CHARGE_NO
      WHERE BUDGET_DATA.BUDGET_YEAR = @YEAR
      AND BUDGET_DATA.PERIOD_TYPE = @PERIOD
      AND BUDGET_DATA.PROJECT_NO = @PROJECTNO
      @PICCONDITION
      --WHERE BUDGET_DATA.BUDGET_YEAR = 2010 AND BUDGET_DATA.PERIOD_TYPE = 3
      --AND (ISNULL(M7, 0) &lt;&gt; 0 OR ISNULL(M8, 0) &lt;&gt; 0 OR ISNULL(M9, 0) &lt;&gt; 0 OR ISNULL(M10, 0) &lt;&gt; 0
      --OR ISNULL(M11, 0) &lt;&gt; 0 OR ISNULL(M12, 0) &lt;&gt; 0)
      GROUP BY BUDGET_DATA.BUDGET_ORDER_NO, BUDGET_DATA.BUDGET_YEAR, BUDGET_DATA.PERIOD_TYPE, BUDGET_DATA.PROJECT_NO, BUDGET_ORDER.BUDGET_ORDER_NAME, BUDGET_ORDER.DEPT_NO, BUDGET_ORDER.COST_TYPE,
      BUDGET_ORDER.PERSON_IN_CHARGE_NO, PIC.PERSON_IN_CHARGE_NAME) AS MAX_REV

      INNER JOIN BG_T_BUDGET_DATA AS MASTER_DATA
      ON MAX_REV.BUDGET_YEAR = MASTER_DATA.BUDGET_YEAR
      AND MAX_REV.PERIOD_TYPE = MASTER_DATA.PERIOD_TYPE
      AND MAX_REV.PROJECT_NO = MASTER_DATA.PROJECT_NO
      AND MAX_REV.BUDGET_ORDER_NO = MASTER_DATA.BUDGET_ORDER_NO
      AND MAX_REV.REV_NO = MASTER_DATA.REV_NO

      LEFT OUTER JOIN BG_T_UPLOAD_DATA AS ORIGINAL_BUDGET
      ON MAX_REV.BUDGET_YEAR = ORIGINAL_BUDGET.BUDGET_YEAR
      AND ORIGINAL_BUDGET.PERIOD_TYPE = @PERIOD
      AND ORIGINAL_BUDGET.PROJECT_NO = @PROJECTNO
      AND MAX_REV.BUDGET_ORDER_NO = ORIGINAL_BUDGET.BUDGET_ORDER_NO
      AND ORIGINAL_BUDGET.DATA_TYPE = 1

      LEFT OUTER JOIN BG_T_UPLOAD_DATA AS ACTUAL_DATA
      ON ACTUAL_DATA.BUDGET_YEAR = MAX_REV.BUDGET_YEAR
      AND ACTUAL_DATA.BUDGET_ORDER_NO = MAX_REV.BUDGET_ORDER_NO
      AND ACTUAL_DATA.DATA_TYPE = 2
      AND ACTUAL_DATA.PERIOD_TYPE = @PERIOD
      AND ACTUAL_DATA.PROJECT_NO = @PROJECTNO
      --ON ACTUAL_DATA.BUDGET_YEAR = MAX_REV.BUDGET_YEAR AND ACTUAL_DATA.BUDGET_ORDER_NO = MAX_REV.BUDGET_ORDER_NO AND ACTUAL_DATA.DATA_TYPE = 2 AND ACTUAL_DATA.PERIOD_TYPE = 3

      WHERE(ISNULL(ORIGINAL_BUDGET.H1, 0) &lt;&gt; 0 OR ISNULL(ORIGINAL_BUDGET.H2, 0) &lt;&gt; 0
      OR ISNULL(ACTUAL_DATA.M1, 0) &lt;&gt; 0 OR ISNULL(ACTUAL_DATA.M2, 0) &lt;&gt; 0 OR ISNULL(ACTUAL_DATA.M3, 0) &lt;&gt; 0
      OR ISNULL(MASTER_DATA.M4, 0) &lt;&gt; 0 OR ISNULL(MASTER_DATA.M5, 0) &lt;&gt; 0 OR ISNULL(MASTER_DATA.M6, 0) &lt;&gt; 0
      OR ISNULL(MASTER_DATA.M7, 0) &lt;&gt; 0 OR ISNULL(MASTER_DATA.M8, 0) &lt;&gt; 0 OR ISNULL(MASTER_DATA.M9, 0) &lt;&gt; 0
      OR ISNULL(MASTER_DATA.M10, 0) &lt;&gt; 0 OR ISNULL(MASTER_DATA.M11, 0) &lt;&gt; 0 OR ISNULL(MASTER_DATA.M12, 0) &lt;&gt; 0
      OR ISNULL(MASTER_DATA.RRT1, 0) &lt;&gt; 0 OR ISNULL(MASTER_DATA.RRT2, 0) &lt;&gt; 0 OR ISNULL(MASTER_DATA.RRT3, 0) &lt;&gt; 0
      OR ISNULL(MASTER_DATA.RRT4, 0) &lt;&gt; 0 OR ISNULL(MASTER_DATA.RRT5, 0) &lt;&gt; 0)
      ORDER BY MAX_REV.BUDGET_ORDER_NO
    </SELECT004_3 >

    <SELECT004_6>
      SELECT MTP.BUDGET_ORDER_NO
      , MTP.BUDGET_YEAR, BOO.COST_TYPE,
      MTP.PERIOD_TYPE, MTP.PROJECT_NO, MTP.REV_NO, BOO.BUDGET_ORDER_NAME,
      DPP.DEPT_NO, PICC.PERSON_IN_CHARGE_NO, PICC.PERSON_IN_CHARGE_NAME,
      BOO.PIC_SHOW_FLAG AS PIC_SHOW_FLG,
      ISNULL(MTP.RRT1,0) AS RRT1,
      ISNULL(MTP.RRT2,0) AS RRT2,
      ISNULL(MTP.RRT3,0) AS RRT3,
      ISNULL(MTP.RRT4,0) AS RRT4,
      ISNULL(MTP.RRT5,0) AS RRT5,

      ISNULL(OB_BUDGET_DATA.M1, 0) + ISNULL(OB_BUDGET_DATA.M2, 0)
      + ISNULL(OB_BUDGET_DATA.M3, 0) + ISNULL(OB_BUDGET_DATA.M4, 0)
      + ISNULL(OB_BUDGET_DATA.M5, 0) + ISNULL(OB_BUDGET_DATA.M6, 0)
      + ISNULL(OB_BUDGET_DATA.M7, 0) + ISNULL(OB_BUDGET_DATA.M8, 0)
      + ISNULL(OB_BUDGET_DATA.M9, 0) + ISNULL(OB_BUDGET_DATA.M10, 0)
      + ISNULL(OB_BUDGET_DATA.M11, 0) + ISNULL(OB_BUDGET_DATA.M12, 0) AS REVISE_TOTAL_YEAR ,

      (ISNULL(OB_BUDGET_DATA.M1, 0) + ISNULL(OB_BUDGET_DATA.M2, 0)
      + ISNULL(OB_BUDGET_DATA.M3, 0) + ISNULL(OB_BUDGET_DATA.M4, 0)
      + ISNULL(OB_BUDGET_DATA.M5, 0) + ISNULL(OB_BUDGET_DATA.M6, 0)
      + ISNULL(OB_BUDGET_DATA.M7, 0) + ISNULL(OB_BUDGET_DATA.M8, 0)
      + ISNULL(OB_BUDGET_DATA.M9, 0) + ISNULL(OB_BUDGET_DATA.M10, 0)
      + ISNULL(OB_BUDGET_DATA.M11, 0) + ISNULL(OB_BUDGET_DATA.M12, 0))
      - ISNULL(MASTER_DATA1.RRT2, 0) AS DIFF_TOTAL_YEAR,



      ISNULL(MASTER_DATA1.RRT1, 0) AS PrevRRT1,
      ISNULL(MASTER_DATA1.RRT2, 0) AS PrevRRT2,
      ISNULL(MASTER_DATA1.RRT3, 0) AS PrevRRT3,
      ISNULL(MASTER_DATA1.RRT4, 0) AS PrevRRT4,
      ISNULL(MASTER_DATA1.RRT5, 0) AS PrevRRT5,

      CASE WHEN BOO.COST_TYPE = 1 THEN ISNULL(MTP.RRT1, 0) ELSE 0 END AS RRT1_FIXCOST,
      CASE WHEN BOO.COST_TYPE = 2 THEN ISNULL(MTP.RRT1, 0) ELSE 0 END AS RRT1_VARIABLECOST,
      CASE WHEN BOO.COST_TYPE = 1 THEN ISNULL(MTP.RRT2, 0) ELSE 0 END AS RRT2_FIXCOST,
      CASE WHEN BOO.COST_TYPE = 2 THEN ISNULL(MTP.RRT2, 0) ELSE 0 END AS RRT2_VARIABLECOST,
      CASE WHEN BOO.COST_TYPE = 1 THEN ISNULL(MTP.RRT3, 0) ELSE 0 END AS RRT3_FIXCOST,
      CASE WHEN BOO.COST_TYPE = 2 THEN ISNULL(MTP.RRT3, 0) ELSE 0 END AS RRT3_VARIABLECOST,
      CASE WHEN BOO.COST_TYPE = 1 THEN ISNULL(MTP.RRT4, 0) ELSE 0 END AS RRT4_FIXCOST,
      CASE WHEN BOO.COST_TYPE = 2 THEN ISNULL(MTP.RRT4, 0) ELSE 0 END AS RRT4_VARIABLECOST,
      CASE WHEN BOO.COST_TYPE = 1 THEN ISNULL(MTP.RRT5, 0) ELSE 0 END AS RRT5_FIXCOST,
      CASE WHEN BOO.COST_TYPE = 2 THEN ISNULL(MTP.RRT5, 0) ELSE 0 END AS RRT5_VARIABLECOST,

      CASE WHEN BOO.COST_TYPE = 1 THEN ISNULL(MASTER_DATA1.RRT1, 0) ELSE 0 END AS PrevRRT1_FIXCOST,
      CASE WHEN BOO.COST_TYPE = 2 THEN ISNULL(MASTER_DATA1.RRT1, 0) ELSE 0 END AS PrevRRT1_VARIABLECOST,
      CASE WHEN BOO.COST_TYPE = 1 THEN ISNULL(MASTER_DATA1.RRT2, 0) ELSE 0 END AS PrevRRT2_FIXCOST,
      CASE WHEN BOO.COST_TYPE = 2 THEN ISNULL(MASTER_DATA1.RRT2, 0) ELSE 0 END AS PrevRRT2_VARIABLECOST,
      CASE WHEN BOO.COST_TYPE = 1 THEN ISNULL(MASTER_DATA1.RRT3, 0) ELSE 0 END AS PrevRRT3_FIXCOST,
      CASE WHEN BOO.COST_TYPE = 2 THEN ISNULL(MASTER_DATA1.RRT3, 0) ELSE 0 END AS PrevRRT3_VARIABLECOST,
      CASE WHEN BOO.COST_TYPE = 1 THEN ISNULL(MASTER_DATA1.RRT4, 0) ELSE 0 END AS PrevRRT4_FIXCOST,
      CASE WHEN BOO.COST_TYPE = 2 THEN ISNULL(MASTER_DATA1.RRT4, 0) ELSE 0 END AS PrevRRT4_VARIABLECOST,
      CASE WHEN BOO.COST_TYPE = 1 THEN ISNULL(MASTER_DATA1.RRT5, 0) ELSE 0 END AS PrevRRT5_FIXCOST,
      CASE WHEN BOO.COST_TYPE = 2 THEN ISNULL(MASTER_DATA1.RRT5, 0) ELSE 0 END AS PrevRRT5_VARIABLECOST,

      CASE WHEN BOO.COST_TYPE = 1 THEN ISNULL(OB_BUDGET_DATA.M1, 0) + ISNULL(OB_BUDGET_DATA.M2, 0) + ISNULL(OB_BUDGET_DATA.M3, 0) + ISNULL(OB_BUDGET_DATA.M4, 0) + ISNULL(OB_BUDGET_DATA.M5, 0) + ISNULL(OB_BUDGET_DATA.M6, 0) + ISNULL(OB_BUDGET_DATA.M7, 0) + ISNULL(OB_BUDGET_DATA.M8, 0) + ISNULL(OB_BUDGET_DATA.M9, 0) + ISNULL(OB_BUDGET_DATA.M10, 0) + ISNULL(OB_BUDGET_DATA.M11, 0) + ISNULL(OB_BUDGET_DATA.M12, 0) ELSE 0 END AS REVISE_TOTAL_YEAR_FIXCOST,
      CASE WHEN BOO.COST_TYPE = 2 THEN ISNULL(OB_BUDGET_DATA.M1, 0) + ISNULL(OB_BUDGET_DATA.M2, 0) + ISNULL(OB_BUDGET_DATA.M3, 0) + ISNULL(OB_BUDGET_DATA.M4, 0) + ISNULL(OB_BUDGET_DATA.M5, 0) + ISNULL(OB_BUDGET_DATA.M6, 0) + ISNULL(OB_BUDGET_DATA.M7, 0) + ISNULL(OB_BUDGET_DATA.M8, 0) + ISNULL(OB_BUDGET_DATA.M9, 0) + ISNULL(OB_BUDGET_DATA.M10, 0) + ISNULL(OB_BUDGET_DATA.M11, 0) + ISNULL(OB_BUDGET_DATA.M12, 0) ELSE 0 END AS REVISE_TOTAL_YEAR_VARIABLECOST,

      CASE WHEN BOO.COST_TYPE = 1 THEN ISNULL(OB_BUDGET_DATA.M1, 0) + ISNULL(OB_BUDGET_DATA.M2, 0) + ISNULL(OB_BUDGET_DATA.M3, 0) + ISNULL(OB_BUDGET_DATA.M4, 0) + ISNULL(OB_BUDGET_DATA.M5, 0) + ISNULL(OB_BUDGET_DATA.M6, 0) + ISNULL(OB_BUDGET_DATA.M7, 0) + ISNULL(OB_BUDGET_DATA.M8, 0) + ISNULL(OB_BUDGET_DATA.M9, 0) + ISNULL(OB_BUDGET_DATA.M10, 0) + ISNULL(OB_BUDGET_DATA.M11, 0) + ISNULL(OB_BUDGET_DATA.M12, 0)  - ISNULL(MASTER_DATA1.RRT2, 0) ELSE 0 END AS DIFF_TOTAL_YEAR_FIXCOST,
      CASE WHEN BOO.COST_TYPE = 2 THEN ISNULL(OB_BUDGET_DATA.M1, 0) + ISNULL(OB_BUDGET_DATA.M2, 0) + ISNULL(OB_BUDGET_DATA.M3, 0) + ISNULL(OB_BUDGET_DATA.M4, 0) + ISNULL(OB_BUDGET_DATA.M5, 0) + ISNULL(OB_BUDGET_DATA.M6, 0) + ISNULL(OB_BUDGET_DATA.M7, 0) + ISNULL(OB_BUDGET_DATA.M8, 0) + ISNULL(OB_BUDGET_DATA.M9, 0) + ISNULL(OB_BUDGET_DATA.M10, 0) + ISNULL(OB_BUDGET_DATA.M11, 0) + ISNULL(OB_BUDGET_DATA.M12, 0)  - ISNULL(MASTER_DATA1.RRT2, 0) ELSE 0 END AS DIFF_TOTAL_YEAR_VARIABLECOST
      ,(ISNULL(MTP.RRT2,0) -  ISNULL(MASTER_DATA1.RRT3, 0)) AS DIFF_PREV_YEAR
      ,CASE WHEN BOO.COST_TYPE = 1 THEN ISNULL(MTP.RRT2, 0)  - ISNULL(MASTER_DATA1.RRT3, 0) ELSE 0 END AS DIFF_PREV_YEAR_FIXCOST
      ,CASE WHEN BOO.COST_TYPE = 2 THEN ISNULL(MTP.RRT2, 0)  - ISNULL(MASTER_DATA1.RRT3, 0) ELSE 0 END AS DIFF_PREV_YEAR_VARIABLECOST




      FROM
      (
      SELECT

      BD.BUDGET_YEAR,
      BD.PERIOD_TYPE,
      BUDGET_ORDER_MAIN.BUDGET_ORDER_NO,
      BD.REV_NO,
      BD.M1,
      BD.M2,
      BD.M3,
      BD.M4,
      BD.M5,
      BD.M6,
      BD.M7,
      BD.M8,
      BD.M9,
      BD.M10,
      BD.M11,
      BD.M12,
      BD.RRT1,
      BD.RRT2,
      BD.RRT3,
      BD.RRT4,
      BD.RRT5,
      BD.REMARKS,
      BD.WB_FLAG,
      BD.CREATE_USER_ID,
      BD.CREATE_DATE,
      BD.UPDATE_USER_ID,
      BD.UPDATE_DATE,
      BD.PROJECT_NO,
      BO.BUDGET_ORDER_NAME,BO.PIC_SHOW_FLAG AS PIC_SHOW_FLG,
      AC.ACCOUNT_NO, AC.ACCOUNT_NAME,
      BO.COST, BO.COST_TYPE, DP.DEPT_NO, DP.DEPT_NAME,
      PIC.PERSON_IN_CHARGE_NO, PIC.PERSON_IN_CHARGE_NAME


      FROM
      (
      SELECT
      distinct(BD.BUDGET_ORDER_NO)
      FROM BG_T_BUDGET_DATA AS BD
      LEFT JOIN BG_M_BUDGET_ORDER AS BO ON BD.BUDGET_ORDER_NO = BO.BUDGET_ORDER_NO
      LEFT JOIN BG_M_ACCOUNT AS AC ON BO.ACCOUNT_NO = AC.ACCOUNT_NO
      LEFT JOIN BG_M_DEPT AS DP ON BO.DEPT_NO = DP.DEPT_NO
      LEFT JOIN BG_M_PERSON_IN_CHARGE AS PIC ON BO.PERSON_IN_CHARGE_NO = PIC.PERSON_IN_CHARGE_NO
      LEFT JOIN BG_T_BUDGET_PERIOD AS BP ON BD.BUDGET_YEAR = BP.BUDGET_YEAR AND BD.PERIOD_TYPE = BP.PERIOD_TYPE AND BD.PROJECT_NO = BP.PROJECT_NO
      WHERE
      BD.BUDGET_YEAR = @YEAR
      AND BD.PERIOD_TYPE = @PERIOD
      AND BO.BUDGET_TYPE = 'E'
      AND BD.REV_NO  = (SELECT ISNULL(MAX(REV_NO),1) AS MAX_REV_NO FROM BG_T_BUDGET_HEADER WHERE BUDGET_YEAR = @YEAR AND PERIOD_TYPE = @PERIOD AND BUDGET_TYPE = 'E' AND PROJECT_NO = @PROJECTNO)
      AND BD.PROJECT_NO = @PROJECTNO
      AND BO.ACTIVE_FLAG = 1
      @PICCONDITION

      UNION

      SELECT
      distinct(BD.BUDGET_ORDER_NO)
      FROM
      BG_T_BUDGET_DATA AS BD
      LEFT JOIN BG_M_BUDGET_ORDER AS BO ON BD.BUDGET_ORDER_NO = BO.BUDGET_ORDER_NO
      LEFT JOIN BG_M_ACCOUNT AS AC ON BO.ACCOUNT_NO = AC.ACCOUNT_NO
      LEFT JOIN BG_M_DEPT AS DP ON BO.DEPT_NO = DP.DEPT_NO
      LEFT JOIN BG_M_PERSON_IN_CHARGE AS PIC ON BO.PERSON_IN_CHARGE_NO = PIC.PERSON_IN_CHARGE_NO
      LEFT JOIN BG_T_BUDGET_PERIOD AS BP ON BD.BUDGET_YEAR = BP.BUDGET_YEAR AND BD.PERIOD_TYPE = BP.PERIOD_TYPE AND BD.PROJECT_NO = BP.PROJECT_NO
      WHERE
      BD.BUDGET_YEAR = @YEAR+1
      AND BD.PERIOD_TYPE = 1
      AND BO.BUDGET_TYPE = 'E'
      AND BD.REV_NO = @RefRBRevNo
      AND BD.PROJECT_NO = @RefRBProjectNo
      AND BO.ACTIVE_FLAG = 1
      @PICCONDITION
      ) AS BUDGET_ORDER_MAIN


      LEFT JOIN BG_T_BUDGET_DATA  BD
      ON BD.BUDGET_ORDER_NO = BUDGET_ORDER_MAIN.BUDGET_ORDER_NO
      AND BD.BUDGET_YEAR = @YEAR
      AND BD.PERIOD_TYPE = @PERIOD
      AND BD.REV_NO = (SELECT ISNULL(MAX(REV_NO),1) AS MAX_REV_NO FROM BG_T_BUDGET_HEADER WHERE BUDGET_YEAR = @YEAR AND PERIOD_TYPE = @PERIOD)
      AND BD.PROJECT_NO = @PROJECTNO


      LEFT JOIN BG_M_BUDGET_ORDER AS BO ON BD.BUDGET_ORDER_NO = BO.BUDGET_ORDER_NO
      LEFT JOIN BG_M_ACCOUNT AS AC ON BO.ACCOUNT_NO = AC.ACCOUNT_NO
      LEFT JOIN BG_M_DEPT AS DP ON BO.DEPT_NO = DP.DEPT_NO
      LEFT JOIN BG_M_PERSON_IN_CHARGE AS PIC ON BO.PERSON_IN_CHARGE_NO = PIC.PERSON_IN_CHARGE_NO
      LEFT JOIN BG_T_BUDGET_PERIOD AS BP ON BD.BUDGET_YEAR = BP.BUDGET_YEAR AND BD.PERIOD_TYPE = BP.PERIOD_TYPE AND BD.PROJECT_NO = BP.PROJECT_NO


      ) AS MTP


      LEFT JOIN BG_M_BUDGET_ORDER AS BOO
      ON MTP.BUDGET_ORDER_NO = BOO.BUDGET_ORDER_NO

      LEFT JOIN BG_M_DEPT AS DPP
      ON BOO.DEPT_NO = DPP.DEPT_NO

      LEFT JOIN BG_M_PERSON_IN_CHARGE AS PICC
      ON BOO.PERSON_IN_CHARGE_NO = PICC.PERSON_IN_CHARGE_NO


      LEFT OUTER JOIN BG_T_BUDGET_DATA AS OB_BUDGET_DATA
      ON OB_BUDGET_DATA.BUDGET_YEAR = @YEAR + 1
      AND OB_BUDGET_DATA.BUDGET_ORDER_NO = MTP.BUDGET_ORDER_NO
      AND OB_BUDGET_DATA.PERIOD_TYPE = 1
      AND OB_BUDGET_DATA.PROJECT_NO = @RefRBProjectNo
      AND OB_BUDGET_DATA.REV_NO = @RefRBRevNo

      LEFT JOIN
      (
      SELECT BUDGET_DATA.BUDGET_ORDER_NO, BUDGET_DATA.BUDGET_YEAR, BUDGET_ORDER.COST_TYPE,
      BUDGET_DATA.PERIOD_TYPE, BUDGET_DATA.PROJECT_NO, MAX(BUDGET_DATA.REV_NO) AS REV_NO, BUDGET_ORDER.BUDGET_ORDER_NAME,
      BUDGET_ORDER.DEPT_NO, BUDGET_ORDER.PERSON_IN_CHARGE_NO, PIC.PERSON_IN_CHARGE_NAME
      FROM BG_T_BUDGET_DATA AS BUDGET_DATA
      INNER JOIN BG_M_BUDGET_ORDER AS BUDGET_ORDER
      ON BUDGET_ORDER.BUDGET_ORDER_NO = BUDGET_DATA.BUDGET_ORDER_NO AND BUDGET_ORDER.BUDGET_TYPE = 'E' AND BUDGET_ORDER.ACTIVE_FLAG = 1
      INNER JOIN BG_M_PERSON_IN_CHARGE AS PIC
      ON PIC.PERSON_IN_CHARGE_NO = BUDGET_ORDER.PERSON_IN_CHARGE_NO
      WHERE BUDGET_DATA.BUDGET_YEAR = @YEAR
      AND BUDGET_DATA.PERIOD_TYPE = @PERIOD
      AND BUDGET_DATA.PROJECT_NO = @PROJECTNO
      AND BUDGET_DATA.REV_NO = (SELECT ISNULL(MAX(REV_NO),1) AS MAX_REV_NO FROM BG_T_BUDGET_HEADER WHERE BUDGET_YEAR = @YEAR AND PERIOD_TYPE = @PERIOD AND PROJECT_NO = @PROJECTNO)
      GROUP BY BUDGET_DATA.BUDGET_ORDER_NO, BUDGET_DATA.BUDGET_YEAR, BUDGET_DATA.PERIOD_TYPE, BUDGET_DATA.PROJECT_NO, BUDGET_ORDER.BUDGET_ORDER_NAME, BUDGET_ORDER.DEPT_NO, BUDGET_ORDER.COST_TYPE,
      BUDGET_ORDER.PERSON_IN_CHARGE_NO, PIC.PERSON_IN_CHARGE_NAME) AS MAX_REV ON MTP.BUDGET_ORDER_NO = MAX_REV.BUDGET_ORDER_NO


      LEFT JOIN
      (
      SELECT BUDGET_DATA1.BUDGET_ORDER_NO, BUDGET_DATA1.BUDGET_YEAR, BUDGET_ORDER1.COST_TYPE,
      BUDGET_DATA1.PERIOD_TYPE, BUDGET_DATA1.PROJECT_NO, MAX(BUDGET_DATA1.REV_NO) AS REV_NO, BUDGET_ORDER1.BUDGET_ORDER_NAME,
      BUDGET_ORDER1.DEPT_NO, BUDGET_ORDER1.PERSON_IN_CHARGE_NO, PIC1.PERSON_IN_CHARGE_NAME
      FROM BG_T_BUDGET_DATA AS BUDGET_DATA1
      INNER JOIN BG_M_BUDGET_ORDER AS BUDGET_ORDER1
      ON BUDGET_ORDER1.BUDGET_ORDER_NO = BUDGET_DATA1.BUDGET_ORDER_NO AND BUDGET_ORDER1.BUDGET_TYPE = 'E' AND BUDGET_ORDER1.ACTIVE_FLAG = 1
      INNER JOIN BG_M_PERSON_IN_CHARGE AS PIC1
      ON PIC1.PERSON_IN_CHARGE_NO = BUDGET_ORDER1.PERSON_IN_CHARGE_NO
      WHERE BUDGET_DATA1.BUDGET_YEAR = (@YEAR - 1)
      AND BUDGET_DATA1.PERIOD_TYPE = @PERIOD
      AND BUDGET_DATA1.PROJECT_NO = @PROJECTNO
      AND BUDGET_DATA1.REV_NO = (SELECT ISNULL(MAX(REV_NO),1) AS MAX_REV_NO FROM BG_T_BUDGET_HEADER WHERE BUDGET_YEAR = (@YEAR - 1) AND PERIOD_TYPE = @PERIOD AND PROJECT_NO = @PROJECTNO)
      GROUP BY BUDGET_DATA1.BUDGET_ORDER_NO, BUDGET_DATA1.BUDGET_YEAR, BUDGET_DATA1.PERIOD_TYPE, BUDGET_DATA1.PROJECT_NO, BUDGET_ORDER1.BUDGET_ORDER_NAME, BUDGET_ORDER1.DEPT_NO, BUDGET_ORDER1.COST_TYPE,
      BUDGET_ORDER1.PERSON_IN_CHARGE_NO, PIC1.PERSON_IN_CHARGE_NAME) AS MAX_PREV_REV ON MTP.BUDGET_ORDER_NO = MAX_PREV_REV.BUDGET_ORDER_NO



      LEFT JOIN BG_T_BUDGET_DATA AS MASTER_DATA1
      ON MAX_PREV_REV.BUDGET_YEAR = MASTER_DATA1.BUDGET_YEAR
      AND MAX_PREV_REV.PERIOD_TYPE = MASTER_DATA1.PERIOD_TYPE
      AND MAX_PREV_REV.PROJECT_NO = MASTER_DATA1.PROJECT_NO
      AND MAX_PREV_REV.BUDGET_ORDER_NO = MASTER_DATA1.BUDGET_ORDER_NO
      AND MAX_PREV_REV.REV_NO = MASTER_DATA1.REV_NO


      WHERE(ISNULL(OB_BUDGET_DATA.M1, 0) &lt;&gt; 0
      OR ISNULL(OB_BUDGET_DATA.M2, 0) &lt;&gt; 0
      OR ISNULL(OB_BUDGET_DATA.M3, 0) &lt;&gt; 0
      OR ISNULL(OB_BUDGET_DATA.M4, 0) &lt;&gt; 0
      OR ISNULL(OB_BUDGET_DATA.M5, 0) &lt;&gt; 0
      OR ISNULL(OB_BUDGET_DATA.M6, 0) &lt;&gt; 0
      OR ISNULL(OB_BUDGET_DATA.M7, 0) &lt;&gt; 0
      OR ISNULL(OB_BUDGET_DATA.M8, 0) &lt;&gt; 0
      OR ISNULL(OB_BUDGET_DATA.M9, 0) &lt;&gt; 0
      OR ISNULL(OB_BUDGET_DATA.M10, 0) &lt;&gt; 0
      OR ISNULL(OB_BUDGET_DATA.M11, 0) &lt;&gt; 0
      OR ISNULL(OB_BUDGET_DATA.M12, 0) &lt;&gt; 0
      OR ISNULL(MASTER_DATA1.RRT1, 0) &lt;&gt; 0
      OR ISNULL(MASTER_DATA1.RRT2, 0) &lt;&gt; 0
      OR ISNULL(MASTER_DATA1.RRT3, 0) &lt;&gt; 0
      OR ISNULL(MASTER_DATA1.RRT4, 0) &lt;&gt; 0
      OR ISNULL(MASTER_DATA1.RRT5, 0) &lt;&gt; 0
      OR ISNULL(MTP.RRT1, 0) &lt;&gt; 0
      OR ISNULL(MTP.RRT2, 0) &lt;&gt; 0
      OR ISNULL(MTP.RRT3, 0) &lt;&gt; 0
      OR ISNULL(MTP.RRT4, 0) &lt;&gt; 0
      OR ISNULL(MTP.RRT5, 0) &lt;&gt; 0)

      ORDER BY MTP.BUDGET_ORDER_NO


    </SELECT004_6>
    
    <!--<SELECT004_6>
      SELECT MTP.BUDGET_ORDER_NO, MTP.BUDGET_YEAR, MTP.COST_TYPE,
      MTP.PERIOD_TYPE, MTP.PROJECT_NO, MTP.REV_NO, MTP.BUDGET_ORDER_NAME,
      MTP.DEPT_NO, MTP.PERSON_IN_CHARGE_NO, MTP.PERSON_IN_CHARGE_NAME,
      MTP.PIC_SHOW_FLG,
      MTP.RRT1,
      MTP.RRT2,
      MTP.RRT3,
      MTP.RRT4,
      MTP.RRT5,

      ISNULL(OB_BUDGET_DATA.M1, 0) + ISNULL(OB_BUDGET_DATA.M2, 0)
      + ISNULL(OB_BUDGET_DATA.M3, 0) + ISNULL(OB_BUDGET_DATA.M4, 0)
      + ISNULL(OB_BUDGET_DATA.M5, 0) + ISNULL(OB_BUDGET_DATA.M6, 0)
      + ISNULL(OB_BUDGET_DATA.M7, 0) + ISNULL(OB_BUDGET_DATA.M8, 0)
      + ISNULL(OB_BUDGET_DATA.M9, 0) + ISNULL(OB_BUDGET_DATA.M10, 0)
      + ISNULL(OB_BUDGET_DATA.M11, 0) + ISNULL(OB_BUDGET_DATA.M12, 0) AS REVISE_TOTAL_YEAR,
      (ISNULL(OB_BUDGET_DATA.M1, 0) + ISNULL(OB_BUDGET_DATA.M2, 0)
      + ISNULL(OB_BUDGET_DATA.M3, 0) + ISNULL(OB_BUDGET_DATA.M4, 0)
      + ISNULL(OB_BUDGET_DATA.M5, 0) + ISNULL(OB_BUDGET_DATA.M6, 0)
      + ISNULL(OB_BUDGET_DATA.M7, 0) + ISNULL(OB_BUDGET_DATA.M8, 0)
      + ISNULL(OB_BUDGET_DATA.M9, 0) + ISNULL(OB_BUDGET_DATA.M10, 0)
      + ISNULL(OB_BUDGET_DATA.M11, 0) + ISNULL(OB_BUDGET_DATA.M12, 0))
      - ISNULL(MASTER_DATA1.RRT2, 0) AS DIFF_TOTAL_YEAR,

      ISNULL(MASTER_DATA1.RRT1, 0) AS PrevRRT1,
      ISNULL(MASTER_DATA1.RRT2, 0) AS PrevRRT2,
      ISNULL(MASTER_DATA1.RRT3, 0) AS PrevRRT3,
      ISNULL(MASTER_DATA1.RRT4, 0) AS PrevRRT4,
      ISNULL(MASTER_DATA1.RRT5, 0) AS PrevRRT5,
      CASE WHEN MAX_REV.COST_TYPE = 1 THEN ISNULL(MTP.RRT1, 0) ELSE 0 END AS RRT1_FIXCOST,
      CASE WHEN MAX_REV.COST_TYPE = 2 THEN ISNULL(MTP.RRT1, 0) ELSE 0 END AS RRT1_VARIABLECOST,
      CASE WHEN MAX_REV.COST_TYPE = 1 THEN ISNULL(MTP.RRT2, 0) ELSE 0 END AS RRT2_FIXCOST,
      CASE WHEN MAX_REV.COST_TYPE = 2 THEN ISNULL(MTP.RRT2, 0) ELSE 0 END AS RRT2_VARIABLECOST,
      CASE WHEN MAX_REV.COST_TYPE = 1 THEN ISNULL(MTP.RRT3, 0) ELSE 0 END AS RRT3_FIXCOST,
      CASE WHEN MAX_REV.COST_TYPE = 2 THEN ISNULL(MTP.RRT3, 0) ELSE 0 END AS RRT3_VARIABLECOST,
      CASE WHEN MAX_REV.COST_TYPE = 1 THEN ISNULL(MTP.RRT4, 0) ELSE 0 END AS RRT4_FIXCOST,
      CASE WHEN MAX_REV.COST_TYPE = 2 THEN ISNULL(MTP.RRT4, 0) ELSE 0 END AS RRT4_VARIABLECOST,
      CASE WHEN MAX_REV.COST_TYPE = 1 THEN ISNULL(MTP.RRT5, 0) ELSE 0 END AS RRT5_FIXCOST,
      CASE WHEN MAX_REV.COST_TYPE = 2 THEN ISNULL(MTP.RRT5, 0) ELSE 0 END AS RRT5_VARIABLECOST,

      CASE WHEN MAX_PREV_REV.COST_TYPE = 1 THEN ISNULL(MASTER_DATA1.RRT1, 0) ELSE 0 END AS PrevRRT1_FIXCOST,
      CASE WHEN MAX_PREV_REV.COST_TYPE = 2 THEN ISNULL(MASTER_DATA1.RRT1, 0) ELSE 0 END AS PrevRRT1_VARIABLECOST,
      CASE WHEN MAX_PREV_REV.COST_TYPE = 1 THEN ISNULL(MASTER_DATA1.RRT2, 0) ELSE 0 END AS PrevRRT2_FIXCOST,
      CASE WHEN MAX_PREV_REV.COST_TYPE = 2 THEN ISNULL(MASTER_DATA1.RRT2, 0) ELSE 0 END AS PrevRRT2_VARIABLECOST,
      CASE WHEN MAX_PREV_REV.COST_TYPE = 1 THEN ISNULL(MASTER_DATA1.RRT3, 0) ELSE 0 END AS PrevRRT3_FIXCOST,
      CASE WHEN MAX_PREV_REV.COST_TYPE = 2 THEN ISNULL(MASTER_DATA1.RRT3, 0) ELSE 0 END AS PrevRRT3_VARIABLECOST,
      CASE WHEN MAX_PREV_REV.COST_TYPE = 1 THEN ISNULL(MASTER_DATA1.RRT4, 0) ELSE 0 END AS PrevRRT4_FIXCOST,
      CASE WHEN MAX_PREV_REV.COST_TYPE = 2 THEN ISNULL(MASTER_DATA1.RRT4, 0) ELSE 0 END AS PrevRRT4_VARIABLECOST,
      CASE WHEN MAX_PREV_REV.COST_TYPE = 1 THEN ISNULL(MASTER_DATA1.RRT5, 0) ELSE 0 END AS PrevRRT5_FIXCOST,
      CASE WHEN MAX_PREV_REV.COST_TYPE = 2 THEN ISNULL(MASTER_DATA1.RRT5, 0) ELSE 0 END AS PrevRRT5_VARIABLECOST,

      CASE WHEN MAX_REV.COST_TYPE = 1 THEN ISNULL(OB_BUDGET_DATA.M1, 0) + ISNULL(OB_BUDGET_DATA.M2, 0) + ISNULL(OB_BUDGET_DATA.M3, 0) + ISNULL(OB_BUDGET_DATA.M4, 0) + ISNULL(OB_BUDGET_DATA.M5, 0) + ISNULL(OB_BUDGET_DATA.M6, 0) + ISNULL(OB_BUDGET_DATA.M7, 0) + ISNULL(OB_BUDGET_DATA.M8, 0) + ISNULL(OB_BUDGET_DATA.M9, 0) + ISNULL(OB_BUDGET_DATA.M10, 0) + ISNULL(OB_BUDGET_DATA.M11, 0) + ISNULL(OB_BUDGET_DATA.M12, 0) ELSE 0 END AS REVISE_TOTAL_YEAR_FIXCOST,
      CASE WHEN MAX_REV.COST_TYPE = 2 THEN ISNULL(OB_BUDGET_DATA.M1, 0) + ISNULL(OB_BUDGET_DATA.M2, 0) + ISNULL(OB_BUDGET_DATA.M3, 0) + ISNULL(OB_BUDGET_DATA.M4, 0) + ISNULL(OB_BUDGET_DATA.M5, 0) + ISNULL(OB_BUDGET_DATA.M6, 0) + ISNULL(OB_BUDGET_DATA.M7, 0) + ISNULL(OB_BUDGET_DATA.M8, 0) + ISNULL(OB_BUDGET_DATA.M9, 0) + ISNULL(OB_BUDGET_DATA.M10, 0) + ISNULL(OB_BUDGET_DATA.M11, 0) + ISNULL(OB_BUDGET_DATA.M12, 0) ELSE 0 END AS REVISE_TOTAL_YEAR_VARIABLECOST,

      CASE WHEN MAX_REV.COST_TYPE = 1 THEN ISNULL(OB_BUDGET_DATA.M1, 0) + ISNULL(OB_BUDGET_DATA.M2, 0) + ISNULL(OB_BUDGET_DATA.M3, 0) + ISNULL(OB_BUDGET_DATA.M4, 0) + ISNULL(OB_BUDGET_DATA.M5, 0) + ISNULL(OB_BUDGET_DATA.M6, 0) + ISNULL(OB_BUDGET_DATA.M7, 0) + ISNULL(OB_BUDGET_DATA.M8, 0) + ISNULL(OB_BUDGET_DATA.M9, 0) + ISNULL(OB_BUDGET_DATA.M10, 0) + ISNULL(OB_BUDGET_DATA.M11, 0) + ISNULL(OB_BUDGET_DATA.M12, 0)  - ISNULL(MASTER_DATA1.RRT2, 0) ELSE 0 END AS DIFF_TOTAL_YEAR_FIXCOST,
      CASE WHEN MAX_REV.COST_TYPE = 2 THEN ISNULL(OB_BUDGET_DATA.M1, 0) + ISNULL(OB_BUDGET_DATA.M2, 0) + ISNULL(OB_BUDGET_DATA.M3, 0) + ISNULL(OB_BUDGET_DATA.M4, 0) + ISNULL(OB_BUDGET_DATA.M5, 0) + ISNULL(OB_BUDGET_DATA.M6, 0) + ISNULL(OB_BUDGET_DATA.M7, 0) + ISNULL(OB_BUDGET_DATA.M8, 0) + ISNULL(OB_BUDGET_DATA.M9, 0) + ISNULL(OB_BUDGET_DATA.M10, 0) + ISNULL(OB_BUDGET_DATA.M11, 0) + ISNULL(OB_BUDGET_DATA.M12, 0)  - ISNULL(MASTER_DATA1.RRT2, 0) ELSE 0 END AS DIFF_TOTAL_YEAR_VARIABLECOST
      ,(ISNULL(MTP.RRT2,0) -  ISNULL(MASTER_DATA1.RRT3, 0)) AS DIFF_PREV_YEAR
      ,CASE WHEN MAX_REV.COST_TYPE = 1 THEN ISNULL(MTP.RRT2, 0)  - ISNULL(MASTER_DATA1.RRT3, 0) ELSE 0 END AS DIFF_PREV_YEAR_FIXCOST
      ,CASE WHEN MAX_REV.COST_TYPE = 2 THEN ISNULL(MTP.RRT2, 0)  - ISNULL(MASTER_DATA1.RRT3, 0) ELSE 0 END AS DIFF_PREV_YEAR_VARIABLECOST
      FROM
      (
      SELECT BD.*,  BO.BUDGET_ORDER_NAME,BO.PIC_SHOW_FLAG AS PIC_SHOW_FLG,
      AC.ACCOUNT_NO, AC.ACCOUNT_NAME,
      BO.COST, BO.COST_TYPE, DP.DEPT_NO, DP.DEPT_NAME,
      PIC.PERSON_IN_CHARGE_NO, PIC.PERSON_IN_CHARGE_NAME FROM
      BG_T_BUDGET_DATA AS BD
      LEFT JOIN BG_M_BUDGET_ORDER AS BO ON BD.BUDGET_ORDER_NO = BO.BUDGET_ORDER_NO
      LEFT JOIN BG_M_ACCOUNT AS AC ON BO.ACCOUNT_NO = AC.ACCOUNT_NO
      LEFT JOIN BG_M_DEPT AS DP ON BO.DEPT_NO = DP.DEPT_NO
      LEFT JOIN BG_M_PERSON_IN_CHARGE AS PIC ON BO.PERSON_IN_CHARGE_NO = PIC.PERSON_IN_CHARGE_NO
      LEFT JOIN BG_T_BUDGET_PERIOD AS BP ON BD.BUDGET_YEAR = BP.BUDGET_YEAR AND BD.PERIOD_TYPE = BP.PERIOD_TYPE AND BD.PROJECT_NO = BP.PROJECT_NO
      WHERE
      BD.BUDGET_YEAR = @YEAR
      AND BD.PERIOD_TYPE = @PERIOD
      AND BO.BUDGET_TYPE = 'E'
      AND BD.REV_NO = (SELECT ISNULL(MAX(REV_NO),1) AS MAX_REV_NO FROM BG_T_BUDGET_HEADER
      WHERE BUDGET_YEAR = @YEAR
      AND PERIOD_TYPE = @PERIOD AND BUDGET_TYPE = 'E' AND PROJECT_NO = @PROJECTNO)
      AND BD.PROJECT_NO = @PROJECTNO AND
      BO.ACTIVE_FLAG = 1  
     
      @PICCONDITION
      ) AS MTP
      LEFT JOIN
      (
      SELECT BUDGET_DATA.BUDGET_ORDER_NO, BUDGET_DATA.BUDGET_YEAR, BUDGET_ORDER.COST_TYPE,
      BUDGET_DATA.PERIOD_TYPE, BUDGET_DATA.PROJECT_NO, MAX(BUDGET_DATA.REV_NO) AS REV_NO, BUDGET_ORDER.BUDGET_ORDER_NAME,
      BUDGET_ORDER.DEPT_NO, BUDGET_ORDER.PERSON_IN_CHARGE_NO, PIC.PERSON_IN_CHARGE_NAME
      FROM BG_T_BUDGET_DATA AS BUDGET_DATA
      INNER JOIN BG_M_BUDGET_ORDER AS BUDGET_ORDER
      ON BUDGET_ORDER.BUDGET_ORDER_NO = BUDGET_DATA.BUDGET_ORDER_NO AND BUDGET_ORDER.BUDGET_TYPE = 'E' AND BUDGET_ORDER.ACTIVE_FLAG = 1
      INNER JOIN BG_M_PERSON_IN_CHARGE AS PIC
      ON PIC.PERSON_IN_CHARGE_NO = BUDGET_ORDER.PERSON_IN_CHARGE_NO
      WHERE BUDGET_DATA.BUDGET_YEAR = @YEAR
      AND BUDGET_DATA.PERIOD_TYPE = 10
     
      AND BUDGET_DATA.PROJECT_NO = @RefRBProjectNo
      AND BUDGET_DATA.REV_NO = @RefRBRevNo
      GROUP BY BUDGET_DATA.BUDGET_ORDER_NO, BUDGET_DATA.BUDGET_YEAR, BUDGET_DATA.PERIOD_TYPE, BUDGET_DATA.PROJECT_NO, BUDGET_ORDER.BUDGET_ORDER_NAME, BUDGET_ORDER.DEPT_NO, BUDGET_ORDER.COST_TYPE,
      BUDGET_ORDER.PERSON_IN_CHARGE_NO, PIC.PERSON_IN_CHARGE_NAME) AS MAX_REV ON MTP.BUDGET_ORDER_NO = MAX_REV.BUDGET_ORDER_NO

      LEFT JOIN BG_T_BUDGET_DATA AS MASTER_DATA
      ON MAX_REV.BUDGET_YEAR = MASTER_DATA.BUDGET_YEAR
      AND MAX_REV.PERIOD_TYPE = MASTER_DATA.PERIOD_TYPE
      AND MAX_REV.PROJECT_NO = MASTER_DATA.PROJECT_NO
      AND MAX_REV.BUDGET_ORDER_NO = MASTER_DATA.BUDGET_ORDER_NO
      AND MAX_REV.REV_NO = MASTER_DATA.REV_NO

      LEFT JOIN
      (
      SELECT BUDGET_DATA1.BUDGET_ORDER_NO, BUDGET_DATA1.BUDGET_YEAR, BUDGET_ORDER1.COST_TYPE,
      BUDGET_DATA1.PERIOD_TYPE, BUDGET_DATA1.PROJECT_NO, MAX(BUDGET_DATA1.REV_NO) AS REV_NO, BUDGET_ORDER1.BUDGET_ORDER_NAME,
      BUDGET_ORDER1.DEPT_NO, BUDGET_ORDER1.PERSON_IN_CHARGE_NO, PIC1.PERSON_IN_CHARGE_NAME
      FROM BG_T_BUDGET_DATA AS BUDGET_DATA1
      INNER JOIN BG_M_BUDGET_ORDER AS BUDGET_ORDER1
      ON BUDGET_ORDER1.BUDGET_ORDER_NO = BUDGET_DATA1.BUDGET_ORDER_NO AND BUDGET_ORDER1.BUDGET_TYPE = 'E' AND BUDGET_ORDER1.ACTIVE_FLAG = 1
      INNER JOIN BG_M_PERSON_IN_CHARGE AS PIC1
      ON PIC1.PERSON_IN_CHARGE_NO = BUDGET_ORDER1.PERSON_IN_CHARGE_NO
      WHERE BUDGET_DATA1.BUDGET_YEAR = (@YEAR - 1)
      AND BUDGET_DATA1.PERIOD_TYPE = @PERIOD
     
      AND BUDGET_DATA1.PROJECT_NO = @MtpProjectNo
      AND BUDGET_DATA1.REV_NO = @MtpRevNo
      GROUP BY BUDGET_DATA1.BUDGET_ORDER_NO, BUDGET_DATA1.BUDGET_YEAR, BUDGET_DATA1.PERIOD_TYPE, BUDGET_DATA1.PROJECT_NO, BUDGET_ORDER1.BUDGET_ORDER_NAME, BUDGET_ORDER1.DEPT_NO, BUDGET_ORDER1.COST_TYPE,
      BUDGET_ORDER1.PERSON_IN_CHARGE_NO, PIC1.PERSON_IN_CHARGE_NAME) AS MAX_PREV_REV ON MTP.BUDGET_ORDER_NO = MAX_PREV_REV.BUDGET_ORDER_NO

      LEFT JOIN BG_T_BUDGET_DATA AS MASTER_DATA1
      ON MAX_PREV_REV.BUDGET_YEAR = MASTER_DATA1.BUDGET_YEAR
      AND MAX_PREV_REV.PERIOD_TYPE = MASTER_DATA1.PERIOD_TYPE
      AND MAX_PREV_REV.PROJECT_NO = MASTER_DATA1.PROJECT_NO
      AND MAX_PREV_REV.BUDGET_ORDER_NO = MASTER_DATA1.BUDGET_ORDER_NO
      AND MAX_PREV_REV.REV_NO = MASTER_DATA1.REV_NO

      LEFT OUTER JOIN BG_T_UPLOAD_DATA AS ACTUAL_DATA
      ON ACTUAL_DATA.BUDGET_YEAR = MAX_REV.BUDGET_YEAR
      AND ACTUAL_DATA.BUDGET_ORDER_NO = MAX_REV.BUDGET_ORDER_NO
      AND ACTUAL_DATA.DATA_TYPE = 2
      AND ACTUAL_DATA.PERIOD_TYPE = 3
      AND ACTUAL_DATA.PROJECT_NO = 1

      LEFT JOIN BG_T_BUDGET_DATA AS OB_MASTER_DATA
      ON MAX_REV.BUDGET_YEAR = OB_MASTER_DATA.BUDGET_YEAR
      AND MAX_REV.PERIOD_TYPE = OB_MASTER_DATA.PERIOD_TYPE
      AND MAX_REV.PROJECT_NO = OB_MASTER_DATA.PROJECT_NO
      AND MAX_REV.BUDGET_ORDER_NO = OB_MASTER_DATA.BUDGET_ORDER_NO
      AND MAX_REV.REV_NO = OB_MASTER_DATA.REV_NO

      LEFT OUTER JOIN BG_T_UPLOAD_DATA AS OB_ACTUAL_DATA
      ON OB_ACTUAL_DATA.BUDGET_YEAR = MAX_REV.BUDGET_YEAR
      AND OB_ACTUAL_DATA.BUDGET_ORDER_NO = MAX_REV.BUDGET_ORDER_NO
      AND OB_ACTUAL_DATA.DATA_TYPE = 2
      AND OB_ACTUAL_DATA.PERIOD_TYPE = @REFPERIOD
      AND OB_ACTUAL_DATA.PROJECT_NO = 1

      LEFT OUTER JOIN BG_T_BUDGET_DATA AS OB_BUDGET_DATA
      ON OB_BUDGET_DATA.BUDGET_YEAR = MAX_REV.BUDGET_YEAR + 1
      AND OB_BUDGET_DATA.BUDGET_ORDER_NO = MAX_REV.BUDGET_ORDER_NO
      AND OB_BUDGET_DATA.PERIOD_TYPE = 1
      AND OB_BUDGET_DATA.PROJECT_NO = @RefRBProjectNo
      AND OB_BUDGET_DATA.REV_NO = @RefRBRevNo

      WHERE(ISNULL(OB_BUDGET_DATA.M1, 0) &lt;&gt; 0
      OR ISNULL(OB_BUDGET_DATA.M2, 0) &lt;&gt; 0
      OR ISNULL(OB_BUDGET_DATA.M3, 0) &lt;&gt; 0
      OR ISNULL(OB_BUDGET_DATA.M4, 0) &lt;&gt; 0
      OR ISNULL(OB_BUDGET_DATA.M5, 0) &lt;&gt; 0
      OR ISNULL(OB_BUDGET_DATA.M6, 0) &lt;&gt; 0
      OR ISNULL(OB_BUDGET_DATA.M7, 0) &lt;&gt; 0
      OR ISNULL(OB_BUDGET_DATA.M8, 0) &lt;&gt; 0
      OR ISNULL(OB_BUDGET_DATA.M9, 0) &lt;&gt; 0
      OR ISNULL(OB_BUDGET_DATA.M10, 0) &lt;&gt; 0
      OR ISNULL(OB_BUDGET_DATA.M11, 0) &lt;&gt; 0
      OR ISNULL(OB_BUDGET_DATA.M12, 0) &lt;&gt; 0
      OR ISNULL(MASTER_DATA1.RRT1, 0) &lt;&gt; 0
      OR ISNULL(MASTER_DATA1.RRT2, 0) &lt;&gt; 0
      OR ISNULL(MASTER_DATA1.RRT3, 0) &lt;&gt; 0
      OR ISNULL(MASTER_DATA1.RRT4, 0) &lt;&gt; 0
      OR ISNULL(MASTER_DATA1.RRT5, 0) &lt;&gt; 0
      OR ISNULL(MTP.RRT1, 0) &lt;&gt; 0
      OR ISNULL(MTP.RRT2, 0) &lt;&gt; 0
      OR ISNULL(MTP.RRT3, 0) &lt;&gt; 0
      OR ISNULL(MTP.RRT4, 0) &lt;&gt; 0
      OR ISNULL(MTP.RRT5, 0) &lt;&gt; 0)

      ORDER BY MTP.BUDGET_ORDER_NO
    </SELECT004_6>-->

    <!--<SELECT004_7>
      SELECT MTP.BUDGET_YEAR, MTP.PERIOD_TYPE, MTP.PROJECT_NO, MTP.PERSON_IN_CHARGE_NO, MTP.PERSON_IN_CHARGE_NAME, MTP.PIC_SHOW_FLG,
      SUM(MTP.RRT1) AS RRT1,
      SUM(MTP.RRT2) AS RRT2,
      SUM(MTP.RRT3) AS RRT3,
      SUM(MTP.RRT4) AS RRT4,
      SUM(MTP.RRT5) AS RRT5,


      ISNULL(OB_BUDGET_DATA.OB_DATA,0) AS REVISE_TOTAL_YEAR,

      ISNULL(OB_BUDGET_DATA.OB_DATA, 0) - SUM(ISNULL(MASTER_DATA1.RRT2, 0)) AS DIFF_TOTAL_YEAR,

      SUM(ISNULL(MASTER_DATA1.RRT1, 0)) AS PrevRRT1,
      SUM(ISNULL(MASTER_DATA1.RRT2, 0)) AS PrevRRT2,
      SUM(ISNULL(MASTER_DATA1.RRT3, 0)) AS PrevRRT3,
      SUM(ISNULL(MASTER_DATA1.RRT4, 0)) AS PrevRRT4,
      SUM(ISNULL(MASTER_DATA1.RRT5, 0)) AS PrevRRT5,
      SUM(CASE WHEN MAX_REV.COST_TYPE = 1 THEN ISNULL(MTP.RRT1, 0) ELSE 0 END) AS RRT1_FIXCOST,
      SUM(CASE WHEN MAX_REV.COST_TYPE = 2 THEN ISNULL(MTP.RRT1, 0) ELSE 0 END) AS RRT1_VARIABLECOST,
      SUM(CASE WHEN MAX_REV.COST_TYPE = 1 THEN ISNULL(MTP.RRT2, 0) ELSE 0 END) AS RRT2_FIXCOST,
      SUM(CASE WHEN MAX_REV.COST_TYPE = 2 THEN ISNULL(MTP.RRT2, 0) ELSE 0 END) AS RRT2_VARIABLECOST,
      SUM(CASE WHEN MAX_REV.COST_TYPE = 1 THEN ISNULL(MTP.RRT3, 0) ELSE 0 END) AS RRT3_FIXCOST,
      SUM(CASE WHEN MAX_REV.COST_TYPE = 2 THEN ISNULL(MTP.RRT3, 0) ELSE 0 END) AS RRT3_VARIABLECOST,
      SUM(CASE WHEN MAX_REV.COST_TYPE = 1 THEN ISNULL(MTP.RRT4, 0) ELSE 0 END) AS RRT4_FIXCOST,
      SUM(CASE WHEN MAX_REV.COST_TYPE = 2 THEN ISNULL(MTP.RRT4, 0) ELSE 0 END) AS RRT4_VARIABLECOST,
      SUM(CASE WHEN MAX_REV.COST_TYPE = 1 THEN ISNULL(MTP.RRT5, 0) ELSE 0 END) AS RRT5_FIXCOST,
      SUM(CASE WHEN MAX_REV.COST_TYPE = 2 THEN ISNULL(MTP.RRT5, 0) ELSE 0 END) AS RRT5_VARIABLECOST,

      SUM(CASE WHEN MAX_PREV_REV.COST_TYPE = 1 THEN ISNULL(MASTER_DATA1.RRT1, 0) ELSE 0 END) AS PrevRRT1_FIXCOST,
      SUM(CASE WHEN MAX_PREV_REV.COST_TYPE = 2 THEN ISNULL(MASTER_DATA1.RRT1, 0) ELSE 0 END) AS PrevRRT1_VARIABLECOST,
      SUM(CASE WHEN MAX_PREV_REV.COST_TYPE = 1 THEN ISNULL(MASTER_DATA1.RRT2, 0) ELSE 0 END) AS PrevRRT2_FIXCOST,
      SUM(CASE WHEN MAX_PREV_REV.COST_TYPE = 2 THEN ISNULL(MASTER_DATA1.RRT2, 0) ELSE 0 END) AS PrevRRT2_VARIABLECOST,
      SUM(CASE WHEN MAX_PREV_REV.COST_TYPE = 1 THEN ISNULL(MASTER_DATA1.RRT3, 0) ELSE 0 END) AS PrevRRT3_FIXCOST,
      SUM(CASE WHEN MAX_PREV_REV.COST_TYPE = 2 THEN ISNULL(MASTER_DATA1.RRT3, 0) ELSE 0 END) AS PrevRRT3_VARIABLECOST,
      SUM(CASE WHEN MAX_PREV_REV.COST_TYPE = 1 THEN ISNULL(MASTER_DATA1.RRT4, 0) ELSE 0 END) AS PrevRRT4_FIXCOST,
      SUM(CASE WHEN MAX_PREV_REV.COST_TYPE = 2 THEN ISNULL(MASTER_DATA1.RRT4, 0) ELSE 0 END) AS PrevRRT4_VARIABLECOST,
      SUM(CASE WHEN MAX_PREV_REV.COST_TYPE = 1 THEN ISNULL(MASTER_DATA1.RRT5, 0) ELSE 0 END) AS PrevRRT5_FIXCOST,
      SUM(CASE WHEN MAX_PREV_REV.COST_TYPE = 2 THEN ISNULL(MASTER_DATA1.RRT5, 0) ELSE 0 END) AS PrevRRT5_VARIABLECOST,


      ISNULL(OB_BUDGET_DATA.REVISE_TOTAL_YEAR_FIXCOST,0) AS REVISE_TOTAL_YEAR_FIXCOST,



      ISNULL(OB_BUDGET_DATA.REVISE_TOTAL_YEAR_VARIABLECOST,0) AS REVISE_TOTAL_YEAR_VARIABLECOST,
 
      

      ISNULL(OB_BUDGET_DATA.REVISE_TOTAL_YEAR_FIXCOST,0) - SUM(CASE WHEN MAX_REV.COST_TYPE = 1 THEN ISNULL(MASTER_DATA1.RRT2, 0) ELSE 0 END) AS DIFF_TOTAL_YEAR_FIXCOST,
      ISNULL(OB_BUDGET_DATA.REVISE_TOTAL_YEAR_VARIABLECOST,0) - SUM(CASE WHEN MAX_REV.COST_TYPE = 2 THEN ISNULL(MASTER_DATA1.RRT2, 0) ELSE 0 END) AS DIFF_TOTAL_YEAR_VARIABLECOST

      ,SUM(ISNULL(MTP.RRT2, 0)  - ISNULL(MASTER_DATA1.RRT3, 0)) AS DIFF_PREV_YEAR
      ,SUM(CASE WHEN MAX_REV.COST_TYPE = 1 THEN ISNULL(MTP.RRT2, 0) - ISNULL(MASTER_DATA1.RRT3, 0) ELSE 0 END) AS DIFF_PREV_YEAR_FIXCOST
      ,SUM(CASE WHEN MAX_REV.COST_TYPE = 2 THEN ISNULL(MTP.RRT2, 0) - ISNULL(MASTER_DATA1.RRT3, 0) ELSE 0 END) AS DIFF_PREV_YEAR_VARIABLECOST
      FROM
      (
      SELECT BD.*,  BO.BUDGET_ORDER_NAME,BO.PIC_SHOW_FLAG AS PIC_SHOW_FLG,
      AC.ACCOUNT_NO, AC.ACCOUNT_NAME,
      BO.COST, BO.COST_TYPE, DP.DEPT_NO, DP.DEPT_NAME,
      PIC.PERSON_IN_CHARGE_NO, PIC.PERSON_IN_CHARGE_NAME FROM
      BG_T_BUDGET_DATA AS BD
      LEFT JOIN BG_M_BUDGET_ORDER AS BO ON BD.BUDGET_ORDER_NO = BO.BUDGET_ORDER_NO
      LEFT JOIN BG_M_ACCOUNT AS AC ON BO.ACCOUNT_NO = AC.ACCOUNT_NO
      LEFT JOIN BG_M_DEPT AS DP ON BO.DEPT_NO = DP.DEPT_NO
      LEFT JOIN BG_M_PERSON_IN_CHARGE AS PIC ON BO.PERSON_IN_CHARGE_NO = PIC.PERSON_IN_CHARGE_NO
      LEFT JOIN BG_T_BUDGET_PERIOD AS BP ON BD.BUDGET_YEAR = BP.BUDGET_YEAR AND BD.PERIOD_TYPE = BP.PERIOD_TYPE AND BD.PROJECT_NO = BP.PROJECT_NO
      WHERE
      BD.BUDGET_YEAR = @YEAR
      AND BD.PERIOD_TYPE = @PERIOD
      AND BO.BUDGET_TYPE = 'E'
      AND BD.REV_NO = (SELECT ISNULL(MAX(REV_NO),1) AS MAX_REV_NO FROM BG_T_BUDGET_HEADER
      WHERE BUDGET_YEAR = @YEAR
      AND PERIOD_TYPE = @PERIOD AND BUDGET_TYPE = 'E' AND PROJECT_NO = @PROJECTNO)
      AND BD.PROJECT_NO = @PROJECTNO AND
      BO.ACTIVE_FLAG = 1  
      @PICCONDITION
      ) AS MTP
      LEFT JOIN
      (
      SELECT BUDGET_DATA.BUDGET_ORDER_NO, BUDGET_DATA.BUDGET_YEAR, BUDGET_ORDER.COST_TYPE,
      BUDGET_DATA.PERIOD_TYPE, BUDGET_DATA.PROJECT_NO, MAX(BUDGET_DATA.REV_NO) AS REV_NO, BUDGET_ORDER.BUDGET_ORDER_NAME,
      BUDGET_ORDER.DEPT_NO, BUDGET_ORDER.PERSON_IN_CHARGE_NO, PIC.PERSON_IN_CHARGE_NAME
      FROM BG_T_BUDGET_DATA AS BUDGET_DATA
      INNER JOIN BG_M_BUDGET_ORDER AS BUDGET_ORDER
      ON BUDGET_ORDER.BUDGET_ORDER_NO = BUDGET_DATA.BUDGET_ORDER_NO AND BUDGET_ORDER.BUDGET_TYPE = 'E' AND BUDGET_ORDER.ACTIVE_FLAG = 1
      INNER JOIN BG_M_PERSON_IN_CHARGE AS PIC
      ON PIC.PERSON_IN_CHARGE_NO = BUDGET_ORDER.PERSON_IN_CHARGE_NO
      WHERE BUDGET_DATA.BUDGET_YEAR = @YEAR
      AND BUDGET_DATA.PERIOD_TYPE = 3
      AND BUDGET_DATA.PROJECT_NO = @RefRBProjectNo
      AND BUDGET_DATA.REV_NO = @RefRBRevNo
      GROUP BY BUDGET_DATA.BUDGET_ORDER_NO, BUDGET_DATA.BUDGET_YEAR, BUDGET_DATA.PERIOD_TYPE, BUDGET_DATA.PROJECT_NO, BUDGET_ORDER.BUDGET_ORDER_NAME, BUDGET_ORDER.DEPT_NO, BUDGET_ORDER.COST_TYPE,
      BUDGET_ORDER.PERSON_IN_CHARGE_NO, PIC.PERSON_IN_CHARGE_NAME) AS MAX_REV ON MTP.BUDGET_ORDER_NO = MAX_REV.BUDGET_ORDER_NO

      LEFT JOIN BG_T_BUDGET_DATA AS MASTER_DATA
      ON MAX_REV.BUDGET_YEAR = MASTER_DATA.BUDGET_YEAR
      AND MAX_REV.PERIOD_TYPE = MASTER_DATA.PERIOD_TYPE
      AND MAX_REV.PROJECT_NO = MASTER_DATA.PROJECT_NO
      AND MAX_REV.BUDGET_ORDER_NO = MASTER_DATA.BUDGET_ORDER_NO
      AND MAX_REV.REV_NO = MASTER_DATA.REV_NO

      LEFT JOIN
      (
      SELECT BUDGET_DATA1.BUDGET_ORDER_NO, BUDGET_DATA1.BUDGET_YEAR, BUDGET_ORDER1.COST_TYPE,
      BUDGET_DATA1.PERIOD_TYPE, BUDGET_DATA1.PROJECT_NO, MAX(BUDGET_DATA1.REV_NO) AS REV_NO, BUDGET_ORDER1.BUDGET_ORDER_NAME,
      BUDGET_ORDER1.DEPT_NO, BUDGET_ORDER1.PERSON_IN_CHARGE_NO, PIC1.PERSON_IN_CHARGE_NAME
      FROM BG_T_BUDGET_DATA AS BUDGET_DATA1
      INNER JOIN BG_M_BUDGET_ORDER AS BUDGET_ORDER1
      ON BUDGET_ORDER1.BUDGET_ORDER_NO = BUDGET_DATA1.BUDGET_ORDER_NO AND BUDGET_ORDER1.BUDGET_TYPE = 'E' AND BUDGET_ORDER1.ACTIVE_FLAG = 1
      INNER JOIN BG_M_PERSON_IN_CHARGE AS PIC1
      ON PIC1.PERSON_IN_CHARGE_NO = BUDGET_ORDER1.PERSON_IN_CHARGE_NO
      WHERE BUDGET_DATA1.BUDGET_YEAR = (@YEAR - 1)
      AND BUDGET_DATA1.PERIOD_TYPE = @PERIOD
     
      AND BUDGET_DATA1.PROJECT_NO = @MtpProjectNo
      AND BUDGET_DATA1.REV_NO = @MtpRevNo
      GROUP BY BUDGET_DATA1.BUDGET_ORDER_NO, BUDGET_DATA1.BUDGET_YEAR, BUDGET_DATA1.PERIOD_TYPE, BUDGET_DATA1.PROJECT_NO, BUDGET_ORDER1.BUDGET_ORDER_NAME, BUDGET_ORDER1.DEPT_NO, BUDGET_ORDER1.COST_TYPE,
      BUDGET_ORDER1.PERSON_IN_CHARGE_NO, PIC1.PERSON_IN_CHARGE_NAME) AS MAX_PREV_REV ON MTP.BUDGET_ORDER_NO = MAX_PREV_REV.BUDGET_ORDER_NO

      LEFT JOIN BG_T_BUDGET_DATA AS MASTER_DATA1
      ON MAX_PREV_REV.BUDGET_YEAR = MASTER_DATA1.BUDGET_YEAR
      AND MAX_PREV_REV.PERIOD_TYPE = MASTER_DATA1.PERIOD_TYPE
      AND MAX_PREV_REV.PROJECT_NO = MASTER_DATA1.PROJECT_NO
      AND MAX_PREV_REV.BUDGET_ORDER_NO = MASTER_DATA1.BUDGET_ORDER_NO
      AND MAX_PREV_REV.REV_NO = MASTER_DATA1.REV_NO

      LEFT OUTER JOIN BG_T_UPLOAD_DATA AS ACTUAL_DATA
      ON ACTUAL_DATA.BUDGET_YEAR = MAX_REV.BUDGET_YEAR
      AND ACTUAL_DATA.BUDGET_ORDER_NO = MAX_REV.BUDGET_ORDER_NO
      AND ACTUAL_DATA.DATA_TYPE = 2
      AND ACTUAL_DATA.PERIOD_TYPE = 3
      AND ACTUAL_DATA.PROJECT_NO = 1



      LEFT JOIN BG_T_BUDGET_DATA AS OB_MASTER_DATA
      ON MAX_REV.BUDGET_YEAR = OB_MASTER_DATA.BUDGET_YEAR
      AND MAX_REV.PERIOD_TYPE = OB_MASTER_DATA.PERIOD_TYPE
      AND MAX_REV.PROJECT_NO = OB_MASTER_DATA.PROJECT_NO
      AND MAX_REV.BUDGET_ORDER_NO = OB_MASTER_DATA.BUDGET_ORDER_NO
      AND MAX_REV.REV_NO = OB_MASTER_DATA.REV_NO


      LEFT OUTER JOIN BG_T_UPLOAD_DATA AS OB_ACTUAL_DATA
      ON OB_ACTUAL_DATA.BUDGET_YEAR = MAX_REV.BUDGET_YEAR
      AND OB_ACTUAL_DATA.BUDGET_ORDER_NO = MAX_REV.BUDGET_ORDER_NO
      AND OB_ACTUAL_DATA.DATA_TYPE = 2
      AND OB_ACTUAL_DATA.PERIOD_TYPE = @REFPERIOD
      AND OB_ACTUAL_DATA.PROJECT_NO = 1



      LEFT OUTER JOIN
      (
      SELECT
    
      BUDGET_DATA.BUDGET_YEAR,
      BUDGET_DATA.PERIOD_TYPE,
      BUDGET_DATA.PROJECT_NO,
      BUDGET_ORDER.PERSON_IN_CHARGE_NO,
      PIC.PERSON_IN_CHARGE_NAME
      ,SUM(ISNULL(M1,0)
      + ISNULL(M2,0)
      + ISNULL(M3,0)
      + ISNULL(M4,0)
      + ISNULL(M5,0)
      + ISNULL(M6,0)
      + ISNULL(M7,0)
      + ISNULL(M8,0)
      + ISNULL(M9,0)
      + ISNULL(M10,0)
      + ISNULL(M11,0)
      + ISNULL(M12,0)
      ) AS OB_DATA


      ,SUM(CASE WHEN COST_TYPE = 1 THEN ISNULL(M1, 0)
      + ISNULL(M2, 0) + ISNULL(M3, 0)
      + ISNULL(M4, 0) + ISNULL(M5, 0)
      + ISNULL(M6, 0) + ISNULL(M7, 0)
      + ISNULL(M8, 0) + ISNULL(M9, 0)
      + ISNULL(M10, 0) + ISNULL(M11, 0)
      + ISNULL(M12, 0) ELSE 0 END) AS REVISE_TOTAL_YEAR_FIXCOST,

      SUM(CASE WHEN COST_TYPE = 2 THEN ISNULL(M1, 0)
      + ISNULL(M2, 0) + ISNULL(M3, 0)
      + ISNULL(M4, 0) + ISNULL(M5, 0)
      + ISNULL(M6, 0) + ISNULL(M7, 0)
      + ISNULL(M8, 0) + ISNULL(M9, 0)
      + ISNULL(M10, 0) + ISNULL(M11, 0)
      + ISNULL(M12, 0) ELSE 0 END) AS REVISE_TOTAL_YEAR_VARIABLECOST


      FROM BG_T_BUDGET_DATA AS BUDGET_DATA
      INNER JOIN BG_M_BUDGET_ORDER AS BUDGET_ORDER
      ON BUDGET_ORDER.BUDGET_ORDER_NO = BUDGET_DATA.BUDGET_ORDER_NO AND BUDGET_ORDER.BUDGET_TYPE = 'E' AND BUDGET_ORDER.ACTIVE_FLAG = 1
      INNER JOIN BG_M_PERSON_IN_CHARGE AS PIC
      ON PIC.PERSON_IN_CHARGE_NO = BUDGET_ORDER.PERSON_IN_CHARGE_NO
      WHERE BUDGET_DATA.BUDGET_YEAR = 2018
      AND BUDGET_DATA.PERIOD_TYPE = 1
      AND BUDGET_DATA.PROJECT_NO = @RefRBProjectNo
      AND BUDGET_DATA.REV_NO = @RefRBRevNo
      GROUP BY
     
      BUDGET_DATA.BUDGET_YEAR,
      BUDGET_DATA.PERIOD_TYPE,
      BUDGET_DATA.PROJECT_NO,
      BUDGET_ORDER.PERSON_IN_CHARGE_NO,
      PIC.PERSON_IN_CHARGE_NAME
      )AS OB_BUDGET_DATA
      ON OB_BUDGET_DATA.PERSON_IN_CHARGE_NO = MTP.PERSON_IN_CHARGE_NO
     


      GROUP BY MTP.BUDGET_YEAR, MTP.PERIOD_TYPE, MTP.PROJECT_NO, MTP.PERSON_IN_CHARGE_NO, MTP.PERSON_IN_CHARGE_NAME, MTP.PIC_SHOW_FLG
      , OB_BUDGET_DATA.OB_DATA, OB_BUDGET_DATA.REVISE_TOTAL_YEAR_FIXCOST, REVISE_TOTAL_YEAR_VARIABLECOST
      ORDER BY MTP.PERSON_IN_CHARGE_NO
    </SELECT004_7>-->

    <SELECT004_7>
      SELECT

      MTP.BUDGET_YEAR, MTP.PERIOD_TYPE, MTP.PROJECT_NO,
      PICM.PERSON_IN_CHARGE_NO,
      PICM.PERSON_IN_CHARGE_NAME,
      PICM.PIC_SHOW_FLG,

      SUM(ISNULL(MTP.RRT1,0)) AS RRT1,
      SUM(ISNULL(MTP.RRT2,0)) AS RRT2,
      SUM(ISNULL(MTP.RRT3,0)) AS RRT3,
      SUM(ISNULL(MTP.RRT4,0)) AS RRT4,
      SUM(ISNULL(MTP.RRT5,0)) AS RRT5,

      ISNULL(OB_BUDGET_DATA.OB_DATA,0) AS REVISE_TOTAL_YEAR,

      ISNULL(OB_BUDGET_DATA.OB_DATA, 0) - SUM(ISNULL(MASTER_DATA1.RRT2, 0)) AS DIFF_TOTAL_YEAR,

      SUM(ISNULL(MASTER_DATA1.RRT1, 0)) AS PrevRRT1,
      SUM(ISNULL(MASTER_DATA1.RRT2, 0)) AS PrevRRT2,
      SUM(ISNULL(MASTER_DATA1.RRT3, 0)) AS PrevRRT3,
      SUM(ISNULL(MASTER_DATA1.RRT4, 0)) AS PrevRRT4,
      SUM(ISNULL(MASTER_DATA1.RRT5, 0)) AS PrevRRT5,
      SUM(CASE WHEN MAX_REV.COST_TYPE = 1 THEN ISNULL(MTP.RRT1, 0) ELSE 0 END) AS RRT1_FIXCOST,
      SUM(CASE WHEN MAX_REV.COST_TYPE = 2 THEN ISNULL(MTP.RRT1, 0) ELSE 0 END) AS RRT1_VARIABLECOST,
      SUM(CASE WHEN MAX_REV.COST_TYPE = 1 THEN ISNULL(MTP.RRT2, 0) ELSE 0 END) AS RRT2_FIXCOST,
      SUM(CASE WHEN MAX_REV.COST_TYPE = 2 THEN ISNULL(MTP.RRT2, 0) ELSE 0 END) AS RRT2_VARIABLECOST,
      SUM(CASE WHEN MAX_REV.COST_TYPE = 1 THEN ISNULL(MTP.RRT3, 0) ELSE 0 END) AS RRT3_FIXCOST,
      SUM(CASE WHEN MAX_REV.COST_TYPE = 2 THEN ISNULL(MTP.RRT3, 0) ELSE 0 END) AS RRT3_VARIABLECOST,
      SUM(CASE WHEN MAX_REV.COST_TYPE = 1 THEN ISNULL(MTP.RRT4, 0) ELSE 0 END) AS RRT4_FIXCOST,
      SUM(CASE WHEN MAX_REV.COST_TYPE = 2 THEN ISNULL(MTP.RRT4, 0) ELSE 0 END) AS RRT4_VARIABLECOST,
      SUM(CASE WHEN MAX_REV.COST_TYPE = 1 THEN ISNULL(MTP.RRT5, 0) ELSE 0 END) AS RRT5_FIXCOST,
      SUM(CASE WHEN MAX_REV.COST_TYPE = 2 THEN ISNULL(MTP.RRT5, 0) ELSE 0 END) AS RRT5_VARIABLECOST,

      SUM(CASE WHEN MAX_PREV_REV.COST_TYPE = 1 THEN ISNULL(MASTER_DATA1.RRT1, 0) ELSE 0 END) AS PrevRRT1_FIXCOST,
      SUM(CASE WHEN MAX_PREV_REV.COST_TYPE = 2 THEN ISNULL(MASTER_DATA1.RRT1, 0) ELSE 0 END) AS PrevRRT1_VARIABLECOST,
      SUM(CASE WHEN MAX_PREV_REV.COST_TYPE = 1 THEN ISNULL(MASTER_DATA1.RRT2, 0) ELSE 0 END) AS PrevRRT2_FIXCOST,
      SUM(CASE WHEN MAX_PREV_REV.COST_TYPE = 2 THEN ISNULL(MASTER_DATA1.RRT2, 0) ELSE 0 END) AS PrevRRT2_VARIABLECOST,
      SUM(CASE WHEN MAX_PREV_REV.COST_TYPE = 1 THEN ISNULL(MASTER_DATA1.RRT3, 0) ELSE 0 END) AS PrevRRT3_FIXCOST,
      SUM(CASE WHEN MAX_PREV_REV.COST_TYPE = 2 THEN ISNULL(MASTER_DATA1.RRT3, 0) ELSE 0 END) AS PrevRRT3_VARIABLECOST,
      SUM(CASE WHEN MAX_PREV_REV.COST_TYPE = 1 THEN ISNULL(MASTER_DATA1.RRT4, 0) ELSE 0 END) AS PrevRRT4_FIXCOST,
      SUM(CASE WHEN MAX_PREV_REV.COST_TYPE = 2 THEN ISNULL(MASTER_DATA1.RRT4, 0) ELSE 0 END) AS PrevRRT4_VARIABLECOST,
      SUM(CASE WHEN MAX_PREV_REV.COST_TYPE = 1 THEN ISNULL(MASTER_DATA1.RRT5, 0) ELSE 0 END) AS PrevRRT5_FIXCOST,
      SUM(CASE WHEN MAX_PREV_REV.COST_TYPE = 2 THEN ISNULL(MASTER_DATA1.RRT5, 0) ELSE 0 END) AS PrevRRT5_VARIABLECOST,

      ISNULL(OB_BUDGET_DATA.REVISE_TOTAL_YEAR_FIXCOST,0) AS REVISE_TOTAL_YEAR_FIXCOST,

      ISNULL(OB_BUDGET_DATA.REVISE_TOTAL_YEAR_VARIABLECOST,0) AS REVISE_TOTAL_YEAR_VARIABLECOST,

      ISNULL(OB_BUDGET_DATA.REVISE_TOTAL_YEAR_FIXCOST,0) - SUM(CASE WHEN MAX_REV.COST_TYPE = 1 THEN ISNULL(MASTER_DATA1.RRT2, 0) ELSE 0 END) AS DIFF_TOTAL_YEAR_FIXCOST,
      ISNULL(OB_BUDGET_DATA.REVISE_TOTAL_YEAR_VARIABLECOST,0) - SUM(CASE WHEN MAX_REV.COST_TYPE = 2 THEN ISNULL(MASTER_DATA1.RRT2, 0) ELSE 0 END) AS DIFF_TOTAL_YEAR_VARIABLECOST

      ,SUM(ISNULL(MTP.RRT2, 0)  - ISNULL(MASTER_DATA1.RRT3, 0)) AS DIFF_PREV_YEAR
      ,SUM(CASE WHEN MAX_REV.COST_TYPE = 1 THEN ISNULL(MTP.RRT2, 0) - ISNULL(MASTER_DATA1.RRT3, 0) ELSE 0 END) AS DIFF_PREV_YEAR_FIXCOST
      ,SUM(CASE WHEN MAX_REV.COST_TYPE = 2 THEN ISNULL(MTP.RRT2, 0) - ISNULL(MASTER_DATA1.RRT3, 0) ELSE 0 END) AS DIFF_PREV_YEAR_VARIABLECOST


      FROM
      (
      SELECT
      distinct(PIC.PERSON_IN_CHARGE_NO), PIC.PERSON_IN_CHARGE_NAME,BO.PIC_SHOW_FLAG AS PIC_SHOW_FLG FROM
      BG_T_BUDGET_DATA AS BD
      LEFT JOIN BG_M_BUDGET_ORDER AS BO ON BD.BUDGET_ORDER_NO = BO.BUDGET_ORDER_NO
      LEFT JOIN BG_M_ACCOUNT AS AC ON BO.ACCOUNT_NO = AC.ACCOUNT_NO
      LEFT JOIN BG_M_DEPT AS DP ON BO.DEPT_NO = DP.DEPT_NO
      LEFT JOIN BG_M_PERSON_IN_CHARGE AS PIC ON BO.PERSON_IN_CHARGE_NO = PIC.PERSON_IN_CHARGE_NO
      LEFT JOIN BG_T_BUDGET_PERIOD AS BP ON BD.BUDGET_YEAR = BP.BUDGET_YEAR AND BD.PERIOD_TYPE = BP.PERIOD_TYPE AND BD.PROJECT_NO = BP.PROJECT_NO
      WHERE
      BD.BUDGET_YEAR = @YEAR
      AND BD.PERIOD_TYPE = @PERIOD
      AND BO.BUDGET_TYPE = 'E'
      AND BD.REV_NO =  (SELECT ISNULL(MAX(REV_NO),1) AS MAX_REV_NO FROM BG_T_BUDGET_HEADER WHERE BUDGET_YEAR = @YEAR AND PERIOD_TYPE = @PERIOD AND BUDGET_TYPE = 'E' AND PROJECT_NO = @PROJECTNO)
      AND BD.PROJECT_NO = @PROJECTNO AND
      BO.ACTIVE_FLAG = 1

      UNION

      SELECT
      distinct(PIC.PERSON_IN_CHARGE_NO), PIC.PERSON_IN_CHARGE_NAME,BO.PIC_SHOW_FLAG AS PIC_SHOW_FLG FROM
      BG_T_BUDGET_DATA AS BD
      LEFT JOIN BG_M_BUDGET_ORDER AS BO ON BD.BUDGET_ORDER_NO = BO.BUDGET_ORDER_NO
      LEFT JOIN BG_M_ACCOUNT AS AC ON BO.ACCOUNT_NO = AC.ACCOUNT_NO
      LEFT JOIN BG_M_DEPT AS DP ON BO.DEPT_NO = DP.DEPT_NO
      LEFT JOIN BG_M_PERSON_IN_CHARGE AS PIC ON BO.PERSON_IN_CHARGE_NO = PIC.PERSON_IN_CHARGE_NO
      LEFT JOIN BG_T_BUDGET_PERIOD AS BP ON BD.BUDGET_YEAR = BP.BUDGET_YEAR AND BD.PERIOD_TYPE = BP.PERIOD_TYPE AND BD.PROJECT_NO = BP.PROJECT_NO
      WHERE
      BD.BUDGET_YEAR = @YEAR + 1
      AND BD.PERIOD_TYPE = 1
      AND BO.BUDGET_TYPE = 'E'
      AND BD.REV_NO = @RefRBRevNo
      AND BD.PROJECT_NO = @RefRBProjectNo AND
      BO.ACTIVE_FLAG = 1
      ) AS PICM


      LEFT JOIN
      (
      SELECT BD.*,  BO.BUDGET_ORDER_NAME,BO.PIC_SHOW_FLAG AS PIC_SHOW_FLG,
      AC.ACCOUNT_NO, AC.ACCOUNT_NAME,
      BO.COST, BO.COST_TYPE, DP.DEPT_NO, DP.DEPT_NAME,
      PIC.PERSON_IN_CHARGE_NO, PIC.PERSON_IN_CHARGE_NAME FROM
      BG_T_BUDGET_DATA AS BD
      LEFT JOIN BG_M_BUDGET_ORDER AS BO ON BD.BUDGET_ORDER_NO = BO.BUDGET_ORDER_NO
      LEFT JOIN BG_M_ACCOUNT AS AC ON BO.ACCOUNT_NO = AC.ACCOUNT_NO
      LEFT JOIN BG_M_DEPT AS DP ON BO.DEPT_NO = DP.DEPT_NO
      LEFT JOIN BG_M_PERSON_IN_CHARGE AS PIC ON BO.PERSON_IN_CHARGE_NO = PIC.PERSON_IN_CHARGE_NO
      LEFT JOIN BG_T_BUDGET_PERIOD AS BP ON BD.BUDGET_YEAR = BP.BUDGET_YEAR AND BD.PERIOD_TYPE = BP.PERIOD_TYPE AND BD.PROJECT_NO = BP.PROJECT_NO
      WHERE
      BD.BUDGET_YEAR = @YEAR
      AND BD.PERIOD_TYPE = @PERIOD
      AND BO.BUDGET_TYPE = 'E'
      AND BD.REV_NO =  (SELECT ISNULL(MAX(REV_NO),1) AS MAX_REV_NO FROM BG_T_BUDGET_HEADER WHERE BUDGET_YEAR = @YEAR AND PERIOD_TYPE = @PERIOD AND BUDGET_TYPE = 'E' AND PROJECT_NO = @PROJECTNO)
      AND BD.PROJECT_NO = @PROJECTNO AND
      BO.ACTIVE_FLAG = 1
      ) AS MTP
      ON MTP.PERSON_IN_CHARGE_NO = PICM.PERSON_IN_CHARGE_NO


      LEFT OUTER JOIN
      (
      SELECT
      BUDGET_DATA.BUDGET_YEAR,
      BUDGET_DATA.PERIOD_TYPE,
      BUDGET_DATA.PROJECT_NO,
      BUDGET_ORDER.PERSON_IN_CHARGE_NO,
      PIC.PERSON_IN_CHARGE_NAME
      ,SUM(ISNULL(M1,0)
      + ISNULL(M2,0)
      + ISNULL(M3,0)
      + ISNULL(M4,0)
      + ISNULL(M5,0)
      + ISNULL(M6,0)
      + ISNULL(M7,0)
      + ISNULL(M8,0)
      + ISNULL(M9,0)
      + ISNULL(M10,0)
      + ISNULL(M11,0)
      + ISNULL(M12,0)
      ) AS OB_DATA


      ,SUM(CASE WHEN COST_TYPE = 1 THEN ISNULL(M1, 0)
      + ISNULL(M2, 0) + ISNULL(M3, 0)
      + ISNULL(M4, 0) + ISNULL(M5, 0)
      + ISNULL(M6, 0) + ISNULL(M7, 0)
      + ISNULL(M8, 0) + ISNULL(M9, 0)
      + ISNULL(M10, 0) + ISNULL(M11, 0)
      + ISNULL(M12, 0) ELSE 0 END) AS REVISE_TOTAL_YEAR_FIXCOST,

      SUM(CASE WHEN COST_TYPE = 2 THEN ISNULL(M1, 0)
      + ISNULL(M2, 0) + ISNULL(M3, 0)
      + ISNULL(M4, 0) + ISNULL(M5, 0)
      + ISNULL(M6, 0) + ISNULL(M7, 0)
      + ISNULL(M8, 0) + ISNULL(M9, 0)
      + ISNULL(M10, 0) + ISNULL(M11, 0)
      + ISNULL(M12, 0) ELSE 0 END) AS REVISE_TOTAL_YEAR_VARIABLECOST


      FROM BG_T_BUDGET_DATA AS BUDGET_DATA
      INNER JOIN BG_M_BUDGET_ORDER AS BUDGET_ORDER
      ON BUDGET_ORDER.BUDGET_ORDER_NO = BUDGET_DATA.BUDGET_ORDER_NO AND BUDGET_ORDER.BUDGET_TYPE = 'E' AND BUDGET_ORDER.ACTIVE_FLAG = 1
      INNER JOIN BG_M_PERSON_IN_CHARGE AS PIC
      ON PIC.PERSON_IN_CHARGE_NO = BUDGET_ORDER.PERSON_IN_CHARGE_NO
      WHERE BUDGET_DATA.BUDGET_YEAR = @YEAR  +1
      AND BUDGET_DATA.PERIOD_TYPE = 1
      AND BUDGET_DATA.PROJECT_NO = @RefRBProjectNo
      AND BUDGET_DATA.REV_NO = @RefRBRevNo
      GROUP BY

      BUDGET_DATA.BUDGET_YEAR,
      BUDGET_DATA.PERIOD_TYPE,
      BUDGET_DATA.PROJECT_NO,
      BUDGET_ORDER.PERSON_IN_CHARGE_NO,
      PIC.PERSON_IN_CHARGE_NAME
      )AS OB_BUDGET_DATA
      ON OB_BUDGET_DATA.PERSON_IN_CHARGE_NO = PICM.PERSON_IN_CHARGE_NO


      LEFT JOIN
      (
      SELECT BUDGET_DATA.BUDGET_ORDER_NO, BUDGET_DATA.BUDGET_YEAR, BUDGET_ORDER.COST_TYPE,
      BUDGET_DATA.PERIOD_TYPE, BUDGET_DATA.PROJECT_NO, MAX(BUDGET_DATA.REV_NO) AS REV_NO, BUDGET_ORDER.BUDGET_ORDER_NAME,
      BUDGET_ORDER.DEPT_NO, BUDGET_ORDER.PERSON_IN_CHARGE_NO, PIC.PERSON_IN_CHARGE_NAME
      FROM BG_T_BUDGET_DATA AS BUDGET_DATA
      INNER JOIN BG_M_BUDGET_ORDER AS BUDGET_ORDER
      ON BUDGET_ORDER.BUDGET_ORDER_NO = BUDGET_DATA.BUDGET_ORDER_NO AND BUDGET_ORDER.BUDGET_TYPE = 'E' AND BUDGET_ORDER.ACTIVE_FLAG = 1
      INNER JOIN BG_M_PERSON_IN_CHARGE AS PIC
      ON PIC.PERSON_IN_CHARGE_NO = BUDGET_ORDER.PERSON_IN_CHARGE_NO
      WHERE BUDGET_DATA.BUDGET_YEAR = @YEAR
      AND BUDGET_DATA.PERIOD_TYPE = @PERIOD
      AND BUDGET_DATA.PROJECT_NO = @PROJECTNO
      AND BUDGET_DATA.REV_NO = @RefRBRevNo
      GROUP BY BUDGET_DATA.BUDGET_ORDER_NO, BUDGET_DATA.BUDGET_YEAR, BUDGET_DATA.PERIOD_TYPE, BUDGET_DATA.PROJECT_NO, BUDGET_ORDER.BUDGET_ORDER_NAME, BUDGET_ORDER.DEPT_NO, BUDGET_ORDER.COST_TYPE,
      BUDGET_ORDER.PERSON_IN_CHARGE_NO, PIC.PERSON_IN_CHARGE_NAME) AS MAX_REV ON MTP.BUDGET_ORDER_NO = MAX_REV.BUDGET_ORDER_NO

      LEFT JOIN BG_T_BUDGET_DATA AS MASTER_DATA
      ON MAX_REV.BUDGET_YEAR = MASTER_DATA.BUDGET_YEAR
      AND MAX_REV.PERIOD_TYPE = MASTER_DATA.PERIOD_TYPE
      AND MAX_REV.PROJECT_NO = MASTER_DATA.PROJECT_NO
      AND MAX_REV.BUDGET_ORDER_NO = MASTER_DATA.BUDGET_ORDER_NO
      AND MAX_REV.REV_NO = MASTER_DATA.REV_NO


      LEFT JOIN
      (
      SELECT BUDGET_DATA1.BUDGET_ORDER_NO, BUDGET_DATA1.BUDGET_YEAR, BUDGET_ORDER1.COST_TYPE,
      BUDGET_DATA1.PERIOD_TYPE, BUDGET_DATA1.PROJECT_NO, MAX(BUDGET_DATA1.REV_NO) AS REV_NO, BUDGET_ORDER1.BUDGET_ORDER_NAME,
      BUDGET_ORDER1.DEPT_NO, BUDGET_ORDER1.PERSON_IN_CHARGE_NO, PIC1.PERSON_IN_CHARGE_NAME
      FROM BG_T_BUDGET_DATA AS BUDGET_DATA1
      INNER JOIN BG_M_BUDGET_ORDER AS BUDGET_ORDER1
      ON BUDGET_ORDER1.BUDGET_ORDER_NO = BUDGET_DATA1.BUDGET_ORDER_NO AND BUDGET_ORDER1.BUDGET_TYPE = 'E' AND BUDGET_ORDER1.ACTIVE_FLAG = 1
      INNER JOIN BG_M_PERSON_IN_CHARGE AS PIC1
      ON PIC1.PERSON_IN_CHARGE_NO = BUDGET_ORDER1.PERSON_IN_CHARGE_NO
      WHERE BUDGET_DATA1.BUDGET_YEAR = (@YEAR - 1)
      AND BUDGET_DATA1.PERIOD_TYPE = @PERIOD
      AND BUDGET_DATA1.PROJECT_NO = @PROJECTNO
      AND BUDGET_DATA1.REV_NO = @MtpRevNo
      GROUP BY BUDGET_DATA1.BUDGET_ORDER_NO, BUDGET_DATA1.BUDGET_YEAR, BUDGET_DATA1.PERIOD_TYPE, BUDGET_DATA1.PROJECT_NO, BUDGET_ORDER1.BUDGET_ORDER_NAME, BUDGET_ORDER1.DEPT_NO, BUDGET_ORDER1.COST_TYPE,
      BUDGET_ORDER1.PERSON_IN_CHARGE_NO, PIC1.PERSON_IN_CHARGE_NAME) AS MAX_PREV_REV ON MTP.BUDGET_ORDER_NO = MAX_PREV_REV.BUDGET_ORDER_NO

      LEFT JOIN BG_T_BUDGET_DATA AS MASTER_DATA1
      ON MAX_PREV_REV.BUDGET_YEAR = MASTER_DATA1.BUDGET_YEAR
      AND MAX_PREV_REV.PERIOD_TYPE = MASTER_DATA1.PERIOD_TYPE
      AND MAX_PREV_REV.PROJECT_NO = MASTER_DATA1.PROJECT_NO
      AND MAX_PREV_REV.BUDGET_ORDER_NO = MASTER_DATA1.BUDGET_ORDER_NO
      AND MAX_PREV_REV.REV_NO = MASTER_DATA1.REV_NO


      GROUP BY MTP.BUDGET_YEAR, MTP.PERIOD_TYPE, MTP.PROJECT_NO, PICM.PERSON_IN_CHARGE_NO, PICM.PERSON_IN_CHARGE_NAME, PICM.PIC_SHOW_FLG
      ,OB_BUDGET_DATA.OB_DATA, OB_BUDGET_DATA.REVISE_TOTAL_YEAR_FIXCOST, REVISE_TOTAL_YEAR_VARIABLECOST
      ORDER BY PICM.PERSON_IN_CHARGE_NO
    </SELECT004_7>
    
    

    <!--<SELECT004_8>
      SELECT MTP.BUDGET_YEAR, MTP.PERIOD_TYPE, MTP.PROJECT_NO, MTP.PERSON_IN_CHARGE_NO, MTP.PERSON_IN_CHARGE_NAME, MTP.PIC_SHOW_FLG,
      SUM(MTP.RRT1) AS RRT1,
      SUM(MTP.RRT2) AS RRT2,
      SUM(MTP.RRT3) AS RRT3,
      SUM(MTP.RRT4) AS RRT4,
      SUM(MTP.RRT5) AS RRT5,

     
      ISNULL(OB_BUDGET_DATA.OB_DATA,0) AS REVISE_TOTAL_YEAR,

      ISNULL(OB_BUDGET_DATA.OB_DATA, 0) - SUM(ISNULL(MASTER_DATA1.RRT2, 0)) AS DIFF_TOTAL_YEAR,

      SUM(ISNULL(MASTER_DATA1.RRT1, 0)) AS PrevRRT1,
      SUM(ISNULL(MASTER_DATA1.RRT2, 0)) AS PrevRRT2,
      SUM(ISNULL(MASTER_DATA1.RRT3, 0)) AS PrevRRT3,
      SUM(ISNULL(MASTER_DATA1.RRT4, 0)) AS PrevRRT4,
      SUM(ISNULL(MASTER_DATA1.RRT5, 0)) AS PrevRRT5,
      SUM(CASE WHEN MAX_REV.COST_TYPE = 1 THEN ISNULL(MTP.RRT1, 0) ELSE 0 END) AS RRT1_FIXCOST,
      SUM(CASE WHEN MAX_REV.COST_TYPE = 2 THEN ISNULL(MTP.RRT1, 0) ELSE 0 END) AS RRT1_VARIABLECOST,
      SUM(CASE WHEN MAX_REV.COST_TYPE = 1 THEN ISNULL(MTP.RRT2, 0) ELSE 0 END) AS RRT2_FIXCOST,
      SUM(CASE WHEN MAX_REV.COST_TYPE = 2 THEN ISNULL(MTP.RRT2, 0) ELSE 0 END) AS RRT2_VARIABLECOST,
      SUM(CASE WHEN MAX_REV.COST_TYPE = 1 THEN ISNULL(MTP.RRT3, 0) ELSE 0 END) AS RRT3_FIXCOST,
      SUM(CASE WHEN MAX_REV.COST_TYPE = 2 THEN ISNULL(MTP.RRT3, 0) ELSE 0 END) AS RRT3_VARIABLECOST,
      SUM(CASE WHEN MAX_REV.COST_TYPE = 1 THEN ISNULL(MTP.RRT4, 0) ELSE 0 END) AS RRT4_FIXCOST,
      SUM(CASE WHEN MAX_REV.COST_TYPE = 2 THEN ISNULL(MTP.RRT4, 0) ELSE 0 END) AS RRT4_VARIABLECOST,
      SUM(CASE WHEN MAX_REV.COST_TYPE = 1 THEN ISNULL(MTP.RRT5, 0) ELSE 0 END) AS RRT5_FIXCOST,
      SUM(CASE WHEN MAX_REV.COST_TYPE = 2 THEN ISNULL(MTP.RRT5, 0) ELSE 0 END) AS RRT5_VARIABLECOST,

      SUM(CASE WHEN MAX_PREV_REV.COST_TYPE = 1 THEN ISNULL(MASTER_DATA1.RRT1, 0) ELSE 0 END) AS PrevRRT1_FIXCOST,
      SUM(CASE WHEN MAX_PREV_REV.COST_TYPE = 2 THEN ISNULL(MASTER_DATA1.RRT1, 0) ELSE 0 END) AS PrevRRT1_VARIABLECOST,
      SUM(CASE WHEN MAX_PREV_REV.COST_TYPE = 1 THEN ISNULL(MASTER_DATA1.RRT2, 0) ELSE 0 END) AS PrevRRT2_FIXCOST,
      SUM(CASE WHEN MAX_PREV_REV.COST_TYPE = 2 THEN ISNULL(MASTER_DATA1.RRT2, 0) ELSE 0 END) AS PrevRRT2_VARIABLECOST,
      SUM(CASE WHEN MAX_PREV_REV.COST_TYPE = 1 THEN ISNULL(MASTER_DATA1.RRT3, 0) ELSE 0 END) AS PrevRRT3_FIXCOST,
      SUM(CASE WHEN MAX_PREV_REV.COST_TYPE = 2 THEN ISNULL(MASTER_DATA1.RRT3, 0) ELSE 0 END) AS PrevRRT3_VARIABLECOST,
      SUM(CASE WHEN MAX_PREV_REV.COST_TYPE = 1 THEN ISNULL(MASTER_DATA1.RRT4, 0) ELSE 0 END) AS PrevRRT4_FIXCOST,
      SUM(CASE WHEN MAX_PREV_REV.COST_TYPE = 2 THEN ISNULL(MASTER_DATA1.RRT4, 0) ELSE 0 END) AS PrevRRT4_VARIABLECOST,
      SUM(CASE WHEN MAX_PREV_REV.COST_TYPE = 1 THEN ISNULL(MASTER_DATA1.RRT5, 0) ELSE 0 END) AS PrevRRT5_FIXCOST,
      SUM(CASE WHEN MAX_PREV_REV.COST_TYPE = 2 THEN ISNULL(MASTER_DATA1.RRT5, 0) ELSE 0 END) AS PrevRRT5_VARIABLECOST,

      
      ISNULL(OB_BUDGET_DATA.REVISE_TOTAL_YEAR_FIXCOST,0) AS REVISE_TOTAL_YEAR_FIXCOST,

   

      ISNULL(OB_BUDGET_DATA.REVISE_TOTAL_YEAR_FIXCOST,0) - SUM(CASE WHEN MAX_REV.COST_TYPE = 1 THEN ISNULL(MASTER_DATA1.RRT2, 0) ELSE 0 END) AS DIFF_TOTAL_YEAR_FIXCOST,
      ISNULL(OB_BUDGET_DATA.REVISE_TOTAL_YEAR_VARIABLECOST,0) - SUM(CASE WHEN MAX_REV.COST_TYPE = 2 THEN ISNULL(MASTER_DATA1.RRT2, 0) ELSE 0 END) AS DIFF_TOTAL_YEAR_VARIABLECOST

      ,SUM(ISNULL(MTP.RRT2, 0)  - ISNULL(MASTER_DATA1.RRT3, 0)) AS DIFF_PREV_YEAR
      ,SUM(CASE WHEN MAX_REV.COST_TYPE = 1 THEN ISNULL(MTP.RRT2, 0) - ISNULL(MASTER_DATA1.RRT3, 0) ELSE 0 END) AS DIFF_PREV_YEAR_FIXCOST
      ,SUM(CASE WHEN MAX_REV.COST_TYPE = 2 THEN ISNULL(MTP.RRT2, 0) - ISNULL(MASTER_DATA1.RRT3, 0) ELSE 0 END) AS DIFF_PREV_YEAR_VARIABLECOST

      FROM
      (
      SELECT BD.*,  BO.BUDGET_ORDER_NAME,BO.PIC_SHOW_FLAG AS PIC_SHOW_FLG,
      AC.ACCOUNT_NO, AC.ACCOUNT_NAME,
      BO.COST, BO.COST_TYPE, DP.DEPT_NO, DP.DEPT_NAME,
      PIC.PERSON_IN_CHARGE_NO, PIC.PERSON_IN_CHARGE_NAME FROM
      BG_T_BUDGET_DATA AS BD
      LEFT JOIN BG_M_BUDGET_ORDER AS BO ON BD.BUDGET_ORDER_NO = BO.BUDGET_ORDER_NO
      LEFT JOIN BG_M_ACCOUNT AS AC ON BO.ACCOUNT_NO = AC.ACCOUNT_NO
      LEFT JOIN BG_M_DEPT AS DP ON BO.DEPT_NO = DP.DEPT_NO
      LEFT JOIN BG_M_PERSON_IN_CHARGE AS PIC ON BO.PERSON_IN_CHARGE_NO = PIC.PERSON_IN_CHARGE_NO
      LEFT JOIN BG_T_BUDGET_PERIOD AS BP ON BD.BUDGET_YEAR = BP.BUDGET_YEAR AND BD.PERIOD_TYPE = BP.PERIOD_TYPE AND BD.PROJECT_NO = BP.PROJECT_NO
      WHERE
      BD.BUDGET_YEAR = @YEAR
      AND BD.PERIOD_TYPE = @PERIOD
      AND BO.BUDGET_TYPE = 'E'
      AND BD.REV_NO = @REVNO
      AND BD.PROJECT_NO = @PROJECTNO AND
      BO.ACTIVE_FLAG = 1  
 
      @PICCONDITION
      ) AS MTP
      LEFT JOIN
      (
      SELECT BUDGET_DATA.BUDGET_ORDER_NO, BUDGET_DATA.BUDGET_YEAR, BUDGET_ORDER.COST_TYPE,
      BUDGET_DATA.PERIOD_TYPE, BUDGET_DATA.PROJECT_NO, MAX(BUDGET_DATA.REV_NO) AS REV_NO, BUDGET_ORDER.BUDGET_ORDER_NAME,
      BUDGET_ORDER.DEPT_NO, BUDGET_ORDER.PERSON_IN_CHARGE_NO, PIC.PERSON_IN_CHARGE_NAME
      FROM BG_T_BUDGET_DATA AS BUDGET_DATA
      INNER JOIN BG_M_BUDGET_ORDER AS BUDGET_ORDER
      ON BUDGET_ORDER.BUDGET_ORDER_NO = BUDGET_DATA.BUDGET_ORDER_NO AND BUDGET_ORDER.BUDGET_TYPE = 'E' AND BUDGET_ORDER.ACTIVE_FLAG = 1
      INNER JOIN BG_M_PERSON_IN_CHARGE AS PIC
      ON PIC.PERSON_IN_CHARGE_NO = BUDGET_ORDER.PERSON_IN_CHARGE_NO
      WHERE BUDGET_DATA.BUDGET_YEAR = @YEAR
      AND BUDGET_DATA.PERIOD_TYPE = 3     
      AND BUDGET_DATA.PROJECT_NO = @RefRBProjectNo
      AND BUDGET_DATA.REV_NO = @RefRBRevNo
      GROUP BY BUDGET_DATA.BUDGET_ORDER_NO, BUDGET_DATA.BUDGET_YEAR, BUDGET_DATA.PERIOD_TYPE, BUDGET_DATA.PROJECT_NO, BUDGET_ORDER.BUDGET_ORDER_NAME, BUDGET_ORDER.DEPT_NO, BUDGET_ORDER.COST_TYPE,
      BUDGET_ORDER.PERSON_IN_CHARGE_NO, PIC.PERSON_IN_CHARGE_NAME) AS MAX_REV ON MTP.BUDGET_ORDER_NO = MAX_REV.BUDGET_ORDER_NO

      LEFT JOIN BG_T_BUDGET_DATA AS MASTER_DATA
      ON MAX_REV.BUDGET_YEAR = MASTER_DATA.BUDGET_YEAR
      AND MAX_REV.PERIOD_TYPE = MASTER_DATA.PERIOD_TYPE
      AND MAX_REV.PROJECT_NO = MASTER_DATA.PROJECT_NO
      AND MAX_REV.BUDGET_ORDER_NO = MASTER_DATA.BUDGET_ORDER_NO
      AND MAX_REV.REV_NO = MASTER_DATA.REV_NO

      LEFT JOIN
      (
      SELECT BUDGET_DATA1.BUDGET_ORDER_NO, BUDGET_DATA1.BUDGET_YEAR, BUDGET_ORDER1.COST_TYPE,
      BUDGET_DATA1.PERIOD_TYPE, BUDGET_DATA1.PROJECT_NO, MAX(BUDGET_DATA1.REV_NO) AS REV_NO, BUDGET_ORDER1.BUDGET_ORDER_NAME,
      BUDGET_ORDER1.DEPT_NO, BUDGET_ORDER1.PERSON_IN_CHARGE_NO, PIC1.PERSON_IN_CHARGE_NAME
      FROM BG_T_BUDGET_DATA AS BUDGET_DATA1
      INNER JOIN BG_M_BUDGET_ORDER AS BUDGET_ORDER1
      ON BUDGET_ORDER1.BUDGET_ORDER_NO = BUDGET_DATA1.BUDGET_ORDER_NO AND BUDGET_ORDER1.BUDGET_TYPE = 'E' AND BUDGET_ORDER1.ACTIVE_FLAG = 1
      INNER JOIN BG_M_PERSON_IN_CHARGE AS PIC1
      ON PIC1.PERSON_IN_CHARGE_NO = BUDGET_ORDER1.PERSON_IN_CHARGE_NO
      WHERE BUDGET_DATA1.BUDGET_YEAR = (@YEAR - 1)
      AND BUDGET_DATA1.PERIOD_TYPE = @PERIOD    
      AND BUDGET_DATA1.PROJECT_NO = @MtpProjectNo
      AND BUDGET_DATA1.REV_NO = @MtpRevNo
      GROUP BY BUDGET_DATA1.BUDGET_ORDER_NO, BUDGET_DATA1.BUDGET_YEAR, BUDGET_DATA1.PERIOD_TYPE, BUDGET_DATA1.PROJECT_NO, BUDGET_ORDER1.BUDGET_ORDER_NAME, BUDGET_ORDER1.DEPT_NO, BUDGET_ORDER1.COST_TYPE,
      BUDGET_ORDER1.PERSON_IN_CHARGE_NO, PIC1.PERSON_IN_CHARGE_NAME) AS MAX_PREV_REV ON MTP.BUDGET_ORDER_NO = MAX_PREV_REV.BUDGET_ORDER_NO

      LEFT JOIN BG_T_BUDGET_DATA AS MASTER_DATA1
      ON MAX_PREV_REV.BUDGET_YEAR = MASTER_DATA1.BUDGET_YEAR
      AND MAX_PREV_REV.PERIOD_TYPE = MASTER_DATA1.PERIOD_TYPE
      AND MAX_PREV_REV.PROJECT_NO = MASTER_DATA1.PROJECT_NO
      AND MAX_PREV_REV.BUDGET_ORDER_NO = MASTER_DATA1.BUDGET_ORDER_NO
      AND MAX_PREV_REV.REV_NO = MASTER_DATA1.REV_NO

      LEFT OUTER JOIN BG_T_UPLOAD_DATA AS ACTUAL_DATA
      ON ACTUAL_DATA.BUDGET_YEAR = MAX_REV.BUDGET_YEAR
      AND ACTUAL_DATA.BUDGET_ORDER_NO = MAX_REV.BUDGET_ORDER_NO
      AND ACTUAL_DATA.DATA_TYPE = 2
      AND ACTUAL_DATA.PERIOD_TYPE = 3
      AND ACTUAL_DATA.PROJECT_NO = 1


      LEFT JOIN BG_T_BUDGET_DATA AS OB_MASTER_DATA
      ON MAX_REV.BUDGET_YEAR = OB_MASTER_DATA.BUDGET_YEAR
      AND MAX_REV.PERIOD_TYPE = OB_MASTER_DATA.PERIOD_TYPE
      AND MAX_REV.PROJECT_NO = OB_MASTER_DATA.PROJECT_NO
      AND MAX_REV.BUDGET_ORDER_NO = OB_MASTER_DATA.BUDGET_ORDER_NO
      AND MAX_REV.REV_NO = OB_MASTER_DATA.REV_NO


      LEFT OUTER JOIN BG_T_UPLOAD_DATA AS OB_ACTUAL_DATA
      ON OB_ACTUAL_DATA.BUDGET_YEAR = MAX_REV.BUDGET_YEAR
      AND OB_ACTUAL_DATA.BUDGET_ORDER_NO = MAX_REV.BUDGET_ORDER_NO
      AND OB_ACTUAL_DATA.DATA_TYPE = 2
      AND OB_ACTUAL_DATA.PERIOD_TYPE = @REFPERIOD
      AND OB_ACTUAL_DATA.PROJECT_NO = 1

      LEFT OUTER JOIN
      (
      SELECT
   
      BUDGET_DATA.BUDGET_YEAR,
      BUDGET_DATA.PERIOD_TYPE,
      BUDGET_DATA.PROJECT_NO,
      BUDGET_ORDER.PERSON_IN_CHARGE_NO,
      PIC.PERSON_IN_CHARGE_NAME
      ,SUM(ISNULL(M1,0)
      + ISNULL(M2,0)
      + ISNULL(M3,0)
      + ISNULL(M4,0)
      + ISNULL(M5,0)
      + ISNULL(M6,0)
      + ISNULL(M7,0)
      + ISNULL(M8,0)
      + ISNULL(M9,0)
      + ISNULL(M10,0)
      + ISNULL(M11,0)
      + ISNULL(M12,0)
      ) AS OB_DATA


      ,SUM(CASE WHEN COST_TYPE = 1 THEN ISNULL(M1, 0)
      + ISNULL(M2, 0) + ISNULL(M3, 0)
      + ISNULL(M4, 0) + ISNULL(M5, 0)
      + ISNULL(M6, 0) + ISNULL(M7, 0)
      + ISNULL(M8, 0) + ISNULL(M9, 0)
      + ISNULL(M10, 0) + ISNULL(M11, 0)
      + ISNULL(M12, 0) ELSE 0 END) AS REVISE_TOTAL_YEAR_FIXCOST,

      SUM(CASE WHEN COST_TYPE = 2 THEN ISNULL(M1, 0)
      + ISNULL(M2, 0) + ISNULL(M3, 0)
      + ISNULL(M4, 0) + ISNULL(M5, 0)
      + ISNULL(M6, 0) + ISNULL(M7, 0)
      + ISNULL(M8, 0) + ISNULL(M9, 0)
      + ISNULL(M10, 0) + ISNULL(M11, 0)
      + ISNULL(M12, 0) ELSE 0 END) AS REVISE_TOTAL_YEAR_VARIABLECOST


      FROM BG_T_BUDGET_DATA AS BUDGET_DATA
      INNER JOIN BG_M_BUDGET_ORDER AS BUDGET_ORDER
      ON BUDGET_ORDER.BUDGET_ORDER_NO = BUDGET_DATA.BUDGET_ORDER_NO AND BUDGET_ORDER.BUDGET_TYPE = 'E' AND BUDGET_ORDER.ACTIVE_FLAG = 1
      INNER JOIN BG_M_PERSON_IN_CHARGE AS PIC
      ON PIC.PERSON_IN_CHARGE_NO = BUDGET_ORDER.PERSON_IN_CHARGE_NO
      WHERE BUDGET_DATA.BUDGET_YEAR = @YEAR +1
      AND BUDGET_DATA.PERIOD_TYPE = 1
      AND BUDGET_DATA.PROJECT_NO = @RefRBProjectNo
      AND BUDGET_DATA.REV_NO = @RefRBRevNo
      GROUP BY
     
      BUDGET_DATA.BUDGET_YEAR,
      BUDGET_DATA.PERIOD_TYPE,
      BUDGET_DATA.PROJECT_NO,
      BUDGET_ORDER.PERSON_IN_CHARGE_NO,
      PIC.PERSON_IN_CHARGE_NAME
      )AS OB_BUDGET_DATA
      ON OB_BUDGET_DATA.PERSON_IN_CHARGE_NO = MTP.PERSON_IN_CHARGE_NO
    


      GROUP BY MTP.BUDGET_YEAR, MTP.PERIOD_TYPE, MTP.PROJECT_NO, MTP.PERSON_IN_CHARGE_NO, MTP.PERSON_IN_CHARGE_NAME, MTP.PIC_SHOW_FLG
      ,OB_BUDGET_DATA.OB_DATA, OB_BUDGET_DATA.REVISE_TOTAL_YEAR_FIXCOST, REVISE_TOTAL_YEAR_VARIABLECOST
      ORDER BY MTP.PERSON_IN_CHARGE_NO
    </SELECT004_8>-->

    <SELECT004_8>
      SELECT

      MTP.BUDGET_YEAR, MTP.PERIOD_TYPE, MTP.PROJECT_NO,
      PICM.PERSON_IN_CHARGE_NO,
      PICM.PERSON_IN_CHARGE_NAME,
      PICM.PIC_SHOW_FLG,

      SUM(ISNULL(MTP.RRT1,0)) AS RRT1,
      SUM(ISNULL(MTP.RRT2,0)) AS RRT2,
      SUM(ISNULL(MTP.RRT3,0)) AS RRT3,
      SUM(ISNULL(MTP.RRT4,0)) AS RRT4,
      SUM(ISNULL(MTP.RRT5,0)) AS RRT5,

      ISNULL(OB_BUDGET_DATA.OB_DATA,0) AS REVISE_TOTAL_YEAR,

      ISNULL(OB_BUDGET_DATA.OB_DATA, 0) - SUM(ISNULL(MASTER_DATA1.RRT2, 0)) AS DIFF_TOTAL_YEAR,

      SUM(ISNULL(MASTER_DATA1.RRT1, 0)) AS PrevRRT1,
      SUM(ISNULL(MASTER_DATA1.RRT2, 0)) AS PrevRRT2,
      SUM(ISNULL(MASTER_DATA1.RRT3, 0)) AS PrevRRT3,
      SUM(ISNULL(MASTER_DATA1.RRT4, 0)) AS PrevRRT4,
      SUM(ISNULL(MASTER_DATA1.RRT5, 0)) AS PrevRRT5,
      SUM(CASE WHEN MAX_REV.COST_TYPE = 1 THEN ISNULL(MTP.RRT1, 0) ELSE 0 END) AS RRT1_FIXCOST,
      SUM(CASE WHEN MAX_REV.COST_TYPE = 2 THEN ISNULL(MTP.RRT1, 0) ELSE 0 END) AS RRT1_VARIABLECOST,
      SUM(CASE WHEN MAX_REV.COST_TYPE = 1 THEN ISNULL(MTP.RRT2, 0) ELSE 0 END) AS RRT2_FIXCOST,
      SUM(CASE WHEN MAX_REV.COST_TYPE = 2 THEN ISNULL(MTP.RRT2, 0) ELSE 0 END) AS RRT2_VARIABLECOST,
      SUM(CASE WHEN MAX_REV.COST_TYPE = 1 THEN ISNULL(MTP.RRT3, 0) ELSE 0 END) AS RRT3_FIXCOST,
      SUM(CASE WHEN MAX_REV.COST_TYPE = 2 THEN ISNULL(MTP.RRT3, 0) ELSE 0 END) AS RRT3_VARIABLECOST,
      SUM(CASE WHEN MAX_REV.COST_TYPE = 1 THEN ISNULL(MTP.RRT4, 0) ELSE 0 END) AS RRT4_FIXCOST,
      SUM(CASE WHEN MAX_REV.COST_TYPE = 2 THEN ISNULL(MTP.RRT4, 0) ELSE 0 END) AS RRT4_VARIABLECOST,
      SUM(CASE WHEN MAX_REV.COST_TYPE = 1 THEN ISNULL(MTP.RRT5, 0) ELSE 0 END) AS RRT5_FIXCOST,
      SUM(CASE WHEN MAX_REV.COST_TYPE = 2 THEN ISNULL(MTP.RRT5, 0) ELSE 0 END) AS RRT5_VARIABLECOST,

      SUM(CASE WHEN MAX_PREV_REV.COST_TYPE = 1 THEN ISNULL(MASTER_DATA1.RRT1, 0) ELSE 0 END) AS PrevRRT1_FIXCOST,
      SUM(CASE WHEN MAX_PREV_REV.COST_TYPE = 2 THEN ISNULL(MASTER_DATA1.RRT1, 0) ELSE 0 END) AS PrevRRT1_VARIABLECOST,
      SUM(CASE WHEN MAX_PREV_REV.COST_TYPE = 1 THEN ISNULL(MASTER_DATA1.RRT2, 0) ELSE 0 END) AS PrevRRT2_FIXCOST,
      SUM(CASE WHEN MAX_PREV_REV.COST_TYPE = 2 THEN ISNULL(MASTER_DATA1.RRT2, 0) ELSE 0 END) AS PrevRRT2_VARIABLECOST,
      SUM(CASE WHEN MAX_PREV_REV.COST_TYPE = 1 THEN ISNULL(MASTER_DATA1.RRT3, 0) ELSE 0 END) AS PrevRRT3_FIXCOST,
      SUM(CASE WHEN MAX_PREV_REV.COST_TYPE = 2 THEN ISNULL(MASTER_DATA1.RRT3, 0) ELSE 0 END) AS PrevRRT3_VARIABLECOST,
      SUM(CASE WHEN MAX_PREV_REV.COST_TYPE = 1 THEN ISNULL(MASTER_DATA1.RRT4, 0) ELSE 0 END) AS PrevRRT4_FIXCOST,
      SUM(CASE WHEN MAX_PREV_REV.COST_TYPE = 2 THEN ISNULL(MASTER_DATA1.RRT4, 0) ELSE 0 END) AS PrevRRT4_VARIABLECOST,
      SUM(CASE WHEN MAX_PREV_REV.COST_TYPE = 1 THEN ISNULL(MASTER_DATA1.RRT5, 0) ELSE 0 END) AS PrevRRT5_FIXCOST,
      SUM(CASE WHEN MAX_PREV_REV.COST_TYPE = 2 THEN ISNULL(MASTER_DATA1.RRT5, 0) ELSE 0 END) AS PrevRRT5_VARIABLECOST,

      ISNULL(OB_BUDGET_DATA.REVISE_TOTAL_YEAR_FIXCOST,0) AS REVISE_TOTAL_YEAR_FIXCOST,

      ISNULL(OB_BUDGET_DATA.REVISE_TOTAL_YEAR_VARIABLECOST,0) AS REVISE_TOTAL_YEAR_VARIABLECOST,

      ISNULL(OB_BUDGET_DATA.REVISE_TOTAL_YEAR_FIXCOST,0) - SUM(CASE WHEN MAX_REV.COST_TYPE = 1 THEN ISNULL(MASTER_DATA1.RRT2, 0) ELSE 0 END) AS DIFF_TOTAL_YEAR_FIXCOST,
      ISNULL(OB_BUDGET_DATA.REVISE_TOTAL_YEAR_VARIABLECOST,0) - SUM(CASE WHEN MAX_REV.COST_TYPE = 2 THEN ISNULL(MASTER_DATA1.RRT2, 0) ELSE 0 END) AS DIFF_TOTAL_YEAR_VARIABLECOST

      ,SUM(ISNULL(MTP.RRT2, 0)  - ISNULL(MASTER_DATA1.RRT3, 0)) AS DIFF_PREV_YEAR
      ,SUM(CASE WHEN MAX_REV.COST_TYPE = 1 THEN ISNULL(MTP.RRT2, 0) - ISNULL(MASTER_DATA1.RRT3, 0) ELSE 0 END) AS DIFF_PREV_YEAR_FIXCOST
      ,SUM(CASE WHEN MAX_REV.COST_TYPE = 2 THEN ISNULL(MTP.RRT2, 0) - ISNULL(MASTER_DATA1.RRT3, 0) ELSE 0 END) AS DIFF_PREV_YEAR_VARIABLECOST


      FROM
      (
      SELECT
      distinct(PIC.PERSON_IN_CHARGE_NO), PIC.PERSON_IN_CHARGE_NAME,BO.PIC_SHOW_FLAG AS PIC_SHOW_FLG FROM
      BG_T_BUDGET_DATA AS BD
      LEFT JOIN BG_M_BUDGET_ORDER AS BO ON BD.BUDGET_ORDER_NO = BO.BUDGET_ORDER_NO
      LEFT JOIN BG_M_ACCOUNT AS AC ON BO.ACCOUNT_NO = AC.ACCOUNT_NO
      LEFT JOIN BG_M_DEPT AS DP ON BO.DEPT_NO = DP.DEPT_NO
      LEFT JOIN BG_M_PERSON_IN_CHARGE AS PIC ON BO.PERSON_IN_CHARGE_NO = PIC.PERSON_IN_CHARGE_NO
      LEFT JOIN BG_T_BUDGET_PERIOD AS BP ON BD.BUDGET_YEAR = BP.BUDGET_YEAR AND BD.PERIOD_TYPE = BP.PERIOD_TYPE AND BD.PROJECT_NO = BP.PROJECT_NO
      WHERE
      BD.BUDGET_YEAR = @YEAR
      AND BD.PERIOD_TYPE = @PERIOD
      AND BO.BUDGET_TYPE = 'E'
      AND BD.REV_NO = @REVNO
      AND BD.PROJECT_NO = @PROJECTNO AND
      BO.ACTIVE_FLAG = 1

      UNION

      SELECT
      distinct(PIC.PERSON_IN_CHARGE_NO), PIC.PERSON_IN_CHARGE_NAME,BO.PIC_SHOW_FLAG AS PIC_SHOW_FLG FROM
      BG_T_BUDGET_DATA AS BD
      LEFT JOIN BG_M_BUDGET_ORDER AS BO ON BD.BUDGET_ORDER_NO = BO.BUDGET_ORDER_NO
      LEFT JOIN BG_M_ACCOUNT AS AC ON BO.ACCOUNT_NO = AC.ACCOUNT_NO
      LEFT JOIN BG_M_DEPT AS DP ON BO.DEPT_NO = DP.DEPT_NO
      LEFT JOIN BG_M_PERSON_IN_CHARGE AS PIC ON BO.PERSON_IN_CHARGE_NO = PIC.PERSON_IN_CHARGE_NO
      LEFT JOIN BG_T_BUDGET_PERIOD AS BP ON BD.BUDGET_YEAR = BP.BUDGET_YEAR AND BD.PERIOD_TYPE = BP.PERIOD_TYPE AND BD.PROJECT_NO = BP.PROJECT_NO
      WHERE
      BD.BUDGET_YEAR = @YEAR + 1
      AND BD.PERIOD_TYPE = 1
      AND BO.BUDGET_TYPE = 'E'
      AND BD.REV_NO = @RefRBRevNo
      AND BD.PROJECT_NO = @RefRBProjectNo AND
      BO.ACTIVE_FLAG = 1
      ) AS PICM


      LEFT JOIN
      (
      SELECT BD.*,  BO.BUDGET_ORDER_NAME,BO.PIC_SHOW_FLAG AS PIC_SHOW_FLG,
      AC.ACCOUNT_NO, AC.ACCOUNT_NAME,
      BO.COST, BO.COST_TYPE, DP.DEPT_NO, DP.DEPT_NAME,
      PIC.PERSON_IN_CHARGE_NO, PIC.PERSON_IN_CHARGE_NAME FROM
      BG_T_BUDGET_DATA AS BD
      LEFT JOIN BG_M_BUDGET_ORDER AS BO ON BD.BUDGET_ORDER_NO = BO.BUDGET_ORDER_NO
      LEFT JOIN BG_M_ACCOUNT AS AC ON BO.ACCOUNT_NO = AC.ACCOUNT_NO
      LEFT JOIN BG_M_DEPT AS DP ON BO.DEPT_NO = DP.DEPT_NO
      LEFT JOIN BG_M_PERSON_IN_CHARGE AS PIC ON BO.PERSON_IN_CHARGE_NO = PIC.PERSON_IN_CHARGE_NO
      LEFT JOIN BG_T_BUDGET_PERIOD AS BP ON BD.BUDGET_YEAR = BP.BUDGET_YEAR AND BD.PERIOD_TYPE = BP.PERIOD_TYPE AND BD.PROJECT_NO = BP.PROJECT_NO
      WHERE
      BD.BUDGET_YEAR = @YEAR
      AND BD.PERIOD_TYPE = @PERIOD
      AND BO.BUDGET_TYPE = 'E'
      AND BD.REV_NO = @REVNO
      AND BD.PROJECT_NO = @PROJECTNO AND
      BO.ACTIVE_FLAG = 1
      ) AS MTP
      ON MTP.PERSON_IN_CHARGE_NO = PICM.PERSON_IN_CHARGE_NO


      LEFT OUTER JOIN
      (
      SELECT
      BUDGET_DATA.BUDGET_YEAR,
      BUDGET_DATA.PERIOD_TYPE,
      BUDGET_DATA.PROJECT_NO,
      BUDGET_ORDER.PERSON_IN_CHARGE_NO,
      PIC.PERSON_IN_CHARGE_NAME
      ,SUM(ISNULL(M1,0)
      + ISNULL(M2,0)
      + ISNULL(M3,0)
      + ISNULL(M4,0)
      + ISNULL(M5,0)
      + ISNULL(M6,0)
      + ISNULL(M7,0)
      + ISNULL(M8,0)
      + ISNULL(M9,0)
      + ISNULL(M10,0)
      + ISNULL(M11,0)
      + ISNULL(M12,0)
      ) AS OB_DATA


      ,SUM(CASE WHEN COST_TYPE = 1 THEN ISNULL(M1, 0)
      + ISNULL(M2, 0) + ISNULL(M3, 0)
      + ISNULL(M4, 0) + ISNULL(M5, 0)
      + ISNULL(M6, 0) + ISNULL(M7, 0)
      + ISNULL(M8, 0) + ISNULL(M9, 0)
      + ISNULL(M10, 0) + ISNULL(M11, 0)
      + ISNULL(M12, 0) ELSE 0 END) AS REVISE_TOTAL_YEAR_FIXCOST,

      SUM(CASE WHEN COST_TYPE = 2 THEN ISNULL(M1, 0)
      + ISNULL(M2, 0) + ISNULL(M3, 0)
      + ISNULL(M4, 0) + ISNULL(M5, 0)
      + ISNULL(M6, 0) + ISNULL(M7, 0)
      + ISNULL(M8, 0) + ISNULL(M9, 0)
      + ISNULL(M10, 0) + ISNULL(M11, 0)
      + ISNULL(M12, 0) ELSE 0 END) AS REVISE_TOTAL_YEAR_VARIABLECOST


      FROM BG_T_BUDGET_DATA AS BUDGET_DATA
      INNER JOIN BG_M_BUDGET_ORDER AS BUDGET_ORDER
      ON BUDGET_ORDER.BUDGET_ORDER_NO = BUDGET_DATA.BUDGET_ORDER_NO AND BUDGET_ORDER.BUDGET_TYPE = 'E' AND BUDGET_ORDER.ACTIVE_FLAG = 1
      INNER JOIN BG_M_PERSON_IN_CHARGE AS PIC
      ON PIC.PERSON_IN_CHARGE_NO = BUDGET_ORDER.PERSON_IN_CHARGE_NO
      WHERE BUDGET_DATA.BUDGET_YEAR = @YEAR  +1
      AND BUDGET_DATA.PERIOD_TYPE = 1
      AND BUDGET_DATA.PROJECT_NO = @RefRBProjectNo
      AND BUDGET_DATA.REV_NO = @RefRBRevNo
      GROUP BY

      BUDGET_DATA.BUDGET_YEAR,
      BUDGET_DATA.PERIOD_TYPE,
      BUDGET_DATA.PROJECT_NO,
      BUDGET_ORDER.PERSON_IN_CHARGE_NO,
      PIC.PERSON_IN_CHARGE_NAME
      )AS OB_BUDGET_DATA
      ON OB_BUDGET_DATA.PERSON_IN_CHARGE_NO = PICM.PERSON_IN_CHARGE_NO


      LEFT JOIN
      (
      SELECT BUDGET_DATA.BUDGET_ORDER_NO, BUDGET_DATA.BUDGET_YEAR, BUDGET_ORDER.COST_TYPE,
      BUDGET_DATA.PERIOD_TYPE, BUDGET_DATA.PROJECT_NO, MAX(BUDGET_DATA.REV_NO) AS REV_NO, BUDGET_ORDER.BUDGET_ORDER_NAME,
      BUDGET_ORDER.DEPT_NO, BUDGET_ORDER.PERSON_IN_CHARGE_NO, PIC.PERSON_IN_CHARGE_NAME
      FROM BG_T_BUDGET_DATA AS BUDGET_DATA
      INNER JOIN BG_M_BUDGET_ORDER AS BUDGET_ORDER
      ON BUDGET_ORDER.BUDGET_ORDER_NO = BUDGET_DATA.BUDGET_ORDER_NO AND BUDGET_ORDER.BUDGET_TYPE = 'E' AND BUDGET_ORDER.ACTIVE_FLAG = 1
      INNER JOIN BG_M_PERSON_IN_CHARGE AS PIC
      ON PIC.PERSON_IN_CHARGE_NO = BUDGET_ORDER.PERSON_IN_CHARGE_NO
      WHERE BUDGET_DATA.BUDGET_YEAR = @YEAR
      AND BUDGET_DATA.PERIOD_TYPE = @PERIOD
      AND BUDGET_DATA.PROJECT_NO = @PROJECTNO
      AND BUDGET_DATA.REV_NO = @REVNO
      GROUP BY BUDGET_DATA.BUDGET_ORDER_NO, BUDGET_DATA.BUDGET_YEAR, BUDGET_DATA.PERIOD_TYPE, BUDGET_DATA.PROJECT_NO, BUDGET_ORDER.BUDGET_ORDER_NAME, BUDGET_ORDER.DEPT_NO, BUDGET_ORDER.COST_TYPE,
      BUDGET_ORDER.PERSON_IN_CHARGE_NO, PIC.PERSON_IN_CHARGE_NAME) AS MAX_REV ON MTP.BUDGET_ORDER_NO = MAX_REV.BUDGET_ORDER_NO

      LEFT JOIN BG_T_BUDGET_DATA AS MASTER_DATA
      ON MAX_REV.BUDGET_YEAR = MASTER_DATA.BUDGET_YEAR
      AND MAX_REV.PERIOD_TYPE = MASTER_DATA.PERIOD_TYPE
      AND MAX_REV.PROJECT_NO = MASTER_DATA.PROJECT_NO
      AND MAX_REV.BUDGET_ORDER_NO = MASTER_DATA.BUDGET_ORDER_NO
      AND MAX_REV.REV_NO = MASTER_DATA.REV_NO


      LEFT JOIN
      (
      SELECT BUDGET_DATA1.BUDGET_ORDER_NO, BUDGET_DATA1.BUDGET_YEAR, BUDGET_ORDER1.COST_TYPE,
      BUDGET_DATA1.PERIOD_TYPE, BUDGET_DATA1.PROJECT_NO, MAX(BUDGET_DATA1.REV_NO) AS REV_NO, BUDGET_ORDER1.BUDGET_ORDER_NAME,
      BUDGET_ORDER1.DEPT_NO, BUDGET_ORDER1.PERSON_IN_CHARGE_NO, PIC1.PERSON_IN_CHARGE_NAME
      FROM BG_T_BUDGET_DATA AS BUDGET_DATA1
      INNER JOIN BG_M_BUDGET_ORDER AS BUDGET_ORDER1
      ON BUDGET_ORDER1.BUDGET_ORDER_NO = BUDGET_DATA1.BUDGET_ORDER_NO AND BUDGET_ORDER1.BUDGET_TYPE = 'E' AND BUDGET_ORDER1.ACTIVE_FLAG = 1
      INNER JOIN BG_M_PERSON_IN_CHARGE AS PIC1
      ON PIC1.PERSON_IN_CHARGE_NO = BUDGET_ORDER1.PERSON_IN_CHARGE_NO
      WHERE BUDGET_DATA1.BUDGET_YEAR = (@YEAR - 1)
      AND BUDGET_DATA1.PERIOD_TYPE = @PERIOD
      AND BUDGET_DATA1.PROJECT_NO = @PROJECTNO
      AND BUDGET_DATA1.REV_NO = @REVNO
      GROUP BY BUDGET_DATA1.BUDGET_ORDER_NO, BUDGET_DATA1.BUDGET_YEAR, BUDGET_DATA1.PERIOD_TYPE, BUDGET_DATA1.PROJECT_NO, BUDGET_ORDER1.BUDGET_ORDER_NAME, BUDGET_ORDER1.DEPT_NO, BUDGET_ORDER1.COST_TYPE,
      BUDGET_ORDER1.PERSON_IN_CHARGE_NO, PIC1.PERSON_IN_CHARGE_NAME) AS MAX_PREV_REV ON MTP.BUDGET_ORDER_NO = MAX_PREV_REV.BUDGET_ORDER_NO

      LEFT JOIN BG_T_BUDGET_DATA AS MASTER_DATA1
      ON MAX_PREV_REV.BUDGET_YEAR = MASTER_DATA1.BUDGET_YEAR
      AND MAX_PREV_REV.PERIOD_TYPE = MASTER_DATA1.PERIOD_TYPE
      AND MAX_PREV_REV.PROJECT_NO = MASTER_DATA1.PROJECT_NO
      AND MAX_PREV_REV.BUDGET_ORDER_NO = MASTER_DATA1.BUDGET_ORDER_NO
      AND MAX_PREV_REV.REV_NO = MASTER_DATA1.REV_NO


      GROUP BY MTP.BUDGET_YEAR, MTP.PERIOD_TYPE, MTP.PROJECT_NO, PICM.PERSON_IN_CHARGE_NO, PICM.PERSON_IN_CHARGE_NAME, PICM.PIC_SHOW_FLG
      ,OB_BUDGET_DATA.OB_DATA, OB_BUDGET_DATA.REVISE_TOTAL_YEAR_FIXCOST, REVISE_TOTAL_YEAR_VARIABLECOST
      ORDER BY PICM.PERSON_IN_CHARGE_NO
    </SELECT004_8>

    <SELECT004_9>
      SELECT MAX_REV.*,
      ISNULL(ACTUAL_DATA.H1, 0) AS ACTUAL_FIRST_HALF,

      --ISNULL(MAX_REV.REVISE_SECOND_HALF, 0) AS REVISE_SECOND_HALF,

      ISNULL(MASTER_DATA.M1, 0) AS M1, ISNULL(MASTER_DATA.M2, 0) AS M2, ISNULL(MASTER_DATA.M3, 0) AS M3,
      ISNULL(MASTER_DATA.M4, 0) AS M4, ISNULL(MASTER_DATA.M5, 0) AS M5, ISNULL(MASTER_DATA.M6, 0) AS M6,
      (ISNULL(MASTER_DATA.M1, 0) + ISNULL(MASTER_DATA.M2, 0) + ISNULL(MASTER_DATA.M3, 0) + ISNULL(MASTER_DATA.M4, 0) + ISNULL(MASTER_DATA.M5,0) + ISNULL(MASTER_DATA.M6, 0)) AS FIRST_HALF_SUM,
      (ISNULL(MASTER_DATA.M7, 0) + ISNULL(MASTER_DATA.M8, 0) + ISNULL(MASTER_DATA.M9, 0) + ISNULL(MASTER_DATA.M10, 0) + ISNULL(MASTER_DATA.M11, 0)+ ISNULL(MASTER_DATA.M12, 0)) AS SECOND_HALF_SUM,
      (ISNULL(MASTER_DATA.M1, 0) + ISNULL(MASTER_DATA.M2, 0) + ISNULL(MASTER_DATA.M3, 0) + ISNULL(MASTER_DATA.M4, 0) + ISNULL(MASTER_DATA.M5,0) + ISNULL(MASTER_DATA.M6, 0) + ISNULL(MASTER_DATA.M7, 0) + ISNULL(MASTER_DATA.M8, 0) + ISNULL(MASTER_DATA.M9, 0) + ISNULL(MASTER_DATA.M10, 0) + ISNULL(MASTER_DATA.M11, 0)+ ISNULL(MASTER_DATA.M12, 0)) AS YEAR_SUM,

      (ISNULL(ACTUAL_DATA.H1, 0) + ISNULL(MAX_REV.REVISE_SECOND_HALF, 0)) AS LAST_YEAR_SUM,

      (ISNULL(MASTER_DATA.M1, 0) + ISNULL(MASTER_DATA.M2, 0) + ISNULL(MASTER_DATA.M3, 0) + ISNULL(MASTER_DATA.M4, 0) + ISNULL(MASTER_DATA.M5,0) + ISNULL(MASTER_DATA.M6, 0) + ISNULL(MASTER_DATA.M7, 0) + ISNULL(MASTER_DATA.M8, 0) + ISNULL(MASTER_DATA.M9, 0) + ISNULL(MASTER_DATA.M10, 0) + ISNULL(MASTER_DATA.M11, 0)+ ISNULL(MASTER_DATA.M12, 0)) - (ISNULL(ACTUAL_DATA.H1, 0) + ISNULL(MAX_REV.REVISE_SECOND_HALF, 0)) AS DIFF_YEAR,
      CASE WHEN MAX_REV.COST_TYPE = 1 THEN ISNULL(ACTUAL_DATA.H1, 0) ELSE 0 END AS ACTUAL_FIRST_HALF_FIXCOST,
      CASE WHEN MAX_REV.COST_TYPE = 2 THEN ISNULL(ACTUAL_DATA.H1, 0) ELSE 0 END AS ACTUAL_FIRST_HALF_VARIABLECOST,
      CASE WHEN MAX_REV.COST_TYPE = 1 THEN ISNULL(MAX_REV.REVISE_SECOND_HALF, 0) ELSE 0 END AS REVISE_SECOND_HALF_FIXCOST,
      CASE WHEN MAX_REV.COST_TYPE = 2 THEN ISNULL(MAX_REV.REVISE_SECOND_HALF, 0) ELSE 0 END AS REVISE_SECOND_HALF_VARIABLECOST,
      CASE WHEN MAX_REV.COST_TYPE = 1 THEN ISNULL(MASTER_DATA.M1, 0) ELSE 0 END AS M1_FIXCOST,
      CASE WHEN MAX_REV.COST_TYPE = 2 THEN ISNULL(MASTER_DATA.M1, 0) ELSE 0 END AS M1_VARIABLECOST,
      CASE WHEN MAX_REV.COST_TYPE = 1 THEN ISNULL(MASTER_DATA.M2, 0) ELSE 0 END AS M2_FIXCOST,
      CASE WHEN MAX_REV.COST_TYPE = 2 THEN ISNULL(MASTER_DATA.M2, 0) ELSE 0 END AS M2_VARIABLECOST,
      CASE WHEN MAX_REV.COST_TYPE = 1 THEN ISNULL(MASTER_DATA.M3, 0) ELSE 0 END AS M3_FIXCOST,
      CASE WHEN MAX_REV.COST_TYPE = 2 THEN ISNULL(MASTER_DATA.M3, 0) ELSE 0 END AS M3_VARIABLECOST,
      CASE WHEN MAX_REV.COST_TYPE = 1 THEN ISNULL(MASTER_DATA.M4, 0) ELSE 0 END AS M4_FIXCOST,
      CASE WHEN MAX_REV.COST_TYPE = 2 THEN ISNULL(MASTER_DATA.M4, 0) ELSE 0 END AS M4_VARIABLECOST,
      CASE WHEN MAX_REV.COST_TYPE = 1 THEN ISNULL(MASTER_DATA.M5, 0) ELSE 0 END AS M5_FIXCOST,
      CASE WHEN MAX_REV.COST_TYPE = 2 THEN ISNULL(MASTER_DATA.M5, 0) ELSE 0 END AS M5_VARIABLECOST,
      CASE WHEN MAX_REV.COST_TYPE = 1 THEN ISNULL(MASTER_DATA.M6, 0) ELSE 0 END AS M6_FIXCOST,
      CASE WHEN MAX_REV.COST_TYPE = 2 THEN ISNULL(MASTER_DATA.M6, 0) ELSE 0 END AS M6_VARIABLECOST,
      CASE WHEN MAX_REV.COST_TYPE = 1 THEN (ISNULL(MASTER_DATA.M1, 0) + ISNULL(MASTER_DATA.M2, 0) + ISNULL(MASTER_DATA.M3, 0) + ISNULL(MASTER_DATA.M4, 0) + ISNULL(MASTER_DATA.M5,0) + ISNULL(MASTER_DATA.M6, 0)) ELSE 0 END AS FIRST_HALF_FIXCOST,
      CASE WHEN MAX_REV.COST_TYPE = 2 THEN (ISNULL(MASTER_DATA.M1, 0) + ISNULL(MASTER_DATA.M2, 0) + ISNULL(MASTER_DATA.M3, 0) + ISNULL(MASTER_DATA.M4, 0) + ISNULL(MASTER_DATA.M5,0) + ISNULL(MASTER_DATA.M6, 0)) ELSE 0 END AS FIRST_HALF_VARIABLECOST,
      CASE WHEN MAX_REV.COST_TYPE = 1 THEN (ISNULL(MASTER_DATA.M7, 0) + ISNULL(MASTER_DATA.M8, 0) + ISNULL(MASTER_DATA.M9, 0) + ISNULL(MASTER_DATA.M10, 0) + ISNULL(MASTER_DATA.M11, 0)+ ISNULL(MASTER_DATA.M12, 0)) ELSE 0 END AS SECOND_HALF_FIXCOST,
      CASE WHEN MAX_REV.COST_TYPE = 2 THEN (ISNULL(MASTER_DATA.M7, 0) + ISNULL(MASTER_DATA.M8, 0) + ISNULL(MASTER_DATA.M9, 0) + ISNULL(MASTER_DATA.M10, 0) + ISNULL(MASTER_DATA.M11, 0)+ ISNULL(MASTER_DATA.M12, 0)) ELSE 0 END AS SECOND_HALF_VARIABLECOST,
      CASE WHEN MAX_REV.COST_TYPE = 1 THEN (ISNULL(MASTER_DATA.M1, 0) + ISNULL(MASTER_DATA.M2, 0) + ISNULL(MASTER_DATA.M3, 0) + ISNULL(MASTER_DATA.M4, 0) + ISNULL(MASTER_DATA.M5,0) + ISNULL(MASTER_DATA.M6, 0) + ISNULL(MASTER_DATA.M7, 0) + ISNULL(MASTER_DATA.M8, 0) + ISNULL(MASTER_DATA.M9, 0) + ISNULL(MASTER_DATA.M10, 0) + ISNULL(MASTER_DATA.M11, 0)+ ISNULL(MASTER_DATA.M12, 0)) ELSE 0 END AS YEAR_FIXCOST,
      CASE WHEN MAX_REV.COST_TYPE = 2 THEN (ISNULL(MASTER_DATA.M1, 0) + ISNULL(MASTER_DATA.M2, 0) + ISNULL(MASTER_DATA.M3, 0) + ISNULL(MASTER_DATA.M4, 0) + ISNULL(MASTER_DATA.M5,0) + ISNULL(MASTER_DATA.M6, 0) + ISNULL(MASTER_DATA.M7, 0) + ISNULL(MASTER_DATA.M8, 0) + ISNULL(MASTER_DATA.M9, 0) + ISNULL(MASTER_DATA.M10, 0) + ISNULL(MASTER_DATA.M11, 0)+ ISNULL(MASTER_DATA.M12, 0)) ELSE 0 END AS YEAR_VARIABLECOST,
      CASE WHEN MAX_REV.COST_TYPE = 1 THEN (ISNULL(ACTUAL_DATA.H1, 0) + ISNULL(MAX_REV.REVISE_SECOND_HALF, 0)) ELSE 0 END AS LAST_YEAR_SUM_FIXCOST,
      CASE WHEN MAX_REV.COST_TYPE = 2 THEN (ISNULL(ACTUAL_DATA.H1, 0) + ISNULL(MAX_REV.REVISE_SECOND_HALF, 0)) ELSE 0 END AS LAST_YEAR_SUM_VARIABLECOST,
      CASE WHEN MAX_REV.COST_TYPE = 1 THEN (ISNULL(MASTER_DATA.M1, 0) + ISNULL(MASTER_DATA.M2, 0) + ISNULL(MASTER_DATA.M3, 0) + ISNULL(MASTER_DATA.M4, 0) + ISNULL(MASTER_DATA.M5,0) + ISNULL(MASTER_DATA.M6, 0) + ISNULL(MASTER_DATA.M7, 0) + ISNULL(MASTER_DATA.M8, 0) + ISNULL(MASTER_DATA.M9, 0) + ISNULL(MASTER_DATA.M10, 0) + ISNULL(MASTER_DATA.M11, 0)+ ISNULL(MASTER_DATA.M12, 0)) - (ISNULL(ACTUAL_DATA.H1, 0) + ISNULL(MAX_REV.REVISE_SECOND_HALF, 0)) ELSE 0 END AS DIFF_YEAR_FIXCOST,
      CASE WHEN MAX_REV.COST_TYPE = 2 THEN (ISNULL(MASTER_DATA.M1, 0) + ISNULL(MASTER_DATA.M2, 0) + ISNULL(MASTER_DATA.M3, 0) + ISNULL(MASTER_DATA.M4, 0) + ISNULL(MASTER_DATA.M5,0) + ISNULL(MASTER_DATA.M6, 0) + ISNULL(MASTER_DATA.M7, 0) + ISNULL(MASTER_DATA.M8, 0) + ISNULL(MASTER_DATA.M9, 0) + ISNULL(MASTER_DATA.M10, 0) + ISNULL(MASTER_DATA.M11, 0)+ ISNULL(MASTER_DATA.M12, 0)) - (ISNULL(ACTUAL_DATA.H1, 0) + ISNULL(MAX_REV.REVISE_SECOND_HALF, 0)) ELSE 0 END AS DIFF_YEAR_VARIABLECOST
      ,ISNULL(MTP.RRT2,0) AS MTP_RRT1
      ,CASE WHEN MAX_REV.COST_TYPE = 2 THEN ISNULL(MTP.RRT2,0) ELSE 0 END AS MTP_RRT1_VARIABLECOST
      ,CASE WHEN MAX_REV.COST_TYPE = 1 THEN ISNULL(MTP.RRT2,0) ELSE 0 END AS MTP_RRT1_FIXCOST
      ,(ISNULL(MASTER_DATA.M1, 0) + ISNULL(MASTER_DATA.M2, 0) + ISNULL(MASTER_DATA.M3, 0) + ISNULL(MASTER_DATA.M4, 0) + ISNULL(MASTER_DATA.M5,0) + ISNULL(MASTER_DATA.M6, 0) + ISNULL(MASTER_DATA.M7, 0) + ISNULL(MASTER_DATA.M8, 0) + ISNULL(MASTER_DATA.M9, 0) + ISNULL(MASTER_DATA.M10, 0) + ISNULL(MASTER_DATA.M11, 0)+ ISNULL(MASTER_DATA.M12, 0)) - (ISNULL(MTP.RRT2,0)) AS DIFF_MTP
      ,CASE WHEN MAX_REV.COST_TYPE = 1 THEN (ISNULL(MASTER_DATA.M1, 0) + ISNULL(MASTER_DATA.M2, 0) + ISNULL(MASTER_DATA.M3, 0) + ISNULL(MASTER_DATA.M4, 0) + ISNULL(MASTER_DATA.M5,0) + ISNULL(MASTER_DATA.M6, 0) + ISNULL(MASTER_DATA.M7, 0) + ISNULL(MASTER_DATA.M8, 0) + ISNULL(MASTER_DATA.M9, 0) + ISNULL(MASTER_DATA.M10, 0) + ISNULL(MASTER_DATA.M11, 0)+ ISNULL(MASTER_DATA.M12, 0)) - (ISNULL(MTP.RRT2,0)) ELSE 0 END AS DIFF_MTP_FIXCOST
      ,CASE WHEN MAX_REV.COST_TYPE = 2 THEN (ISNULL(MASTER_DATA.M1, 0) + ISNULL(MASTER_DATA.M2, 0) + ISNULL(MASTER_DATA.M3, 0) + ISNULL(MASTER_DATA.M4, 0) + ISNULL(MASTER_DATA.M5,0) + ISNULL(MASTER_DATA.M6, 0) + ISNULL(MASTER_DATA.M7, 0) + ISNULL(MASTER_DATA.M8, 0) + ISNULL(MASTER_DATA.M9, 0) + ISNULL(MASTER_DATA.M10, 0) + ISNULL(MASTER_DATA.M11, 0)+ ISNULL(MASTER_DATA.M12, 0)) - (ISNULL(MTP.RRT2,0)) ELSE 0 END AS DIFF_MTP_VARIABLECOST

      ,ISNULL(MASTER_DATA.M7, 0) AS M7, ISNULL(MASTER_DATA.M8, 0) AS M8, ISNULL(MASTER_DATA.M9, 0) AS M9,
      ISNULL(MASTER_DATA.M10, 0) AS M10, ISNULL(MASTER_DATA.M11, 0) AS M11, ISNULL(MASTER_DATA.M12, 0) AS M12

      ,CASE WHEN MAX_REV.COST_TYPE = 1 THEN ISNULL(MASTER_DATA.M7, 0) ELSE 0 END AS M7_FIXCOST,
      CASE WHEN MAX_REV.COST_TYPE = 2 THEN ISNULL(MASTER_DATA.M7, 0) ELSE 0 END AS M7_VARIABLECOST,
      CASE WHEN MAX_REV.COST_TYPE = 1 THEN ISNULL(MASTER_DATA.M8, 0) ELSE 0 END AS M8_FIXCOST,
      CASE WHEN MAX_REV.COST_TYPE = 2 THEN ISNULL(MASTER_DATA.M8, 0) ELSE 0 END AS M8_VARIABLECOST,
      CASE WHEN MAX_REV.COST_TYPE = 1 THEN ISNULL(MASTER_DATA.M9, 0) ELSE 0 END AS M9_FIXCOST,
      CASE WHEN MAX_REV.COST_TYPE = 2 THEN ISNULL(MASTER_DATA.M9, 0) ELSE 0 END AS M9_VARIABLECOST,
      CASE WHEN MAX_REV.COST_TYPE = 1 THEN ISNULL(MASTER_DATA.M10, 0) ELSE 0 END AS M10_FIXCOST,
      CASE WHEN MAX_REV.COST_TYPE = 2 THEN ISNULL(MASTER_DATA.M10, 0) ELSE 0 END AS M10_VARIABLECOST,
      CASE WHEN MAX_REV.COST_TYPE = 1 THEN ISNULL(MASTER_DATA.M11, 0) ELSE 0 END AS M11_FIXCOST,
      CASE WHEN MAX_REV.COST_TYPE = 2 THEN ISNULL(MASTER_DATA.M11, 0) ELSE 0 END AS M11_VARIABLECOST,
      CASE WHEN MAX_REV.COST_TYPE = 1 THEN ISNULL(MASTER_DATA.M12, 0) ELSE 0 END AS M12_FIXCOST,
      CASE WHEN MAX_REV.COST_TYPE = 2 THEN ISNULL(MASTER_DATA.M12, 0) ELSE 0 END AS M12_VARIABLECOST
      
      FROM (
      SELECT BUDGET_DATA.BUDGET_ORDER_NO, BUDGET_DATA.BUDGET_YEAR, BUDGET_ORDER.COST_TYPE,
      BUDGET_DATA.PERIOD_TYPE, BUDGET_DATA.PROJECT_NO, MAX(BUDGET_DATA.REV_NO) AS REV_NO, BUDGET_ORDER.BUDGET_ORDER_NAME,
      BUDGET_ORDER.DEPT_NO, BUDGET_ORDER.PERSON_IN_CHARGE_NO AS PERSON_IN_CHARGE, PIC.PERSON_IN_CHARGE_NAME

      ,ISNULL((SELECT ISNULL(ISNULL(M10,0)+ISNULL(M11,0)+ISNULL(M12,0),0)
      FROM BG_T_BUDGET_DATA
      WHERE BUDGET_YEAR = (@YEAR-1)
      AND PERIOD_TYPE = 2
      --AND REV_NO = (SELECT MAX(REV_NO) AS REV_NO FROM BG_T_BUDGET_DATA WHERE BUDGET_YEAR = (@YEAR-1) AND PERIOD_TYPE = 2 AND PROJECT_NO = @PROJECTNO)
      --AND PROJECT_NO = @PROJECTNO
      AND REV_NO = @RefEstRevNo
      AND PROJECT_NO = @RefEstProjectNo
      AND BUDGET_ORDER_NO = BUDGET_DATA.BUDGET_ORDER_NO),0)+
      ISNULL((SELECT ISNULL(M7,0)+ISNULL(M8,0)+ISNULL(M9,0)
      FROM BG_T_UPLOAD_DATA
      WHERE BUDGET_YEAR = (@YEAR-1)
      AND PERIOD_TYPE = 2
      AND PROJECT_NO = @PROJECTNO
      AND DATA_TYPE = 2
      AND BUDGET_ORDER_NO = BUDGET_DATA.BUDGET_ORDER_NO),0) AS REVISE_SECOND_HALF

      FROM BG_T_BUDGET_DATA AS BUDGET_DATA
      INNER JOIN BG_M_BUDGET_ORDER AS BUDGET_ORDER
      ON BUDGET_ORDER.BUDGET_ORDER_NO = BUDGET_DATA.BUDGET_ORDER_NO AND BUDGET_ORDER.BUDGET_TYPE = 'E' AND BUDGET_ORDER.ACTIVE_FLAG = 1
      INNER JOIN BG_M_PERSON_IN_CHARGE AS PIC
      ON PIC.PERSON_IN_CHARGE_NO = BUDGET_ORDER.PERSON_IN_CHARGE_NO

      WHERE BUDGET_DATA.BUDGET_YEAR = @YEAR
      AND BUDGET_DATA.PERIOD_TYPE = @PERIOD
      AND BUDGET_DATA.PROJECT_NO = @PROJECTNO
      AND BUDGET_DATA.REV_NO = @REVNO
      @PICCONDITION
      GROUP BY BUDGET_DATA.BUDGET_ORDER_NO, BUDGET_DATA.BUDGET_YEAR, BUDGET_DATA.PERIOD_TYPE, BUDGET_DATA.PROJECT_NO, BUDGET_ORDER.BUDGET_ORDER_NAME, BUDGET_ORDER.DEPT_NO, BUDGET_ORDER.COST_TYPE,
      BUDGET_ORDER.PERSON_IN_CHARGE_NO, PIC.PERSON_IN_CHARGE_NAME) AS MAX_REV

      INNER JOIN BG_T_BUDGET_DATA AS MASTER_DATA
      ON MAX_REV.BUDGET_YEAR = MASTER_DATA.BUDGET_YEAR
      AND MAX_REV.PERIOD_TYPE = MASTER_DATA.PERIOD_TYPE
      AND MAX_REV.PROJECT_NO = MASTER_DATA.PROJECT_NO
      AND MAX_REV.BUDGET_ORDER_NO = MASTER_DATA.BUDGET_ORDER_NO
      AND MAX_REV.REV_NO = MASTER_DATA.REV_NO

      LEFT OUTER JOIN BG_T_UPLOAD_DATA AS ACTUAL_DATA
      ON ACTUAL_DATA.BUDGET_YEAR = MAX_REV.BUDGET_YEAR - 1
      AND ACTUAL_DATA.PERIOD_TYPE = @PERIOD
      AND ACTUAL_DATA.PROJECT_NO = @PROJECTNO
      AND ACTUAL_DATA.BUDGET_ORDER_NO = MAX_REV.BUDGET_ORDER_NO
      AND ACTUAL_DATA.DATA_TYPE = 2

      LEFT OUTER JOIN BG_T_UPLOAD_DATA AS REVISE_DATA
      ON REVISE_DATA.BUDGET_YEAR = MAX_REV.BUDGET_YEAR - 1
      AND REVISE_DATA.PERIOD_TYPE = @PERIOD
      AND REVISE_DATA.PROJECT_NO = @PROJECTNO
      AND REVISE_DATA.BUDGET_ORDER_NO = MAX_REV.BUDGET_ORDER_NO
      AND REVISE_DATA.DATA_TYPE = 1

      LEFT JOIN BG_T_BUDGET_DATA AS MTP
      ON MAX_REV.BUDGET_ORDER_NO = MTP.BUDGET_ORDER_NO
      AND MTP.BUDGET_YEAR=(@YEAR-2)
      AND MTP.PERIOD_TYPE = 10
      AND MTP.PROJECT_NO = @MtpProjectNo
      AND MTP.REV_NO = '@MtpRevNo'

      WHERE ACTUAL_DATA.H1 &lt;&gt; 0 OR MAX_REV.REVISE_SECOND_HALF &lt;&gt; 0 OR (ISNULL(MASTER_DATA.M1, 0) &lt;&gt; 0
      OR ISNULL(MASTER_DATA.M2, 0) &lt;&gt; 0 OR ISNULL(MASTER_DATA.M3, 0) &lt;&gt; 0
      OR ISNULL(MASTER_DATA.M4, 0) &lt;&gt; 0 OR ISNULL(MASTER_DATA.M5, 0) &lt;&gt; 0 OR ISNULL(MASTER_DATA.M6, 0) &lt;&gt; 0
      OR ISNULL(MASTER_DATA.M7, 0) &lt;&gt; 0 OR ISNULL(MASTER_DATA.M8, 0) &lt;&gt; 0 OR ISNULL(MASTER_DATA.M9, 0) &lt;&gt; 0
      OR ISNULL(MTP.RRT2,0) &lt;&gt; 0
      OR ISNULL(MASTER_DATA.M10, 0) &lt;&gt; 0 OR ISNULL(MASTER_DATA.M11, 0) &lt;&gt; 0 OR ISNULL(MASTER_DATA.M12, 0) &lt;&gt; 0)
      ORDER BY MAX_REV.BUDGET_ORDER_NO
    </SELECT004_9>
    <SELECT004_10>
      SELECT MAX_REV.*, ISNULL(ACTUAL_DATA.M7, 0) AS M7, ISNULL(ACTUAL_DATA.M8, 0) AS M8,
      ISNULL(ACTUAL_DATA.M9, 0) AS M9, ISNULL(MASTER_DATA.M10, 0) AS M10,
      ISNULL(MASTER_DATA.M11, 0) AS M11, ISNULL(MASTER_DATA.M12, 0) AS M12,
      CASE WHEN MAX_REV.COST_TYPE = 1 THEN ISNULL(ACTUAL_DATA.M7, 0) ELSE 0 END AS M7_FIXCOST,
      CASE WHEN MAX_REV.COST_TYPE = 2 THEN ISNULL(ACTUAL_DATA.M7, 0) ELSE 0 END AS M7_VARIABLECOST,
      CASE WHEN MAX_REV.COST_TYPE = 1 THEN ISNULL(ACTUAL_DATA.M8, 0) ELSE 0 END AS M8_FIXCOST,
      CASE WHEN MAX_REV.COST_TYPE = 2 THEN ISNULL(ACTUAL_DATA.M8, 0) ELSE 0 END AS M8_VARIABLECOST,
      CASE WHEN MAX_REV.COST_TYPE = 1 THEN ISNULL(ACTUAL_DATA.M9, 0) ELSE 0 END AS M9_FIXCOST,
      CASE WHEN MAX_REV.COST_TYPE = 2 THEN ISNULL(ACTUAL_DATA.M9, 0) ELSE 0 END AS M9_VARIABLECOST,
      CASE WHEN MAX_REV.COST_TYPE = 1 THEN ISNULL(MASTER_DATA.M10, 0) ELSE 0 END AS M10_FIXCOST,
      CASE WHEN MAX_REV.COST_TYPE = 2 THEN ISNULL(MASTER_DATA.M10, 0) ELSE 0 END AS M10_VARIABLECOST,
      CASE WHEN MAX_REV.COST_TYPE = 1 THEN ISNULL(MASTER_DATA.M11, 0) ELSE 0 END AS M11_FIXCOST,
      CASE WHEN MAX_REV.COST_TYPE = 2 THEN ISNULL(MASTER_DATA.M11, 0) ELSE 0 END AS M11_VARIABLECOST,
      CASE WHEN MAX_REV.COST_TYPE = 1 THEN ISNULL(MASTER_DATA.M12, 0) ELSE 0 END AS M12_FIXCOST,
      CASE WHEN MAX_REV.COST_TYPE = 2 THEN ISNULL(MASTER_DATA.M12, 0) ELSE 0 END AS M12_VARIABLECOST,
      ISNULL(ACTUAL_DATA.H1, 0)  AS ACTUAL_FIRST_HALF,
      (ISNULL(REVISE_BUDGET.M7, 0) + ISNULL(REVISE_BUDGET.M8, 0) + ISNULL(REVISE_BUDGET.M9, 0) + ISNULL(REVISE_BUDGET.M10, 0) + ISNULL(REVISE_BUDGET.M11,0) + ISNULL(REVISE_BUDGET.M12, 0))  AS REVISE_SECOND_HALF,
      (ISNULL(ACTUAL_DATA.M7, 0) + ISNULL(ACTUAL_DATA.M8, 0) + ISNULL(ACTUAL_DATA.M9, 0) + ISNULL(MASTER_DATA.M10, 0) + ISNULL(MASTER_DATA.M11,0) + ISNULL(MASTER_DATA.M12, 0)) AS ESTIMATE_SECOND_HALF,
      (ISNULL(ACTUAL_DATA.M7, 0) + ISNULL(ACTUAL_DATA.M8, 0) + ISNULL(ACTUAL_DATA.M9, 0) + ISNULL(MASTER_DATA.M10, 0) + ISNULL(MASTER_DATA.M11,0) + ISNULL(MASTER_DATA.M12, 0) - (ISNULL(REVISE_BUDGET.M7, 0) + ISNULL(REVISE_BUDGET.M8, 0) + ISNULL(REVISE_BUDGET.M9, 0) + ISNULL(REVISE_BUDGET.M10, 0) + ISNULL(REVISE_BUDGET.M11,0) + ISNULL(REVISE_BUDGET.M12, 0))) AS DIFFERENCE_SECOND_HALF,
      (ISNULL(ACTUAL_DATA.H1, 0) + ISNULL(ACTUAL_DATA.M7, 0) + ISNULL(ACTUAL_DATA.M8, 0) + ISNULL(ACTUAL_DATA.M9, 0) + ISNULL(MASTER_DATA.M10, 0) + ISNULL(MASTER_DATA.M11,0) + ISNULL(MASTER_DATA.M12, 0)) AS ESTIMATE_TOTAL_YEAR,
      CASE WHEN MAX_REV.COST_TYPE = 1 THEN ISNULL(ACTUAL_DATA.H1, 0) ELSE 0 END AS ACTUAL_FIRST_HALF_FIXCOST,
      CASE WHEN MAX_REV.COST_TYPE = 2 THEN ISNULL(ACTUAL_DATA.H1, 0) ELSE 0 END AS ACTUAL_FIRST_HALF_VARIABLECOST,
      CASE WHEN MAX_REV.COST_TYPE = 1 THEN (ISNULL(REVISE_BUDGET.M7, 0) + ISNULL(REVISE_BUDGET.M8, 0) + ISNULL(REVISE_BUDGET.M9, 0) + ISNULL(REVISE_BUDGET.M10, 0) + ISNULL(REVISE_BUDGET.M11,0) + ISNULL(REVISE_BUDGET.M12, 0)) ELSE 0 END AS REVISE_SECOND_HALF_FIXCOST,
      CASE WHEN MAX_REV.COST_TYPE = 2 THEN (ISNULL(REVISE_BUDGET.M7, 0) + ISNULL(REVISE_BUDGET.M8, 0) + ISNULL(REVISE_BUDGET.M9, 0) + ISNULL(REVISE_BUDGET.M10, 0) + ISNULL(REVISE_BUDGET.M11,0) + ISNULL(REVISE_BUDGET.M12, 0)) ELSE 0 END AS REVISE_SECOND_HALF_VARIABLECOST,
      CASE WHEN MAX_REV.COST_TYPE = 1 THEN (ISNULL(ACTUAL_DATA.M7, 0) + ISNULL(ACTUAL_DATA.M8, 0) + ISNULL(ACTUAL_DATA.M9, 0) + ISNULL(MASTER_DATA.M10, 0) + ISNULL(MASTER_DATA.M11,0) + ISNULL(MASTER_DATA.M12, 0)) ELSE 0 END AS ESTIMATE_SECOND_HALF_FIXCOST,
      CASE WHEN MAX_REV.COST_TYPE = 2 THEN (ISNULL(ACTUAL_DATA.M7, 0) + ISNULL(ACTUAL_DATA.M8, 0) + ISNULL(ACTUAL_DATA.M9, 0) + ISNULL(MASTER_DATA.M10, 0) + ISNULL(MASTER_DATA.M11,0) + ISNULL(MASTER_DATA.M12, 0)) ELSE 0 END AS ESTIMATE_SECOND_HALF_VARIABLECOST,
      CASE WHEN MAX_REV.COST_TYPE = 1 THEN (ISNULL(ACTUAL_DATA.M7, 0) + ISNULL(ACTUAL_DATA.M8, 0) + ISNULL(ACTUAL_DATA.M9, 0) + ISNULL(MASTER_DATA.M10, 0) + ISNULL(MASTER_DATA.M11,0) + ISNULL(MASTER_DATA.M12, 0) - (ISNULL(REVISE_BUDGET.M7, 0) + ISNULL(REVISE_BUDGET.M8, 0) + ISNULL(REVISE_BUDGET.M9, 0) + ISNULL(REVISE_BUDGET.M10, 0) + ISNULL(REVISE_BUDGET.M11,0) + ISNULL(REVISE_BUDGET.M12, 0))) ELSE 0 END AS DIFFERENCE_SECOND_HALF_FIXCOST,
      CASE WHEN MAX_REV.COST_TYPE = 2 THEN (ISNULL(ACTUAL_DATA.M7, 0) + ISNULL(ACTUAL_DATA.M8, 0) + ISNULL(ACTUAL_DATA.M9, 0) + ISNULL(MASTER_DATA.M10, 0) + ISNULL(MASTER_DATA.M11,0) + ISNULL(MASTER_DATA.M12, 0) - (ISNULL(REVISE_BUDGET.M7, 0) + ISNULL(REVISE_BUDGET.M8, 0) + ISNULL(REVISE_BUDGET.M9, 0) + ISNULL(REVISE_BUDGET.M10, 0) + ISNULL(REVISE_BUDGET.M11,0) + ISNULL(REVISE_BUDGET.M12, 0))) ELSE 0 END AS DIFFERENCE_SECOND_HALF_VARIABLECOST,
      CASE WHEN MAX_REV.COST_TYPE = 1 THEN (ISNULL(ACTUAL_DATA.H1, 0) + ISNULL(ACTUAL_DATA.M7, 0) + ISNULL(ACTUAL_DATA.M8, 0) + ISNULL(ACTUAL_DATA.M9, 0) + ISNULL(MASTER_DATA.M10, 0) + ISNULL(MASTER_DATA.M11,0) + ISNULL(MASTER_DATA.M12, 0)) ELSE 0 END AS ESTIMATE_TOTAL_YEAR_FIXCOST,
      CASE WHEN MAX_REV.COST_TYPE = 2 THEN (ISNULL(ACTUAL_DATA.H1, 0) + ISNULL(ACTUAL_DATA.M7, 0) + ISNULL(ACTUAL_DATA.M8, 0) + ISNULL(ACTUAL_DATA.M9, 0) + ISNULL(MASTER_DATA.M10, 0) + ISNULL(MASTER_DATA.M11,0) + ISNULL(MASTER_DATA.M12, 0)) ELSE 0 END AS ESTIMATE_TOTAL_YEAR_VARIABLECOST
      FROM (
      SELECT BUDGET_DATA.BUDGET_ORDER_NO, BUDGET_DATA.BUDGET_YEAR, BUDGET_ORDER.COST_TYPE,
      BUDGET_DATA.PERIOD_TYPE, BUDGET_DATA.PROJECT_NO, MAX(BUDGET_DATA.REV_NO) AS REV_NO, BUDGET_ORDER.BUDGET_ORDER_NAME,
      BUDGET_ORDER.DEPT_NO, BUDGET_ORDER.PERSON_IN_CHARGE_NO, PIC.PERSON_IN_CHARGE_NAME
      FROM BG_T_BUDGET_DATA AS BUDGET_DATA
      INNER JOIN BG_M_BUDGET_ORDER AS BUDGET_ORDER
      ON BUDGET_ORDER.BUDGET_ORDER_NO = BUDGET_DATA.BUDGET_ORDER_NO AND BUDGET_ORDER.BUDGET_TYPE = 'E' AND BUDGET_ORDER.ACTIVE_FLAG = 1
      INNER JOIN BG_M_PERSON_IN_CHARGE AS PIC
      ON PIC.PERSON_IN_CHARGE_NO = BUDGET_ORDER.PERSON_IN_CHARGE_NO
      WHERE BUDGET_DATA.BUDGET_YEAR = @YEAR
      AND BUDGET_DATA.PERIOD_TYPE = @PERIOD
      AND BUDGET_DATA.PROJECT_NO = @PROJECTNO
      AND BUDGET_DATA.REV_NO = @REVNO
      @PICCONDITION
      GROUP BY BUDGET_DATA.BUDGET_ORDER_NO, BUDGET_DATA.BUDGET_YEAR, BUDGET_DATA.PERIOD_TYPE, BUDGET_DATA.PROJECT_NO, BUDGET_ORDER.BUDGET_ORDER_NAME, BUDGET_ORDER.DEPT_NO, BUDGET_ORDER.COST_TYPE,
      BUDGET_ORDER.PERSON_IN_CHARGE_NO, PIC.PERSON_IN_CHARGE_NAME) AS MAX_REV

      INNER JOIN BG_T_BUDGET_DATA AS MASTER_DATA
      ON MAX_REV.BUDGET_YEAR = MASTER_DATA.BUDGET_YEAR
      AND MASTER_DATA.PERIOD_TYPE = @PERIOD
      AND MASTER_DATA.PROJECT_NO = @PROJECTNO
      AND MAX_REV.BUDGET_ORDER_NO = MASTER_DATA.BUDGET_ORDER_NO
      AND MAX_REV.REV_NO = MASTER_DATA.REV_NO

      ---- change Revise to OB 02/05/2018
      --LEFT OUTER JOIN BG_T_UPLOAD_DATA AS REVISE_BUDGET
      --ON MAX_REV.BUDGET_YEAR = REVISE_BUDGET.BUDGET_YEAR
      ----AND REVISE_BUDGET.PERIOD_TYPE = 2
      --AND REVISE_BUDGET.PERIOD_TYPE = 1
      --AND REVISE_BUDGET.PROJECT_NO = 1
      --AND MAX_REV.BUDGET_ORDER_NO = REVISE_BUDGET.BUDGET_ORDER_NO
      --AND REVISE_BUDGET.DATA_TYPE = 1
      LEFT JOIN BG_T_BUDGET_DATA AS REVISE_BUDGET
      ON  REVISE_BUDGET.BUDGET_YEAR =  MAX_REV.BUDGET_YEAR
      AND REVISE_BUDGET.PERIOD_TYPE = 1
      AND REVISE_BUDGET.PROJECT_NO = MAX_REV.PROJECT_NO
      AND REVISE_BUDGET.BUDGET_ORDER_NO = MAX_REV.BUDGET_ORDER_NO
      AND REVISE_BUDGET.REV_NO = MAX_REV.REV_NO

      LEFT OUTER JOIN BG_T_UPLOAD_DATA AS ACTUAL_DATA
      ON ACTUAL_DATA.BUDGET_YEAR = MAX_REV.BUDGET_YEAR
      AND ACTUAL_DATA.BUDGET_ORDER_NO = MAX_REV.BUDGET_ORDER_NO
      AND ACTUAL_DATA.DATA_TYPE = 2
      AND ACTUAL_DATA.PERIOD_TYPE = @PERIOD
      AND ACTUAL_DATA.PROJECT_NO = @PROJECTNO

      WHERE ISNULL(ACTUAL_DATA.H1, 0) &lt;&gt; 0 
      OR ISNULL(REVISE_BUDGET.M7, 0) &lt;&gt; 0
      OR ISNULL(REVISE_BUDGET.M8, 0) &lt;&gt; 0
      OR ISNULL(REVISE_BUDGET.M9, 0) &lt;&gt; 0
      OR ISNULL(REVISE_BUDGET.M10, 0) &lt;&gt; 0
      OR ISNULL(REVISE_BUDGET.M11, 0) &lt;&gt; 0
      OR ISNULL(REVISE_BUDGET.M12, 0) &lt;&gt; 0
      OR ISNULL(ACTUAL_DATA.M7, 0) &lt;&gt; 0 OR ISNULL(ACTUAL_DATA.M8, 0) &lt;&gt; 0 OR
      ISNULL(ACTUAL_DATA.M9, 0) &lt;&gt; 0 OR (ISNULL(MASTER_DATA.M10, 0) &lt;&gt; 0 OR
      ISNULL(MASTER_DATA.M11, 0) &lt;&gt; 0 OR ISNULL(MASTER_DATA.M12, 0) &lt;&gt; 0)
      ORDER BY MAX_REV.BUDGET_ORDER_NO
    </SELECT004_10>
    <SELECT004_11>
      SELECT MAX_REV.*,
      --ISNULL(ORIGINAL_BUDGET.M1, 0) + ISNULL(ORIGINAL_BUDGET.M2,0) + ISNULL(ORIGINAL_BUDGET.M3,0) + ISNULL(ORIGINAL_BUDGET.M4,0) + ISNULL(ORIGINAL_BUDGET.M5,0) + ISNULL(ORIGINAL_BUDGET.M6,0) AS ORIGINAL_FIRST_HALF,
      ISNULL(ORIGINAL_BUDGET.H1,0) AS ORIGINAL_FIRST_HALF,
      ISNULL(ACTUAL_DATA.M1, 0) AS M1,
      ISNULL(ACTUAL_DATA.M2, 0) AS M2,
      ISNULL(ACTUAL_DATA.M3, 0) AS M3,
      ISNULL(MASTER_DATA.M4, 0) AS M4,
      ISNULL(MASTER_DATA.M5, 0) AS M5,
      ISNULL(MASTER_DATA.M6, 0) AS M6,
      ISNULL(ACTUAL_DATA.M1, 0) + ISNULL(ACTUAL_DATA.M2, 0) + ISNULL(ACTUAL_DATA.M3, 0) + ISNULL(MASTER_DATA.M4, 0) + ISNULL(MASTER_DATA.M5, 0) + ISNULL(MASTER_DATA.M6, 0) AS ESTIMATE_FIRST_HALF,
      ISNULL(ACTUAL_DATA.M1, 0) + ISNULL(ACTUAL_DATA.M2, 0) + ISNULL(ACTUAL_DATA.M3, 0) + ISNULL(MASTER_DATA.M4, 0) + ISNULL(MASTER_DATA.M5, 0) + ISNULL(MASTER_DATA.M6, 0) - (ISNULL(ORIGINAL_BUDGET.H1, 0)) AS DIFF_FIRST_HALF,
      ISNULL(ORIGINAL_BUDGET.H2, 0) AS ORIGINAL_SECOND_HALF,
      ISNULL(MASTER_DATA.M7, 0) AS M7, ISNULL(MASTER_DATA.M8, 0) AS M8,
      ISNULL(MASTER_DATA.M9, 0) AS M9, ISNULL(MASTER_DATA.M10, 0) AS M10,
      ISNULL(MASTER_DATA.M11, 0) AS M11, ISNULL(MASTER_DATA.M12, 0) AS M12,
      ISNULL(MASTER_DATA.M7, 0) + ISNULL(MASTER_DATA.M8, 0) + ISNULL(MASTER_DATA.M9, 0) + ISNULL(MASTER_DATA.M10, 0) + ISNULL(MASTER_DATA.M11, 0) + ISNULL(MASTER_DATA.M12, 0) AS REVISE_SECOND_HALF,
      ISNULL(MASTER_DATA.M7, 0) + ISNULL(MASTER_DATA.M8, 0) + ISNULL(MASTER_DATA.M9, 0) + ISNULL(MASTER_DATA.M10, 0) + ISNULL(MASTER_DATA.M11, 0) + ISNULL(MASTER_DATA.M12, 0) - ISNULL(ORIGINAL_BUDGET.H2, 0) AS DIFF_SECOND_HALF,
      ISNULL(ACTUAL_DATA.M1, 0) + ISNULL(ACTUAL_DATA.M2, 0) + ISNULL(ACTUAL_DATA.M3, 0) + ISNULL(MASTER_DATA.M4, 0) + ISNULL(MASTER_DATA.M5, 0) + ISNULL(MASTER_DATA.M6, 0) + ISNULL(MASTER_DATA.M7, 0) + ISNULL(MASTER_DATA.M8, 0) + ISNULL(MASTER_DATA.M9, 0) + ISNULL(MASTER_DATA.M10, 0) + ISNULL(MASTER_DATA.M11, 0) + ISNULL(MASTER_DATA.M12, 0) AS REVISE_TOTAL_YEAR,
      ISNULL(ACTUAL_DATA.M1, 0) + ISNULL(ACTUAL_DATA.M2, 0) + ISNULL(ACTUAL_DATA.M3, 0) + ISNULL(MASTER_DATA.M4, 0) + ISNULL(MASTER_DATA.M5, 0) + ISNULL(MASTER_DATA.M6, 0) - ISNULL(ORIGINAL_BUDGET.H1, 0) + (ISNULL(MASTER_DATA.M7, 0) + ISNULL(MASTER_DATA.M8, 0) + ISNULL(MASTER_DATA.M9, 0) + ISNULL(MASTER_DATA.M10, 0) + ISNULL(MASTER_DATA.M11, 0) + ISNULL(MASTER_DATA.M12, 0) - ISNULL(ORIGINAL_BUDGET.H2, 0)) AS DIFF_TOTAL_YEAR,
      ISNULL(MASTER_DATA.RRT1, 0) AS RRT1,
      ISNULL(MASTER_DATA.RRT2, 0) AS RRT2,
      ISNULL(MASTER_DATA.RRT3, 0) AS RRT3,
      ISNULL(MASTER_DATA.RRT4, 0) AS RRT4,
      ISNULL(MASTER_DATA.RRT5, 0) AS RRT5,
      CASE WHEN MAX_REV.COST_TYPE = 1 THEN ISNULL(MASTER_DATA.RRT1, 0) ELSE 0 END AS RRT1_FIXCOST,
      CASE WHEN MAX_REV.COST_TYPE = 2 THEN ISNULL(MASTER_DATA.RRT1, 0) ELSE 0 END AS RRT1_VARIABLECOST,
      CASE WHEN MAX_REV.COST_TYPE = 1 THEN ISNULL(MASTER_DATA.RRT2, 0) ELSE 0 END AS RRT2_FIXCOST,
      CASE WHEN MAX_REV.COST_TYPE = 2 THEN ISNULL(MASTER_DATA.RRT2, 0) ELSE 0 END AS RRT2_VARIABLECOST,
      CASE WHEN MAX_REV.COST_TYPE = 1 THEN ISNULL(MASTER_DATA.RRT3, 0) ELSE 0 END AS RRT3_FIXCOST,
      CASE WHEN MAX_REV.COST_TYPE = 2 THEN ISNULL(MASTER_DATA.RRT3, 0) ELSE 0 END AS RRT3_VARIABLECOST,
      CASE WHEN MAX_REV.COST_TYPE = 1 THEN ISNULL(MASTER_DATA.RRT4, 0) ELSE 0 END AS RRT4_FIXCOST,
      CASE WHEN MAX_REV.COST_TYPE = 2 THEN ISNULL(MASTER_DATA.RRT4, 0) ELSE 0 END AS RRT4_VARIABLECOST,
      CASE WHEN MAX_REV.COST_TYPE = 1 THEN ISNULL(MASTER_DATA.RRT5, 0) ELSE 0 END AS RRT5_FIXCOST,
      CASE WHEN MAX_REV.COST_TYPE = 2 THEN ISNULL(MASTER_DATA.RRT5, 0) ELSE 0 END AS RRT5_VARIABLECOST,
      CASE WHEN MAX_REV.COST_TYPE = 1 THEN ISNULL(ORIGINAL_BUDGET.H1, 0) ELSE 0 END AS ORIGINAL_FIRST_HALF_FIXCOST,
      CASE WHEN MAX_REV.COST_TYPE = 2 THEN ISNULL(ORIGINAL_BUDGET.H1, 0) ELSE 0 END AS ORIGINAL_FIRST_HALF_VARIABLECOST,
      CASE WHEN MAX_REV.COST_TYPE = 1 THEN ISNULL(ACTUAL_DATA.M1, 0) ELSE 0 END AS M1_FIXCOST,
      CASE WHEN MAX_REV.COST_TYPE = 2 THEN ISNULL(ACTUAL_DATA.M1, 0) ELSE 0 END AS M1_VARIABLECOST,
      CASE WHEN MAX_REV.COST_TYPE = 1 THEN ISNULL(ACTUAL_DATA.M2, 0) ELSE 0 END AS M2_FIXCOST,
      CASE WHEN MAX_REV.COST_TYPE = 2 THEN ISNULL(ACTUAL_DATA.M2, 0) ELSE 0 END AS M2_VARIABLECOST,
      CASE WHEN MAX_REV.COST_TYPE = 1 THEN ISNULL(ACTUAL_DATA.M3, 0) ELSE 0 END AS M3_FIXCOST,
      CASE WHEN MAX_REV.COST_TYPE = 2 THEN ISNULL(ACTUAL_DATA.M3, 0) ELSE 0 END AS M3_VARIABLECOST,
      CASE WHEN MAX_REV.COST_TYPE = 1 THEN ISNULL(MASTER_DATA.M4, 0) ELSE 0 END AS M4_FIXCOST,
      CASE WHEN MAX_REV.COST_TYPE = 2 THEN ISNULL(MASTER_DATA.M4, 0) ELSE 0 END AS M4_VARIABLECOST,
      CASE WHEN MAX_REV.COST_TYPE = 1 THEN ISNULL(MASTER_DATA.M5, 0) ELSE 0 END AS M5_FIXCOST,
      CASE WHEN MAX_REV.COST_TYPE = 2 THEN ISNULL(MASTER_DATA.M5, 0) ELSE 0 END AS M5_VARIABLECOST,
      CASE WHEN MAX_REV.COST_TYPE = 1 THEN ISNULL(MASTER_DATA.M6, 0) ELSE 0 END AS M6_FIXCOST,
      CASE WHEN MAX_REV.COST_TYPE = 2 THEN ISNULL(MASTER_DATA.M6, 0) ELSE 0 END AS M6_VARIABLECOST,
      CASE WHEN MAX_REV.COST_TYPE = 1 THEN ISNULL(ACTUAL_DATA.M1, 0) + ISNULL(ACTUAL_DATA.M2, 0) + ISNULL(ACTUAL_DATA.M3, 0) + ISNULL(MASTER_DATA.M4, 0) + ISNULL(MASTER_DATA.M5, 0) + ISNULL(MASTER_DATA.M6, 0) ELSE 0 END AS ESTIMATE_FIRST_HALF_FIXCOST,
      CASE WHEN MAX_REV.COST_TYPE = 2 THEN ISNULL(ACTUAL_DATA.M1, 0) + ISNULL(ACTUAL_DATA.M2, 0) + ISNULL(ACTUAL_DATA.M3, 0) + ISNULL(MASTER_DATA.M4, 0) + ISNULL(MASTER_DATA.M5, 0) + ISNULL(MASTER_DATA.M6, 0) ELSE 0 END AS ESTIMATE_FIRST_HALF_VARIABLECOST,
      CASE WHEN MAX_REV.COST_TYPE = 1 THEN ISNULL(ACTUAL_DATA.M1, 0) + ISNULL(ACTUAL_DATA.M2, 0) + ISNULL(ACTUAL_DATA.M3, 0) + ISNULL(MASTER_DATA.M4, 0) + ISNULL(MASTER_DATA.M5, 0) + ISNULL(MASTER_DATA.M6, 0) - ISNULL(ORIGINAL_BUDGET.H1, 0) ELSE 0 END AS DIFF_FIRST_HALF_FIXCOST,
      CASE WHEN MAX_REV.COST_TYPE = 2 THEN ISNULL(ACTUAL_DATA.M1, 0) + ISNULL(ACTUAL_DATA.M2, 0) + ISNULL(ACTUAL_DATA.M3, 0) + ISNULL(MASTER_DATA.M4, 0) + ISNULL(MASTER_DATA.M5, 0) + ISNULL(MASTER_DATA.M6, 0) - ISNULL(ORIGINAL_BUDGET.H1, 0) ELSE 0 END AS DIFF_FIRST_HALF_VARIABLECOST,
      CASE WHEN MAX_REV.COST_TYPE = 1 THEN ISNULL(ORIGINAL_BUDGET.H2,0) ELSE 0 END AS ORIGINAL_SECOND_HALF_FIXCOST,
      CASE WHEN MAX_REV.COST_TYPE = 2 THEN ISNULL(ORIGINAL_BUDGET.H2,0) ELSE 0 END AS ORIGINAL_SECOND_HALF_VARIABLECOST,
      CASE WHEN MAX_REV.COST_TYPE = 1 THEN ISNULL(MASTER_DATA.M7, 0) ELSE 0 END AS M7_FIXCOST,
      CASE WHEN MAX_REV.COST_TYPE = 2 THEN ISNULL(MASTER_DATA.M7, 0) ELSE 0 END AS M7_VARIABLECOST,
      CASE WHEN MAX_REV.COST_TYPE = 1 THEN ISNULL(MASTER_DATA.M8, 0) ELSE 0 END AS M8_FIXCOST,
      CASE WHEN MAX_REV.COST_TYPE = 2 THEN ISNULL(MASTER_DATA.M8, 0) ELSE 0 END AS M8_VARIABLECOST,
      CASE WHEN MAX_REV.COST_TYPE = 1 THEN ISNULL(MASTER_DATA.M9, 0) ELSE 0 END AS M9_FIXCOST,
      CASE WHEN MAX_REV.COST_TYPE = 2 THEN ISNULL(MASTER_DATA.M9, 0) ELSE 0 END AS M9_VARIABLECOST,
      CASE WHEN MAX_REV.COST_TYPE = 1 THEN ISNULL(MASTER_DATA.M10, 0) ELSE 0 END AS M10_FIXCOST,
      CASE WHEN MAX_REV.COST_TYPE = 2 THEN ISNULL(MASTER_DATA.M10, 0) ELSE 0 END AS M10_VARIABLECOST,
      CASE WHEN MAX_REV.COST_TYPE = 1 THEN ISNULL(MASTER_DATA.M11, 0) ELSE 0 END AS M11_FIXCOST,
      CASE WHEN MAX_REV.COST_TYPE = 2 THEN ISNULL(MASTER_DATA.M11, 0) ELSE 0 END AS M11_VARIABLECOST,
      CASE WHEN MAX_REV.COST_TYPE = 1 THEN ISNULL(MASTER_DATA.M12, 0) ELSE 0 END AS M12_FIXCOST,
      CASE WHEN MAX_REV.COST_TYPE = 2 THEN ISNULL(MASTER_DATA.M12, 0) ELSE 0 END AS M12_VARIABLECOST,
      CASE WHEN MAX_REV.COST_TYPE = 1 THEN ISNULL(MASTER_DATA.M7, 0) + ISNULL(MASTER_DATA.M8, 0) + ISNULL(MASTER_DATA.M9, 0) + ISNULL(MASTER_DATA.M10, 0) + ISNULL(MASTER_DATA.M11, 0) + ISNULL(MASTER_DATA.M12, 0) ELSE 0 END AS REVISE_SECOND_HALF_FIXCOST,
      CASE WHEN MAX_REV.COST_TYPE = 2 THEN ISNULL(MASTER_DATA.M7, 0) + ISNULL(MASTER_DATA.M8, 0) + ISNULL(MASTER_DATA.M9, 0) + ISNULL(MASTER_DATA.M10, 0) + ISNULL(MASTER_DATA.M11, 0) + ISNULL(MASTER_DATA.M12, 0) ELSE 0 END AS REVISE_SECOND_HALF_VARIABLECOST,
      CASE WHEN MAX_REV.COST_TYPE = 1 THEN ISNULL(MASTER_DATA.M7, 0) + ISNULL(MASTER_DATA.M8, 0) + ISNULL(MASTER_DATA.M9, 0) + ISNULL(MASTER_DATA.M10, 0) + ISNULL(MASTER_DATA.M11, 0) + ISNULL(MASTER_DATA.M12, 0) - ISNULL(ORIGINAL_BUDGET.H2, 0) ELSE 0 END AS DIFF_SECOND_HALF_FIXCOST,
      CASE WHEN MAX_REV.COST_TYPE = 2 THEN ISNULL(MASTER_DATA.M7, 0) + ISNULL(MASTER_DATA.M8, 0) + ISNULL(MASTER_DATA.M9, 0) + ISNULL(MASTER_DATA.M10, 0) + ISNULL(MASTER_DATA.M11, 0) + ISNULL(MASTER_DATA.M12, 0) - ISNULL(ORIGINAL_BUDGET.H2, 0) ELSE 0 END AS DIFF_SECOND_HALF_VARIABLECOST,
      CASE WHEN MAX_REV.COST_TYPE = 1 THEN ISNULL(ACTUAL_DATA.M1, 0) + ISNULL(ACTUAL_DATA.M2, 0) + ISNULL(ACTUAL_DATA.M3, 0) + ISNULL(MASTER_DATA.M4, 0) + ISNULL(MASTER_DATA.M5, 0) + ISNULL(MASTER_DATA.M6, 0) + ISNULL(MASTER_DATA.M7, 0) + ISNULL(MASTER_DATA.M8, 0) + ISNULL(MASTER_DATA.M9, 0) + ISNULL(MASTER_DATA.M10, 0) + ISNULL(MASTER_DATA.M11, 0) + ISNULL(MASTER_DATA.M12, 0) ELSE 0 END AS REVISE_TOTAL_YEAR_FIXCOST,
      CASE WHEN MAX_REV.COST_TYPE = 2 THEN ISNULL(ACTUAL_DATA.M1, 0) + ISNULL(ACTUAL_DATA.M2, 0) + ISNULL(ACTUAL_DATA.M3, 0) + ISNULL(MASTER_DATA.M4, 0) + ISNULL(MASTER_DATA.M5, 0) + ISNULL(MASTER_DATA.M6, 0) + ISNULL(MASTER_DATA.M7, 0) + ISNULL(MASTER_DATA.M8, 0) + ISNULL(MASTER_DATA.M9, 0) + ISNULL(MASTER_DATA.M10, 0) + ISNULL(MASTER_DATA.M11, 0) + ISNULL(MASTER_DATA.M12, 0) ELSE 0 END AS REVISE_TOTAL_YEAR_VARIABLECOST,
      CASE WHEN MAX_REV.COST_TYPE = 1 THEN ISNULL(ACTUAL_DATA.M1, 0) + ISNULL(ACTUAL_DATA.M2, 0) + ISNULL(ACTUAL_DATA.M3, 0) + ISNULL(MASTER_DATA.M4, 0) + ISNULL(MASTER_DATA.M5, 0) + ISNULL(MASTER_DATA.M6, 0) - ISNULL(ORIGINAL_BUDGET.H1, 0) + (ISNULL(MASTER_DATA.M7, 0) + ISNULL(MASTER_DATA.M8, 0) + ISNULL(MASTER_DATA.M9, 0) + ISNULL(MASTER_DATA.M10, 0) + ISNULL(MASTER_DATA.M11, 0) + ISNULL(MASTER_DATA.M12, 0) - ISNULL(ORIGINAL_BUDGET.H2, 0)) ELSE 0 END AS DIFF_TOTAL_YEAR_FIXCOST,
      CASE WHEN MAX_REV.COST_TYPE = 2 THEN ISNULL(ACTUAL_DATA.M1, 0) + ISNULL(ACTUAL_DATA.M2, 0) + ISNULL(ACTUAL_DATA.M3, 0) + ISNULL(MASTER_DATA.M4, 0) + ISNULL(MASTER_DATA.M5, 0) + ISNULL(MASTER_DATA.M6, 0) - ISNULL(ORIGINAL_BUDGET.H1, 0) + (ISNULL(MASTER_DATA.M7, 0) + ISNULL(MASTER_DATA.M8, 0) + ISNULL(MASTER_DATA.M9, 0) + ISNULL(MASTER_DATA.M10, 0) + ISNULL(MASTER_DATA.M11, 0) + ISNULL(MASTER_DATA.M12, 0) - ISNULL(ORIGINAL_BUDGET.H2, 0)) ELSE 0 END AS DIFF_TOTAL_YEAR_VARIABLECOST
      FROM (
      SELECT BUDGET_DATA.BUDGET_ORDER_NO, BUDGET_DATA.BUDGET_YEAR, BUDGET_ORDER.COST_TYPE,
      BUDGET_DATA.PERIOD_TYPE, BUDGET_DATA.PROJECT_NO, MAX(BUDGET_DATA.REV_NO) AS REV_NO, BUDGET_ORDER.BUDGET_ORDER_NAME,
      BUDGET_ORDER.DEPT_NO, BUDGET_ORDER.PERSON_IN_CHARGE_NO, PIC.PERSON_IN_CHARGE_NAME
      FROM BG_T_BUDGET_DATA AS BUDGET_DATA
      INNER JOIN BG_M_BUDGET_ORDER AS BUDGET_ORDER
      ON BUDGET_ORDER.BUDGET_ORDER_NO = BUDGET_DATA.BUDGET_ORDER_NO AND BUDGET_ORDER.BUDGET_TYPE = 'E' AND BUDGET_ORDER.ACTIVE_FLAG = 1
      INNER JOIN BG_M_PERSON_IN_CHARGE AS PIC
      ON PIC.PERSON_IN_CHARGE_NO = BUDGET_ORDER.PERSON_IN_CHARGE_NO
      WHERE BUDGET_DATA.BUDGET_YEAR = @YEAR
      AND BUDGET_DATA.PERIOD_TYPE = @PERIOD
      AND BUDGET_DATA.PROJECT_NO = @PROJECTNO
      AND BUDGET_DATA.REV_NO = @REVNO
      @PICCONDITION
      --WHERE BUDGET_DATA.BUDGET_YEAR = 2010 AND BUDGET_DATA.PERIOD_TYPE = 3
      --AND (ISNULL(M7, 0) &lt;&gt; 0 OR ISNULL(M8, 0) &lt;&gt; 0 OR ISNULL(M9, 0) &lt;&gt; 0 OR ISNULL(M10, 0) &lt;&gt; 0
      --OR ISNULL(M11, 0) &lt;&gt; 0 OR ISNULL(M12, 0) &lt;&gt; 0)
      GROUP BY BUDGET_DATA.BUDGET_ORDER_NO, BUDGET_DATA.BUDGET_YEAR, BUDGET_DATA.PERIOD_TYPE, BUDGET_DATA.PROJECT_NO, BUDGET_ORDER.BUDGET_ORDER_NAME, BUDGET_ORDER.DEPT_NO, BUDGET_ORDER.COST_TYPE,
      BUDGET_ORDER.PERSON_IN_CHARGE_NO, PIC.PERSON_IN_CHARGE_NAME) AS MAX_REV

      INNER JOIN BG_T_BUDGET_DATA AS MASTER_DATA
      ON MAX_REV.BUDGET_YEAR = MASTER_DATA.BUDGET_YEAR
      AND MAX_REV.PERIOD_TYPE = MASTER_DATA.PERIOD_TYPE
      AND MAX_REV.PROJECT_NO = MASTER_DATA.PROJECT_NO
      AND MAX_REV.BUDGET_ORDER_NO = MASTER_DATA.BUDGET_ORDER_NO
      AND MAX_REV.REV_NO = MASTER_DATA.REV_NO

      LEFT OUTER JOIN BG_T_UPLOAD_DATA AS ORIGINAL_BUDGET
      ON MAX_REV.BUDGET_YEAR = ORIGINAL_BUDGET.BUDGET_YEAR
      AND ORIGINAL_BUDGET.PERIOD_TYPE = @PERIOD
      AND ORIGINAL_BUDGET.PROJECT_NO = @PROJECTNO
      AND MAX_REV.BUDGET_ORDER_NO = ORIGINAL_BUDGET.BUDGET_ORDER_NO
      AND ORIGINAL_BUDGET.DATA_TYPE = 1

      LEFT OUTER JOIN BG_T_UPLOAD_DATA AS ACTUAL_DATA
      ON ACTUAL_DATA.BUDGET_YEAR = MAX_REV.BUDGET_YEAR
      AND ACTUAL_DATA.BUDGET_ORDER_NO = MAX_REV.BUDGET_ORDER_NO
      AND ACTUAL_DATA.DATA_TYPE = 2
      AND ACTUAL_DATA.PERIOD_TYPE = @PERIOD
      AND ACTUAL_DATA.PROJECT_NO = @PROJECTNO
      --ON ACTUAL_DATA.BUDGET_YEAR = MAX_REV.BUDGET_YEAR AND ACTUAL_DATA.BUDGET_ORDER_NO = MAX_REV.BUDGET_ORDER_NO AND ACTUAL_DATA.DATA_TYPE = 2 AND ACTUAL_DATA.PERIOD_TYPE = 3

      WHERE(ISNULL(ORIGINAL_BUDGET.H1, 0) &lt;&gt; 0 OR ISNULL(ORIGINAL_BUDGET.H2, 0) &lt;&gt; 0
      OR ISNULL(ACTUAL_DATA.M1, 0) &lt;&gt; 0 OR ISNULL(ACTUAL_DATA.M2, 0) &lt;&gt; 0 OR ISNULL(ACTUAL_DATA.M3, 0) &lt;&gt; 0
      OR ISNULL(MASTER_DATA.M4, 0) &lt;&gt; 0 OR ISNULL(MASTER_DATA.M5, 0) &lt;&gt; 0 OR ISNULL(MASTER_DATA.M6, 0) &lt;&gt; 0
      OR ISNULL(MASTER_DATA.M7, 0) &lt;&gt; 0 OR ISNULL(MASTER_DATA.M8, 0) &lt;&gt; 0 OR ISNULL(MASTER_DATA.M9, 0) &lt;&gt; 0
      OR ISNULL(MASTER_DATA.M10, 0) &lt;&gt; 0 OR ISNULL(MASTER_DATA.M11, 0) &lt;&gt; 0 OR ISNULL(MASTER_DATA.M12, 0) &lt;&gt; 0
      OR ISNULL(MASTER_DATA.RRT1, 0) &lt;&gt; 0 OR ISNULL(MASTER_DATA.RRT2, 0) &lt;&gt; 0 OR ISNULL(MASTER_DATA.RRT3, 0) &lt;&gt; 0
      OR ISNULL(MASTER_DATA.RRT4, 0) &lt;&gt; 0 OR ISNULL(MASTER_DATA.RRT5, 0) &lt;&gt; 0)
      ORDER BY MAX_REV.BUDGET_ORDER_NO
    </SELECT004_11 >
    
    <SELECT004_12>

      SELECT MTP.BUDGET_ORDER_NO
      , MTP.BUDGET_YEAR, BOO.COST_TYPE,
      MTP.PERIOD_TYPE, MTP.PROJECT_NO, MTP.REV_NO, BOO.BUDGET_ORDER_NAME,
      DPP.DEPT_NO, PICC.PERSON_IN_CHARGE_NO, PICC.PERSON_IN_CHARGE_NAME,
      BOO.PIC_SHOW_FLAG AS PIC_SHOW_FLG,
      ISNULL(MTP.RRT1,0) AS RRT1,
      ISNULL(MTP.RRT2,0) AS RRT2,
      ISNULL(MTP.RRT3,0) AS RRT3,
      ISNULL(MTP.RRT4,0) AS RRT4,
      ISNULL(MTP.RRT5,0) AS RRT5,

      ISNULL(OB_BUDGET_DATA.M1, 0) + ISNULL(OB_BUDGET_DATA.M2, 0)
      + ISNULL(OB_BUDGET_DATA.M3, 0) + ISNULL(OB_BUDGET_DATA.M4, 0)
      + ISNULL(OB_BUDGET_DATA.M5, 0) + ISNULL(OB_BUDGET_DATA.M6, 0)
      + ISNULL(OB_BUDGET_DATA.M7, 0) + ISNULL(OB_BUDGET_DATA.M8, 0)
      + ISNULL(OB_BUDGET_DATA.M9, 0) + ISNULL(OB_BUDGET_DATA.M10, 0)
      + ISNULL(OB_BUDGET_DATA.M11, 0) + ISNULL(OB_BUDGET_DATA.M12, 0) AS REVISE_TOTAL_YEAR ,

      (ISNULL(OB_BUDGET_DATA.M1, 0) + ISNULL(OB_BUDGET_DATA.M2, 0)
      + ISNULL(OB_BUDGET_DATA.M3, 0) + ISNULL(OB_BUDGET_DATA.M4, 0)
      + ISNULL(OB_BUDGET_DATA.M5, 0) + ISNULL(OB_BUDGET_DATA.M6, 0)
      + ISNULL(OB_BUDGET_DATA.M7, 0) + ISNULL(OB_BUDGET_DATA.M8, 0)
      + ISNULL(OB_BUDGET_DATA.M9, 0) + ISNULL(OB_BUDGET_DATA.M10, 0)
      + ISNULL(OB_BUDGET_DATA.M11, 0) + ISNULL(OB_BUDGET_DATA.M12, 0))
      - ISNULL(MASTER_DATA1.RRT2, 0) AS DIFF_TOTAL_YEAR,



      ISNULL(MASTER_DATA1.RRT1, 0) AS PrevRRT1,
      ISNULL(MASTER_DATA1.RRT2, 0) AS PrevRRT2,
      ISNULL(MASTER_DATA1.RRT3, 0) AS PrevRRT3,
      ISNULL(MASTER_DATA1.RRT4, 0) AS PrevRRT4,
      ISNULL(MASTER_DATA1.RRT5, 0) AS PrevRRT5,

      CASE WHEN BOO.COST_TYPE = 1 THEN ISNULL(MTP.RRT1, 0) ELSE 0 END AS RRT1_FIXCOST,
      CASE WHEN BOO.COST_TYPE = 2 THEN ISNULL(MTP.RRT1, 0) ELSE 0 END AS RRT1_VARIABLECOST,
      CASE WHEN BOO.COST_TYPE = 1 THEN ISNULL(MTP.RRT2, 0) ELSE 0 END AS RRT2_FIXCOST,
      CASE WHEN BOO.COST_TYPE = 2 THEN ISNULL(MTP.RRT2, 0) ELSE 0 END AS RRT2_VARIABLECOST,
      CASE WHEN BOO.COST_TYPE = 1 THEN ISNULL(MTP.RRT3, 0) ELSE 0 END AS RRT3_FIXCOST,
      CASE WHEN BOO.COST_TYPE = 2 THEN ISNULL(MTP.RRT3, 0) ELSE 0 END AS RRT3_VARIABLECOST,
      CASE WHEN BOO.COST_TYPE = 1 THEN ISNULL(MTP.RRT4, 0) ELSE 0 END AS RRT4_FIXCOST,
      CASE WHEN BOO.COST_TYPE = 2 THEN ISNULL(MTP.RRT4, 0) ELSE 0 END AS RRT4_VARIABLECOST,
      CASE WHEN BOO.COST_TYPE = 1 THEN ISNULL(MTP.RRT5, 0) ELSE 0 END AS RRT5_FIXCOST,
      CASE WHEN BOO.COST_TYPE = 2 THEN ISNULL(MTP.RRT5, 0) ELSE 0 END AS RRT5_VARIABLECOST,

      CASE WHEN BOO.COST_TYPE = 1 THEN ISNULL(MASTER_DATA1.RRT1, 0) ELSE 0 END AS PrevRRT1_FIXCOST,
      CASE WHEN BOO.COST_TYPE = 2 THEN ISNULL(MASTER_DATA1.RRT1, 0) ELSE 0 END AS PrevRRT1_VARIABLECOST,
      CASE WHEN BOO.COST_TYPE = 1 THEN ISNULL(MASTER_DATA1.RRT2, 0) ELSE 0 END AS PrevRRT2_FIXCOST,
      CASE WHEN BOO.COST_TYPE = 2 THEN ISNULL(MASTER_DATA1.RRT2, 0) ELSE 0 END AS PrevRRT2_VARIABLECOST,
      CASE WHEN BOO.COST_TYPE = 1 THEN ISNULL(MASTER_DATA1.RRT3, 0) ELSE 0 END AS PrevRRT3_FIXCOST,
      CASE WHEN BOO.COST_TYPE = 2 THEN ISNULL(MASTER_DATA1.RRT3, 0) ELSE 0 END AS PrevRRT3_VARIABLECOST,
      CASE WHEN BOO.COST_TYPE = 1 THEN ISNULL(MASTER_DATA1.RRT4, 0) ELSE 0 END AS PrevRRT4_FIXCOST,
      CASE WHEN BOO.COST_TYPE = 2 THEN ISNULL(MASTER_DATA1.RRT4, 0) ELSE 0 END AS PrevRRT4_VARIABLECOST,
      CASE WHEN BOO.COST_TYPE = 1 THEN ISNULL(MASTER_DATA1.RRT5, 0) ELSE 0 END AS PrevRRT5_FIXCOST,
      CASE WHEN BOO.COST_TYPE = 2 THEN ISNULL(MASTER_DATA1.RRT5, 0) ELSE 0 END AS PrevRRT5_VARIABLECOST,

      CASE WHEN BOO.COST_TYPE = 1 THEN ISNULL(OB_BUDGET_DATA.M1, 0) + ISNULL(OB_BUDGET_DATA.M2, 0) + ISNULL(OB_BUDGET_DATA.M3, 0) + ISNULL(OB_BUDGET_DATA.M4, 0) + ISNULL(OB_BUDGET_DATA.M5, 0) + ISNULL(OB_BUDGET_DATA.M6, 0) + ISNULL(OB_BUDGET_DATA.M7, 0) + ISNULL(OB_BUDGET_DATA.M8, 0) + ISNULL(OB_BUDGET_DATA.M9, 0) + ISNULL(OB_BUDGET_DATA.M10, 0) + ISNULL(OB_BUDGET_DATA.M11, 0) + ISNULL(OB_BUDGET_DATA.M12, 0) ELSE 0 END AS REVISE_TOTAL_YEAR_FIXCOST,
      CASE WHEN BOO.COST_TYPE = 2 THEN ISNULL(OB_BUDGET_DATA.M1, 0) + ISNULL(OB_BUDGET_DATA.M2, 0) + ISNULL(OB_BUDGET_DATA.M3, 0) + ISNULL(OB_BUDGET_DATA.M4, 0) + ISNULL(OB_BUDGET_DATA.M5, 0) + ISNULL(OB_BUDGET_DATA.M6, 0) + ISNULL(OB_BUDGET_DATA.M7, 0) + ISNULL(OB_BUDGET_DATA.M8, 0) + ISNULL(OB_BUDGET_DATA.M9, 0) + ISNULL(OB_BUDGET_DATA.M10, 0) + ISNULL(OB_BUDGET_DATA.M11, 0) + ISNULL(OB_BUDGET_DATA.M12, 0) ELSE 0 END AS REVISE_TOTAL_YEAR_VARIABLECOST,

      CASE WHEN BOO.COST_TYPE = 1 THEN ISNULL(OB_BUDGET_DATA.M1, 0) + ISNULL(OB_BUDGET_DATA.M2, 0) + ISNULL(OB_BUDGET_DATA.M3, 0) + ISNULL(OB_BUDGET_DATA.M4, 0) + ISNULL(OB_BUDGET_DATA.M5, 0) + ISNULL(OB_BUDGET_DATA.M6, 0) + ISNULL(OB_BUDGET_DATA.M7, 0) + ISNULL(OB_BUDGET_DATA.M8, 0) + ISNULL(OB_BUDGET_DATA.M9, 0) + ISNULL(OB_BUDGET_DATA.M10, 0) + ISNULL(OB_BUDGET_DATA.M11, 0) + ISNULL(OB_BUDGET_DATA.M12, 0)  - ISNULL(MASTER_DATA1.RRT2, 0) ELSE 0 END AS DIFF_TOTAL_YEAR_FIXCOST,
      CASE WHEN BOO.COST_TYPE = 2 THEN ISNULL(OB_BUDGET_DATA.M1, 0) + ISNULL(OB_BUDGET_DATA.M2, 0) + ISNULL(OB_BUDGET_DATA.M3, 0) + ISNULL(OB_BUDGET_DATA.M4, 0) + ISNULL(OB_BUDGET_DATA.M5, 0) + ISNULL(OB_BUDGET_DATA.M6, 0) + ISNULL(OB_BUDGET_DATA.M7, 0) + ISNULL(OB_BUDGET_DATA.M8, 0) + ISNULL(OB_BUDGET_DATA.M9, 0) + ISNULL(OB_BUDGET_DATA.M10, 0) + ISNULL(OB_BUDGET_DATA.M11, 0) + ISNULL(OB_BUDGET_DATA.M12, 0)  - ISNULL(MASTER_DATA1.RRT2, 0) ELSE 0 END AS DIFF_TOTAL_YEAR_VARIABLECOST
      ,(ISNULL(MTP.RRT2,0) -  ISNULL(MASTER_DATA1.RRT3, 0)) AS DIFF_PREV_YEAR
      ,CASE WHEN BOO.COST_TYPE = 1 THEN ISNULL(MTP.RRT2, 0)  - ISNULL(MASTER_DATA1.RRT3, 0) ELSE 0 END AS DIFF_PREV_YEAR_FIXCOST
      ,CASE WHEN BOO.COST_TYPE = 2 THEN ISNULL(MTP.RRT2, 0)  - ISNULL(MASTER_DATA1.RRT3, 0) ELSE 0 END AS DIFF_PREV_YEAR_VARIABLECOST




      FROM
      (
      SELECT

      BD.BUDGET_YEAR,
      BD.PERIOD_TYPE,
      BUDGET_ORDER_MAIN.BUDGET_ORDER_NO,
      BD.REV_NO,
      BD.M1,
      BD.M2,
      BD.M3,
      BD.M4,
      BD.M5,
      BD.M6,
      BD.M7,
      BD.M8,
      BD.M9,
      BD.M10,
      BD.M11,
      BD.M12,
      BD.RRT1,
      BD.RRT2,
      BD.RRT3,
      BD.RRT4,
      BD.RRT5,
      BD.REMARKS,
      BD.WB_FLAG,
      BD.CREATE_USER_ID,
      BD.CREATE_DATE,
      BD.UPDATE_USER_ID,
      BD.UPDATE_DATE,
      BD.PROJECT_NO,
      BO.BUDGET_ORDER_NAME,BO.PIC_SHOW_FLAG AS PIC_SHOW_FLG,
      AC.ACCOUNT_NO, AC.ACCOUNT_NAME,
      BO.COST, BO.COST_TYPE, DP.DEPT_NO, DP.DEPT_NAME,
      PIC.PERSON_IN_CHARGE_NO, PIC.PERSON_IN_CHARGE_NAME


      FROM
      (
      SELECT
      distinct(BD.BUDGET_ORDER_NO)
      FROM BG_T_BUDGET_DATA AS BD
      LEFT JOIN BG_M_BUDGET_ORDER AS BO ON BD.BUDGET_ORDER_NO = BO.BUDGET_ORDER_NO
      LEFT JOIN BG_M_ACCOUNT AS AC ON BO.ACCOUNT_NO = AC.ACCOUNT_NO
      LEFT JOIN BG_M_DEPT AS DP ON BO.DEPT_NO = DP.DEPT_NO
      LEFT JOIN BG_M_PERSON_IN_CHARGE AS PIC ON BO.PERSON_IN_CHARGE_NO = PIC.PERSON_IN_CHARGE_NO
      LEFT JOIN BG_T_BUDGET_PERIOD AS BP ON BD.BUDGET_YEAR = BP.BUDGET_YEAR AND BD.PERIOD_TYPE = BP.PERIOD_TYPE AND BD.PROJECT_NO = BP.PROJECT_NO
      WHERE
      BD.BUDGET_YEAR = @YEAR
      AND BD.PERIOD_TYPE = @PERIOD
      AND BO.BUDGET_TYPE = 'E'
      AND BD.REV_NO = @REVNO
      AND BD.PROJECT_NO = @PROJECTNO
      AND BO.ACTIVE_FLAG = 1
      @PICCONDITION

      UNION

      SELECT
      distinct(BD.BUDGET_ORDER_NO)
      FROM
      BG_T_BUDGET_DATA AS BD
      LEFT JOIN BG_M_BUDGET_ORDER AS BO ON BD.BUDGET_ORDER_NO = BO.BUDGET_ORDER_NO
      LEFT JOIN BG_M_ACCOUNT AS AC ON BO.ACCOUNT_NO = AC.ACCOUNT_NO
      LEFT JOIN BG_M_DEPT AS DP ON BO.DEPT_NO = DP.DEPT_NO
      LEFT JOIN BG_M_PERSON_IN_CHARGE AS PIC ON BO.PERSON_IN_CHARGE_NO = PIC.PERSON_IN_CHARGE_NO
      LEFT JOIN BG_T_BUDGET_PERIOD AS BP ON BD.BUDGET_YEAR = BP.BUDGET_YEAR AND BD.PERIOD_TYPE = BP.PERIOD_TYPE AND BD.PROJECT_NO = BP.PROJECT_NO
      WHERE
      BD.BUDGET_YEAR = @YEAR+1
      AND BD.PERIOD_TYPE = 1
      AND BO.BUDGET_TYPE = 'E'
      AND BD.REV_NO = @RefRBRevNo
      AND BD.PROJECT_NO = @RefRBProjectNo
      AND BO.ACTIVE_FLAG = 1
      @PICCONDITION
      ) AS BUDGET_ORDER_MAIN


      LEFT JOIN BG_T_BUDGET_DATA  BD
      ON BD.BUDGET_ORDER_NO = BUDGET_ORDER_MAIN.BUDGET_ORDER_NO
      AND BD.BUDGET_YEAR = @YEAR
      AND BD.PERIOD_TYPE = @PERIOD
      AND BD.REV_NO = @REVNO
      AND BD.PROJECT_NO = @PROJECTNO


      LEFT JOIN BG_M_BUDGET_ORDER AS BO ON BD.BUDGET_ORDER_NO = BO.BUDGET_ORDER_NO
      LEFT JOIN BG_M_ACCOUNT AS AC ON BO.ACCOUNT_NO = AC.ACCOUNT_NO
      LEFT JOIN BG_M_DEPT AS DP ON BO.DEPT_NO = DP.DEPT_NO
      LEFT JOIN BG_M_PERSON_IN_CHARGE AS PIC ON BO.PERSON_IN_CHARGE_NO = PIC.PERSON_IN_CHARGE_NO
      LEFT JOIN BG_T_BUDGET_PERIOD AS BP ON BD.BUDGET_YEAR = BP.BUDGET_YEAR AND BD.PERIOD_TYPE = BP.PERIOD_TYPE AND BD.PROJECT_NO = BP.PROJECT_NO


      ) AS MTP


      LEFT JOIN BG_M_BUDGET_ORDER AS BOO
      ON MTP.BUDGET_ORDER_NO = BOO.BUDGET_ORDER_NO

      LEFT JOIN BG_M_DEPT AS DPP
      ON BOO.DEPT_NO = DPP.DEPT_NO

      LEFT JOIN BG_M_PERSON_IN_CHARGE AS PICC
      ON BOO.PERSON_IN_CHARGE_NO = PICC.PERSON_IN_CHARGE_NO


      LEFT OUTER JOIN BG_T_BUDGET_DATA AS OB_BUDGET_DATA
      ON OB_BUDGET_DATA.BUDGET_YEAR = @YEAR + 1
      AND OB_BUDGET_DATA.BUDGET_ORDER_NO = MTP.BUDGET_ORDER_NO
      AND OB_BUDGET_DATA.PERIOD_TYPE = 1
      AND OB_BUDGET_DATA.PROJECT_NO = @RefRBProjectNo
      AND OB_BUDGET_DATA.REV_NO = @RefRBRevNo

      LEFT JOIN
      (
      SELECT BUDGET_DATA.BUDGET_ORDER_NO, BUDGET_DATA.BUDGET_YEAR, BUDGET_ORDER.COST_TYPE,
      BUDGET_DATA.PERIOD_TYPE, BUDGET_DATA.PROJECT_NO, MAX(BUDGET_DATA.REV_NO) AS REV_NO, BUDGET_ORDER.BUDGET_ORDER_NAME,
      BUDGET_ORDER.DEPT_NO, BUDGET_ORDER.PERSON_IN_CHARGE_NO, PIC.PERSON_IN_CHARGE_NAME
      FROM BG_T_BUDGET_DATA AS BUDGET_DATA
      INNER JOIN BG_M_BUDGET_ORDER AS BUDGET_ORDER
      ON BUDGET_ORDER.BUDGET_ORDER_NO = BUDGET_DATA.BUDGET_ORDER_NO AND BUDGET_ORDER.BUDGET_TYPE = 'E' AND BUDGET_ORDER.ACTIVE_FLAG = 1
      INNER JOIN BG_M_PERSON_IN_CHARGE AS PIC
      ON PIC.PERSON_IN_CHARGE_NO = BUDGET_ORDER.PERSON_IN_CHARGE_NO
      WHERE BUDGET_DATA.BUDGET_YEAR = @YEAR
      AND BUDGET_DATA.PERIOD_TYPE = @PERIOD
      AND BUDGET_DATA.PROJECT_NO = @PROJECTNO
      AND BUDGET_DATA.REV_NO = @REVNO
      GROUP BY BUDGET_DATA.BUDGET_ORDER_NO, BUDGET_DATA.BUDGET_YEAR, BUDGET_DATA.PERIOD_TYPE, BUDGET_DATA.PROJECT_NO, BUDGET_ORDER.BUDGET_ORDER_NAME, BUDGET_ORDER.DEPT_NO, BUDGET_ORDER.COST_TYPE,
      BUDGET_ORDER.PERSON_IN_CHARGE_NO, PIC.PERSON_IN_CHARGE_NAME) AS MAX_REV ON MTP.BUDGET_ORDER_NO = MAX_REV.BUDGET_ORDER_NO


      LEFT JOIN
      (
      SELECT BUDGET_DATA1.BUDGET_ORDER_NO, BUDGET_DATA1.BUDGET_YEAR, BUDGET_ORDER1.COST_TYPE,
      BUDGET_DATA1.PERIOD_TYPE, BUDGET_DATA1.PROJECT_NO, MAX(BUDGET_DATA1.REV_NO) AS REV_NO, BUDGET_ORDER1.BUDGET_ORDER_NAME,
      BUDGET_ORDER1.DEPT_NO, BUDGET_ORDER1.PERSON_IN_CHARGE_NO, PIC1.PERSON_IN_CHARGE_NAME
      FROM BG_T_BUDGET_DATA AS BUDGET_DATA1
      INNER JOIN BG_M_BUDGET_ORDER AS BUDGET_ORDER1
      ON BUDGET_ORDER1.BUDGET_ORDER_NO = BUDGET_DATA1.BUDGET_ORDER_NO AND BUDGET_ORDER1.BUDGET_TYPE = 'E' AND BUDGET_ORDER1.ACTIVE_FLAG = 1
      INNER JOIN BG_M_PERSON_IN_CHARGE AS PIC1
      ON PIC1.PERSON_IN_CHARGE_NO = BUDGET_ORDER1.PERSON_IN_CHARGE_NO
      WHERE BUDGET_DATA1.BUDGET_YEAR = (@YEAR - 1)
      AND BUDGET_DATA1.PERIOD_TYPE = @PERIOD
      AND BUDGET_DATA1.PROJECT_NO = @PROJECTNO
      AND BUDGET_DATA1.REV_NO = @REVNO
      GROUP BY BUDGET_DATA1.BUDGET_ORDER_NO, BUDGET_DATA1.BUDGET_YEAR, BUDGET_DATA1.PERIOD_TYPE, BUDGET_DATA1.PROJECT_NO, BUDGET_ORDER1.BUDGET_ORDER_NAME, BUDGET_ORDER1.DEPT_NO, BUDGET_ORDER1.COST_TYPE,
      BUDGET_ORDER1.PERSON_IN_CHARGE_NO, PIC1.PERSON_IN_CHARGE_NAME) AS MAX_PREV_REV ON MTP.BUDGET_ORDER_NO = MAX_PREV_REV.BUDGET_ORDER_NO



      LEFT JOIN BG_T_BUDGET_DATA AS MASTER_DATA1
      ON MAX_PREV_REV.BUDGET_YEAR = MASTER_DATA1.BUDGET_YEAR
      AND MAX_PREV_REV.PERIOD_TYPE = MASTER_DATA1.PERIOD_TYPE
      AND MAX_PREV_REV.PROJECT_NO = MASTER_DATA1.PROJECT_NO
      AND MAX_PREV_REV.BUDGET_ORDER_NO = MASTER_DATA1.BUDGET_ORDER_NO
      AND MAX_PREV_REV.REV_NO = MASTER_DATA1.REV_NO


      WHERE(ISNULL(OB_BUDGET_DATA.M1, 0) &lt;&gt; 0
      OR ISNULL(OB_BUDGET_DATA.M2, 0) &lt;&gt; 0
      OR ISNULL(OB_BUDGET_DATA.M3, 0) &lt;&gt; 0
      OR ISNULL(OB_BUDGET_DATA.M4, 0) &lt;&gt; 0
      OR ISNULL(OB_BUDGET_DATA.M5, 0) &lt;&gt; 0
      OR ISNULL(OB_BUDGET_DATA.M6, 0) &lt;&gt; 0
      OR ISNULL(OB_BUDGET_DATA.M7, 0) &lt;&gt; 0
      OR ISNULL(OB_BUDGET_DATA.M8, 0) &lt;&gt; 0
      OR ISNULL(OB_BUDGET_DATA.M9, 0) &lt;&gt; 0
      OR ISNULL(OB_BUDGET_DATA.M10, 0) &lt;&gt; 0
      OR ISNULL(OB_BUDGET_DATA.M11, 0) &lt;&gt; 0
      OR ISNULL(OB_BUDGET_DATA.M12, 0) &lt;&gt; 0
      OR ISNULL(MASTER_DATA1.RRT1, 0) &lt;&gt; 0
      OR ISNULL(MASTER_DATA1.RRT2, 0) &lt;&gt; 0
      OR ISNULL(MASTER_DATA1.RRT3, 0) &lt;&gt; 0
      OR ISNULL(MASTER_DATA1.RRT4, 0) &lt;&gt; 0
      OR ISNULL(MASTER_DATA1.RRT5, 0) &lt;&gt; 0
      OR ISNULL(MTP.RRT1, 0) &lt;&gt; 0
      OR ISNULL(MTP.RRT2, 0) &lt;&gt; 0
      OR ISNULL(MTP.RRT3, 0) &lt;&gt; 0
      OR ISNULL(MTP.RRT4, 0) &lt;&gt; 0
      OR ISNULL(MTP.RRT5, 0) &lt;&gt; 0)

      ORDER BY MTP.BUDGET_ORDER_NO

    </SELECT004_12>
    <!--<SELECT004_12>
      SELECT MTP.BUDGET_ORDER_NO, MTP.BUDGET_YEAR, MTP.COST_TYPE,
      MTP.PERIOD_TYPE, MTP.PROJECT_NO, MTP.REV_NO, MTP.BUDGET_ORDER_NAME,
      MTP.DEPT_NO, MTP.PERSON_IN_CHARGE_NO, MTP.PERSON_IN_CHARGE_NAME,
      MTP.PIC_SHOW_FLG,
      MTP.RRT1,
      MTP.RRT2,
      MTP.RRT3,
      MTP.RRT4,
      MTP.RRT5,

      ISNULL(OB_BUDGET_DATA.M1, 0) + ISNULL(OB_BUDGET_DATA.M2, 0)
      + ISNULL(OB_BUDGET_DATA.M3, 0) + ISNULL(OB_BUDGET_DATA.M4, 0)
      + ISNULL(OB_BUDGET_DATA.M5, 0) + ISNULL(OB_BUDGET_DATA.M6, 0)
      + ISNULL(OB_BUDGET_DATA.M7, 0) + ISNULL(OB_BUDGET_DATA.M8, 0)
      + ISNULL(OB_BUDGET_DATA.M9, 0) + ISNULL(OB_BUDGET_DATA.M10, 0)
      + ISNULL(OB_BUDGET_DATA.M11, 0) + ISNULL(OB_BUDGET_DATA.M12, 0) AS REVISE_TOTAL_YEAR,
      (ISNULL(OB_BUDGET_DATA.M1, 0) + ISNULL(OB_BUDGET_DATA.M2, 0)
      + ISNULL(OB_BUDGET_DATA.M3, 0) + ISNULL(OB_BUDGET_DATA.M4, 0)
      + ISNULL(OB_BUDGET_DATA.M5, 0) + ISNULL(OB_BUDGET_DATA.M6, 0)
      + ISNULL(OB_BUDGET_DATA.M7, 0) + ISNULL(OB_BUDGET_DATA.M8, 0)
      + ISNULL(OB_BUDGET_DATA.M9, 0) + ISNULL(OB_BUDGET_DATA.M10, 0)
      + ISNULL(OB_BUDGET_DATA.M11, 0) + ISNULL(OB_BUDGET_DATA.M12, 0))
      - ISNULL(MASTER_DATA1.RRT2, 0) AS DIFF_TOTAL_YEAR,

      ISNULL(MASTER_DATA1.RRT1, 0) AS PrevRRT1,
      ISNULL(MASTER_DATA1.RRT2, 0) AS PrevRRT2,
      ISNULL(MASTER_DATA1.RRT3, 0) AS PrevRRT3,
      ISNULL(MASTER_DATA1.RRT4, 0) AS PrevRRT4,
      ISNULL(MASTER_DATA1.RRT5, 0) AS PrevRRT5,
    
      CASE WHEN MAX_REV.COST_TYPE = 1 THEN ISNULL(MTP.RRT1, 0) ELSE 0 END AS RRT1_FIXCOST,
      CASE WHEN MAX_REV.COST_TYPE = 2 THEN ISNULL(MTP.RRT1, 0) ELSE 0 END AS RRT1_VARIABLECOST,
      CASE WHEN MAX_REV.COST_TYPE = 1 THEN ISNULL(MTP.RRT2, 0) ELSE 0 END AS RRT2_FIXCOST,
      CASE WHEN MAX_REV.COST_TYPE = 2 THEN ISNULL(MTP.RRT2, 0) ELSE 0 END AS RRT2_VARIABLECOST,
      CASE WHEN MAX_REV.COST_TYPE = 1 THEN ISNULL(MTP.RRT3, 0) ELSE 0 END AS RRT3_FIXCOST,
      CASE WHEN MAX_REV.COST_TYPE = 2 THEN ISNULL(MTP.RRT3, 0) ELSE 0 END AS RRT3_VARIABLECOST,
      CASE WHEN MAX_REV.COST_TYPE = 1 THEN ISNULL(MTP.RRT4, 0) ELSE 0 END AS RRT4_FIXCOST,
      CASE WHEN MAX_REV.COST_TYPE = 2 THEN ISNULL(MTP.RRT4, 0) ELSE 0 END AS RRT4_VARIABLECOST,
      CASE WHEN MAX_REV.COST_TYPE = 1 THEN ISNULL(MTP.RRT5, 0) ELSE 0 END AS RRT5_FIXCOST,
      CASE WHEN MAX_REV.COST_TYPE = 2 THEN ISNULL(MTP.RRT5, 0) ELSE 0 END AS RRT5_VARIABLECOST,

      CASE WHEN MAX_PREV_REV.COST_TYPE = 1 THEN ISNULL(MASTER_DATA1.RRT1, 0) ELSE 0 END AS PrevRRT1_FIXCOST,
      CASE WHEN MAX_PREV_REV.COST_TYPE = 2 THEN ISNULL(MASTER_DATA1.RRT1, 0) ELSE 0 END AS PrevRRT1_VARIABLECOST,
      CASE WHEN MAX_PREV_REV.COST_TYPE = 1 THEN ISNULL(MASTER_DATA1.RRT2, 0) ELSE 0 END AS PrevRRT2_FIXCOST,
      CASE WHEN MAX_PREV_REV.COST_TYPE = 2 THEN ISNULL(MASTER_DATA1.RRT2, 0) ELSE 0 END AS PrevRRT2_VARIABLECOST,
      CASE WHEN MAX_PREV_REV.COST_TYPE = 1 THEN ISNULL(MASTER_DATA1.RRT3, 0) ELSE 0 END AS PrevRRT3_FIXCOST,
      CASE WHEN MAX_PREV_REV.COST_TYPE = 2 THEN ISNULL(MASTER_DATA1.RRT3, 0) ELSE 0 END AS PrevRRT3_VARIABLECOST,
      CASE WHEN MAX_PREV_REV.COST_TYPE = 1 THEN ISNULL(MASTER_DATA1.RRT4, 0) ELSE 0 END AS PrevRRT4_FIXCOST,
      CASE WHEN MAX_PREV_REV.COST_TYPE = 2 THEN ISNULL(MASTER_DATA1.RRT4, 0) ELSE 0 END AS PrevRRT4_VARIABLECOST,
      CASE WHEN MAX_PREV_REV.COST_TYPE = 1 THEN ISNULL(MASTER_DATA1.RRT5, 0) ELSE 0 END AS PrevRRT5_FIXCOST,
      CASE WHEN MAX_PREV_REV.COST_TYPE = 2 THEN ISNULL(MASTER_DATA1.RRT5, 0) ELSE 0 END AS PrevRRT5_VARIABLECOST,

      CASE WHEN MAX_REV.COST_TYPE = 1 THEN ISNULL(OB_BUDGET_DATA.M1, 0) + ISNULL(OB_BUDGET_DATA.M2, 0) + ISNULL(OB_BUDGET_DATA.M3, 0) + ISNULL(OB_BUDGET_DATA.M4, 0) + ISNULL(OB_BUDGET_DATA.M5, 0) + ISNULL(OB_BUDGET_DATA.M6, 0) + ISNULL(OB_BUDGET_DATA.M7, 0) + ISNULL(OB_BUDGET_DATA.M8, 0) + ISNULL(OB_BUDGET_DATA.M9, 0) + ISNULL(OB_BUDGET_DATA.M10, 0) + ISNULL(OB_BUDGET_DATA.M11, 0) + ISNULL(OB_BUDGET_DATA.M12, 0) ELSE 0 END AS REVISE_TOTAL_YEAR_FIXCOST,
      CASE WHEN MAX_REV.COST_TYPE = 2 THEN ISNULL(OB_BUDGET_DATA.M1, 0) + ISNULL(OB_BUDGET_DATA.M2, 0) + ISNULL(OB_BUDGET_DATA.M3, 0) + ISNULL(OB_BUDGET_DATA.M4, 0) + ISNULL(OB_BUDGET_DATA.M5, 0) + ISNULL(OB_BUDGET_DATA.M6, 0) + ISNULL(OB_BUDGET_DATA.M7, 0) + ISNULL(OB_BUDGET_DATA.M8, 0) + ISNULL(OB_BUDGET_DATA.M9, 0) + ISNULL(OB_BUDGET_DATA.M10, 0) + ISNULL(OB_BUDGET_DATA.M11, 0) + ISNULL(OB_BUDGET_DATA.M12, 0) ELSE 0 END AS REVISE_TOTAL_YEAR_VARIABLECOST,

      CASE WHEN MAX_REV.COST_TYPE = 1 THEN ISNULL(OB_BUDGET_DATA.M1, 0) + ISNULL(OB_BUDGET_DATA.M2, 0) + ISNULL(OB_BUDGET_DATA.M3, 0) + ISNULL(OB_BUDGET_DATA.M4, 0) + ISNULL(OB_BUDGET_DATA.M5, 0) + ISNULL(OB_BUDGET_DATA.M6, 0) + ISNULL(OB_BUDGET_DATA.M7, 0) + ISNULL(OB_BUDGET_DATA.M8, 0) + ISNULL(OB_BUDGET_DATA.M9, 0) + ISNULL(OB_BUDGET_DATA.M10, 0) + ISNULL(OB_BUDGET_DATA.M11, 0) + ISNULL(OB_BUDGET_DATA.M12, 0)  - ISNULL(MASTER_DATA1.RRT2, 0) ELSE 0 END AS DIFF_TOTAL_YEAR_FIXCOST,
      CASE WHEN MAX_REV.COST_TYPE = 2 THEN ISNULL(OB_BUDGET_DATA.M1, 0) + ISNULL(OB_BUDGET_DATA.M2, 0) + ISNULL(OB_BUDGET_DATA.M3, 0) + ISNULL(OB_BUDGET_DATA.M4, 0) + ISNULL(OB_BUDGET_DATA.M5, 0) + ISNULL(OB_BUDGET_DATA.M6, 0) + ISNULL(OB_BUDGET_DATA.M7, 0) + ISNULL(OB_BUDGET_DATA.M8, 0) + ISNULL(OB_BUDGET_DATA.M9, 0) + ISNULL(OB_BUDGET_DATA.M10, 0) + ISNULL(OB_BUDGET_DATA.M11, 0) + ISNULL(OB_BUDGET_DATA.M12, 0)  - ISNULL(MASTER_DATA1.RRT2, 0) ELSE 0 END AS DIFF_TOTAL_YEAR_VARIABLECOST
      ,(ISNULL(MTP.RRT2,0) -  ISNULL(MASTER_DATA1.RRT3, 0)) AS DIFF_PREV_YEAR
      ,CASE WHEN MAX_REV.COST_TYPE = 1 THEN ISNULL(MTP.RRT2, 0)  - ISNULL(MASTER_DATA1.RRT3, 0) ELSE 0 END AS DIFF_PREV_YEAR_FIXCOST
      ,CASE WHEN MAX_REV.COST_TYPE = 2 THEN ISNULL(MTP.RRT2, 0)  - ISNULL(MASTER_DATA1.RRT3, 0) ELSE 0 END AS DIFF_PREV_YEAR_VARIABLECOST

      FROM
      (
      SELECT BD.*,  BO.BUDGET_ORDER_NAME,BO.PIC_SHOW_FLAG AS PIC_SHOW_FLG,
      AC.ACCOUNT_NO, AC.ACCOUNT_NAME,
      BO.COST, BO.COST_TYPE, DP.DEPT_NO, DP.DEPT_NAME,
      PIC.PERSON_IN_CHARGE_NO, PIC.PERSON_IN_CHARGE_NAME FROM
      BG_T_BUDGET_DATA AS BD
      LEFT JOIN BG_M_BUDGET_ORDER AS BO ON BD.BUDGET_ORDER_NO = BO.BUDGET_ORDER_NO
      LEFT JOIN BG_M_ACCOUNT AS AC ON BO.ACCOUNT_NO = AC.ACCOUNT_NO
      LEFT JOIN BG_M_DEPT AS DP ON BO.DEPT_NO = DP.DEPT_NO
      LEFT JOIN BG_M_PERSON_IN_CHARGE AS PIC ON BO.PERSON_IN_CHARGE_NO = PIC.PERSON_IN_CHARGE_NO
      LEFT JOIN BG_T_BUDGET_PERIOD AS BP ON BD.BUDGET_YEAR = BP.BUDGET_YEAR AND BD.PERIOD_TYPE = BP.PERIOD_TYPE AND BD.PROJECT_NO = BP.PROJECT_NO
      WHERE
      BD.BUDGET_YEAR = @YEAR
      AND BD.PERIOD_TYPE = @PERIOD
      AND BO.BUDGET_TYPE = 'E'
      AND BD.REV_NO = @REVNO
      AND BD.PROJECT_NO = @PROJECTNO AND
      BO.ACTIVE_FLAG = 1  
     
      @PICCONDITION
      ) AS MTP
      LEFT JOIN
      (
      SELECT BUDGET_DATA.BUDGET_ORDER_NO, BUDGET_DATA.BUDGET_YEAR, BUDGET_ORDER.COST_TYPE,
      BUDGET_DATA.PERIOD_TYPE, BUDGET_DATA.PROJECT_NO, MAX(BUDGET_DATA.REV_NO) AS REV_NO, BUDGET_ORDER.BUDGET_ORDER_NAME,
      BUDGET_ORDER.DEPT_NO, BUDGET_ORDER.PERSON_IN_CHARGE_NO, PIC.PERSON_IN_CHARGE_NAME
      FROM BG_T_BUDGET_DATA AS BUDGET_DATA
      INNER JOIN BG_M_BUDGET_ORDER AS BUDGET_ORDER
      ON BUDGET_ORDER.BUDGET_ORDER_NO = BUDGET_DATA.BUDGET_ORDER_NO AND BUDGET_ORDER.BUDGET_TYPE = 'E' AND BUDGET_ORDER.ACTIVE_FLAG = 1
      INNER JOIN BG_M_PERSON_IN_CHARGE AS PIC
      ON PIC.PERSON_IN_CHARGE_NO = BUDGET_ORDER.PERSON_IN_CHARGE_NO
      WHERE BUDGET_DATA.BUDGET_YEAR = @YEAR
      AND BUDGET_DATA.PERIOD_TYPE = 10
     
      AND BUDGET_DATA.PROJECT_NO = @RefRBProjectNo
      AND BUDGET_DATA.REV_NO = @RefRBRevNo
      GROUP BY BUDGET_DATA.BUDGET_ORDER_NO, BUDGET_DATA.BUDGET_YEAR, BUDGET_DATA.PERIOD_TYPE, BUDGET_DATA.PROJECT_NO, BUDGET_ORDER.BUDGET_ORDER_NAME, BUDGET_ORDER.DEPT_NO, BUDGET_ORDER.COST_TYPE,
      BUDGET_ORDER.PERSON_IN_CHARGE_NO, PIC.PERSON_IN_CHARGE_NAME) AS MAX_REV ON MTP.BUDGET_ORDER_NO = MAX_REV.BUDGET_ORDER_NO

      LEFT JOIN BG_T_BUDGET_DATA AS MASTER_DATA
      ON MAX_REV.BUDGET_YEAR = MASTER_DATA.BUDGET_YEAR
      AND MAX_REV.PERIOD_TYPE = MASTER_DATA.PERIOD_TYPE
      AND MAX_REV.PROJECT_NO = MASTER_DATA.PROJECT_NO
      AND MAX_REV.BUDGET_ORDER_NO = MASTER_DATA.BUDGET_ORDER_NO
      AND MAX_REV.REV_NO = MASTER_DATA.REV_NO

      LEFT JOIN
      (
      SELECT BUDGET_DATA1.BUDGET_ORDER_NO, BUDGET_DATA1.BUDGET_YEAR, BUDGET_ORDER1.COST_TYPE,
      BUDGET_DATA1.PERIOD_TYPE, BUDGET_DATA1.PROJECT_NO, MAX(BUDGET_DATA1.REV_NO) AS REV_NO, BUDGET_ORDER1.BUDGET_ORDER_NAME,
      BUDGET_ORDER1.DEPT_NO, BUDGET_ORDER1.PERSON_IN_CHARGE_NO, PIC1.PERSON_IN_CHARGE_NAME
      FROM BG_T_BUDGET_DATA AS BUDGET_DATA1
      INNER JOIN BG_M_BUDGET_ORDER AS BUDGET_ORDER1
      ON BUDGET_ORDER1.BUDGET_ORDER_NO = BUDGET_DATA1.BUDGET_ORDER_NO AND BUDGET_ORDER1.BUDGET_TYPE = 'E' AND BUDGET_ORDER1.ACTIVE_FLAG = 1
      INNER JOIN BG_M_PERSON_IN_CHARGE AS PIC1
      ON PIC1.PERSON_IN_CHARGE_NO = BUDGET_ORDER1.PERSON_IN_CHARGE_NO
      WHERE BUDGET_DATA1.BUDGET_YEAR = (@YEAR - 1)
      AND BUDGET_DATA1.PERIOD_TYPE = @PERIOD
     
      AND BUDGET_DATA1.PROJECT_NO = @MtpProjectNo
      AND BUDGET_DATA1.REV_NO = @MtpRevNo
      GROUP BY BUDGET_DATA1.BUDGET_ORDER_NO, BUDGET_DATA1.BUDGET_YEAR, BUDGET_DATA1.PERIOD_TYPE, BUDGET_DATA1.PROJECT_NO, BUDGET_ORDER1.BUDGET_ORDER_NAME, BUDGET_ORDER1.DEPT_NO, BUDGET_ORDER1.COST_TYPE,
      BUDGET_ORDER1.PERSON_IN_CHARGE_NO, PIC1.PERSON_IN_CHARGE_NAME) AS MAX_PREV_REV ON MTP.BUDGET_ORDER_NO = MAX_PREV_REV.BUDGET_ORDER_NO

      LEFT JOIN BG_T_BUDGET_DATA AS MASTER_DATA1
      ON MAX_PREV_REV.BUDGET_YEAR = MASTER_DATA1.BUDGET_YEAR
      AND MAX_PREV_REV.PERIOD_TYPE = MASTER_DATA1.PERIOD_TYPE
      AND MAX_PREV_REV.PROJECT_NO = MASTER_DATA1.PROJECT_NO
      AND MAX_PREV_REV.BUDGET_ORDER_NO = MASTER_DATA1.BUDGET_ORDER_NO
      AND MAX_PREV_REV.REV_NO = MASTER_DATA1.REV_NO

      LEFT OUTER JOIN BG_T_UPLOAD_DATA AS ACTUAL_DATA
      ON ACTUAL_DATA.BUDGET_YEAR = MAX_REV.BUDGET_YEAR
      AND ACTUAL_DATA.BUDGET_ORDER_NO = MAX_REV.BUDGET_ORDER_NO
      AND ACTUAL_DATA.DATA_TYPE = 2
      AND ACTUAL_DATA.PERIOD_TYPE = 3
      AND ACTUAL_DATA.PROJECT_NO = 1


      LEFT JOIN BG_T_BUDGET_DATA AS OB_MASTER_DATA
      ON MAX_REV.BUDGET_YEAR = OB_MASTER_DATA.BUDGET_YEAR
      AND MAX_REV.PERIOD_TYPE = OB_MASTER_DATA.PERIOD_TYPE
      AND MAX_REV.PROJECT_NO = OB_MASTER_DATA.PROJECT_NO
      AND MAX_REV.BUDGET_ORDER_NO = OB_MASTER_DATA.BUDGET_ORDER_NO
      AND MAX_REV.REV_NO = OB_MASTER_DATA.REV_NO

      LEFT OUTER JOIN BG_T_UPLOAD_DATA AS OB_ACTUAL_DATA
      ON OB_ACTUAL_DATA.BUDGET_YEAR = MAX_REV.BUDGET_YEAR
      AND OB_ACTUAL_DATA.BUDGET_ORDER_NO = MAX_REV.BUDGET_ORDER_NO
      AND OB_ACTUAL_DATA.DATA_TYPE = 2
      AND OB_ACTUAL_DATA.PERIOD_TYPE = @REFPERIOD
      AND OB_ACTUAL_DATA.PROJECT_NO = 1

      LEFT OUTER JOIN BG_T_BUDGET_DATA AS OB_BUDGET_DATA
      ON OB_BUDGET_DATA.BUDGET_YEAR = MAX_REV.BUDGET_YEAR + 1
      AND OB_BUDGET_DATA.BUDGET_ORDER_NO = MAX_REV.BUDGET_ORDER_NO
      AND OB_BUDGET_DATA.PERIOD_TYPE = 1
      AND OB_BUDGET_DATA.PROJECT_NO = @RefRBProjectNo
      AND OB_BUDGET_DATA.REV_NO = @RefRBRevNo


      WHERE(ISNULL(OB_BUDGET_DATA.M1, 0) &lt;&gt; 0
      OR ISNULL(OB_BUDGET_DATA.M2, 0) &lt;&gt; 0
      OR ISNULL(OB_BUDGET_DATA.M3, 0) &lt;&gt; 0
      OR ISNULL(OB_BUDGET_DATA.M4, 0) &lt;&gt; 0
      OR ISNULL(OB_BUDGET_DATA.M5, 0) &lt;&gt; 0
      OR ISNULL(OB_BUDGET_DATA.M6, 0) &lt;&gt; 0
      OR ISNULL(OB_BUDGET_DATA.M7, 0) &lt;&gt; 0
      OR ISNULL(OB_BUDGET_DATA.M8, 0) &lt;&gt; 0
      OR ISNULL(OB_BUDGET_DATA.M9, 0) &lt;&gt; 0
      OR ISNULL(OB_BUDGET_DATA.M10, 0) &lt;&gt; 0
      OR ISNULL(OB_BUDGET_DATA.M11, 0) &lt;&gt; 0
      OR ISNULL(OB_BUDGET_DATA.M12, 0) &lt;&gt; 0
      OR ISNULL(MASTER_DATA1.RRT1, 0) &lt;&gt; 0
      OR ISNULL(MASTER_DATA1.RRT2, 0) &lt;&gt; 0
      OR ISNULL(MASTER_DATA1.RRT3, 0) &lt;&gt; 0
      OR ISNULL(MASTER_DATA1.RRT4, 0) &lt;&gt; 0
      OR ISNULL(MASTER_DATA1.RRT5, 0) &lt;&gt; 0
      OR ISNULL(MTP.RRT1, 0) &lt;&gt; 0
      OR ISNULL(MTP.RRT2, 0) &lt;&gt; 0
      OR ISNULL(MTP.RRT3, 0) &lt;&gt; 0
      OR ISNULL(MTP.RRT4, 0) &lt;&gt; 0
      OR ISNULL(MTP.RRT5, 0) &lt;&gt; 0)

      ORDER BY MTP.BUDGET_ORDER_NO
    </SELECT004_12>-->


    <SELECT005_1>
      SELECT
      MAX_REV.BUDGET_YEAR, MAX_REV.PERIOD_TYPE, MAX_REV.PROJECT_NO, MAX_REV.BUDGET_ORDER_NO,
      MAX_REV.BUDGET_ORDER_NAME, MAX_REV.ACCOUNT_NO, MAX_REV.ACCOUNT_NAME, MAX_REV.DEPT_NO, MAX_REV.PERSON_IN_CHARGE_NO, MAX_REV.COST,
      MAX_REV.REV_NO,
      ISNULL(ACTUAL_DATA.H1,0) AS ACTUAL_1ST_HALF,

      --ISNULL(REVISE_BUDGET.H2,0) AS REVISE_2ND_HALF,
      ISNULL(MAX_REV.REVISE_SECOND_HALF, 0) AS REVISE_2ND_HALF,

      ISNULL(MASTER_DATA.M1,0) AS M1,
      ISNULL(MASTER_DATA.M2,0) AS M2,
      ISNULL(MASTER_DATA.M3,0) AS M3,
      ISNULL(MASTER_DATA.M4,0) AS M4,
      ISNULL(MASTER_DATA.M5,0) AS M5,
      ISNULL(MASTER_DATA.M6,0) AS M6,
      ISNULL(MASTER_DATA.M7,0) AS M7,
      ISNULL(MASTER_DATA.M8,0) AS M8,
      ISNULL(MASTER_DATA.M9,0) AS M9,
      ISNULL(MASTER_DATA.M10,0) AS M10,
      ISNULL(MASTER_DATA.M11,0) AS M11,
      ISNULL(MASTER_DATA.M12,0) AS M12,
      --(ISNULL(MASTER_DATA.M1,0) + ISNULL(MASTER_DATA.M2,0) + ISNULL(MASTER_DATA.M3,0) + ISNULL(MASTER_DATA.M4,0) + ISNULL(MASTER_DATA.M5,0) + ISNULL(MASTER_DATA.M6,0)) AS TOTAL_1ST_HALF,
      0.0 AS TOTAL_1ST_HALF,
      --(ISNULL(MASTER_DATA.M7,0) + ISNULL(MASTER_DATA.M8,0) + ISNULL(MASTER_DATA.M9,0) + ISNULL(MASTER_DATA.M10,0) + ISNULL(MASTER_DATA.M11,0) + ISNULL(MASTER_DATA.M12,0)) AS TOTAL_2ND_HALF
      0.0 AS TOTAL_2ND_HALF,
      0.0 AS TOTAL_YEAR
      ,ISNULL(MTP.RRT2,0) AS MTP_RRT1

      FROM (
      SELECT BUDGET_DATA.BUDGET_YEAR, BUDGET_DATA.PERIOD_TYPE, BUDGET_DATA.PROJECT_NO, BUDGET_ORDER.BUDGET_ORDER_NO,
      BUDGET_ORDER.BUDGET_ORDER_NAME, BUDGET_ORDER.ACCOUNT_NO, ACCOUNT.ACCOUNT_NAME, BUDGET_ORDER.DEPT_NO, BUDGET_ORDER.PERSON_IN_CHARGE_NO, BUDGET_ORDER.COST,
      MAX(BUDGET_DATA.REV_NO) AS REV_NO

      ,ISNULL((SELECT ISNULL(ISNULL(M10,0)+ISNULL(M11,0)+ISNULL(M12,0),0)
      FROM BG_T_BUDGET_DATA
      WHERE BUDGET_YEAR = (@BudgetYear-1)
      AND PERIOD_TYPE = 2
      --AND REV_NO = (SELECT MAX(REV_NO) AS REV_NO FROM BG_T_BUDGET_DATA WHERE BUDGET_YEAR = (@BudgetYear-1) AND PERIOD_TYPE = 2 AND PROJECT_NO = @ProjectNo)
      --AND PROJECT_NO = @ProjectNo
      AND REV_NO = @RefEstRevNo
      AND PROJECT_NO = @RefEstProjectNo
      AND BUDGET_ORDER_NO = BUDGET_ORDER.BUDGET_ORDER_NO),0)+
      ISNULL((SELECT ISNULL(M7,0)+ISNULL(M8,0)+ISNULL(M9,0)
      FROM BG_T_UPLOAD_DATA
      WHERE BUDGET_YEAR = (@BudgetYear-1)
      AND PERIOD_TYPE = 2
      --AND PROJECT_NO = @ProjectNo
      AND PROJECT_NO = @RefEstProjectNo
      AND DATA_TYPE = 2
      AND BUDGET_ORDER_NO = BUDGET_ORDER.BUDGET_ORDER_NO),0) AS REVISE_SECOND_HALF

      FROM BG_T_BUDGET_DATA AS BUDGET_DATA
      INNER JOIN BG_M_BUDGET_ORDER AS BUDGET_ORDER
      ON BUDGET_DATA.BUDGET_ORDER_NO = BUDGET_ORDER.BUDGET_ORDER_NO
      INNER JOIN BG_M_ACCOUNT AS ACCOUNT
      ON BUDGET_ORDER.ACCOUNT_NO = ACCOUNT.ACCOUNT_NO
      WHERE BUDGET_ORDER.BUDGET_TYPE = 'E'
      AND BUDGET_ORDER.ACTIVE_FLAG = 1
      AND BUDGET_DATA.BUDGET_YEAR = @BudgetYear
      AND BUDGET_DATA.PERIOD_TYPE = @PeriodType
      AND BUDGET_DATA.PROJECT_NO = @ProjectNo
      @AccountNo
      GROUP BY BUDGET_DATA.BUDGET_YEAR, BUDGET_DATA.PERIOD_TYPE, BUDGET_DATA.PROJECT_NO, BUDGET_ORDER.BUDGET_ORDER_NO,
      BUDGET_ORDER.BUDGET_ORDER_NAME, BUDGET_ORDER.ACCOUNT_NO, ACCOUNT.ACCOUNT_NAME, BUDGET_ORDER.DEPT_NO, BUDGET_ORDER.PERSON_IN_CHARGE_NO, BUDGET_ORDER.COST ) AS MAX_REV

      INNER JOIN BG_T_BUDGET_DATA AS MASTER_DATA
      ON MAX_REV.BUDGET_YEAR = MASTER_DATA.BUDGET_YEAR
      AND MAX_REV.PERIOD_TYPE = MASTER_DATA.PERIOD_TYPE
      AND MAX_REV.PROJECT_NO = MASTER_DATA.PROJECT_NO
      AND MAX_REV.BUDGET_ORDER_NO = MASTER_DATA.BUDGET_ORDER_NO
      AND MAX_REV.REV_NO = MASTER_DATA.REV_NO

      LEFT OUTER JOIN BG_T_UPLOAD_DATA AS REVISE_BUDGET
      ON REVISE_BUDGET.BUDGET_YEAR = @BudgetYear - 1
      AND REVISE_BUDGET.PERIOD_TYPE = @PeriodType
      AND REVISE_BUDGET.PROJECT_NO = @ProjectNo
      AND REVISE_BUDGET.BUDGET_ORDER_NO = MAX_REV.BUDGET_ORDER_NO
      AND REVISE_BUDGET.DATA_TYPE = 1

      LEFT OUTER JOIN BG_T_UPLOAD_DATA AS ACTUAL_DATA
      ON ACTUAL_DATA.BUDGET_YEAR = @BudgetYear - 1
      AND ACTUAL_DATA.PERIOD_TYPE = @PeriodType
      AND ACTUAL_DATA.PROJECT_NO = @ProjectNo
      AND ACTUAL_DATA.BUDGET_ORDER_NO = MAX_REV.BUDGET_ORDER_NO
      AND ACTUAL_DATA.DATA_TYPE = 2

      LEFT JOIN BG_T_BUDGET_DATA AS MTP
      ON MAX_REV.BUDGET_ORDER_NO = MTP.BUDGET_ORDER_NO
      AND MTP.BUDGET_YEAR=(@BudgetYear-2)
      AND MTP.PERIOD_TYPE = 10
      AND MTP.PROJECT_NO = @MtpProjectNo
      AND MTP.REV_NO = @MtpRevNo
      --AND MTP.REV_NO = (SELECT ISNULL(MAX(REV_NO),1) AS MAX_REV_NO FROM BG_T_BUDGET_HEADER
      --WHERE BUDGET_YEAR = (@BudgetYear-1)
      --AND PERIOD_TYPE = 10 AND BUDGET_TYPE = 'E' AND PROJECT_NO = @MtpProjectNo)

      WHERE
      (
      ISNULL(ACTUAL_DATA.H1, 0) &lt;&gt; 0
      OR ISNULL(MAX_REV.REVISE_SECOND_HALF, 0) &lt;&gt; 0
      OR ISNULL(MASTER_DATA.M1, 0) &lt;&gt; 0
      OR ISNULL(MASTER_DATA.M2, 0) &lt;&gt; 0
      OR ISNULL(MASTER_DATA.M3, 0) &lt;&gt; 0
      OR ISNULL(MASTER_DATA.M4, 0) &lt;&gt; 0
      OR ISNULL(MASTER_DATA.M5, 0) &lt;&gt; 0
      OR ISNULL(MASTER_DATA.M6, 0) &lt;&gt; 0
      OR ISNULL(MASTER_DATA.M7, 0) &lt;&gt; 0
      OR ISNULL(MASTER_DATA.M8, 0) &lt;&gt; 0
      OR ISNULL(MASTER_DATA.M9, 0) &lt;&gt; 0
      OR ISNULL(MASTER_DATA.M10, 0) &lt;&gt; 0
      OR ISNULL(MASTER_DATA.M11, 0) &lt;&gt; 0
      OR ISNULL(MASTER_DATA.M12, 0) &lt;&gt; 0
      OR ISNULL(MTP.RRT2,0) &lt;&gt; 0
      )

    </SELECT005_1>
    <SELECT005_2>
      AND BUDGET_ORDER.ACCOUNT_NO = '@AccountNo'
    </SELECT005_2>
    <SELECT005_3>
      SELECT
      MAX_REV.BUDGET_YEAR, MAX_REV.PERIOD_TYPE, MAX_REV.PROJECT_NO, MAX_REV.BUDGET_ORDER_NO,
      MAX_REV.BUDGET_ORDER_NAME, MAX_REV.ACCOUNT_NO, MAX_REV.ACCOUNT_NAME, MAX_REV.DEPT_NO, MAX_REV.PERSON_IN_CHARGE_NO, MAX_REV.COST,
      MAX_REV.REV_NO,
      ISNULL(ACTUAL_DATA.H1,0) AS ACTUAL_1ST_HALF,

      --ISNULL(REVISE_BUDGET.H2,0) AS REVISE_2ND_HALF,
      ISNULL(MAX_REV.REVISE_SECOND_HALF, 0) AS REVISE_2ND_HALF,

      ISNULL(MASTER_DATA.M1,0) AS M1,
      ISNULL(MASTER_DATA.M2,0) AS M2,
      ISNULL(MASTER_DATA.M3,0) AS M3,
      ISNULL(MASTER_DATA.M4,0) AS M4,
      ISNULL(MASTER_DATA.M5,0) AS M5,
      ISNULL(MASTER_DATA.M6,0) AS M6,
      ISNULL(MASTER_DATA.M7,0) AS M7,
      ISNULL(MASTER_DATA.M8,0) AS M8,
      ISNULL(MASTER_DATA.M9,0) AS M9,
      ISNULL(MASTER_DATA.M10,0) AS M10,
      ISNULL(MASTER_DATA.M11,0) AS M11,
      ISNULL(MASTER_DATA.M12,0) AS M12,
      --(ISNULL(MASTER_DATA.M1,0) + ISNULL(MASTER_DATA.M2,0) + ISNULL(MASTER_DATA.M3,0) + ISNULL(MASTER_DATA.M4,0) + ISNULL(MASTER_DATA.M5,0) + ISNULL(MASTER_DATA.M6,0)) AS TOTAL_1ST_HALF,
      0.0 AS TOTAL_1ST_HALF,
      --(ISNULL(MASTER_DATA.M7,0) + ISNULL(MASTER_DATA.M8,0) + ISNULL(MASTER_DATA.M9,0) + ISNULL(MASTER_DATA.M10,0) + ISNULL(MASTER_DATA.M11,0) + ISNULL(MASTER_DATA.M12,0)) AS TOTAL_2ND_HALF
      0.0 AS TOTAL_2ND_HALF,
      0.0 AS TOTAL_YEAR
      ,ISNULL(MTP.RRT2,0) AS MTP_RRT1

      FROM (
      SELECT BUDGET_DATA.BUDGET_YEAR, BUDGET_DATA.PERIOD_TYPE, BUDGET_DATA.PROJECT_NO, BUDGET_ORDER.BUDGET_ORDER_NO,
      BUDGET_ORDER.BUDGET_ORDER_NAME, BUDGET_ORDER.ACCOUNT_NO, ACCOUNT.ACCOUNT_NAME, BUDGET_ORDER.DEPT_NO, BUDGET_ORDER.PERSON_IN_CHARGE_NO, BUDGET_ORDER.COST,
      MAX(BUDGET_DATA.REV_NO) AS REV_NO

      ,ISNULL((SELECT ISNULL(ISNULL(M10,0)+ISNULL(M11,0)+ISNULL(M12,0),0)
      FROM BG_T_BUDGET_DATA
      WHERE BUDGET_YEAR = (@BudgetYear-1)
      AND PERIOD_TYPE = 2
      --AND REV_NO = (SELECT MAX(REV_NO) AS REV_NO FROM BG_T_BUDGET_DATA WHERE BUDGET_YEAR = (@BudgetYear-1) AND PERIOD_TYPE = 2 AND PROJECT_NO = @ProjectNo)
      --AND PROJECT_NO = @ProjectNo
      AND REV_NO = @RefEstRevNo
      AND PROJECT_NO = @RefEstProjectNo
      AND BUDGET_ORDER_NO = BUDGET_ORDER.BUDGET_ORDER_NO),0)+
      ISNULL((SELECT ISNULL(M7,0)+ISNULL(M8,0)+ISNULL(M9,0)
      FROM BG_T_UPLOAD_DATA
      WHERE BUDGET_YEAR = (@BudgetYear-1)
      AND PERIOD_TYPE = 2
      --AND PROJECT_NO = @ProjectNo
      AND PROJECT_NO = @RefEstProjectNo
      AND DATA_TYPE = 2
      AND BUDGET_ORDER_NO = BUDGET_ORDER.BUDGET_ORDER_NO),0) AS REVISE_SECOND_HALF

      FROM BG_T_BUDGET_DATA AS BUDGET_DATA
      INNER JOIN BG_M_BUDGET_ORDER AS BUDGET_ORDER
      ON BUDGET_DATA.BUDGET_ORDER_NO = BUDGET_ORDER.BUDGET_ORDER_NO
      INNER JOIN BG_M_ACCOUNT AS ACCOUNT
      ON BUDGET_ORDER.ACCOUNT_NO = ACCOUNT.ACCOUNT_NO
      WHERE BUDGET_ORDER.BUDGET_TYPE = 'E'
      AND BUDGET_ORDER.ACTIVE_FLAG = 1
      AND BUDGET_DATA.BUDGET_YEAR = @BudgetYear
      AND BUDGET_DATA.PERIOD_TYPE = @PeriodType
      AND BUDGET_DATA.PROJECT_NO = @ProjectNo
      AND BUDGET_DATA.REV_NO = @RevNo
      @AccountNo
      GROUP BY BUDGET_DATA.BUDGET_YEAR, BUDGET_DATA.PERIOD_TYPE, BUDGET_DATA.PROJECT_NO, BUDGET_ORDER.BUDGET_ORDER_NO,
      BUDGET_ORDER.BUDGET_ORDER_NAME, BUDGET_ORDER.ACCOUNT_NO, ACCOUNT.ACCOUNT_NAME, BUDGET_ORDER.DEPT_NO, BUDGET_ORDER.PERSON_IN_CHARGE_NO, BUDGET_ORDER.COST ) AS MAX_REV

      INNER JOIN BG_T_BUDGET_DATA AS MASTER_DATA
      ON MAX_REV.BUDGET_YEAR = MASTER_DATA.BUDGET_YEAR
      AND MAX_REV.PERIOD_TYPE = MASTER_DATA.PERIOD_TYPE
      AND MAX_REV.PROJECT_NO = MASTER_DATA.PROJECT_NO
      AND MAX_REV.BUDGET_ORDER_NO = MASTER_DATA.BUDGET_ORDER_NO
      AND MAX_REV.REV_NO = MASTER_DATA.REV_NO

      LEFT OUTER JOIN BG_T_UPLOAD_DATA AS REVISE_BUDGET
      ON REVISE_BUDGET.BUDGET_YEAR = @BudgetYear - 1
      AND REVISE_BUDGET.PERIOD_TYPE = @PeriodType
      AND REVISE_BUDGET.PROJECT_NO = @ProjectNo
      AND REVISE_BUDGET.BUDGET_ORDER_NO = MAX_REV.BUDGET_ORDER_NO
      AND REVISE_BUDGET.DATA_TYPE = 1

      LEFT OUTER JOIN BG_T_UPLOAD_DATA AS ACTUAL_DATA
      ON ACTUAL_DATA.BUDGET_YEAR = @BudgetYear - 1
      AND ACTUAL_DATA.PERIOD_TYPE = @PeriodType
      AND ACTUAL_DATA.PROJECT_NO = @ProjectNo
      AND ACTUAL_DATA.BUDGET_ORDER_NO = MAX_REV.BUDGET_ORDER_NO
      AND ACTUAL_DATA.DATA_TYPE = 2

      LEFT JOIN BG_T_BUDGET_DATA AS MTP
      ON MAX_REV.BUDGET_ORDER_NO = MTP.BUDGET_ORDER_NO
      AND MTP.BUDGET_YEAR=(@BudgetYear-2)
      AND MTP.PERIOD_TYPE = 10
      AND MTP.PROJECT_NO = @MtpProjectNo
      AND MTP.REV_NO = '@MtpRevNo'

      WHERE
      (
      ISNULL(ACTUAL_DATA.H1, 0) &lt;&gt; 0
      OR ISNULL(MAX_REV.REVISE_SECOND_HALF, 0) &lt;&gt; 0
      OR ISNULL(MASTER_DATA.M1, 0) &lt;&gt; 0
      OR ISNULL(MASTER_DATA.M2, 0) &lt;&gt; 0
      OR ISNULL(MASTER_DATA.M3, 0) &lt;&gt; 0
      OR ISNULL(MASTER_DATA.M4, 0) &lt;&gt; 0
      OR ISNULL(MASTER_DATA.M5, 0) &lt;&gt; 0
      OR ISNULL(MASTER_DATA.M6, 0) &lt;&gt; 0
      OR ISNULL(MASTER_DATA.M7, 0) &lt;&gt; 0
      OR ISNULL(MASTER_DATA.M8, 0) &lt;&gt; 0
      OR ISNULL(MASTER_DATA.M9, 0) &lt;&gt; 0
      OR ISNULL(MASTER_DATA.M10, 0) &lt;&gt; 0
      OR ISNULL(MASTER_DATA.M11, 0) &lt;&gt; 0
      OR ISNULL(MASTER_DATA.M12, 0) &lt;&gt; 0
      OR ISNULL(MTP.RRT2,0) &lt;&gt; 0
      )

    </SELECT005_3>
    <SELECT006_1>
      SELECT BGDT.BUDGET_YEAR [FISCAL_YEAR], BGDT.REV_NO [VERSION]
      , BGDT.BUDGET_ORDER_NO [ORDER_NO], BGOR.ACCOUNT_NO [ACCOUNT_NO]
      , (SELECT M1 FROM BG_T_UPLOAD_DATA
      WHERE BUDGET_YEAR = @P_BUDGET_YEAR AND
      PERIOD_TYPE = @P_PERIOD_TYPE AND
      PROJECT_NO = @P_PROJECT_NO AND
      BUDGET_ORDER_NO = BGDT.BUDGET_ORDER_NO AND
      DATA_TYPE = 2
      ) [Budget_1]
      , (SELECT M2 FROM BG_T_UPLOAD_DATA
      WHERE BUDGET_YEAR = @P_BUDGET_YEAR AND
      PERIOD_TYPE = @P_PERIOD_TYPE AND
      PROJECT_NO = @P_PROJECT_NO AND
      BUDGET_ORDER_NO = BGDT.BUDGET_ORDER_NO AND
      DATA_TYPE = 2
      ) [Budget_2]
      , (SELECT M3 FROM BG_T_UPLOAD_DATA
      WHERE BUDGET_YEAR = @P_BUDGET_YEAR AND
      PERIOD_TYPE = @P_PERIOD_TYPE AND
      PROJECT_NO = @P_PROJECT_NO AND
      BUDGET_ORDER_NO = BGDT.BUDGET_ORDER_NO AND
      DATA_TYPE = 2
      ) [Budget_3]
      , BGDT.M4 [Budget_4], BGDT.M5 [Budget_5], BGDT.M6 [Budget_6]
      , BGDT.M7 [Budget_7], BGDT.M8 [Budget_8], BGDT.M9 [Budget_9]
      , BGDT.M10 [Budget_10], BGDT.M11 [Budget_11], BGDT.M12 [Budget_12]
      , BGDT.RRT1 [MTP_1]
      , BGDT.RRT2 [MTP_2]
      , BGDT.RRT3 [MTP_3]
      , BGDT.RRT4 [MTP_4]
      , BGDT.RRT5 [MTP_5]
      FROM [BG_T_BUDGET_DATA] BGDT
      LEFT JOIN [BG_M_BUDGET_ORDER] BGOR ON BGDT.BUDGET_ORDER_NO = BGOR.BUDGET_ORDER_NO
      WHERE CONVERT(VARCHAR(10), BGDT.BUDGET_YEAR) = '@P_BUDGET_YEAR'
      AND CONVERT(VARCHAR(10), BGDT.PERIOD_TYPE) = '@P_PERIOD_TYPE'
      AND BGDT.PROJECT_NO = @P_PROJECT_NO
      AND BGOR.ACCOUNT_NO = '@P_ACCOUNT_NO'
      AND BGOR.ACTIVE_FLAG = 1
      AND BGDT.REV_NO = (SELECT MAX(A.REV_NO)
      FROM [BG_T_BUDGET_DATA] AS A LEFT JOIN [BG_M_BUDGET_ORDER] AS B ON
      A.BUDGET_ORDER_NO = B.BUDGET_ORDER_NO
      WHERE CONVERT(VARCHAR(10), A.BUDGET_YEAR) = '@P_BUDGET_YEAR'
      AND CONVERT(VARCHAR(10), A.PERIOD_TYPE) = '@P_PERIOD_TYPE'
      AND A.PROJECT_NO = @P_PROJECT_NO)
    </SELECT006_1>
    <SELECT006_2>
      (
      SELECT BGDT.BUDGET_YEAR [FISCAL_YEAR], BGDT.REV_NO [VERSION]
      , BGDT.BUDGET_ORDER_NO [ORDER_NO], BGOR.ACCOUNT_NO [ACCOUNT_NO]
      , (SELECT M1 FROM BG_T_UPLOAD_DATA
      WHERE BUDGET_YEAR = @P_BUDGET_YEAR AND
      PERIOD_TYPE = @P_PERIOD_TYPE AND
      PROJECT_NO = @P_PROJECT_NO AND
      BUDGET_ORDER_NO = BGDT.BUDGET_ORDER_NO AND
      DATA_TYPE = 2
      ) [Budget_1]
      , (SELECT M2 FROM BG_T_UPLOAD_DATA
      WHERE BUDGET_YEAR = @P_BUDGET_YEAR AND
      PERIOD_TYPE = @P_PERIOD_TYPE AND
      PROJECT_NO = @P_PROJECT_NO AND
      BUDGET_ORDER_NO = BGDT.BUDGET_ORDER_NO AND
      DATA_TYPE = 2
      ) [Budget_2]
      , (SELECT M3 FROM BG_T_UPLOAD_DATA
      WHERE BUDGET_YEAR = @P_BUDGET_YEAR AND
      PERIOD_TYPE = @P_PERIOD_TYPE AND
      PROJECT_NO = @P_PROJECT_NO AND
      BUDGET_ORDER_NO = BGDT.BUDGET_ORDER_NO AND
      DATA_TYPE = 2
      ) [Budget_3]
      , BGDT.M4 [Budget_4], BGDT.M5 [Budget_5], BGDT.M6 [Budget_6]
      , BGDT.M7 [Budget_7], BGDT.M8 [Budget_8], BGDT.M9 [Budget_9]
      , BGDT.M10 [Budget_10], BGDT.M11 [Budget_11], BGDT.M12 [Budget_12]
      , BGDT.RRT1 [MTP_1]
      , BGDT.RRT2 [MTP_2]
      , BGDT.RRT3 [MTP_3]
      , BGDT.RRT4 [MTP_4]
      , BGDT.RRT5 [MTP_5]
      FROM [BG_T_BUDGET_DATA] BGDT
      LEFT JOIN [BG_M_BUDGET_ORDER] BGOR ON BGDT.BUDGET_ORDER_NO = BGOR.BUDGET_ORDER_NO
      WHERE CONVERT(VARCHAR(10), BGDT.BUDGET_YEAR) = '@P_BUDGET_YEAR'
      AND CONVERT(VARCHAR(10), BGDT.PERIOD_TYPE) = '@P_PERIOD_TYPE'
      AND BGDT.PROJECT_NO = @P_PROJECT_NO
      AND BGOR.BUDGET_TYPE = 'E'
      AND BGOR.ACTIVE_FLAG = 1
      AND BGDT.REV_NO = (SELECT MAX(A.REV_NO)
      FROM [BG_T_BUDGET_DATA] AS A LEFT JOIN [BG_M_BUDGET_ORDER] AS B ON
      A.BUDGET_ORDER_NO = B.BUDGET_ORDER_NO
      WHERE CONVERT(VARCHAR(10), A.BUDGET_YEAR) = '@P_BUDGET_YEAR'
      AND CONVERT(VARCHAR(10), A.PERIOD_TYPE) = '@P_PERIOD_TYPE'
      AND A.PROJECT_NO = @P_PROJECT_NO
      AND B.BUDGET_TYPE = 'E')
      )
      UNION
      (
      SELECT BGDT.BUDGET_YEAR [FISCAL_YEAR], BGDT.REV_NO [VERSION]
      , BGDT.BUDGET_ORDER_NO [ORDER_NO], BGOR.ACCOUNT_NO [ACCOUNT_NO]
      , (SELECT M1 FROM BG_T_UPLOAD_DATA
      WHERE BUDGET_YEAR = @P_BUDGET_YEAR AND
      PERIOD_TYPE = @P_PERIOD_TYPE AND
      PROJECT_NO = @P_PROJECT_NO AND
      BUDGET_ORDER_NO = BGDT.BUDGET_ORDER_NO AND
      DATA_TYPE = 2
      ) [Budget_1]
      , (SELECT M2 FROM BG_T_UPLOAD_DATA
      WHERE BUDGET_YEAR = @P_BUDGET_YEAR AND
      PERIOD_TYPE = @P_PERIOD_TYPE AND
      PROJECT_NO = @P_PROJECT_NO AND
      BUDGET_ORDER_NO = BGDT.BUDGET_ORDER_NO AND
      DATA_TYPE = 2
      ) [Budget_2]
      , (SELECT M3 FROM BG_T_UPLOAD_DATA
      WHERE BUDGET_YEAR = @P_BUDGET_YEAR AND
      PERIOD_TYPE = @P_PERIOD_TYPE AND
      PROJECT_NO = @P_PROJECT_NO AND
      BUDGET_ORDER_NO = BGDT.BUDGET_ORDER_NO AND
      DATA_TYPE = 2
      ) [Budget_3]
      , BGDT.M4 [Budget_4], BGDT.M5 [Budget_5], BGDT.M6 [Budget_6]
      , BGDT.M7 [Budget_7], BGDT.M8 [Budget_8], BGDT.M9 [Budget_9]
      , BGDT.M10 [Budget_10], BGDT.M11 [Budget_11], BGDT.M12 [Budget_12]
      , BGDT.RRT1 [MTP_1]
      , BGDT.RRT2 [MTP_2]
      , BGDT.RRT3 [MTP_3]
      , BGDT.RRT4 [MTP_4]
      , BGDT.RRT5 [MTP_5]
      FROM [BG_T_BUDGET_DATA] BGDT
      LEFT JOIN [BG_M_BUDGET_ORDER] BGOR ON BGDT.BUDGET_ORDER_NO = BGOR.BUDGET_ORDER_NO
      WHERE CONVERT(VARCHAR(10), BGDT.BUDGET_YEAR) = '@P_BUDGET_YEAR'
      AND CONVERT(VARCHAR(10), BGDT.PERIOD_TYPE) = '@P_PERIOD_TYPE'
      AND BGDT.PROJECT_NO = @P_PROJECT_NO
      AND BGOR.BUDGET_TYPE = 'A'
      AND BGOR.ACTIVE_FLAG = 1
      AND BGDT.REV_NO = (SELECT MAX(A.REV_NO)
      FROM [BG_T_BUDGET_DATA] AS A LEFT JOIN [BG_M_BUDGET_ORDER] AS B ON
      A.BUDGET_ORDER_NO = B.BUDGET_ORDER_NO
      WHERE CONVERT(VARCHAR(10), A.BUDGET_YEAR) = '@P_BUDGET_YEAR'
      AND CONVERT(VARCHAR(10), A.PERIOD_TYPE) = '@P_PERIOD_TYPE'
      AND A.PROJECT_NO = @P_PROJECT_NO
      AND B.BUDGET_TYPE = 'A')
      )
    </SELECT006_2>
    <SELECT006_3>
      SELECT BGDT.BUDGET_YEAR [FISCAL_YEAR], BGDT.REV_NO [VERSION]
      , BGDT.BUDGET_ORDER_NO [ORDER_NO], BGOR.ACCOUNT_NO [ACCOUNT_NO]
      , (SELECT M1 FROM BG_T_UPLOAD_DATA
      WHERE BUDGET_YEAR = @P_BUDGET_YEAR AND
      PERIOD_TYPE = @P_PERIOD_TYPE AND
      PROJECT_NO = @P_PROJECT_NO AND
      BUDGET_ORDER_NO = BGDT.BUDGET_ORDER_NO AND
      DATA_TYPE = 2
      ) [Budget_1]
      , (SELECT M2 FROM BG_T_UPLOAD_DATA
      WHERE BUDGET_YEAR = @P_BUDGET_YEAR AND
      PERIOD_TYPE = @P_PERIOD_TYPE AND
      PROJECT_NO = @P_PROJECT_NO AND
      BUDGET_ORDER_NO = BGDT.BUDGET_ORDER_NO AND
      DATA_TYPE = 2
      ) [Budget_2]
      , (SELECT M3 FROM BG_T_UPLOAD_DATA
      WHERE BUDGET_YEAR = @P_BUDGET_YEAR AND
      PERIOD_TYPE = @P_PERIOD_TYPE AND
      PROJECT_NO = @P_PROJECT_NO AND
      BUDGET_ORDER_NO = BGDT.BUDGET_ORDER_NO AND
      DATA_TYPE = 2
      ) [Budget_3]
      ,(SELECT M4 FROM BG_T_UPLOAD_DATA
      WHERE BUDGET_YEAR = @P_BUDGET_YEAR AND
      PERIOD_TYPE = @P_PERIOD_TYPE AND
      PROJECT_NO = @P_PROJECT_NO AND
      BUDGET_ORDER_NO = BGDT.BUDGET_ORDER_NO AND
      DATA_TYPE = 2
      ) [Budget_4]
      , (SELECT M5 FROM BG_T_UPLOAD_DATA
      WHERE BUDGET_YEAR = @P_BUDGET_YEAR AND
      PERIOD_TYPE = @P_PERIOD_TYPE AND
      PROJECT_NO = @P_PROJECT_NO AND
      BUDGET_ORDER_NO = BGDT.BUDGET_ORDER_NO AND
      DATA_TYPE = 2
      ) [Budget_5]
      , (SELECT M6 FROM BG_T_UPLOAD_DATA
      WHERE BUDGET_YEAR = @P_BUDGET_YEAR AND
      PERIOD_TYPE = @P_PERIOD_TYPE AND
      PROJECT_NO = @P_PROJECT_NO AND
      BUDGET_ORDER_NO = BGDT.BUDGET_ORDER_NO AND
      DATA_TYPE = 2
      ) [Budget_6]
      , (SELECT M7 FROM BG_T_UPLOAD_DATA
      WHERE BUDGET_YEAR = @P_BUDGET_YEAR AND
      PERIOD_TYPE = @P_PERIOD_TYPE AND
      PROJECT_NO = @P_PROJECT_NO AND
      BUDGET_ORDER_NO = BGDT.BUDGET_ORDER_NO AND
      DATA_TYPE = 2
      ) [Budget_7]
      , (SELECT M8 FROM BG_T_UPLOAD_DATA
      WHERE BUDGET_YEAR = @P_BUDGET_YEAR AND
      PERIOD_TYPE = @P_PERIOD_TYPE AND
      PROJECT_NO = @P_PROJECT_NO AND
      BUDGET_ORDER_NO = BGDT.BUDGET_ORDER_NO AND
      DATA_TYPE = 2
      ) [Budget_8]
      , (SELECT M9 FROM BG_T_UPLOAD_DATA
      WHERE BUDGET_YEAR = @P_BUDGET_YEAR AND
      PERIOD_TYPE = @P_PERIOD_TYPE AND
      PROJECT_NO = @P_PROJECT_NO AND
      BUDGET_ORDER_NO = BGDT.BUDGET_ORDER_NO AND
      DATA_TYPE = 2
      ) [Budget_9]
      , BGDT.M10 [Budget_10], BGDT.M11 [Budget_11], BGDT.M12 [Budget_12]
      , BGDT.RRT1 [MTP_1]
      , BGDT.RRT2 [MTP_2]
      , BGDT.RRT3 [MTP_3]
      , BGDT.RRT4 [MTP_4]
      , BGDT.RRT5 [MTP_5]
      FROM [BG_T_BUDGET_DATA] BGDT
      LEFT JOIN [BG_M_BUDGET_ORDER] BGOR ON BGDT.BUDGET_ORDER_NO = BGOR.BUDGET_ORDER_NO
      WHERE CONVERT(VARCHAR(10), BGDT.BUDGET_YEAR) = '@P_BUDGET_YEAR'
      AND CONVERT(VARCHAR(10), BGDT.PERIOD_TYPE) = '@P_PERIOD_TYPE'
      AND BGDT.PROJECT_NO = @P_PROJECT_NO
      AND BGOR.ACCOUNT_NO = '@P_ACCOUNT_NO'
      AND BGOR.ACTIVE_FLAG = 1
      AND BGDT.REV_NO = (SELECT MAX(A.REV_NO)
      FROM [BG_T_BUDGET_DATA] AS A LEFT JOIN [BG_M_BUDGET_ORDER] AS B ON
      A.BUDGET_ORDER_NO = B.BUDGET_ORDER_NO
      WHERE CONVERT(VARCHAR(10), A.BUDGET_YEAR) = '@P_BUDGET_YEAR'
      AND CONVERT(VARCHAR(10), A.PERIOD_TYPE) = '@P_PERIOD_TYPE'
      AND A.PROJECT_NO = @P_PROJECT_NO)
    </SELECT006_3>
    <SELECT006_4>
      SELECT BGDT.BUDGET_YEAR [FISCAL_YEAR], BGDT.REV_NO [VERSION]
      , BGDT.BUDGET_ORDER_NO [ORDER_NO], BGOR.ACCOUNT_NO [ACCOUNT_NO]
      , BGDT.M1 [Budget_1], BGDT.M2 [Budget_2], BGDT.M3 [Budget_3]
      , BGDT.M4 [Budget_4], BGDT.M5 [Budget_5], BGDT.M6 [Budget_6]
      , BGDT.M7 [Budget_7], BGDT.M8 [Budget_8], BGDT.M9 [Budget_9]
      , BGDT.M10 [Budget_10], BGDT.M11 [Budget_11], BGDT.M12 [Budget_12]
      , BGDT.RRT1 [MTP_1]
      , BGDT.RRT2 [MTP_2]
      FROM [BG_T_BUDGET_DATA] BGDT
      LEFT JOIN [BG_M_BUDGET_ORDER] BGOR ON BGDT.BUDGET_ORDER_NO = BGOR.BUDGET_ORDER_NO
      WHERE CONVERT(VARCHAR(10), BGDT.BUDGET_YEAR) = '@P_BUDGET_YEAR'
      AND CONVERT(VARCHAR(10), BGDT.PERIOD_TYPE) = '@P_PERIOD_TYPE'
      AND BGDT.PROJECT_NO = @P_PROJECT_NO
      AND BGOR.ACCOUNT_NO = '@P_ACCOUNT_NO'
      AND BGOR.ACTIVE_FLAG = 1
      AND BGDT.REV_NO = (SELECT MAX(A.REV_NO)
      FROM [BG_T_BUDGET_DATA] AS A LEFT JOIN [BG_M_BUDGET_ORDER] AS B ON
      A.BUDGET_ORDER_NO = B.BUDGET_ORDER_NO
      WHERE CONVERT(VARCHAR(10), A.BUDGET_YEAR) = '@P_BUDGET_YEAR'
      AND CONVERT(VARCHAR(10), A.PERIOD_TYPE) = '@P_PERIOD_TYPE'
      AND A.PROJECT_NO = @P_PROJECT_NO)
    </SELECT006_4>
    <SELECT006_5>
      (
      SELECT BGDT.BUDGET_YEAR [FISCAL_YEAR], BGDT.REV_NO [VERSION]
      , BGDT.BUDGET_ORDER_NO [ORDER_NO], BGOR.ACCOUNT_NO [ACCOUNT_NO]
      , (SELECT M1 FROM BG_T_UPLOAD_DATA
      WHERE BUDGET_YEAR = @P_BUDGET_YEAR AND
      PERIOD_TYPE = @P_PERIOD_TYPE AND
      PROJECT_NO = @P_PROJECT_NO AND
      BUDGET_ORDER_NO = BGDT.BUDGET_ORDER_NO AND
      DATA_TYPE = 2
      ) [Budget_1]
      , (SELECT M2 FROM BG_T_UPLOAD_DATA
      WHERE BUDGET_YEAR = @P_BUDGET_YEAR AND
      PERIOD_TYPE = @P_PERIOD_TYPE AND
      PROJECT_NO = @P_PROJECT_NO AND
      BUDGET_ORDER_NO = BGDT.BUDGET_ORDER_NO AND
      DATA_TYPE = 2
      ) [Budget_2]
      , (SELECT M3 FROM BG_T_UPLOAD_DATA
      WHERE BUDGET_YEAR = @P_BUDGET_YEAR AND
      PERIOD_TYPE = @P_PERIOD_TYPE AND
      PROJECT_NO = @P_PROJECT_NO AND
      BUDGET_ORDER_NO = BGDT.BUDGET_ORDER_NO AND
      DATA_TYPE = 2
      ) [Budget_3]
      ,(SELECT M4 FROM BG_T_UPLOAD_DATA
      WHERE BUDGET_YEAR = @P_BUDGET_YEAR AND
      PERIOD_TYPE = @P_PERIOD_TYPE AND
      PROJECT_NO = @P_PROJECT_NO AND
      BUDGET_ORDER_NO = BGDT.BUDGET_ORDER_NO AND
      DATA_TYPE = 2
      ) [Budget_4]
      , (SELECT M5 FROM BG_T_UPLOAD_DATA
      WHERE BUDGET_YEAR = @P_BUDGET_YEAR AND
      PERIOD_TYPE = @P_PERIOD_TYPE AND
      PROJECT_NO = @P_PROJECT_NO AND
      BUDGET_ORDER_NO = BGDT.BUDGET_ORDER_NO AND
      DATA_TYPE = 2
      ) [Budget_5]
      , (SELECT M6 FROM BG_T_UPLOAD_DATA
      WHERE BUDGET_YEAR = @P_BUDGET_YEAR AND
      PERIOD_TYPE = @P_PERIOD_TYPE AND
      PROJECT_NO = @P_PROJECT_NO AND
      BUDGET_ORDER_NO = BGDT.BUDGET_ORDER_NO AND
      DATA_TYPE = 2
      ) [Budget_6]
      , (SELECT M7 FROM BG_T_UPLOAD_DATA
      WHERE BUDGET_YEAR = @P_BUDGET_YEAR AND
      PERIOD_TYPE = @P_PERIOD_TYPE AND
      PROJECT_NO = @P_PROJECT_NO AND
      BUDGET_ORDER_NO = BGDT.BUDGET_ORDER_NO AND
      DATA_TYPE = 2
      ) [Budget_7]
      , (SELECT M8 FROM BG_T_UPLOAD_DATA
      WHERE BUDGET_YEAR = @P_BUDGET_YEAR AND
      PERIOD_TYPE = @P_PERIOD_TYPE AND
      PROJECT_NO = @P_PROJECT_NO AND
      BUDGET_ORDER_NO = BGDT.BUDGET_ORDER_NO AND
      DATA_TYPE = 2
      ) [Budget_8]
      , (SELECT M9 FROM BG_T_UPLOAD_DATA
      WHERE BUDGET_YEAR = @P_BUDGET_YEAR AND
      PERIOD_TYPE = @P_PERIOD_TYPE AND
      PROJECT_NO = @P_PROJECT_NO AND
      BUDGET_ORDER_NO = BGDT.BUDGET_ORDER_NO AND
      DATA_TYPE = 2
      ) [Budget_9]
      , BGDT.M10 [Budget_10], BGDT.M11 [Budget_11], BGDT.M12 [Budget_12]
      , BGDT.RRT1 [MTP_1]
      , BGDT.RRT2 [MTP_2]
      , BGDT.RRT3 [MTP_3]
      , BGDT.RRT4 [MTP_4]
      , BGDT.RRT5 [MTP_5]
      FROM [BG_T_BUDGET_DATA] BGDT
      LEFT JOIN [BG_M_BUDGET_ORDER] BGOR ON BGDT.BUDGET_ORDER_NO = BGOR.BUDGET_ORDER_NO
      WHERE CONVERT(VARCHAR(10), BGDT.BUDGET_YEAR) = '@P_BUDGET_YEAR'
      AND CONVERT(VARCHAR(10), BGDT.PERIOD_TYPE) = '@P_PERIOD_TYPE'
      AND BGDT.PROJECT_NO = @P_PROJECT_NO
      AND BGOR.BUDGET_TYPE = 'E'
      AND BGOR.ACTIVE_FLAG = 1
      AND BGDT.REV_NO = (SELECT MAX(A.REV_NO)
      FROM [BG_T_BUDGET_DATA] AS A LEFT JOIN [BG_M_BUDGET_ORDER] AS B ON
      A.BUDGET_ORDER_NO = B.BUDGET_ORDER_NO
      WHERE CONVERT(VARCHAR(10), A.BUDGET_YEAR) = '@P_BUDGET_YEAR'
      AND CONVERT(VARCHAR(10), A.PERIOD_TYPE) = '@P_PERIOD_TYPE'
      AND A.PROJECT_NO = @P_PROJECT_NO
      AND B.BUDGET_TYPE = 'E')
      )
      UNION
      (
      SELECT BGDT.BUDGET_YEAR [FISCAL_YEAR], BGDT.REV_NO [VERSION]
      , BGDT.BUDGET_ORDER_NO [ORDER_NO], BGOR.ACCOUNT_NO [ACCOUNT_NO]
      , (SELECT M1 FROM BG_T_UPLOAD_DATA
      WHERE BUDGET_YEAR = @P_BUDGET_YEAR AND
      PERIOD_TYPE = @P_PERIOD_TYPE AND
      PROJECT_NO = @P_PROJECT_NO AND
      BUDGET_ORDER_NO = BGDT.BUDGET_ORDER_NO AND
      DATA_TYPE = 2
      ) [Budget_1]
      , (SELECT M2 FROM BG_T_UPLOAD_DATA
      WHERE BUDGET_YEAR = @P_BUDGET_YEAR AND
      PERIOD_TYPE = @P_PERIOD_TYPE AND
      PROJECT_NO = @P_PROJECT_NO AND
      BUDGET_ORDER_NO = BGDT.BUDGET_ORDER_NO AND
      DATA_TYPE = 2
      ) [Budget_2]
      , (SELECT M3 FROM BG_T_UPLOAD_DATA
      WHERE BUDGET_YEAR = @P_BUDGET_YEAR AND
      PERIOD_TYPE = @P_PERIOD_TYPE AND
      PROJECT_NO = @P_PROJECT_NO AND
      BUDGET_ORDER_NO = BGDT.BUDGET_ORDER_NO AND
      DATA_TYPE = 2
      ) [Budget_3]
      ,(SELECT M4 FROM BG_T_UPLOAD_DATA
      WHERE BUDGET_YEAR = @P_BUDGET_YEAR AND
      PERIOD_TYPE = @P_PERIOD_TYPE AND
      PROJECT_NO = @P_PROJECT_NO AND
      BUDGET_ORDER_NO = BGDT.BUDGET_ORDER_NO AND
      DATA_TYPE = 2
      ) [Budget_4]
      , (SELECT M5 FROM BG_T_UPLOAD_DATA
      WHERE BUDGET_YEAR = @P_BUDGET_YEAR AND
      PERIOD_TYPE = @P_PERIOD_TYPE AND
      PROJECT_NO = @P_PROJECT_NO AND
      BUDGET_ORDER_NO = BGDT.BUDGET_ORDER_NO AND
      DATA_TYPE = 2
      ) [Budget_5]
      , (SELECT M6 FROM BG_T_UPLOAD_DATA
      WHERE BUDGET_YEAR = @P_BUDGET_YEAR AND
      PERIOD_TYPE = @P_PERIOD_TYPE AND
      PROJECT_NO = @P_PROJECT_NO AND
      BUDGET_ORDER_NO = BGDT.BUDGET_ORDER_NO AND
      DATA_TYPE = 2
      ) [Budget_6]
      , (SELECT M7 FROM BG_T_UPLOAD_DATA
      WHERE BUDGET_YEAR = @P_BUDGET_YEAR AND
      PERIOD_TYPE = @P_PERIOD_TYPE AND
      PROJECT_NO = @P_PROJECT_NO AND
      BUDGET_ORDER_NO = BGDT.BUDGET_ORDER_NO AND
      DATA_TYPE = 2
      ) [Budget_7]
      , (SELECT M8 FROM BG_T_UPLOAD_DATA
      WHERE BUDGET_YEAR = @P_BUDGET_YEAR AND
      PERIOD_TYPE = @P_PERIOD_TYPE AND
      PROJECT_NO = @P_PROJECT_NO AND
      BUDGET_ORDER_NO = BGDT.BUDGET_ORDER_NO AND
      DATA_TYPE = 2
      ) [Budget_8]
      , (SELECT M9 FROM BG_T_UPLOAD_DATA
      WHERE BUDGET_YEAR = @P_BUDGET_YEAR AND
      PERIOD_TYPE = @P_PERIOD_TYPE AND
      PROJECT_NO = @P_PROJECT_NO AND
      BUDGET_ORDER_NO = BGDT.BUDGET_ORDER_NO AND
      DATA_TYPE = 2
      ) [Budget_9]
      , BGDT.M10 [Budget_10], BGDT.M11 [Budget_11], BGDT.M12 [Budget_12]
      , BGDT.RRT1 [MTP_1]
      , BGDT.RRT2 [MTP_2]
      , BGDT.RRT3 [MTP_3]
      , BGDT.RRT4 [MTP_4]
      , BGDT.RRT5 [MTP_5]
      FROM [BG_T_BUDGET_DATA] BGDT
      LEFT JOIN [BG_M_BUDGET_ORDER] BGOR ON BGDT.BUDGET_ORDER_NO = BGOR.BUDGET_ORDER_NO
      WHERE CONVERT(VARCHAR(10), BGDT.BUDGET_YEAR) = '@P_BUDGET_YEAR'
      AND CONVERT(VARCHAR(10), BGDT.PERIOD_TYPE) = '@P_PERIOD_TYPE'
      AND BGDT.PROJECT_NO = @P_PROJECT_NO
      AND BGOR.BUDGET_TYPE = 'A'
      AND BGOR.ACTIVE_FLAG = 1
      AND BGDT.REV_NO = (SELECT MAX(A.REV_NO)
      FROM [BG_T_BUDGET_DATA] AS A LEFT JOIN [BG_M_BUDGET_ORDER] AS B ON
      A.BUDGET_ORDER_NO = B.BUDGET_ORDER_NO
      WHERE CONVERT(VARCHAR(10), A.BUDGET_YEAR) = '@P_BUDGET_YEAR'
      AND CONVERT(VARCHAR(10), A.PERIOD_TYPE) = '@P_PERIOD_TYPE'
      AND A.PROJECT_NO = @P_PROJECT_NO
      AND B.BUDGET_TYPE = 'A')
      )
    </SELECT006_5>
    <SELECT006_6>
      (
      SELECT BGDT.BUDGET_YEAR [FISCAL_YEAR], BGDT.REV_NO [VERSION]
      , BGDT.BUDGET_ORDER_NO [ORDER_NO], BGOR.ACCOUNT_NO [ACCOUNT_NO]
      , BGDT.M1 [Budget_1], BGDT.M2 [Budget_2], BGDT.M3 [Budget_3]
      , BGDT.M4 [Budget_4], BGDT.M5 [Budget_5], BGDT.M6 [Budget_6]
      , BGDT.M7 [Budget_7], BGDT.M8 [Budget_8], BGDT.M9 [Budget_9]
      , BGDT.M10 [Budget_10], BGDT.M11 [Budget_11], BGDT.M12 [Budget_12]
      , BGDT.RRT1 [MTP_1]
      , BGDT.RRT2 [MTP_2]
      FROM [BG_T_BUDGET_DATA] BGDT
      LEFT JOIN [BG_M_BUDGET_ORDER] BGOR ON BGDT.BUDGET_ORDER_NO = BGOR.BUDGET_ORDER_NO
      WHERE CONVERT(VARCHAR(10), BGDT.BUDGET_YEAR) = '@P_BUDGET_YEAR'
      AND CONVERT(VARCHAR(10), BGDT.PERIOD_TYPE) = '@P_PERIOD_TYPE'
      AND BGDT.PROJECT_NO = @P_PROJECT_NO
      AND BGOR.BUDGET_TYPE = 'E'
      AND BGOR.ACTIVE_FLAG = 1
      AND BGDT.REV_NO = (SELECT MAX(A.REV_NO)
      FROM [BG_T_BUDGET_DATA] AS A LEFT JOIN [BG_M_BUDGET_ORDER] AS B ON
      A.BUDGET_ORDER_NO = B.BUDGET_ORDER_NO
      WHERE CONVERT(VARCHAR(10), A.BUDGET_YEAR) = '@P_BUDGET_YEAR'
      AND CONVERT(VARCHAR(10), A.PERIOD_TYPE) = '@P_PERIOD_TYPE'
      AND A.PROJECT_NO = @P_PROJECT_NO
      AND B.BUDGET_TYPE = 'E')
      )
      UNION
      (
      SELECT BGDT.BUDGET_YEAR [FISCAL_YEAR], BGDT.REV_NO [VERSION]
      , BGDT.BUDGET_ORDER_NO [ORDER_NO], BGOR.ACCOUNT_NO [ACCOUNT_NO]
      , BGDT.M1 [Budget_1], BGDT.M2 [Budget_2], BGDT.M3 [Budget_3]
      , BGDT.M4 [Budget_4], BGDT.M5 [Budget_5], BGDT.M6 [Budget_6]
      , BGDT.M7 [Budget_7], BGDT.M8 [Budget_8], BGDT.M9 [Budget_9]
      , BGDT.M10 [Budget_10], BGDT.M11 [Budget_11], BGDT.M12 [Budget_12]
      , BGDT.RRT1 [MTP_1]
      , BGDT.RRT2 [MTP_2]
      FROM [BG_T_BUDGET_DATA] BGDT
      LEFT JOIN [BG_M_BUDGET_ORDER] BGOR ON BGDT.BUDGET_ORDER_NO = BGOR.BUDGET_ORDER_NO
      WHERE CONVERT(VARCHAR(10), BGDT.BUDGET_YEAR) = '@P_BUDGET_YEAR'
      AND CONVERT(VARCHAR(10), BGDT.PERIOD_TYPE) = '@P_PERIOD_TYPE'
      AND BGDT.PROJECT_NO = @P_PROJECT_NO
      AND BGOR.BUDGET_TYPE = 'A'
      AND BGOR.ACTIVE_FLAG = 1
      AND BGDT.REV_NO = (SELECT MAX(A.REV_NO)
      FROM [BG_T_BUDGET_DATA] AS A LEFT JOIN [BG_M_BUDGET_ORDER] AS B ON
      A.BUDGET_ORDER_NO = B.BUDGET_ORDER_NO
      WHERE CONVERT(VARCHAR(10), A.BUDGET_YEAR) = '@P_BUDGET_YEAR'
      AND CONVERT(VARCHAR(10), A.PERIOD_TYPE) = '@P_PERIOD_TYPE'
      AND A.PROJECT_NO = @P_PROJECT_NO
      AND B.BUDGET_TYPE = 'A')
      )
    </SELECT006_6>
    <SELECT006_7>
      (
      SELECT BGDT.BUDGET_YEAR [FISCAL_YEAR], BGDT.REV_NO [VERSION]
      , BGDT.BUDGET_ORDER_NO [ORDER_NO], BGOR.ACCOUNT_NO [ACCOUNT_NO]
      , (SELECT M1 FROM BG_T_UPLOAD_DATA
      WHERE BUDGET_YEAR = @P_BUDGET_YEAR AND
      PERIOD_TYPE = @P_PERIOD_TYPE AND
      PROJECT_NO = @P_PROJECT_NO AND
      BUDGET_ORDER_NO = BGDT.BUDGET_ORDER_NO AND
      DATA_TYPE = 2
      ) [Budget_1]
      , (SELECT M2 FROM BG_T_UPLOAD_DATA
      WHERE BUDGET_YEAR = @P_BUDGET_YEAR AND
      PERIOD_TYPE = @P_PERIOD_TYPE AND
      PROJECT_NO = @P_PROJECT_NO AND
      BUDGET_ORDER_NO = BGDT.BUDGET_ORDER_NO AND
      DATA_TYPE = 2
      ) [Budget_2]
      , (SELECT M3 FROM BG_T_UPLOAD_DATA
      WHERE BUDGET_YEAR = @P_BUDGET_YEAR AND
      PERIOD_TYPE = @P_PERIOD_TYPE AND
      PROJECT_NO = @P_PROJECT_NO AND
      BUDGET_ORDER_NO = BGDT.BUDGET_ORDER_NO AND
      DATA_TYPE = 2
      ) [Budget_3]
      , BGDT.M4 [Budget_4], BGDT.M5 [Budget_5], BGDT.M6 [Budget_6]
      , BGDT.M7 [Budget_7], BGDT.M8 [Budget_8], BGDT.M9 [Budget_9]
      , BGDT.M10 [Budget_10], BGDT.M11 [Budget_11], BGDT.M12 [Budget_12]
      , BGDT.RRT2 [MTP_2]
      , BGDT.RRT3 [MTP_3]
      FROM [BG_T_BUDGET_DATA] BGDT
      LEFT JOIN [BG_M_BUDGET_ORDER] BGOR ON BGDT.BUDGET_ORDER_NO = BGOR.BUDGET_ORDER_NO
      WHERE CONVERT(VARCHAR(10), BGDT.BUDGET_YEAR) = '@P_BUDGET_YEAR'
      AND CONVERT(VARCHAR(10), BGDT.PERIOD_TYPE) = '@P_PERIOD_TYPE'
      AND BGDT.PROJECT_NO = @P_PROJECT_NO
      AND BGOR.BUDGET_TYPE = 'E'
      AND BGOR.ACTIVE_FLAG = 1
      AND BGDT.REV_NO = (SELECT MAX(A.REV_NO)
      FROM [BG_T_BUDGET_DATA] AS A LEFT JOIN [BG_M_BUDGET_ORDER] AS B ON
      A.BUDGET_ORDER_NO = B.BUDGET_ORDER_NO
      WHERE CONVERT(VARCHAR(10), A.BUDGET_YEAR) = '@P_BUDGET_YEAR'
      AND CONVERT(VARCHAR(10), A.PERIOD_TYPE) = '@P_PERIOD_TYPE'
      AND A.PROJECT_NO = @P_PROJECT_NO
      AND B.BUDGET_TYPE = 'E')
      )
      UNION
      (
      SELECT BGDT.BUDGET_YEAR [FISCAL_YEAR], BGDT.REV_NO [VERSION]
      , BGDT.BUDGET_ORDER_NO [ORDER_NO], BGOR.ACCOUNT_NO [ACCOUNT_NO]
      , (SELECT M1 FROM BG_T_UPLOAD_DATA
      WHERE BUDGET_YEAR = @P_BUDGET_YEAR AND
      PERIOD_TYPE = @P_PERIOD_TYPE AND
      PROJECT_NO = @P_PROJECT_NO AND
      BUDGET_ORDER_NO = BGDT.BUDGET_ORDER_NO AND
      DATA_TYPE = 2
      ) [Budget_1]
      , (SELECT M2 FROM BG_T_UPLOAD_DATA
      WHERE BUDGET_YEAR = @P_BUDGET_YEAR AND
      PERIOD_TYPE = @P_PERIOD_TYPE AND
      PROJECT_NO = @P_PROJECT_NO AND
      BUDGET_ORDER_NO = BGDT.BUDGET_ORDER_NO AND
      DATA_TYPE = 2
      ) [Budget_2]
      , (SELECT M3 FROM BG_T_UPLOAD_DATA
      WHERE BUDGET_YEAR = @P_BUDGET_YEAR AND
      PERIOD_TYPE = @P_PERIOD_TYPE AND
      PROJECT_NO = @P_PROJECT_NO AND
      BUDGET_ORDER_NO = BGDT.BUDGET_ORDER_NO AND
      DATA_TYPE = 2
      ) [Budget_3]
      , BGDT.M4 [Budget_4], BGDT.M5 [Budget_5], BGDT.M6 [Budget_6]
      , BGDT.M7 [Budget_7], BGDT.M8 [Budget_8], BGDT.M9 [Budget_9]
      , BGDT.M10 [Budget_10], BGDT.M11 [Budget_11], BGDT.M12 [Budget_12]
      , BGDT.RRT1 [MTP_1]
      , BGDT.RRT2 [MTP_2]
      FROM [BG_T_BUDGET_DATA] BGDT
      LEFT JOIN [BG_M_BUDGET_ORDER] BGOR ON BGDT.BUDGET_ORDER_NO = BGOR.BUDGET_ORDER_NO
      WHERE CONVERT(VARCHAR(10), BGDT.BUDGET_YEAR) = '@P_BUDGET_YEAR'
      AND CONVERT(VARCHAR(10), BGDT.PERIOD_TYPE) = '@P_PERIOD_TYPE'
      AND BGDT.PROJECT_NO = @P_PROJECT_NO
      AND BGOR.BUDGET_TYPE = 'A'
      AND BGOR.ACTIVE_FLAG = 1
      AND BGDT.REV_NO = (SELECT MAX(A.REV_NO)
      FROM [BG_T_BUDGET_DATA] AS A LEFT JOIN [BG_M_BUDGET_ORDER] AS B ON
      A.BUDGET_ORDER_NO = B.BUDGET_ORDER_NO
      WHERE CONVERT(VARCHAR(10), A.BUDGET_YEAR) = '@P_BUDGET_YEAR'
      AND CONVERT(VARCHAR(10), A.PERIOD_TYPE) = '@P_PERIOD_TYPE'
      AND A.PROJECT_NO = @P_PROJECT_NO
      AND B.BUDGET_TYPE = 'A')
      )
    </SELECT006_7>
    <SELECT006_8>
      SELECT BGDT.BUDGET_YEAR [FISCAL_YEAR], BGDT.REV_NO [VERSION]
      , BGDT.BUDGET_ORDER_NO [ORDER_NO], BGOR.ACCOUNT_NO [ACCOUNT_NO]
      , (SELECT M1 FROM BG_T_UPLOAD_DATA
      WHERE BUDGET_YEAR = @P_BUDGET_YEAR AND
      PERIOD_TYPE = @P_PERIOD_TYPE AND
      PROJECT_NO = @P_PROJECT_NO AND
      BUDGET_ORDER_NO = BGDT.BUDGET_ORDER_NO AND
      DATA_TYPE = 2
      ) [Budget_1]
      , (SELECT M2 FROM BG_T_UPLOAD_DATA
      WHERE BUDGET_YEAR = @P_BUDGET_YEAR AND
      PERIOD_TYPE = @P_PERIOD_TYPE AND
      PROJECT_NO = @P_PROJECT_NO AND
      BUDGET_ORDER_NO = BGDT.BUDGET_ORDER_NO AND
      DATA_TYPE = 2
      ) [Budget_2]
      , (SELECT M3 FROM BG_T_UPLOAD_DATA
      WHERE BUDGET_YEAR = @P_BUDGET_YEAR AND
      PERIOD_TYPE = @P_PERIOD_TYPE AND
      PROJECT_NO = @P_PROJECT_NO AND
      BUDGET_ORDER_NO = BGDT.BUDGET_ORDER_NO AND
      DATA_TYPE = 2
      ) [Budget_3]
      , BGDT.M4 [Budget_4], BGDT.M5 [Budget_5], BGDT.M6 [Budget_6]
      , BGDT.M7 [Budget_7], BGDT.M8 [Budget_8], BGDT.M9 [Budget_9]
      , BGDT.M10 [Budget_10], BGDT.M11 [Budget_11], BGDT.M12 [Budget_12]
      , BGDT.RRT2 [MTP_2]
      , BGDT.RRT3 [MTP_3]
      FROM [BG_T_BUDGET_DATA] BGDT
      LEFT JOIN [BG_M_BUDGET_ORDER] BGOR ON BGDT.BUDGET_ORDER_NO = BGOR.BUDGET_ORDER_NO
      WHERE CONVERT(VARCHAR(10), BGDT.BUDGET_YEAR) = '@P_BUDGET_YEAR'
      AND CONVERT(VARCHAR(10), BGDT.PERIOD_TYPE) = '@P_PERIOD_TYPE'
      AND BGDT.PROJECT_NO = @P_PROJECT_NO
      AND BGOR.ACCOUNT_NO = '@P_ACCOUNT_NO'
      AND BGOR.ACTIVE_FLAG = 1
      AND BGDT.REV_NO = (SELECT MAX(A.REV_NO)
      FROM [BG_T_BUDGET_DATA] AS A LEFT JOIN [BG_M_BUDGET_ORDER] AS B ON
      A.BUDGET_ORDER_NO = B.BUDGET_ORDER_NO
      WHERE CONVERT(VARCHAR(10), A.BUDGET_YEAR) = '@P_BUDGET_YEAR'
      AND CONVERT(VARCHAR(10), A.PERIOD_TYPE) = '@P_PERIOD_TYPE'
      AND A.PROJECT_NO = @P_PROJECT_NO)
    </SELECT006_8>
    <SELECT007_1>
      SELECT
      MAX_REV.BUDGET_YEAR, MAX_REV.PERIOD_TYPE, MAX_REV.PROJECT_NO, MAX_REV.BUDGET_ORDER_NO,
      MAX_REV.BUDGET_ORDER_NAME, MAX_REV.ACCOUNT_NO, MAX_REV.ACCOUNT_NAME, MAX_REV.DEPT_NO, MAX_REV.PERSON_IN_CHARGE_NO, MAX_REV.COST,
      MAX_REV.REV_NO,

      ISNULL(ACTUAL_DATA.H1,0) AS ACTUAL_1ST_HALF,

      ISNULL(REVISE_BUDGET.M7, 0) + ISNULL(REVISE_BUDGET.M8, 0) + ISNULL(REVISE_BUDGET.M9, 0) + ISNULL(REVISE_BUDGET.M10, 0) + ISNULL(REVISE_BUDGET.M11, 0) + ISNULL(REVISE_BUDGET.M12, 0) AS REVISE_BUDGET_2ND_HALF,

      ISNULL(MASTER_DATA.M1,0) AS M1,
      ISNULL(MASTER_DATA.M2,0) AS M2,
      ISNULL(MASTER_DATA.M3,0) AS M3,
      ISNULL(MASTER_DATA.M4,0) AS M4,
      ISNULL(MASTER_DATA.M5,0) AS M5,
      ISNULL(MASTER_DATA.M6,0) AS M6,
      ISNULL(MASTER_DATA.M7,0) AS M7,
      ISNULL(MASTER_DATA.M8,0) AS M8,
      ISNULL(MASTER_DATA.M9,0) AS M9,
      ISNULL(MASTER_DATA.M10,0) AS M10,
      ISNULL(MASTER_DATA.M11,0) AS M11,
      ISNULL(MASTER_DATA.M12,0) AS M12,

      ISNULL(ACTUAL_DATA.M7,0) AS ACTUAL_JUL,
      ISNULL(ACTUAL_DATA.M8,0) AS ACTUAL_AUG,
      ISNULL(ACTUAL_DATA.M9,0) AS ACTUAL_SEP,

      ISNULL(MASTER_DATA.M10,0) AS ESTIMATE_OCT,
      ISNULL(MASTER_DATA.M11,0) AS ESTIMATE_NOV,
      ISNULL(MASTER_DATA.M12,0) AS ESTIMATE_DEC,

      --(ISNULL(MASTER_DATA.M7,0) + ISNULL(MASTER_DATA.M8,0) + ISNULL(MASTER_DATA.M9,0) + ISNULL(MASTER_DATA.M10,0) + ISNULL(MASTER_DATA.M11,0) + ISNULL(MASTER_DATA.M12,0)) AS ESTIMATE_BUDGET_2ND_HALF,
      ISNULL(ACTUAL_DATA.M7,0) + ISNULL(ACTUAL_DATA.M8,0) + ISNULL(ACTUAL_DATA.M9,0) + ISNULL(MASTER_DATA.M10,0) + ISNULL(MASTER_DATA.M11,0) + ISNULL(MASTER_DATA.M12,0) AS ESTIMATE_BUDGET_2ND_HALF,

      0.0 AS ESTIMATE_BUDGET_TOTAL_YEAR

      FROM (
      SELECT BUDGET_DATA.BUDGET_YEAR, BUDGET_DATA.PERIOD_TYPE, BUDGET_DATA.PROJECT_NO, BUDGET_ORDER.BUDGET_ORDER_NO,
      BUDGET_ORDER.BUDGET_ORDER_NAME, BUDGET_ORDER.ACCOUNT_NO, ACCOUNT.ACCOUNT_NAME, BUDGET_ORDER.DEPT_NO, BUDGET_ORDER.PERSON_IN_CHARGE_NO, BUDGET_ORDER.COST,
      MAX(BUDGET_DATA.REV_NO) AS REV_NO
      FROM BG_T_BUDGET_DATA AS BUDGET_DATA
      INNER JOIN BG_M_BUDGET_ORDER AS BUDGET_ORDER
      ON BUDGET_DATA.BUDGET_ORDER_NO = BUDGET_ORDER.BUDGET_ORDER_NO
      INNER JOIN BG_M_ACCOUNT AS ACCOUNT
      ON BUDGET_ORDER.ACCOUNT_NO = ACCOUNT.ACCOUNT_NO
      WHERE BUDGET_ORDER.BUDGET_TYPE = 'E'
      AND BUDGET_ORDER.ACTIVE_FLAG = 1
      AND BUDGET_DATA.BUDGET_YEAR = @BudgetYear
      AND BUDGET_DATA.PERIOD_TYPE = @PeriodType
      AND BUDGET_DATA.PROJECT_NO = @ProjectNo
      @AccountNo

      GROUP BY BUDGET_DATA.BUDGET_YEAR, BUDGET_DATA.PERIOD_TYPE, BUDGET_DATA.PROJECT_NO, BUDGET_ORDER.BUDGET_ORDER_NO,
      BUDGET_ORDER.BUDGET_ORDER_NAME, BUDGET_ORDER.ACCOUNT_NO, ACCOUNT.ACCOUNT_NAME, BUDGET_ORDER.DEPT_NO, BUDGET_ORDER.PERSON_IN_CHARGE_NO, BUDGET_ORDER.COST ) AS MAX_REV

      INNER JOIN BG_T_BUDGET_DATA AS MASTER_DATA
      ON MAX_REV.BUDGET_YEAR = MASTER_DATA.BUDGET_YEAR
      AND MAX_REV.PERIOD_TYPE = MASTER_DATA.PERIOD_TYPE
      AND MAX_REV.PROJECT_NO = MASTER_DATA.PROJECT_NO
      AND MAX_REV.BUDGET_ORDER_NO = MASTER_DATA.BUDGET_ORDER_NO
      AND MAX_REV.REV_NO = MASTER_DATA.REV_NO


      ---- change Revise to OB 02/05/2018
      --LEFT OUTER JOIN BG_T_UPLOAD_DATA AS REVISE_BUDGET
      --ON REVISE_BUDGET.BUDGET_YEAR = MAX_REV.BUDGET_YEAR
      ----AND REVISE_BUDGET.PERIOD_TYPE = 2
      --AND REVISE_BUDGET.PERIOD_TYPE = 1
      --AND REVISE_BUDGET.PROJECT_NO = 1
      --AND REVISE_BUDGET.BUDGET_ORDER_NO = MAX_REV.BUDGET_ORDER_NO
      --AND REVISE_BUDGET.DATA_TYPE = 1

      LEFT JOIN BG_T_BUDGET_DATA AS REVISE_BUDGET
      ON  REVISE_BUDGET.BUDGET_YEAR =  MAX_REV.BUDGET_YEAR
      AND REVISE_BUDGET.PERIOD_TYPE = 1
      AND REVISE_BUDGET.PROJECT_NO = MAX_REV.PROJECT_NO
      AND REVISE_BUDGET.BUDGET_ORDER_NO = MAX_REV.BUDGET_ORDER_NO
      AND REVISE_BUDGET.REV_NO = MAX_REV.REV_NO

      LEFT OUTER JOIN BG_T_UPLOAD_DATA AS ACTUAL_DATA
      ON ACTUAL_DATA.BUDGET_YEAR = MAX_REV.BUDGET_YEAR
      AND ACTUAL_DATA.PERIOD_TYPE = @PeriodType
      AND ACTUAL_DATA.PROJECT_NO = @ProjectNo
      AND ACTUAL_DATA.BUDGET_ORDER_NO = MAX_REV.BUDGET_ORDER_NO
      AND ACTUAL_DATA.DATA_TYPE = 2

      WHERE
      (
      ISNULL(ACTUAL_DATA.H1, 0) &lt;&gt; 0
      OR ISNULL(REVISE_BUDGET.M7, 0) &lt;&gt; 0
      OR ISNULL(REVISE_BUDGET.M8, 0) &lt;&gt; 0
      OR ISNULL(REVISE_BUDGET.M9, 0) &lt;&gt; 0
      OR ISNULL(REVISE_BUDGET.M10, 0) &lt;&gt; 0
      OR ISNULL(REVISE_BUDGET.M11, 0) &lt;&gt; 0
      OR ISNULL(REVISE_BUDGET.M12, 0) &lt;&gt; 0      
      OR ISNULL(ACTUAL_DATA.M7,0) &lt;&gt; 0
      OR ISNULL(ACTUAL_DATA.M8,0) &lt;&gt; 0
      OR ISNULL(ACTUAL_DATA.M9,0) &lt;&gt; 0
      OR ISNULL(MASTER_DATA.M10, 0) &lt;&gt; 0
      OR ISNULL(MASTER_DATA.M11, 0) &lt;&gt; 0
      OR ISNULL(MASTER_DATA.M12, 0) &lt;&gt; 0
      )
    </SELECT007_1>
    <SELECT007_2>
      AND BUDGET_ORDER.ACCOUNT_NO = '@AccountNo'
    </SELECT007_2>
    <SELECT007_3>
      SELECT
      MAX_REV.BUDGET_YEAR, MAX_REV.PERIOD_TYPE, MAX_REV.PROJECT_NO, MAX_REV.BUDGET_ORDER_NO,
      MAX_REV.BUDGET_ORDER_NAME, MAX_REV.ACCOUNT_NO, MAX_REV.ACCOUNT_NAME, MAX_REV.DEPT_NO, MAX_REV.PERSON_IN_CHARGE_NO, MAX_REV.COST,
      MAX_REV.REV_NO,

      ISNULL(ACTUAL_DATA.H1,0) AS ACTUAL_1ST_HALF,

      ISNULL(REVISE_BUDGET.M7, 0) + ISNULL(REVISE_BUDGET.M8, 0) + ISNULL(REVISE_BUDGET.M9, 0) + ISNULL(REVISE_BUDGET.M10, 0) + ISNULL(REVISE_BUDGET.M11, 0) + ISNULL(REVISE_BUDGET.M12, 0) AS REVISE_BUDGET_2ND_HALF,

      ISNULL(MASTER_DATA.M1,0) AS M1,
      ISNULL(MASTER_DATA.M2,0) AS M2,
      ISNULL(MASTER_DATA.M3,0) AS M3,
      ISNULL(MASTER_DATA.M4,0) AS M4,
      ISNULL(MASTER_DATA.M5,0) AS M5,
      ISNULL(MASTER_DATA.M6,0) AS M6,
      ISNULL(MASTER_DATA.M7,0) AS M7,
      ISNULL(MASTER_DATA.M8,0) AS M8,
      ISNULL(MASTER_DATA.M9,0) AS M9,
      ISNULL(MASTER_DATA.M10,0) AS M10,
      ISNULL(MASTER_DATA.M11,0) AS M11,
      ISNULL(MASTER_DATA.M12,0) AS M12,

      ISNULL(ACTUAL_DATA.M7,0) AS ACTUAL_JUL,
      ISNULL(ACTUAL_DATA.M8,0) AS ACTUAL_AUG,
      ISNULL(ACTUAL_DATA.M9,0) AS ACTUAL_SEP,

      ISNULL(MASTER_DATA.M10,0) AS ESTIMATE_OCT,
      ISNULL(MASTER_DATA.M11,0) AS ESTIMATE_NOV,
      ISNULL(MASTER_DATA.M12,0) AS ESTIMATE_DEC,

      --(ISNULL(MASTER_DATA.M7,0) + ISNULL(MASTER_DATA.M8,0) + ISNULL(MASTER_DATA.M9,0) + ISNULL(MASTER_DATA.M10,0) + ISNULL(MASTER_DATA.M11,0) + ISNULL(MASTER_DATA.M12,0)) AS ESTIMATE_BUDGET_2ND_HALF,
      ISNULL(ACTUAL_DATA.M7,0) + ISNULL(ACTUAL_DATA.M8,0) + ISNULL(ACTUAL_DATA.M9,0) + ISNULL(MASTER_DATA.M10,0) + ISNULL(MASTER_DATA.M11,0) + ISNULL(MASTER_DATA.M12,0) AS ESTIMATE_BUDGET_2ND_HALF,

      0.0 AS ESTIMATE_BUDGET_TOTAL_YEAR

      FROM (
      SELECT BUDGET_DATA.BUDGET_YEAR, BUDGET_DATA.PERIOD_TYPE, BUDGET_DATA.PROJECT_NO, BUDGET_ORDER.BUDGET_ORDER_NO,
      BUDGET_ORDER.BUDGET_ORDER_NAME, BUDGET_ORDER.ACCOUNT_NO, ACCOUNT.ACCOUNT_NAME, BUDGET_ORDER.DEPT_NO, BUDGET_ORDER.PERSON_IN_CHARGE_NO, BUDGET_ORDER.COST,
      MAX(BUDGET_DATA.REV_NO) AS REV_NO
      FROM BG_T_BUDGET_DATA AS BUDGET_DATA
      INNER JOIN BG_M_BUDGET_ORDER AS BUDGET_ORDER
      ON BUDGET_DATA.BUDGET_ORDER_NO = BUDGET_ORDER.BUDGET_ORDER_NO
      INNER JOIN BG_M_ACCOUNT AS ACCOUNT
      ON BUDGET_ORDER.ACCOUNT_NO = ACCOUNT.ACCOUNT_NO
      WHERE BUDGET_ORDER.BUDGET_TYPE = 'E'
      AND BUDGET_ORDER.ACTIVE_FLAG = 1
      AND BUDGET_DATA.BUDGET_YEAR = @BudgetYear
      AND BUDGET_DATA.PERIOD_TYPE = @PeriodType
      AND BUDGET_DATA.PROJECT_NO = @ProjectNo
      AND BUDGET_DATA.REV_NO = @RevNo
      @AccountNo

      GROUP BY BUDGET_DATA.BUDGET_YEAR, BUDGET_DATA.PERIOD_TYPE, BUDGET_DATA.PROJECT_NO, BUDGET_ORDER.BUDGET_ORDER_NO,
      BUDGET_ORDER.BUDGET_ORDER_NAME, BUDGET_ORDER.ACCOUNT_NO, ACCOUNT.ACCOUNT_NAME, BUDGET_ORDER.DEPT_NO, BUDGET_ORDER.PERSON_IN_CHARGE_NO, BUDGET_ORDER.COST ) AS MAX_REV

      INNER JOIN BG_T_BUDGET_DATA AS MASTER_DATA
      ON MAX_REV.BUDGET_YEAR = MASTER_DATA.BUDGET_YEAR
      AND MAX_REV.PERIOD_TYPE = MASTER_DATA.PERIOD_TYPE
      AND MAX_REV.PROJECT_NO = MASTER_DATA.PROJECT_NO
      AND MAX_REV.BUDGET_ORDER_NO = MASTER_DATA.BUDGET_ORDER_NO
      AND MAX_REV.REV_NO = MASTER_DATA.REV_NO

      ---- change Revise to OB 02/05/2018
      --LEFT OUTER JOIN BG_T_UPLOAD_DATA AS REVISE_BUDGET
      --ON REVISE_BUDGET.BUDGET_YEAR = MAX_REV.BUDGET_YEAR
      ----AND REVISE_BUDGET.PERIOD_TYPE = 2
      --AND REVISE_BUDGET.PERIOD_TYPE = 1
      --AND REVISE_BUDGET.PROJECT_NO = 1
      --AND REVISE_BUDGET.BUDGET_ORDER_NO = MAX_REV.BUDGET_ORDER_NO
      --AND REVISE_BUDGET.DATA_TYPE = 1

      LEFT JOIN BG_T_BUDGET_DATA AS REVISE_BUDGET
      ON  REVISE_BUDGET.BUDGET_YEAR =  MAX_REV.BUDGET_YEAR
      AND REVISE_BUDGET.PERIOD_TYPE = 1
      AND REVISE_BUDGET.PROJECT_NO = MAX_REV.PROJECT_NO
      AND REVISE_BUDGET.BUDGET_ORDER_NO = MAX_REV.BUDGET_ORDER_NO
      AND REVISE_BUDGET.REV_NO = MAX_REV.REV_NO

      LEFT OUTER JOIN BG_T_UPLOAD_DATA AS ACTUAL_DATA
      ON ACTUAL_DATA.BUDGET_YEAR = MAX_REV.BUDGET_YEAR
      AND ACTUAL_DATA.PERIOD_TYPE = @PeriodType
      AND ACTUAL_DATA.PROJECT_NO = @ProjectNo
      AND ACTUAL_DATA.BUDGET_ORDER_NO = MAX_REV.BUDGET_ORDER_NO
      AND ACTUAL_DATA.DATA_TYPE = 2

      WHERE
      (
      ISNULL(ACTUAL_DATA.H1, 0) &lt;&gt; 0
      OR ISNULL(REVISE_BUDGET.M7, 0) &lt;&gt; 0
      OR ISNULL(REVISE_BUDGET.M8, 0) &lt;&gt; 0
      OR ISNULL(REVISE_BUDGET.M9, 0) &lt;&gt; 0
      OR ISNULL(REVISE_BUDGET.M10, 0) &lt;&gt; 0
      OR ISNULL(REVISE_BUDGET.M11, 0) &lt;&gt; 0
      OR ISNULL(REVISE_BUDGET.M12, 0) &lt;&gt; 0
      OR ISNULL(ACTUAL_DATA.M7,0) &lt;&gt; 0
      OR ISNULL(ACTUAL_DATA.M8,0) &lt;&gt; 0
      OR ISNULL(ACTUAL_DATA.M9,0) &lt;&gt; 0
      OR ISNULL(MASTER_DATA.M10, 0) &lt;&gt; 0
      OR ISNULL(MASTER_DATA.M11, 0) &lt;&gt; 0
      OR ISNULL(MASTER_DATA.M12, 0) &lt;&gt; 0
      )
    </SELECT007_3>
    <SELECT008_1>
      SELECT MAX_REV.BUDGET_YEAR, MAX_REV.PERIOD_TYPE, MAX_REV.PROJECT_NO, MAX_REV.BUDGET_ORDER_NO,
      MAX_REV.BUDGET_ORDER_NAME, MAX_REV.ACCOUNT_NO AS ACCOUNT_NO, MAX_REV.ACCOUNT_NAME AS ACCOUNT_NAME, MAX_REV.DEPT_NO AS DEPT_NO, MAX_REV.PERSON_IN_CHARGE_NO AS PERSON_IN_CHARGE_NO, MAX_REV.COST AS COST,
      MAX_REV.REV_NO AS REV_NO,
      ISNULL(MASTER_DATA.M1, 0) AS M1,
      ISNULL(MASTER_DATA.M2, 0) AS M2,
      ISNULL(MASTER_DATA.M3, 0) AS M3,
      ISNULL(MASTER_DATA.M4, 0) AS M4,
      ISNULL(MASTER_DATA.M5, 0) AS M5,
      ISNULL(MASTER_DATA.M6, 0) AS M6,
      ISNULL(MASTER_DATA.M7, 0) AS M7,
      ISNULL(MASTER_DATA.M8, 0) AS M8,
      ISNULL(MASTER_DATA.M9, 0) AS M9,
      ISNULL(MASTER_DATA.M10, 0) AS M10,
      ISNULL(MASTER_DATA.M11, 0) AS M11,
      ISNULL(MASTER_DATA.M12, 0) AS M12,
      ISNULL(ORIGINAL_BUDGET.H1,0) AS ORIGINAL_1ST_HALF,
      ISNULL(ACTUAL_DATA.M1,0) AS ACTUAL_JAN,
      ISNULL(ACTUAL_DATA.M2,0) AS ACTUAL_FEB,
      ISNULL(ACTUAL_DATA.M3,0) AS ACTUAL_MAR,
      ISNULL(ESTIMATE_BUDGET.M4,0) AS ESTIMATE_APR,
      ISNULL(ESTIMATE_BUDGET.M5,0) AS ESTIMATE_MAY,
      ISNULL(ESTIMATE_BUDGET.M6,0) AS ESTIMATE_JUN,
      (ISNULL(ACTUAL_DATA.M1,0) + ISNULL(ACTUAL_DATA.M2,0) + ISNULL(ACTUAL_DATA.M3,0) + ISNULL(ESTIMATE_BUDGET.M4,0) + ISNULL(ESTIMATE_BUDGET.M5,0) + ISNULL(ESTIMATE_BUDGET.M6,0)) AS ESTIMATE_1ST_HALF,
      0.0 AS DIFF_1ST_HALF,
      ISNULL(ORIGINAL_BUDGET.H2,0) AS ORIGINAL_2ND_HALF,
      ISNULL(MASTER_DATA.M7,0) AS REVISE_JUL,
      ISNULL(MASTER_DATA.M8,0) AS REVISE_AUG,
      ISNULL(MASTER_DATA.M9,0) AS REVISE_SEP,
      ISNULL(MASTER_DATA.M10,0) AS REVISE_OCT,
      ISNULL(MASTER_DATA.M11 ,0) AS REVISE_NOV,
      ISNULL(MASTER_DATA.M12 ,0) AS REVISE_DEC,
      (ISNULL(MASTER_DATA.M7,0) + ISNULL(MASTER_DATA.M8,0) + ISNULL(MASTER_DATA.M9,0) + ISNULL(MASTER_DATA.M10,0) + ISNULL(MASTER_DATA.M11 ,0) + ISNULL(MASTER_DATA.M12 ,0)) AS REVISE_2ND_HALF,
      0.0 AS DIFF_2ND_HALF,
      0.0 AS REVISE_YEAR,
      0.0 AS DIFF_YEAR,
      ISNULL(MASTER_DATA.RRT1 ,0) AS RRT1,
      ISNULL(MASTER_DATA.RRT2 ,0) AS RRT2,
      ISNULL(MASTER_DATA.RRT3 ,0) AS RRT3,
      ISNULL(MASTER_DATA.RRT4 ,0) AS RRT4,
      ISNULL(MASTER_DATA.RRT5 ,0) AS RRT5

      FROM (
      SELECT BUDGET_DATA.BUDGET_YEAR, BUDGET_DATA.PERIOD_TYPE, BUDGET_DATA.PROJECT_NO, BUDGET_ORDER.BUDGET_ORDER_NO,
      BUDGET_ORDER.BUDGET_ORDER_NAME, BUDGET_ORDER.ACCOUNT_NO, ACCOUNT.ACCOUNT_NAME, BUDGET_ORDER.DEPT_NO, BUDGET_ORDER.PERSON_IN_CHARGE_NO, BUDGET_ORDER.COST,
      MAX(BUDGET_DATA.REV_NO) AS REV_NO
      FROM BG_T_BUDGET_DATA AS BUDGET_DATA
      INNER JOIN BG_M_BUDGET_ORDER AS BUDGET_ORDER
      ON BUDGET_DATA.BUDGET_ORDER_NO = BUDGET_ORDER.BUDGET_ORDER_NO
      INNER JOIN BG_M_ACCOUNT AS ACCOUNT
      ON BUDGET_ORDER.ACCOUNT_NO = ACCOUNT.ACCOUNT_NO
      WHERE BUDGET_ORDER.BUDGET_TYPE = 'E'
      AND BUDGET_ORDER.ACTIVE_FLAG = 1
      AND BUDGET_DATA.BUDGET_YEAR = @BudgetYear
      AND BUDGET_DATA.PERIOD_TYPE = @PeriodType
      AND BUDGET_DATA.PROJECT_NO = @ProjectNo
      @AccountNo
      GROUP BY BUDGET_DATA.BUDGET_YEAR, BUDGET_DATA.PERIOD_TYPE, BUDGET_DATA.PROJECT_NO, BUDGET_ORDER.BUDGET_ORDER_NO,
      BUDGET_ORDER.BUDGET_ORDER_NAME, BUDGET_ORDER.ACCOUNT_NO, ACCOUNT.ACCOUNT_NAME, BUDGET_ORDER.DEPT_NO, BUDGET_ORDER.PERSON_IN_CHARGE_NO, BUDGET_ORDER.COST ) AS MAX_REV

      INNER JOIN BG_T_BUDGET_DATA AS MASTER_DATA
      ON MAX_REV.BUDGET_YEAR = MASTER_DATA.BUDGET_YEAR
      AND MAX_REV.PERIOD_TYPE = MASTER_DATA.PERIOD_TYPE
      AND MAX_REV.PROJECT_NO = MASTER_DATA.PROJECT_NO
      AND MAX_REV.BUDGET_ORDER_NO = MASTER_DATA.BUDGET_ORDER_NO
      AND MAX_REV.REV_NO = MASTER_DATA.REV_NO

      LEFT OUTER JOIN BG_T_UPLOAD_DATA AS ORIGINAL_BUDGET
      ON MAX_REV.BUDGET_YEAR = ORIGINAL_BUDGET.BUDGET_YEAR
      AND ORIGINAL_BUDGET.PERIOD_TYPE = @PeriodType
      AND ORIGINAL_BUDGET.PROJECT_NO = @ProjectNo
      AND MAX_REV.BUDGET_ORDER_NO = ORIGINAL_BUDGET.BUDGET_ORDER_NO
      AND ORIGINAL_BUDGET.DATA_TYPE = 1

      LEFT OUTER JOIN BG_T_BUDGET_DATA AS ESTIMATE_BUDGET
      ON MAX_REV.BUDGET_YEAR = ESTIMATE_BUDGET.BUDGET_YEAR
      AND ESTIMATE_BUDGET.PERIOD_TYPE = @PeriodType
      AND ESTIMATE_BUDGET.PROJECT_NO = @ProjectNo
      AND MAX_REV.BUDGET_ORDER_NO = ESTIMATE_BUDGET.BUDGET_ORDER_NO
      AND MAX_REV.REV_NO = ESTIMATE_BUDGET.REV_NO

      LEFT OUTER JOIN BG_T_UPLOAD_DATA AS ACTUAL_DATA
      ON MAX_REV.BUDGET_YEAR = ACTUAL_DATA.BUDGET_YEAR
      AND ACTUAL_DATA.PERIOD_TYPE = @PeriodType
      AND ACTUAL_DATA.PROJECT_NO = @ProjectNo
      AND MAX_REV.BUDGET_ORDER_NO = ACTUAL_DATA.BUDGET_ORDER_NO
      AND ACTUAL_DATA.DATA_TYPE = 2

      WHERE
      (
      ISNULL(ORIGINAL_BUDGET.H1, 0) &lt;&gt; 0
      OR ISNULL(ORIGINAL_BUDGET.H2, 0) &lt;&gt; 0
      OR ISNULL(ACTUAL_DATA.M1, 0) &lt;&gt; 0
      OR ISNULL(ACTUAL_DATA.M2, 0) &lt;&gt; 0
      OR ISNULL(ACTUAL_DATA.M3, 0) &lt;&gt; 0
      OR ISNULL(MASTER_DATA.M4, 0) &lt;&gt; 0
      OR ISNULL(MASTER_DATA.M5, 0) &lt;&gt; 0
      OR ISNULL(MASTER_DATA.M6, 0) &lt;&gt; 0
      OR ISNULL(MASTER_DATA.M7, 0) &lt;&gt; 0
      OR ISNULL(MASTER_DATA.M8, 0) &lt;&gt; 0
      OR ISNULL(MASTER_DATA.M9, 0) &lt;&gt; 0
      OR ISNULL(MASTER_DATA.M10, 0) &lt;&gt; 0
      OR ISNULL(MASTER_DATA.M11, 0) &lt;&gt; 0
      OR ISNULL(MASTER_DATA.M12, 0) &lt;&gt; 0
      OR ISNULL(MASTER_DATA.RRT1 ,0) &lt;&gt; 0
      OR ISNULL(MASTER_DATA.RRT2 ,0) &lt;&gt; 0
      OR ISNULL(MASTER_DATA.RRT3 ,0) &lt;&gt; 0
      OR ISNULL(MASTER_DATA.RRT4 ,0) &lt;&gt; 0
      OR ISNULL(MASTER_DATA.RRT5 ,0) &lt;&gt; 0
      )
    </SELECT008_1>
    <SELECT008_2>
      AND BUDGET_ORDER.ACCOUNT_NO = '@AccountNo'
    </SELECT008_2>
    <SELECT008_3>
      SELECT MAX_REV.BUDGET_YEAR, MAX_REV.PERIOD_TYPE, MAX_REV.PROJECT_NO, MAX_REV.BUDGET_ORDER_NO,
      MAX_REV.BUDGET_ORDER_NAME, MAX_REV.ACCOUNT_NO AS ACCOUNT_NO, MAX_REV.ACCOUNT_NAME AS ACCOUNT_NAME, MAX_REV.DEPT_NO AS DEPT_NO, MAX_REV.PERSON_IN_CHARGE_NO AS PERSON_IN_CHARGE_NO, MAX_REV.COST AS COST,
      MAX_REV.REV_NO AS REV_NO,
      ISNULL(MASTER_DATA.M1, 0) AS M1,
      ISNULL(MASTER_DATA.M2, 0) AS M2,
      ISNULL(MASTER_DATA.M3, 0) AS M3,
      ISNULL(MASTER_DATA.M4, 0) AS M4,
      ISNULL(MASTER_DATA.M5, 0) AS M5,
      ISNULL(MASTER_DATA.M6, 0) AS M6,
      ISNULL(MASTER_DATA.M7, 0) AS M7,
      ISNULL(MASTER_DATA.M8, 0) AS M8,
      ISNULL(MASTER_DATA.M9, 0) AS M9,
      ISNULL(MASTER_DATA.M10, 0) AS M10,
      ISNULL(MASTER_DATA.M11, 0) AS M11,
      ISNULL(MASTER_DATA.M12, 0) AS M12,
      ISNULL(ORIGINAL_BUDGET.H1,0) AS ORIGINAL_1ST_HALF,
      ISNULL(ACTUAL_DATA.M1,0) AS ACTUAL_JAN,
      ISNULL(ACTUAL_DATA.M2,0) AS ACTUAL_FEB,
      ISNULL(ACTUAL_DATA.M3,0) AS ACTUAL_MAR,
      ISNULL(ESTIMATE_BUDGET.M4,0) AS ESTIMATE_APR,
      ISNULL(ESTIMATE_BUDGET.M5,0) AS ESTIMATE_MAY,
      ISNULL(ESTIMATE_BUDGET.M6,0) AS ESTIMATE_JUN,
      (ISNULL(ACTUAL_DATA.M1,0) + ISNULL(ACTUAL_DATA.M2,0) + ISNULL(ACTUAL_DATA.M3,0) + ISNULL(ESTIMATE_BUDGET.M4,0) + ISNULL(ESTIMATE_BUDGET.M5,0) + ISNULL(ESTIMATE_BUDGET.M6,0)) AS ESTIMATE_1ST_HALF,
      0.0 AS DIFF_1ST_HALF,
      ISNULL(ORIGINAL_BUDGET.H2,0) AS ORIGINAL_2ND_HALF,
      ISNULL(MASTER_DATA.M7,0) AS REVISE_JUL,
      ISNULL(MASTER_DATA.M8,0) AS REVISE_AUG,
      ISNULL(MASTER_DATA.M9,0) AS REVISE_SEP,
      ISNULL(MASTER_DATA.M10,0) AS REVISE_OCT,
      ISNULL(MASTER_DATA.M11 ,0) AS REVISE_NOV,
      ISNULL(MASTER_DATA.M12 ,0) AS REVISE_DEC,
      (ISNULL(MASTER_DATA.M7,0) + ISNULL(MASTER_DATA.M8,0) + ISNULL(MASTER_DATA.M9,0) + ISNULL(MASTER_DATA.M10,0) + ISNULL(MASTER_DATA.M11 ,0) + ISNULL(MASTER_DATA.M12 ,0)) AS REVISE_2ND_HALF,
      0.0 AS DIFF_2ND_HALF,
      0.0 AS REVISE_YEAR,
      0.0 AS DIFF_YEAR,
      ISNULL(MASTER_DATA.RRT1 ,0) AS RRT1,
      ISNULL(MASTER_DATA.RRT2 ,0) AS RRT2,
      ISNULL(MASTER_DATA.RRT3 ,0) AS RRT3,
      ISNULL(MASTER_DATA.RRT4 ,0) AS RRT4,
      ISNULL(MASTER_DATA.RRT5 ,0) AS RRT5

      FROM (
      SELECT BUDGET_DATA.BUDGET_YEAR, BUDGET_DATA.PERIOD_TYPE, BUDGET_DATA.PROJECT_NO, BUDGET_ORDER.BUDGET_ORDER_NO,
      BUDGET_ORDER.BUDGET_ORDER_NAME, BUDGET_ORDER.ACCOUNT_NO, ACCOUNT.ACCOUNT_NAME, BUDGET_ORDER.DEPT_NO, BUDGET_ORDER.PERSON_IN_CHARGE_NO, BUDGET_ORDER.COST,
      MAX(BUDGET_DATA.REV_NO) AS REV_NO
      FROM BG_T_BUDGET_DATA AS BUDGET_DATA
      INNER JOIN BG_M_BUDGET_ORDER AS BUDGET_ORDER
      ON BUDGET_DATA.BUDGET_ORDER_NO = BUDGET_ORDER.BUDGET_ORDER_NO
      INNER JOIN BG_M_ACCOUNT AS ACCOUNT
      ON BUDGET_ORDER.ACCOUNT_NO = ACCOUNT.ACCOUNT_NO
      WHERE BUDGET_ORDER.BUDGET_TYPE = 'E'
      AND BUDGET_ORDER.ACTIVE_FLAG = 1
      AND BUDGET_DATA.BUDGET_YEAR = @BudgetYear
      AND BUDGET_DATA.PERIOD_TYPE = @PeriodType
      AND BUDGET_DATA.PROJECT_NO = @ProjectNo
      AND BUDGET_DATA.REV_NO = @RevNo
      @AccountNo
      GROUP BY BUDGET_DATA.BUDGET_YEAR, BUDGET_DATA.PERIOD_TYPE, BUDGET_DATA.PROJECT_NO, BUDGET_ORDER.BUDGET_ORDER_NO,
      BUDGET_ORDER.BUDGET_ORDER_NAME, BUDGET_ORDER.ACCOUNT_NO, ACCOUNT.ACCOUNT_NAME, BUDGET_ORDER.DEPT_NO, BUDGET_ORDER.PERSON_IN_CHARGE_NO, BUDGET_ORDER.COST ) AS MAX_REV

      INNER JOIN BG_T_BUDGET_DATA AS MASTER_DATA
      ON MAX_REV.BUDGET_YEAR = MASTER_DATA.BUDGET_YEAR
      AND MAX_REV.PERIOD_TYPE = MASTER_DATA.PERIOD_TYPE
      AND MAX_REV.PROJECT_NO = MASTER_DATA.PROJECT_NO
      AND MAX_REV.BUDGET_ORDER_NO = MASTER_DATA.BUDGET_ORDER_NO
      AND MAX_REV.REV_NO = MASTER_DATA.REV_NO

      LEFT OUTER JOIN BG_T_UPLOAD_DATA AS ORIGINAL_BUDGET
      ON MAX_REV.BUDGET_YEAR = ORIGINAL_BUDGET.BUDGET_YEAR
      AND ORIGINAL_BUDGET.PERIOD_TYPE = @PeriodType
      AND ORIGINAL_BUDGET.PROJECT_NO = @ProjectNo
      AND MAX_REV.BUDGET_ORDER_NO = ORIGINAL_BUDGET.BUDGET_ORDER_NO
      AND ORIGINAL_BUDGET.DATA_TYPE = 1

      LEFT OUTER JOIN BG_T_BUDGET_DATA AS ESTIMATE_BUDGET
      ON MAX_REV.BUDGET_YEAR = ESTIMATE_BUDGET.BUDGET_YEAR
      AND ESTIMATE_BUDGET.PERIOD_TYPE = @PeriodType
      AND ESTIMATE_BUDGET.PROJECT_NO = @ProjectNo
      AND MAX_REV.BUDGET_ORDER_NO = ESTIMATE_BUDGET.BUDGET_ORDER_NO
      AND MAX_REV.REV_NO = ESTIMATE_BUDGET.REV_NO

      LEFT OUTER JOIN BG_T_UPLOAD_DATA AS ACTUAL_DATA
      ON MAX_REV.BUDGET_YEAR = ACTUAL_DATA.BUDGET_YEAR
      AND ACTUAL_DATA.PERIOD_TYPE = @PeriodType
      AND ACTUAL_DATA.PROJECT_NO = @ProjectNo
      AND MAX_REV.BUDGET_ORDER_NO = ACTUAL_DATA.BUDGET_ORDER_NO
      AND ACTUAL_DATA.DATA_TYPE = 2

      WHERE
      (
      ISNULL(ORIGINAL_BUDGET.H1, 0) &lt;&gt; 0
      OR ISNULL(ORIGINAL_BUDGET.H2, 0) &lt;&gt; 0
      OR ISNULL(ACTUAL_DATA.M1, 0) &lt;&gt; 0
      OR ISNULL(ACTUAL_DATA.M2, 0) &lt;&gt; 0
      OR ISNULL(ACTUAL_DATA.M3, 0) &lt;&gt; 0
      OR ISNULL(MASTER_DATA.M4, 0) &lt;&gt; 0
      OR ISNULL(MASTER_DATA.M5, 0) &lt;&gt; 0
      OR ISNULL(MASTER_DATA.M6, 0) &lt;&gt; 0
      OR ISNULL(MASTER_DATA.M7, 0) &lt;&gt; 0
      OR ISNULL(MASTER_DATA.M8, 0) &lt;&gt; 0
      OR ISNULL(MASTER_DATA.M9, 0) &lt;&gt; 0
      OR ISNULL(MASTER_DATA.M10, 0) &lt;&gt; 0
      OR ISNULL(MASTER_DATA.M11, 0) &lt;&gt; 0
      OR ISNULL(MASTER_DATA.M12, 0) &lt;&gt; 0
      OR ISNULL(MASTER_DATA.RRT1 ,0) &lt;&gt; 0
      OR ISNULL(MASTER_DATA.RRT2 ,0) &lt;&gt; 0
      OR ISNULL(MASTER_DATA.RRT3 ,0) &lt;&gt; 0
      OR ISNULL(MASTER_DATA.RRT4 ,0) &lt;&gt; 0
      OR ISNULL(MASTER_DATA.RRT5 ,0) &lt;&gt; 0
      )
    </SELECT008_3>
    <SELECT009>
      SELECT
      MAX_REV.BUDGET_YEAR, MAX_REV.PERIOD_TYPE, MAX_REV.PROJECT_NO, '' AS BUDGET_ORDER_NO, MAX_REV.ACCOUNT_NO, MAX_REV.ACCOUNT_NAME, MAX_REV.COST, MAX_REV.EXPENSE_TYPE,
      MAX(MAX_REV.REV_NO) AS REV_NO,
      SUM(ISNULL(ACTUAL_DATA.H1,0)) AS ACTUAL_1ST_HALF,

      --SUM(ISNULL(REVISE_BUDGET.H2,0)) AS REVISE_2ND_HALF,
      SUM(ISNULL(MAX_REV.REVISE_SECOND_HALF, 0)) AS REVISE_2ND_HALF,

      SUM(ISNULL(MASTER_DATA.M1, 0)) AS M1, SUM(ISNULL(MASTER_DATA.M2, 0)) AS M2, SUM(ISNULL(MASTER_DATA.M3, 0)) AS M3, SUM(ISNULL(MASTER_DATA.M4, 0)) AS M4, SUM(ISNULL(MASTER_DATA.M5, 0)) AS M5, SUM(ISNULL(MASTER_DATA.M6, 0)) AS M6,
      SUM(ISNULL(MASTER_DATA.M7, 0)) AS M7, SUM(ISNULL(MASTER_DATA.M8, 0)) AS M8, SUM(ISNULL(MASTER_DATA.M9, 0)) AS M9, SUM(ISNULL(MASTER_DATA.M10, 0)) AS M10, SUM(ISNULL(MASTER_DATA.M11, 0)) AS M11, SUM(ISNULL(MASTER_DATA.M12, 0)) AS M12,
      SUM(ISNULL(MASTER_DATA.M1, 0) + ISNULL(MASTER_DATA.M2, 0) + ISNULL(MASTER_DATA.M3, 0) + ISNULL(MASTER_DATA.M4, 0) + ISNULL(MASTER_DATA.M5, 0) + ISNULL(MASTER_DATA.M6, 0)) AS TOTAL_1ST_HALF,
      SUM(ISNULL(MASTER_DATA.M7, 0) + ISNULL(MASTER_DATA.M8, 0) + ISNULL(MASTER_DATA.M9, 0) + ISNULL(MASTER_DATA.M10, 0) + ISNULL(MASTER_DATA.M11, 0) + ISNULL(MASTER_DATA.M12, 0)) AS TOTAL_2ND_HALF,
      SUM(ISNULL(MASTER_DATA.M1, 0) + ISNULL(MASTER_DATA.M2, 0) + ISNULL(MASTER_DATA.M3, 0) + ISNULL(MASTER_DATA.M4, 0) + ISNULL(MASTER_DATA.M5, 0) + ISNULL(MASTER_DATA.M6, 0) + ISNULL(MASTER_DATA.M7, 0) + ISNULL(MASTER_DATA.M8, 0) + ISNULL(MASTER_DATA.M9, 0) + ISNULL(MASTER_DATA.M10, 0) + ISNULL(MASTER_DATA.M11, 0) + ISNULL(MASTER_DATA.M12, 0)) AS TOTAL_YEAR
      ,SUM(ISNULL(MTP.RRT2,0)) AS MTP_RRT1

      FROM (
      SELECT BUDGET_DATA.BUDGET_ORDER_NO, BUDGET_DATA.BUDGET_YEAR, BUDGET_DATA.PERIOD_TYPE, BUDGET_DATA.PROJECT_NO,
      BUDGET_ORDER.ACCOUNT_NO, ACCOUNT.ACCOUNT_NAME,
      BUDGET_ORDER.BUDGET_TYPE, BUDGET_ORDER.EXPENSE_TYPE, BUDGET_ORDER.COST,
      MAX(BUDGET_DATA.REV_NO) AS REV_NO

      ,ISNULL((SELECT ISNULL(ISNULL(M10,0)+ISNULL(M11,0)+ISNULL(M12,0),0)
      FROM BG_T_BUDGET_DATA
      WHERE BUDGET_YEAR = (@BudgetYear-1)
      AND PERIOD_TYPE = 2
      --AND REV_NO = (SELECT MAX(REV_NO) AS REV_NO FROM BG_T_BUDGET_DATA WHERE BUDGET_YEAR = (@BudgetYear-1) AND PERIOD_TYPE = 2 AND PROJECT_NO = @ProjectNo)
      --AND PROJECT_NO = @ProjectNo
      AND REV_NO = @RefEstProjectNo
      AND PROJECT_NO = @RefEstProjectNo
      AND BUDGET_ORDER_NO = BUDGET_DATA.BUDGET_ORDER_NO),0)+
      ISNULL((SELECT ISNULL(M7,0)+ISNULL(M8,0)+ISNULL(M9,0)
      FROM BG_T_UPLOAD_DATA
      WHERE BUDGET_YEAR = (@BudgetYear-1)
      AND PERIOD_TYPE = 2
      --AND PROJECT_NO = @ProjectNo
      AND PROJECT_NO = @RefEstProjectNo
      AND DATA_TYPE = 2
      AND BUDGET_ORDER_NO = BUDGET_DATA.BUDGET_ORDER_NO),0) AS REVISE_SECOND_HALF

      FROM BG_T_BUDGET_DATA AS BUDGET_DATA
      INNER JOIN BG_M_BUDGET_ORDER AS BUDGET_ORDER
      ON BUDGET_ORDER.BUDGET_ORDER_NO = BUDGET_DATA.BUDGET_ORDER_NO
      INNER JOIN BG_M_ACCOUNT AS ACCOUNT
      ON ACCOUNT.ACCOUNT_NO = BUDGET_ORDER.ACCOUNT_NO
      WHERE BUDGET_ORDER.BUDGET_TYPE = 'E'
      AND BUDGET_ORDER.ACTIVE_FLAG = 1
      AND BUDGET_DATA.BUDGET_YEAR = @BudgetYear
      AND BUDGET_DATA.PERIOD_TYPE = @PeriodType
      AND BUDGET_DATA.PROJECT_NO = @ProjectNo
      GROUP BY BUDGET_DATA.BUDGET_ORDER_NO, BUDGET_DATA.BUDGET_YEAR, BUDGET_DATA.PERIOD_TYPE, BUDGET_DATA.PROJECT_NO,
      BUDGET_ORDER.ACCOUNT_NO, ACCOUNT.ACCOUNT_NAME, BUDGET_ORDER.BUDGET_TYPE, BUDGET_ORDER.EXPENSE_TYPE, BUDGET_ORDER.COST) AS MAX_REV

      INNER JOIN BG_T_BUDGET_DATA AS MASTER_DATA
      ON MAX_REV.BUDGET_YEAR = MASTER_DATA.BUDGET_YEAR
      AND MAX_REV.PERIOD_TYPE = MASTER_DATA.PERIOD_TYPE
      AND MAX_REV.PROJECT_NO = MASTER_DATA.PROJECT_NO
      AND MAX_REV.BUDGET_ORDER_NO = MASTER_DATA.BUDGET_ORDER_NO
      AND MAX_REV.REV_NO = MASTER_DATA.REV_NO

      LEFT OUTER JOIN BG_T_UPLOAD_DATA AS REVISE_BUDGET
      ON REVISE_BUDGET.BUDGET_YEAR = MAX_REV.BUDGET_YEAR- 1
      AND REVISE_BUDGET.PERIOD_TYPE = @PeriodType
      AND REVISE_BUDGET.PROJECT_NO = @ProjectNo
      AND REVISE_BUDGET.BUDGET_ORDER_NO = MAX_REV.BUDGET_ORDER_NO
      AND REVISE_BUDGET.DATA_TYPE = 1

      LEFT OUTER JOIN BG_T_UPLOAD_DATA AS ACTUAL_DATA
      ON ACTUAL_DATA.BUDGET_YEAR = MAX_REV.BUDGET_YEAR- 1
      AND ACTUAL_DATA.PERIOD_TYPE = @PeriodType
      AND ACTUAL_DATA.PROJECT_NO = @ProjectNo
      AND ACTUAL_DATA.BUDGET_ORDER_NO = MAX_REV.BUDGET_ORDER_NO
      AND ACTUAL_DATA.DATA_TYPE = 2

      LEFT JOIN BG_T_BUDGET_DATA AS MTP
      ON MAX_REV.BUDGET_ORDER_NO = MTP.BUDGET_ORDER_NO
      AND MTP.BUDGET_YEAR=(@BudgetYear-2)
      AND MTP.PERIOD_TYPE = 10
      AND MTP.PROJECT_NO = @MtpProjectNo
      AND MTP.REV_NO = @MtpRevNo
      --AND MTP.REV_NO = (SELECT ISNULL(MAX(REV_NO),1) AS MAX_REV_NO FROM BG_T_BUDGET_HEADER
      --WHERE BUDGET_YEAR = (@BudgetYear-1)
      --AND PERIOD_TYPE = 10 AND BUDGET_TYPE = 'E' AND PROJECT_NO = @MtpProjectNo)

      WHERE
      ( ISNULL(ACTUAL_DATA.H1,0) &lt;&gt; 0
      OR ISNULL(MAX_REV.REVISE_SECOND_HALF,0) &lt;&gt; 0
      OR ISNULL(MASTER_DATA.M1,0) &lt;&gt; 0
      OR ISNULL(MASTER_DATA.M2,0) &lt;&gt; 0
      OR ISNULL(MASTER_DATA.M3,0) &lt;&gt; 0
      OR ISNULL(MASTER_DATA.M4, 0) &lt;&gt; 0
      OR ISNULL(MASTER_DATA.M5, 0) &lt;&gt; 0
      OR ISNULL(MASTER_DATA.M6, 0) &lt;&gt; 0
      OR ISNULL(MASTER_DATA.M7, 0) &lt;&gt; 0
      OR ISNULL(MASTER_DATA.M8, 0) &lt;&gt; 0
      OR ISNULL(MASTER_DATA.M9, 0) &lt;&gt; 0
      OR ISNULL(MASTER_DATA.M10, 0) &lt;&gt; 0
      OR ISNULL(MASTER_DATA.M11, 0) &lt;&gt; 0
      OR ISNULL(MASTER_DATA.M12, 0) &lt;&gt; 0
      OR ISNULL(MTP.RRT2, 0) &lt;&gt; 0
      )

      GROUP BY MAX_REV.BUDGET_YEAR, MAX_REV.PERIOD_TYPE, MAX_REV.PROJECT_NO, MAX_REV.ACCOUNT_NO, MAX_REV.ACCOUNT_NAME, MAX_REV.EXPENSE_TYPE, MAX_REV.COST

      ORDER BY MAX_REV.COST,MAX_REV.EXPENSE_TYPE,MAX_REV.ACCOUNT_NO

    </SELECT009>
    <SELECT009_2>
      SELECT
      MAX_REV.BUDGET_YEAR, MAX_REV.PERIOD_TYPE, MAX_REV.PROJECT_NO, '' AS BUDGET_ORDER_NO, MAX_REV.ACCOUNT_NO, MAX_REV.ACCOUNT_NAME, MAX_REV.COST, MAX_REV.EXPENSE_TYPE,
      MAX(MAX_REV.REV_NO) AS REV_NO,
      SUM(ISNULL(ACTUAL_DATA.H1,0)) AS ACTUAL_1ST_HALF,

      --SUM(ISNULL(REVISE_BUDGET.H2,0)) AS REVISE_2ND_HALF,
      SUM(ISNULL(MAX_REV.REVISE_SECOND_HALF, 0)) AS REVISE_2ND_HALF,

      SUM(ISNULL(MASTER_DATA.M1, 0)) AS M1, SUM(ISNULL(MASTER_DATA.M2, 0)) AS M2, SUM(ISNULL(MASTER_DATA.M3, 0)) AS M3, SUM(ISNULL(MASTER_DATA.M4, 0)) AS M4, SUM(ISNULL(MASTER_DATA.M5, 0)) AS M5, SUM(ISNULL(MASTER_DATA.M6, 0)) AS M6,
      SUM(ISNULL(MASTER_DATA.M7, 0)) AS M7, SUM(ISNULL(MASTER_DATA.M8, 0)) AS M8, SUM(ISNULL(MASTER_DATA.M9, 0)) AS M9, SUM(ISNULL(MASTER_DATA.M10, 0)) AS M10, SUM(ISNULL(MASTER_DATA.M11, 0)) AS M11, SUM(ISNULL(MASTER_DATA.M12, 0)) AS M12,
      SUM(ISNULL(MASTER_DATA.M1, 0) + ISNULL(MASTER_DATA.M2, 0) + ISNULL(MASTER_DATA.M3, 0) + ISNULL(MASTER_DATA.M4, 0) + ISNULL(MASTER_DATA.M5, 0) + ISNULL(MASTER_DATA.M6, 0)) AS TOTAL_1ST_HALF,
      SUM(ISNULL(MASTER_DATA.M7, 0) + ISNULL(MASTER_DATA.M8, 0) + ISNULL(MASTER_DATA.M9, 0) + ISNULL(MASTER_DATA.M10, 0) + ISNULL(MASTER_DATA.M11, 0) + ISNULL(MASTER_DATA.M12, 0)) AS TOTAL_2ND_HALF,
      SUM(ISNULL(MASTER_DATA.M1, 0) + ISNULL(MASTER_DATA.M2, 0) + ISNULL(MASTER_DATA.M3, 0) + ISNULL(MASTER_DATA.M4, 0) + ISNULL(MASTER_DATA.M5, 0) + ISNULL(MASTER_DATA.M6, 0) + ISNULL(MASTER_DATA.M7, 0) + ISNULL(MASTER_DATA.M8, 0) + ISNULL(MASTER_DATA.M9, 0) + ISNULL(MASTER_DATA.M10, 0) + ISNULL(MASTER_DATA.M11, 0) + ISNULL(MASTER_DATA.M12, 0)) AS TOTAL_YEAR
      ,SUM(ISNULL(MTP.RRT2,0)) AS MTP_RRT1

      FROM (
      SELECT BUDGET_DATA.BUDGET_ORDER_NO, BUDGET_DATA.BUDGET_YEAR, BUDGET_DATA.PERIOD_TYPE, BUDGET_DATA.PROJECT_NO,
      BUDGET_ORDER.ACCOUNT_NO, ACCOUNT.ACCOUNT_NAME,
      BUDGET_ORDER.BUDGET_TYPE, BUDGET_ORDER.EXPENSE_TYPE, BUDGET_ORDER.COST,
      MAX(BUDGET_DATA.REV_NO) AS REV_NO

      ,ISNULL((SELECT ISNULL(ISNULL(M10,0)+ISNULL(M11,0)+ISNULL(M12,0),0)
      FROM BG_T_BUDGET_DATA
      WHERE BUDGET_YEAR = (@BudgetYear-1)
      AND PERIOD_TYPE = 2
      --AND REV_NO = (SELECT MAX(REV_NO) AS REV_NO FROM BG_T_BUDGET_DATA WHERE BUDGET_YEAR = (@BudgetYear-1) AND PERIOD_TYPE = 2 AND PROJECT_NO = @ProjectNo)
      --AND PROJECT_NO = @ProjectNo
      AND REV_NO = @RefEstRevNo
      AND PROJECT_NO = @RefEstProjectNo
      AND BUDGET_ORDER_NO = BUDGET_DATA.BUDGET_ORDER_NO),0)+
      ISNULL((SELECT ISNULL(M7,0)+ISNULL(M8,0)+ISNULL(M9,0)
      FROM BG_T_UPLOAD_DATA
      WHERE BUDGET_YEAR = (@BudgetYear-1)
      AND PERIOD_TYPE = 2
      --AND PROJECT_NO = @ProjectNo
      AND PROJECT_NO = @RefEstProjectNo
      AND DATA_TYPE = 2
      AND BUDGET_ORDER_NO = BUDGET_DATA.BUDGET_ORDER_NO),0) AS REVISE_SECOND_HALF

      FROM BG_T_BUDGET_DATA AS BUDGET_DATA
      INNER JOIN BG_M_BUDGET_ORDER AS BUDGET_ORDER
      ON BUDGET_ORDER.BUDGET_ORDER_NO = BUDGET_DATA.BUDGET_ORDER_NO
      INNER JOIN BG_M_ACCOUNT AS ACCOUNT
      ON ACCOUNT.ACCOUNT_NO = BUDGET_ORDER.ACCOUNT_NO
      WHERE BUDGET_ORDER.BUDGET_TYPE = 'E'
      AND BUDGET_ORDER.ACTIVE_FLAG = 1
      AND BUDGET_DATA.BUDGET_YEAR = @BudgetYear
      AND BUDGET_DATA.PERIOD_TYPE = @PeriodType
      AND BUDGET_DATA.PROJECT_NO = @ProjectNo
      AND BUDGET_DATA.REV_NO = @RevNo
      GROUP BY BUDGET_DATA.BUDGET_ORDER_NO, BUDGET_DATA.BUDGET_YEAR, BUDGET_DATA.PERIOD_TYPE, BUDGET_DATA.PROJECT_NO,
      BUDGET_ORDER.ACCOUNT_NO, ACCOUNT.ACCOUNT_NAME, BUDGET_ORDER.BUDGET_TYPE, BUDGET_ORDER.EXPENSE_TYPE, BUDGET_ORDER.COST) AS MAX_REV

      INNER JOIN BG_T_BUDGET_DATA AS MASTER_DATA
      ON MAX_REV.BUDGET_YEAR = MASTER_DATA.BUDGET_YEAR
      AND MAX_REV.PERIOD_TYPE = MASTER_DATA.PERIOD_TYPE
      AND MAX_REV.PROJECT_NO = MASTER_DATA.PROJECT_NO
      AND MAX_REV.BUDGET_ORDER_NO = MASTER_DATA.BUDGET_ORDER_NO
      AND MAX_REV.REV_NO = MASTER_DATA.REV_NO

      LEFT OUTER JOIN BG_T_UPLOAD_DATA AS REVISE_BUDGET
      ON REVISE_BUDGET.BUDGET_YEAR = MAX_REV.BUDGET_YEAR- 1
      AND REVISE_BUDGET.PERIOD_TYPE = @PeriodType
      AND REVISE_BUDGET.PROJECT_NO = @ProjectNo
      AND REVISE_BUDGET.BUDGET_ORDER_NO = MAX_REV.BUDGET_ORDER_NO
      AND REVISE_BUDGET.DATA_TYPE = 1

      LEFT OUTER JOIN BG_T_UPLOAD_DATA AS ACTUAL_DATA
      ON ACTUAL_DATA.BUDGET_YEAR = MAX_REV.BUDGET_YEAR- 1
      AND ACTUAL_DATA.PERIOD_TYPE = @PeriodType
      AND ACTUAL_DATA.PROJECT_NO = @ProjectNo
      AND ACTUAL_DATA.BUDGET_ORDER_NO = MAX_REV.BUDGET_ORDER_NO
      AND ACTUAL_DATA.DATA_TYPE = 2

      LEFT JOIN BG_T_BUDGET_DATA AS MTP
      ON MAX_REV.BUDGET_ORDER_NO = MTP.BUDGET_ORDER_NO
      AND MTP.BUDGET_YEAR=(@BudgetYear-2)
      AND MTP.PERIOD_TYPE = 10
      AND MTP.PROJECT_NO = @MtpProjectNo
      AND MTP.REV_NO = '@MtpRevNo'

      WHERE
      ( ISNULL(ACTUAL_DATA.H1,0) &lt;&gt; 0
      OR ISNULL(MAX_REV.REVISE_SECOND_HALF,0) &lt;&gt; 0
      OR ISNULL(MASTER_DATA.M1,0) &lt;&gt; 0
      OR ISNULL(MASTER_DATA.M2,0) &lt;&gt; 0
      OR ISNULL(MASTER_DATA.M3,0) &lt;&gt; 0
      OR ISNULL(MASTER_DATA.M4, 0) &lt;&gt; 0
      OR ISNULL(MASTER_DATA.M5, 0) &lt;&gt; 0
      OR ISNULL(MASTER_DATA.M6, 0) &lt;&gt; 0
      OR ISNULL(MASTER_DATA.M7, 0) &lt;&gt; 0
      OR ISNULL(MASTER_DATA.M8, 0) &lt;&gt; 0
      OR ISNULL(MASTER_DATA.M9, 0) &lt;&gt; 0
      OR ISNULL(MASTER_DATA.M10, 0) &lt;&gt; 0
      OR ISNULL(MASTER_DATA.M11, 0) &lt;&gt; 0
      OR ISNULL(MASTER_DATA.M12, 0) &lt;&gt; 0
      OR ISNULL(MTP.RRT2,0) &lt;&gt; 0
      )

      GROUP BY MAX_REV.BUDGET_YEAR, MAX_REV.PERIOD_TYPE, MAX_REV.PROJECT_NO, MAX_REV.ACCOUNT_NO, MAX_REV.ACCOUNT_NAME, MAX_REV.EXPENSE_TYPE, MAX_REV.COST

      ORDER BY MAX_REV.COST,MAX_REV.EXPENSE_TYPE,MAX_REV.ACCOUNT_NO

    </SELECT009_2>
    <SELECT010>
      SELECT
      MAX_REV.BUDGET_YEAR, MAX_REV.PERIOD_TYPE, MAX_REV.PROJECT_NO, '' AS BUDGET_ORDER_NO, MAX_REV.ACCOUNT_NO, MAX_REV.ACCOUNT_NAME, MAX_REV.COST, MAX_REV.EXPENSE_TYPE,
      MAX(MAX_REV.REV_NO) AS REV_NO,
      SUM(ISNULL(ACTUAL_DATA.H1,0)) AS ACTUAL_1ST_HALF,
      --SUM(ISNULL(REVISE_BUDGET.H2,0)) AS REVISE_BUDGET_2ND_HALF,
      SUM(ISNULL(REVISE_BUDGET.M7, 0) + ISNULL(REVISE_BUDGET.M8, 0) + ISNULL(REVISE_BUDGET.M9, 0) + ISNULL(REVISE_BUDGET.M10, 0) + ISNULL(REVISE_BUDGET.M11, 0) + ISNULL(REVISE_BUDGET.M12, 0)) AS REVISE_BUDGET_2ND_HALF,

      SUM(ISNULL(MASTER_DATA.M1,0)) AS M1,
      SUM(ISNULL(MASTER_DATA.M2,0)) AS M2,
      SUM(ISNULL(MASTER_DATA.M3,0)) AS M3,
      SUM(ISNULL(MASTER_DATA.M4,0)) AS M4,
      SUM(ISNULL(MASTER_DATA.M5,0)) AS M5,
      SUM(ISNULL(MASTER_DATA.M6,0)) AS M6,
      SUM(ISNULL(MASTER_DATA.M7,0)) AS M7,
      SUM(ISNULL(MASTER_DATA.M8,0)) AS M8,
      SUM(ISNULL(MASTER_DATA.M9,0)) AS M9,
      SUM(ISNULL(MASTER_DATA.M10,0)) AS M10,
      SUM(ISNULL(MASTER_DATA.M11,0)) AS M11,
      SUM(ISNULL(MASTER_DATA.M12,0)) AS M12,

      SUM(ISNULL(ACTUAL_DATA.M7,0))AS ACTUAL_JUL,
      SUM(ISNULL(ACTUAL_DATA.M8,0))AS ACTUAL_AUG,
      SUM(ISNULL(ACTUAL_DATA.M9,0))AS ACTUAL_SEP,

      SUM(ISNULL(MASTER_DATA.M10,0)) AS ESTIMATE_OCT,
      SUM(ISNULL(MASTER_DATA.M11,0)) AS ESTIMATE_NOV,
      SUM(ISNULL(MASTER_DATA.M12,0)) AS ESTIMATE_DEC,

      SUM(ISNULL(ACTUAL_DATA.M7,0) + ISNULL(ACTUAL_DATA.M8,0) + ISNULL(ACTUAL_DATA.M9,0) + ISNULL(MASTER_DATA.M10,0) + ISNULL(MASTER_DATA.M11,0)+ ISNULL(MASTER_DATA.M12,0)) AS ESTIMATE_BUDGET_2ND_HALF,

      0.0 AS DIFFERENCE_2ND_HALF,
      0.0 AS ESTIMATE_BUDGET_TOTAL

      FROM (
      SELECT BUDGET_DATA.BUDGET_ORDER_NO, BUDGET_DATA.BUDGET_YEAR, BUDGET_DATA.PERIOD_TYPE, BUDGET_DATA.PROJECT_NO,
      BUDGET_ORDER.ACCOUNT_NO, ACCOUNT.ACCOUNT_NAME,
      BUDGET_ORDER.BUDGET_TYPE, BUDGET_ORDER.EXPENSE_TYPE, BUDGET_ORDER.COST,
      MAX(BUDGET_DATA.REV_NO) AS REV_NO
      FROM BG_T_BUDGET_DATA AS BUDGET_DATA
      INNER JOIN BG_M_BUDGET_ORDER AS BUDGET_ORDER
      ON BUDGET_ORDER.BUDGET_ORDER_NO = BUDGET_DATA.BUDGET_ORDER_NO
      INNER JOIN BG_M_ACCOUNT AS ACCOUNT
      ON ACCOUNT.ACCOUNT_NO = BUDGET_ORDER.ACCOUNT_NO
      WHERE BUDGET_ORDER.BUDGET_TYPE = 'E'
      AND BUDGET_ORDER.ACTIVE_FLAG = 1
      AND BUDGET_DATA.BUDGET_YEAR = @BudgetYear
      AND BUDGET_DATA.PERIOD_TYPE = @PeriodType
      AND BUDGET_DATA.PROJECT_NO = @ProjectNo
      GROUP BY BUDGET_DATA.BUDGET_ORDER_NO, BUDGET_DATA.BUDGET_YEAR, BUDGET_DATA.PERIOD_TYPE, BUDGET_DATA.PROJECT_NO,
      BUDGET_ORDER.ACCOUNT_NO, ACCOUNT.ACCOUNT_NAME, BUDGET_ORDER.BUDGET_TYPE, BUDGET_ORDER.EXPENSE_TYPE, BUDGET_ORDER.COST) AS MAX_REV

      INNER JOIN BG_T_BUDGET_DATA AS MASTER_DATA
      ON MAX_REV.BUDGET_YEAR = MASTER_DATA.BUDGET_YEAR
      AND MAX_REV.PERIOD_TYPE = MASTER_DATA.PERIOD_TYPE
      AND MAX_REV.PROJECT_NO = MASTER_DATA.PROJECT_NO
      AND MAX_REV.BUDGET_ORDER_NO = MASTER_DATA.BUDGET_ORDER_NO
      AND MAX_REV.REV_NO = MASTER_DATA.REV_NO

      ---- change Revise to OB 02/05/2018
      --LEFT OUTER JOIN BG_T_UPLOAD_DATA AS REVISE_BUDGET
      --ON REVISE_BUDGET.BUDGET_YEAR = MAX_REV.BUDGET_YEAR
      ---- AND REVISE_BUDGET.PERIOD_TYPE = @PeriodType
      --AND REVISE_BUDGET.PERIOD_TYPE = @REFPERIOD
      --AND REVISE_BUDGET.PROJECT_NO = @ProjectNo
      --AND REVISE_BUDGET.BUDGET_ORDER_NO = MAX_REV.BUDGET_ORDER_NO
      --AND REVISE_BUDGET.DATA_TYPE = 1

      LEFT JOIN BG_T_BUDGET_DATA AS REVISE_BUDGET
      ON  REVISE_BUDGET.BUDGET_YEAR =  MAX_REV.BUDGET_YEAR
      AND REVISE_BUDGET.PERIOD_TYPE = 1
      AND REVISE_BUDGET.PROJECT_NO = MAX_REV.PROJECT_NO
      AND REVISE_BUDGET.BUDGET_ORDER_NO = MAX_REV.BUDGET_ORDER_NO
      AND REVISE_BUDGET.REV_NO = MAX_REV.REV_NO

      LEFT OUTER JOIN BG_T_UPLOAD_DATA AS ACTUAL_DATA
      ON ACTUAL_DATA.BUDGET_YEAR = MAX_REV.BUDGET_YEAR
      AND ACTUAL_DATA.PERIOD_TYPE = @PeriodType
      AND ACTUAL_DATA.PROJECT_NO = @ProjectNo
      AND ACTUAL_DATA.BUDGET_ORDER_NO = MAX_REV.BUDGET_ORDER_NO
      AND ACTUAL_DATA.DATA_TYPE = 2

      WHERE
      ( ISNULL(ACTUAL_DATA.H1,0) &lt;&gt; 0
      OR ISNULL(REVISE_BUDGET.M7,0) &lt;&gt; 0
      OR ISNULL(REVISE_BUDGET.M8,0) &lt;&gt; 0
      OR ISNULL(REVISE_BUDGET.M9,0) &lt;&gt; 0
      OR ISNULL(REVISE_BUDGET.M10,0) &lt;&gt; 0
      OR ISNULL(REVISE_BUDGET.M11,0) &lt;&gt; 0
      OR ISNULL(REVISE_BUDGET.M12,0) &lt;&gt; 0
      OR ISNULL(ACTUAL_DATA.M7,0) &lt;&gt; 0
      OR ISNULL(ACTUAL_DATA.M8,0) &lt;&gt; 0
      OR ISNULL(ACTUAL_DATA.M9,0) &lt;&gt; 0
      OR ISNULL(MASTER_DATA.M10, 0) &lt;&gt; 0
      OR ISNULL(MASTER_DATA.M11, 0) &lt;&gt; 0
      OR ISNULL(MASTER_DATA.M12, 0) &lt;&gt; 0
      )
      GROUP BY MAX_REV.BUDGET_YEAR, MAX_REV.PERIOD_TYPE, MAX_REV.PROJECT_NO, MAX_REV.ACCOUNT_NO, MAX_REV.ACCOUNT_NAME, MAX_REV.EXPENSE_TYPE, MAX_REV.COST

      ORDER BY MAX_REV.COST, MAX_REV.EXPENSE_TYPE, MAX_REV.ACCOUNT_NO

    </SELECT010>
    <SELECT010_2>
      SELECT
      MAX_REV.BUDGET_YEAR, MAX_REV.PERIOD_TYPE, MAX_REV.PROJECT_NO, '' AS BUDGET_ORDER_NO, MAX_REV.ACCOUNT_NO, MAX_REV.ACCOUNT_NAME, MAX_REV.COST, MAX_REV.EXPENSE_TYPE,
      MAX(MAX_REV.REV_NO) AS REV_NO,
      SUM(ISNULL(ACTUAL_DATA.H1,0)) AS ACTUAL_1ST_HALF,
      --SUM(ISNULL(REVISE_BUDGET.H2,0)) AS REVISE_BUDGET_2ND_HALF,
      SUM(ISNULL(REVISE_BUDGET.M7, 0) + ISNULL(REVISE_BUDGET.M8, 0) + ISNULL(REVISE_BUDGET.M9, 0) + ISNULL(REVISE_BUDGET.M10, 0) + ISNULL(REVISE_BUDGET.M11, 0) + ISNULL(REVISE_BUDGET.M12, 0)) AS REVISE_BUDGET_2ND_HALF,

      SUM(ISNULL(MASTER_DATA.M1,0)) AS M1,
      SUM(ISNULL(MASTER_DATA.M2,0)) AS M2,
      SUM(ISNULL(MASTER_DATA.M3,0)) AS M3,
      SUM(ISNULL(MASTER_DATA.M4,0)) AS M4,
      SUM(ISNULL(MASTER_DATA.M5,0)) AS M5,
      SUM(ISNULL(MASTER_DATA.M6,0)) AS M6,
      SUM(ISNULL(MASTER_DATA.M7,0)) AS M7,
      SUM(ISNULL(MASTER_DATA.M8,0)) AS M8,
      SUM(ISNULL(MASTER_DATA.M9,0)) AS M9,
      SUM(ISNULL(MASTER_DATA.M10,0)) AS M10,
      SUM(ISNULL(MASTER_DATA.M11,0)) AS M11,
      SUM(ISNULL(MASTER_DATA.M12,0)) AS M12,

      SUM(ISNULL(ACTUAL_DATA.M7,0))AS ACTUAL_JUL,
      SUM(ISNULL(ACTUAL_DATA.M8,0))AS ACTUAL_AUG,
      SUM(ISNULL(ACTUAL_DATA.M9,0))AS ACTUAL_SEP,

      SUM(ISNULL(MASTER_DATA.M10,0)) AS ESTIMATE_OCT,
      SUM(ISNULL(MASTER_DATA.M11,0)) AS ESTIMATE_NOV,
      SUM(ISNULL(MASTER_DATA.M12,0)) AS ESTIMATE_DEC,

      SUM(ISNULL(ACTUAL_DATA.M7,0) + ISNULL(ACTUAL_DATA.M8,0) + ISNULL(ACTUAL_DATA.M9,0) + ISNULL(MASTER_DATA.M10,0) + ISNULL(MASTER_DATA.M11,0)+ ISNULL(MASTER_DATA.M12,0)) AS ESTIMATE_BUDGET_2ND_HALF,

      0.0 AS DIFFERENCE_2ND_HALF,
      0.0 AS ESTIMATE_BUDGET_TOTAL

      FROM (
      SELECT BUDGET_DATA.BUDGET_ORDER_NO, BUDGET_DATA.BUDGET_YEAR, BUDGET_DATA.PERIOD_TYPE, BUDGET_DATA.PROJECT_NO,
      BUDGET_ORDER.ACCOUNT_NO, ACCOUNT.ACCOUNT_NAME,
      BUDGET_ORDER.BUDGET_TYPE, BUDGET_ORDER.EXPENSE_TYPE, BUDGET_ORDER.COST,
      MAX(BUDGET_DATA.REV_NO) AS REV_NO
      FROM BG_T_BUDGET_DATA AS BUDGET_DATA
      INNER JOIN BG_M_BUDGET_ORDER AS BUDGET_ORDER
      ON BUDGET_ORDER.BUDGET_ORDER_NO = BUDGET_DATA.BUDGET_ORDER_NO
      INNER JOIN BG_M_ACCOUNT AS ACCOUNT
      ON ACCOUNT.ACCOUNT_NO = BUDGET_ORDER.ACCOUNT_NO
      WHERE BUDGET_ORDER.BUDGET_TYPE = 'E'
      AND BUDGET_ORDER.ACTIVE_FLAG = 1
      AND BUDGET_DATA.BUDGET_YEAR = @BudgetYear
      AND BUDGET_DATA.PERIOD_TYPE = @PeriodType
      AND BUDGET_DATA.PROJECT_NO = @ProjectNo
      AND BUDGET_DATA.REV_NO = @RevNo
      GROUP BY BUDGET_DATA.BUDGET_ORDER_NO, BUDGET_DATA.BUDGET_YEAR, BUDGET_DATA.PERIOD_TYPE, BUDGET_DATA.PROJECT_NO,
      BUDGET_ORDER.ACCOUNT_NO, ACCOUNT.ACCOUNT_NAME, BUDGET_ORDER.BUDGET_TYPE, BUDGET_ORDER.EXPENSE_TYPE, BUDGET_ORDER.COST) AS MAX_REV

      INNER JOIN BG_T_BUDGET_DATA AS MASTER_DATA
      ON MAX_REV.BUDGET_YEAR = MASTER_DATA.BUDGET_YEAR
      AND MAX_REV.PERIOD_TYPE = MASTER_DATA.PERIOD_TYPE
      AND MAX_REV.PROJECT_NO = MASTER_DATA.PROJECT_NO
      AND MAX_REV.BUDGET_ORDER_NO = MASTER_DATA.BUDGET_ORDER_NO
      AND MAX_REV.REV_NO = MASTER_DATA.REV_NO

      ---- change Revise to OB 02/05/2018
      --LEFT OUTER JOIN BG_T_UPLOAD_DATA AS REVISE_BUDGET
      --ON REVISE_BUDGET.BUDGET_YEAR = MAX_REV.BUDGET_YEAR
      ---- AND REVISE_BUDGET.PERIOD_TYPE = 2
      --AND REVISE_BUDGET.PERIOD_TYPE = 1
      --AND REVISE_BUDGET.PROJECT_NO = 1
      --AND REVISE_BUDGET.BUDGET_ORDER_NO = MAX_REV.BUDGET_ORDER_NO
      --AND REVISE_BUDGET.DATA_TYPE = 1

      LEFT JOIN BG_T_BUDGET_DATA AS REVISE_BUDGET
      ON  REVISE_BUDGET.BUDGET_YEAR =  MAX_REV.BUDGET_YEAR
      AND REVISE_BUDGET.PERIOD_TYPE = 1
      AND REVISE_BUDGET.PROJECT_NO = MAX_REV.PROJECT_NO
      AND REVISE_BUDGET.BUDGET_ORDER_NO = MAX_REV.BUDGET_ORDER_NO
      AND REVISE_BUDGET.REV_NO = MAX_REV.REV_NO

      LEFT OUTER JOIN BG_T_UPLOAD_DATA AS ACTUAL_DATA
      ON ACTUAL_DATA.BUDGET_YEAR = MAX_REV.BUDGET_YEAR
      AND ACTUAL_DATA.PERIOD_TYPE = @PeriodType
      AND ACTUAL_DATA.PROJECT_NO = @ProjectNo
      AND ACTUAL_DATA.BUDGET_ORDER_NO = MAX_REV.BUDGET_ORDER_NO
      AND ACTUAL_DATA.DATA_TYPE = 2

      WHERE
      ( ISNULL(ACTUAL_DATA.H1,0) &lt;&gt; 0
      OR ISNULL(REVISE_BUDGET.M7,0) &lt;&gt; 0
      OR ISNULL(REVISE_BUDGET.M8,0) &lt;&gt; 0
      OR ISNULL(REVISE_BUDGET.M9,0) &lt;&gt; 0
      OR ISNULL(REVISE_BUDGET.M10,0) &lt;&gt; 0
      OR ISNULL(REVISE_BUDGET.M11,0) &lt;&gt; 0
      OR ISNULL(REVISE_BUDGET.M12,0) &lt;&gt; 0
      OR ISNULL(ACTUAL_DATA.M7,0) &lt;&gt; 0
      OR ISNULL(ACTUAL_DATA.M8,0) &lt;&gt; 0
      OR ISNULL(ACTUAL_DATA.M9,0) &lt;&gt; 0
      OR ISNULL(MASTER_DATA.M10, 0) &lt;&gt; 0
      OR ISNULL(MASTER_DATA.M11, 0) &lt;&gt; 0
      OR ISNULL(MASTER_DATA.M12, 0) &lt;&gt; 0
      )
      GROUP BY MAX_REV.BUDGET_YEAR, MAX_REV.PERIOD_TYPE, MAX_REV.PROJECT_NO, MAX_REV.ACCOUNT_NO, MAX_REV.ACCOUNT_NAME, MAX_REV.EXPENSE_TYPE, MAX_REV.COST

      ORDER BY MAX_REV.COST, MAX_REV.EXPENSE_TYPE, MAX_REV.ACCOUNT_NO

    </SELECT010_2>
    <SELECT011>
      SELECT
      MAX_REV.BUDGET_YEAR, MAX_REV.PERIOD_TYPE, MAX_REV.PROJECT_NO, '' AS BUDGET_ORDER_NO, MAX_REV.ACCOUNT_NO, MAX_REV.ACCOUNT_NAME, MAX_REV.EXPENSE_TYPE, MAX_REV.COST,
      MAX(MAX_REV.REV_NO) AS REV_NO,
      SUM(ISNULL(MASTER_DATA.M1, 0)) AS M1,
      SUM(ISNULL(MASTER_DATA.M2, 0)) AS M2,
      SUM(ISNULL(MASTER_DATA.M3, 0)) AS M3,
      SUM(ISNULL(MASTER_DATA.M4, 0)) AS M4,
      SUM(ISNULL(MASTER_DATA.M5, 0)) AS M5,
      SUM(ISNULL(MASTER_DATA.M6, 0)) AS M6,
      SUM(ISNULL(MASTER_DATA.M7, 0)) AS M7,
      SUM(ISNULL(MASTER_DATA.M8, 0)) AS M8,
      SUM(ISNULL(MASTER_DATA.M9, 0)) AS M9,
      SUM(ISNULL(MASTER_DATA.M10, 0)) AS M10,
      SUM(ISNULL(MASTER_DATA.M11, 0)) AS M11,
      SUM(ISNULL(MASTER_DATA.M12, 0)) AS M12,

      SUM(ISNULL(ORIGINAL_BUDGET.H1,0)) AS ORIGINAL_1ST_HALF,

      SUM(ISNULL(ACTUAL_DATA.M1,0)) AS ACTUAL_JAN,
      SUM(ISNULL(ACTUAL_DATA.M2,0)) AS ACTUAL_FEB,
      SUM(ISNULL(ACTUAL_DATA.M3,0)) AS ACTUAL_MAR,

      SUM(ISNULL(ESTIMATE_BUDGET.M4,0)) AS ESTIMATE_APR,
      SUM(ISNULL(ESTIMATE_BUDGET.M5,0)) AS ESTIMATE_MAY,
      SUM(ISNULL(ESTIMATE_BUDGET.M6,0)) AS ESTIMATE_JUN,

      SUM(ISNULL(ACTUAL_DATA.M1,0) + ISNULL(ACTUAL_DATA.M2,0) + ISNULL(ACTUAL_DATA.M3,0) + ISNULL(ESTIMATE_BUDGET.M4,0) + ISNULL(ESTIMATE_BUDGET.M5,0) + ISNULL(ESTIMATE_BUDGET.M6,0)) AS ESTIMATE_1ST_HALF,

      SUM(ISNULL(ORIGINAL_BUDGET.H2,0)) AS ORIGINAL_2ND_HALF,

      SUM(ISNULL(MASTER_DATA.RRT1 ,0)) AS RRT1,
      SUM(ISNULL(MASTER_DATA.RRT2 ,0)) AS RRT2,
      SUM(ISNULL(MASTER_DATA.RRT3 ,0)) AS RRT3,
      SUM(ISNULL(MASTER_DATA.RRT4 ,0)) AS RRT4,
      SUM(ISNULL(MASTER_DATA.RRT5 ,0)) AS RRT5

      FROM (
      SELECT BUDGET_DATA.BUDGET_ORDER_NO, BUDGET_DATA.BUDGET_YEAR, BUDGET_DATA.PERIOD_TYPE, BUDGET_DATA.PROJECT_NO,
      BUDGET_ORDER.ACCOUNT_NO, ACCOUNT.ACCOUNT_NAME,
      BUDGET_ORDER.BUDGET_TYPE, BUDGET_ORDER.EXPENSE_TYPE, BUDGET_ORDER.COST,
      MAX(BUDGET_DATA.REV_NO) AS REV_NO
      FROM BG_T_BUDGET_DATA AS BUDGET_DATA
      INNER JOIN BG_M_BUDGET_ORDER AS BUDGET_ORDER
      ON BUDGET_ORDER.BUDGET_ORDER_NO = BUDGET_DATA.BUDGET_ORDER_NO
      INNER JOIN BG_M_ACCOUNT AS ACCOUNT
      ON ACCOUNT.ACCOUNT_NO = BUDGET_ORDER.ACCOUNT_NO
      WHERE BUDGET_ORDER.BUDGET_TYPE = 'E'
      AND BUDGET_ORDER.ACTIVE_FLAG = 1
      AND BUDGET_DATA.BUDGET_YEAR = @BudgetYear
      AND BUDGET_DATA.PERIOD_TYPE = @PeriodType
      AND BUDGET_DATA.PROJECT_NO = @ProjectNo

      GROUP BY BUDGET_DATA.BUDGET_ORDER_NO, BUDGET_DATA.BUDGET_YEAR, BUDGET_DATA.PERIOD_TYPE, BUDGET_DATA.PROJECT_NO,
      BUDGET_ORDER.ACCOUNT_NO, ACCOUNT.ACCOUNT_NAME,
      BUDGET_ORDER.BUDGET_TYPE, BUDGET_ORDER.EXPENSE_TYPE, BUDGET_ORDER.COST) AS MAX_REV

      INNER JOIN BG_T_BUDGET_DATA AS MASTER_DATA
      ON MAX_REV.BUDGET_YEAR = MASTER_DATA.BUDGET_YEAR
      AND MAX_REV.PERIOD_TYPE = MASTER_DATA.PERIOD_TYPE
      AND MAX_REV.PROJECT_NO = MASTER_DATA.PROJECT_NO
      AND MAX_REV.BUDGET_ORDER_NO = MASTER_DATA.BUDGET_ORDER_NO
      AND MAX_REV.REV_NO = MASTER_DATA.REV_NO

      LEFT OUTER JOIN BG_T_UPLOAD_DATA AS ORIGINAL_BUDGET
      ON MAX_REV.BUDGET_YEAR = ORIGINAL_BUDGET.BUDGET_YEAR
      AND ORIGINAL_BUDGET.PERIOD_TYPE = @PeriodType
      AND ORIGINAL_BUDGET.PROJECT_NO = @ProjectNo
      AND MAX_REV.BUDGET_ORDER_NO = ORIGINAL_BUDGET.BUDGET_ORDER_NO
      AND ORIGINAL_BUDGET.DATA_TYPE = 1

      LEFT OUTER JOIN BG_T_BUDGET_DATA AS ESTIMATE_BUDGET
      ON MAX_REV.BUDGET_YEAR = ESTIMATE_BUDGET.BUDGET_YEAR
      AND ESTIMATE_BUDGET.PERIOD_TYPE = @PeriodType
      AND ESTIMATE_BUDGET.PROJECT_NO = @ProjectNo
      AND MAX_REV.BUDGET_ORDER_NO = ESTIMATE_BUDGET.BUDGET_ORDER_NO
      AND MAX_REV.REV_NO = ESTIMATE_BUDGET.REV_NO

      LEFT OUTER JOIN BG_T_UPLOAD_DATA AS ACTUAL_DATA
      ON MAX_REV.BUDGET_YEAR = ACTUAL_DATA.BUDGET_YEAR
      AND ACTUAL_DATA.PERIOD_TYPE = @PeriodType
      AND ACTUAL_DATA.PROJECT_NO = @ProjectNo
      AND MAX_REV.BUDGET_ORDER_NO = ACTUAL_DATA.BUDGET_ORDER_NO
      AND ACTUAL_DATA.DATA_TYPE = 2

      WHERE
      ( ISNULL(ORIGINAL_BUDGET.H1, 0) &lt;&gt; 0
      OR ISNULL(ORIGINAL_BUDGET.H2, 0) &lt;&gt; 0
      OR ISNULL(ACTUAL_DATA.H1,0) &lt;&gt; 0
      OR ISNULL(ACTUAL_DATA.H2,0) &lt;&gt; 0
      OR ISNULL(ACTUAL_DATA.M1,0) &lt;&gt; 0
      OR ISNULL(ACTUAL_DATA.M2,0) &lt;&gt; 0
      OR ISNULL(ACTUAL_DATA.M3,0) &lt;&gt; 0
      OR ISNULL(MASTER_DATA.M4, 0) &lt;&gt; 0
      OR ISNULL(MASTER_DATA.M5, 0) &lt;&gt; 0
      OR ISNULL(MASTER_DATA.M6, 0) &lt;&gt; 0
      OR ISNULL(MASTER_DATA.M7, 0) &lt;&gt; 0
      OR ISNULL(MASTER_DATA.M8, 0) &lt;&gt; 0
      OR ISNULL(MASTER_DATA.M9, 0) &lt;&gt; 0
      OR ISNULL(MASTER_DATA.M10, 0) &lt;&gt; 0
      OR ISNULL(MASTER_DATA.M11, 0) &lt;&gt; 0
      OR ISNULL(MASTER_DATA.M12, 0) &lt;&gt; 0
      OR ISNULL(MASTER_DATA.RRT1 ,0) &lt;&gt; 0
      OR ISNULL(MASTER_DATA.RRT2 ,0) &lt;&gt; 0
      OR ISNULL(MASTER_DATA.RRT3 ,0) &lt;&gt; 0
      OR ISNULL(MASTER_DATA.RRT4 ,0) &lt;&gt; 0
      OR ISNULL(MASTER_DATA.RRT5 ,0) &lt;&gt; 0
      )
      GROUP BY MAX_REV.BUDGET_YEAR, MAX_REV.PERIOD_TYPE, MAX_REV.PROJECT_NO, MAX_REV.ACCOUNT_NO, MAX_REV.ACCOUNT_NAME, MAX_REV.EXPENSE_TYPE, MAX_REV.COST
      ORDER BY MAX_REV.COST, MAX_REV.EXPENSE_TYPE, MAX_REV.ACCOUNT_NO
    </SELECT011>
    <SELECT011_2>
      SELECT
      MAX_REV.BUDGET_YEAR, MAX_REV.PERIOD_TYPE, MAX_REV.PROJECT_NO, '' AS BUDGET_ORDER_NO, MAX_REV.ACCOUNT_NO, MAX_REV.ACCOUNT_NAME, MAX_REV.EXPENSE_TYPE, MAX_REV.COST,
      MAX(MAX_REV.REV_NO) AS REV_NO,
      SUM(ISNULL(MASTER_DATA.M1, 0)) AS M1,
      SUM(ISNULL(MASTER_DATA.M2, 0)) AS M2,
      SUM(ISNULL(MASTER_DATA.M3, 0)) AS M3,
      SUM(ISNULL(MASTER_DATA.M4, 0)) AS M4,
      SUM(ISNULL(MASTER_DATA.M5, 0)) AS M5,
      SUM(ISNULL(MASTER_DATA.M6, 0)) AS M6,
      SUM(ISNULL(MASTER_DATA.M7, 0)) AS M7,
      SUM(ISNULL(MASTER_DATA.M8, 0)) AS M8,
      SUM(ISNULL(MASTER_DATA.M9, 0)) AS M9,
      SUM(ISNULL(MASTER_DATA.M10, 0)) AS M10,
      SUM(ISNULL(MASTER_DATA.M11, 0)) AS M11,
      SUM(ISNULL(MASTER_DATA.M12, 0)) AS M12,

      SUM(ISNULL(ORIGINAL_BUDGET.H1,0)) AS ORIGINAL_1ST_HALF,

      SUM(ISNULL(ACTUAL_DATA.M1,0)) AS ACTUAL_JAN,
      SUM(ISNULL(ACTUAL_DATA.M2,0)) AS ACTUAL_FEB,
      SUM(ISNULL(ACTUAL_DATA.M3,0)) AS ACTUAL_MAR,

      SUM(ISNULL(ESTIMATE_BUDGET.M4,0)) AS ESTIMATE_APR,
      SUM(ISNULL(ESTIMATE_BUDGET.M5,0)) AS ESTIMATE_MAY,
      SUM(ISNULL(ESTIMATE_BUDGET.M6,0)) AS ESTIMATE_JUN,

      SUM(ISNULL(ACTUAL_DATA.M1,0) + ISNULL(ACTUAL_DATA.M2,0) + ISNULL(ACTUAL_DATA.M3,0) + ISNULL(ESTIMATE_BUDGET.M4,0) + ISNULL(ESTIMATE_BUDGET.M5,0) + ISNULL(ESTIMATE_BUDGET.M6,0)) AS ESTIMATE_1ST_HALF,

      SUM(ISNULL(ORIGINAL_BUDGET.H2,0)) AS ORIGINAL_2ND_HALF,

      SUM(ISNULL(MASTER_DATA.RRT1 ,0)) AS RRT1,
      SUM(ISNULL(MASTER_DATA.RRT2 ,0)) AS RRT2,
      SUM(ISNULL(MASTER_DATA.RRT3 ,0)) AS RRT3,
      SUM(ISNULL(MASTER_DATA.RRT4 ,0)) AS RRT4,
      SUM(ISNULL(MASTER_DATA.RRT5 ,0)) AS RRT5

      FROM (
      SELECT BUDGET_DATA.BUDGET_ORDER_NO, BUDGET_DATA.BUDGET_YEAR, BUDGET_DATA.PERIOD_TYPE, BUDGET_DATA.PROJECT_NO,
      BUDGET_ORDER.ACCOUNT_NO, ACCOUNT.ACCOUNT_NAME,
      BUDGET_ORDER.BUDGET_TYPE, BUDGET_ORDER.EXPENSE_TYPE, BUDGET_ORDER.COST,
      MAX(BUDGET_DATA.REV_NO) AS REV_NO
      FROM BG_T_BUDGET_DATA AS BUDGET_DATA
      INNER JOIN BG_M_BUDGET_ORDER AS BUDGET_ORDER
      ON BUDGET_ORDER.BUDGET_ORDER_NO = BUDGET_DATA.BUDGET_ORDER_NO
      INNER JOIN BG_M_ACCOUNT AS ACCOUNT
      ON ACCOUNT.ACCOUNT_NO = BUDGET_ORDER.ACCOUNT_NO
      WHERE BUDGET_ORDER.BUDGET_TYPE = 'E'
      AND BUDGET_ORDER.ACTIVE_FLAG = 1
      AND BUDGET_DATA.BUDGET_YEAR = @BudgetYear
      AND BUDGET_DATA.PERIOD_TYPE = @PeriodType
      AND BUDGET_DATA.PROJECT_NO = @ProjectNo
      AND BUDGET_DATA.REV_NO = @RevNo

      GROUP BY BUDGET_DATA.BUDGET_ORDER_NO, BUDGET_DATA.BUDGET_YEAR, BUDGET_DATA.PERIOD_TYPE, BUDGET_DATA.PROJECT_NO,
      BUDGET_ORDER.ACCOUNT_NO, ACCOUNT.ACCOUNT_NAME,
      BUDGET_ORDER.BUDGET_TYPE, BUDGET_ORDER.EXPENSE_TYPE, BUDGET_ORDER.COST) AS MAX_REV

      INNER JOIN BG_T_BUDGET_DATA AS MASTER_DATA
      ON MAX_REV.BUDGET_YEAR = MASTER_DATA.BUDGET_YEAR
      AND MAX_REV.PERIOD_TYPE = MASTER_DATA.PERIOD_TYPE
      AND MAX_REV.PROJECT_NO = MASTER_DATA.PROJECT_NO
      AND MAX_REV.BUDGET_ORDER_NO = MASTER_DATA.BUDGET_ORDER_NO
      AND MAX_REV.REV_NO = MASTER_DATA.REV_NO

      LEFT OUTER JOIN BG_T_UPLOAD_DATA AS ORIGINAL_BUDGET
      ON MAX_REV.BUDGET_YEAR = ORIGINAL_BUDGET.BUDGET_YEAR
      AND ORIGINAL_BUDGET.PERIOD_TYPE = @PeriodType
      AND ORIGINAL_BUDGET.PROJECT_NO = @ProjectNo
      AND MAX_REV.BUDGET_ORDER_NO = ORIGINAL_BUDGET.BUDGET_ORDER_NO
      AND ORIGINAL_BUDGET.DATA_TYPE = 1

      LEFT OUTER JOIN BG_T_BUDGET_DATA AS ESTIMATE_BUDGET
      ON MAX_REV.BUDGET_YEAR = ESTIMATE_BUDGET.BUDGET_YEAR
      AND ESTIMATE_BUDGET.PERIOD_TYPE = @PeriodType
      AND ESTIMATE_BUDGET.PROJECT_NO = @ProjectNo
      AND MAX_REV.BUDGET_ORDER_NO = ESTIMATE_BUDGET.BUDGET_ORDER_NO
      AND MAX_REV.REV_NO = ESTIMATE_BUDGET.REV_NO

      LEFT OUTER JOIN BG_T_UPLOAD_DATA AS ACTUAL_DATA
      ON MAX_REV.BUDGET_YEAR = ACTUAL_DATA.BUDGET_YEAR
      AND ACTUAL_DATA.PERIOD_TYPE = @PeriodType
      AND ACTUAL_DATA.PROJECT_NO = @ProjectNo
      AND MAX_REV.BUDGET_ORDER_NO = ACTUAL_DATA.BUDGET_ORDER_NO
      AND ACTUAL_DATA.DATA_TYPE = 2

      WHERE
      ( ISNULL(ORIGINAL_BUDGET.H1, 0) &lt;&gt; 0
      OR ISNULL(ORIGINAL_BUDGET.H2, 0) &lt;&gt; 0
      OR ISNULL(ACTUAL_DATA.H1,0) &lt;&gt; 0
      OR ISNULL(ACTUAL_DATA.H2,0) &lt;&gt; 0
      OR ISNULL(ACTUAL_DATA.M1,0) &lt;&gt; 0
      OR ISNULL(ACTUAL_DATA.M2,0) &lt;&gt; 0
      OR ISNULL(ACTUAL_DATA.M3,0) &lt;&gt; 0
      OR ISNULL(MASTER_DATA.M4, 0) &lt;&gt; 0
      OR ISNULL(MASTER_DATA.M5, 0) &lt;&gt; 0
      OR ISNULL(MASTER_DATA.M6, 0) &lt;&gt; 0
      OR ISNULL(MASTER_DATA.M7, 0) &lt;&gt; 0
      OR ISNULL(MASTER_DATA.M8, 0) &lt;&gt; 0
      OR ISNULL(MASTER_DATA.M9, 0) &lt;&gt; 0
      OR ISNULL(MASTER_DATA.M10, 0) &lt;&gt; 0
      OR ISNULL(MASTER_DATA.M11, 0) &lt;&gt; 0
      OR ISNULL(MASTER_DATA.M12, 0) &lt;&gt; 0
      OR ISNULL(MASTER_DATA.RRT1 ,0) &lt;&gt; 0
      OR ISNULL(MASTER_DATA.RRT2 ,0) &lt;&gt; 0
      OR ISNULL(MASTER_DATA.RRT3 ,0) &lt;&gt; 0
      OR ISNULL(MASTER_DATA.RRT4 ,0) &lt;&gt; 0
      OR ISNULL(MASTER_DATA.RRT5 ,0) &lt;&gt; 0
      )
      GROUP BY MAX_REV.BUDGET_YEAR, MAX_REV.PERIOD_TYPE, MAX_REV.PROJECT_NO, MAX_REV.ACCOUNT_NO, MAX_REV.ACCOUNT_NAME, MAX_REV.EXPENSE_TYPE, MAX_REV.COST
      ORDER BY MAX_REV.COST, MAX_REV.EXPENSE_TYPE, MAX_REV.ACCOUNT_NO
    </SELECT011_2>
    <SELECT012_1>
      SELECT MAX_REV.ASSET_PROJECT, MAX_REV.ASSET_PROJECT_TXT AS ASSET_PROJECT_NAME,
      MAX_REV.ASSET_CATEGORY, MAX_REV.ASSET_CATEGORY_TXT AS ASSET_CATEGORY_NAME, MAX_REV.ASSET_GROUP_NO, MAX_REV.ASSET_GROUP_NAME,
      MAX_REV.BUDGET_ORDER_NO, MAX_REV.BUDGET_ORDER_NAME, MAX_REV.COST_CENTER, MAX_REV.PERSON_IN_CHARGE_NO,
      ISNULL(ACTUAL_DATA.H1, 0) AS ACTUAL_FIRST_HALF,

      --ISNULL(REVISE_DATA.H2, 0) AS REVISE_SECOND_HALF,
      ISNULL(MAX_REV.REVISE_SECOND_HALF, 0) AS REVISE_SECOND_HALF,

      ISNULL(MASTER_DATA.M1, 0) AS M1, ISNULL(MASTER_DATA.M2, 0) AS M2, ISNULL(MASTER_DATA.M3, 0) AS M3,
      ISNULL(MASTER_DATA.M4, 0) AS M4, ISNULL(MASTER_DATA.M5, 0) AS M5, ISNULL(MASTER_DATA.M6, 0) AS M6,
      (ISNULL(MASTER_DATA.M1, 0) + ISNULL(MASTER_DATA.M2, 0) + ISNULL(MASTER_DATA.M3, 0) + ISNULL(MASTER_DATA.M4, 0) + ISNULL(MASTER_DATA.M5,0) + ISNULL(MASTER_DATA.M6, 0)) AS FIRST_HALF_SUM,
      ISNULL(MASTER_DATA.M7, 0) AS M7, ISNULL(MASTER_DATA.M8, 0) AS M8, ISNULL(MASTER_DATA.M9, 0) AS M9,
      ISNULL(MASTER_DATA.M10, 0) AS M10, ISNULL(MASTER_DATA.M11, 0) AS M11, ISNULL(MASTER_DATA.M12, 0) AS M12,
      (ISNULL(MASTER_DATA.M7, 0) + ISNULL(MASTER_DATA.M8, 0) + ISNULL(MASTER_DATA.M9, 0) + ISNULL(MASTER_DATA.M10, 0) + ISNULL(MASTER_DATA.M11, 0)+ ISNULL(MASTER_DATA.M12, 0)) AS SECOND_HALF_SUM,
      (ISNULL(MASTER_DATA.M1, 0) + ISNULL(MASTER_DATA.M2, 0) + ISNULL(MASTER_DATA.M3, 0) + ISNULL(MASTER_DATA.M4, 0) + ISNULL(MASTER_DATA.M5,0) + ISNULL(MASTER_DATA.M6, 0) + ISNULL(MASTER_DATA.M7, 0) + ISNULL(MASTER_DATA.M8, 0) + ISNULL(MASTER_DATA.M9, 0) + ISNULL(MASTER_DATA.M10, 0) + ISNULL(MASTER_DATA.M11, 0)+ ISNULL(MASTER_DATA.M12, 0)) AS YEAR_SUM,

      --ISNULL(ACTUAL_DATA.H1, 0) + ISNULL(REVISE_DATA.H2, 0) AS LAST_YEAR_SUM,
      ISNULL(ACTUAL_DATA.H1, 0) + ISNULL(MAX_REV.REVISE_SECOND_HALF, 0) AS LAST_YEAR_SUM,

      (ISNULL(MASTER_DATA.M1, 0) + ISNULL(MASTER_DATA.M2, 0) + ISNULL(MASTER_DATA.M3, 0) + ISNULL(MASTER_DATA.M4, 0) + ISNULL(MASTER_DATA.M5,0) + ISNULL(MASTER_DATA.M6, 0) + ISNULL(MASTER_DATA.M7, 0) + ISNULL(MASTER_DATA.M8, 0) + ISNULL(MASTER_DATA.M9, 0) + ISNULL(MASTER_DATA.M10, 0) + ISNULL(MASTER_DATA.M11, 0)+ ISNULL(MASTER_DATA.M12, 0)) - (ISNULL(ACTUAL_DATA.H1, 0) + ISNULL(MAX_REV.REVISE_SECOND_HALF, 0)) AS DIFF_YEAR
      FROM (
      SELECT ASSET_GROUP.ASSET_GROUP_NO, ASSET_GROUP.ASSET_GROUP_NAME, ASSET_GROUP.ASSET_PROJECT, ASSET_PROJECT.ASSET_PROJECT_TXT,
      ASSET_GROUP.ASSET_CATEGORY, CATEGORY.ASSET_CATEGORY_TXT, BUDGET_ORDER.BUDGET_ORDER_NO, BUDGET_DATA.BUDGET_YEAR,
      BUDGET_ORDER.COST_CENTER,
      BUDGET_DATA.PERIOD_TYPE,
      BUDGET_DATA.PROJECT_NO,
      MAX(BUDGET_DATA.REV_NO) AS REV_NO, BUDGET_ORDER.BUDGET_ORDER_NAME,
      BUDGET_ORDER.DEPT_NO, BUDGET_ORDER.PERSON_IN_CHARGE_NO

      ,ISNULL((SELECT ISNULL(ISNULL(M10,0)+ISNULL(M11,0)+ISNULL(M12,0),0)
      FROM BG_T_BUDGET_DATA
      WHERE BUDGET_YEAR = (@YEAR-1)
      AND PERIOD_TYPE = 2
      AND REV_NO = (SELECT MAX(REV_NO) AS REV_NO FROM BG_T_BUDGET_DATA WHERE BUDGET_YEAR = (@YEAR-1) AND PERIOD_TYPE = 2 AND PROJECT_NO = @PROJECT_NO AND REV_NO = 1)
      AND PROJECT_NO = @PROJECT_NO
      AND BUDGET_ORDER_NO = BUDGET_ORDER.BUDGET_ORDER_NO),0)+
      ISNULL((SELECT ISNULL(M7,0)+ISNULL(M8,0)+ISNULL(M9,0)
      FROM BG_T_UPLOAD_DATA
      WHERE BUDGET_YEAR = (@YEAR-1)
      AND PERIOD_TYPE = 2
      AND PROJECT_NO = @PROJECT_NO
      AND DATA_TYPE = 2
      AND BUDGET_ORDER_NO = BUDGET_ORDER.BUDGET_ORDER_NO),0) AS REVISE_SECOND_HALF

      FROM BG_M_ASSET_GROUP AS ASSET_GROUP
      INNER JOIN BG_M_ASSET_PROJECT AS ASSET_PROJECT ON ASSET_GROUP.ASSET_PROJECT = ASSET_PROJECT.ASSET_PROJECT
      INNER JOIN BG_M_ASSET_CATEGORY AS CATEGORY ON ASSET_GROUP.ASSET_CATEGORY = CATEGORY.ASSET_CATEGORY
      INNER JOIN BG_M_BUDGET_ORDER AS BUDGET_ORDER ON ASSET_GROUP.ASSET_GROUP_NO = BUDGET_ORDER.ASSET_GROUP_NO
      AND BUDGET_ORDER.BUDGET_TYPE = 'A' AND BUDGET_ORDER.ACTIVE_FLAG = 1
      LEFT OUTER JOIN BG_T_BUDGET_DATA AS BUDGET_DATA
      ON BUDGET_ORDER.BUDGET_ORDER_NO = BUDGET_DATA.BUDGET_ORDER_NO
      WHERE BUDGET_DATA.BUDGET_YEAR = @YEAR
      AND BUDGET_DATA.PERIOD_TYPE = @PERIOD
      AND BUDGET_DATA.PROJECT_NO = @PROJECT_NO
      @PICCONDITION

      GROUP BY ASSET_GROUP.ASSET_GROUP_NO, ASSET_GROUP.ASSET_GROUP_NAME, ASSET_GROUP.ASSET_PROJECT, ASSET_PROJECT.ASSET_PROJECT_TXT,
      ASSET_GROUP.ASSET_CATEGORY, CATEGORY.ASSET_CATEGORY_TXT, BUDGET_ORDER.BUDGET_ORDER_NO, BUDGET_DATA.BUDGET_YEAR, BUDGET_DATA.PERIOD_TYPE, BUDGET_DATA.PROJECT_NO,
      BUDGET_ORDER.BUDGET_ORDER_NAME, BUDGET_ORDER.DEPT_NO, BUDGET_ORDER.COST_CENTER,
      BUDGET_ORDER.PERSON_IN_CHARGE_NO) AS MAX_REV

      INNER JOIN BG_T_BUDGET_DATA AS MASTER_DATA
      ON MAX_REV.BUDGET_YEAR = MASTER_DATA.BUDGET_YEAR
      AND MAX_REV.PERIOD_TYPE = MASTER_DATA.PERIOD_TYPE
      AND MAX_REV.PROJECT_NO = MASTER_DATA.PROJECT_NO
      AND MAX_REV.BUDGET_ORDER_NO = MASTER_DATA.BUDGET_ORDER_NO
      AND MAX_REV.REV_NO = MASTER_DATA.REV_NO

      LEFT OUTER JOIN BG_T_UPLOAD_DATA AS ACTUAL_DATA
      ON ACTUAL_DATA.BUDGET_YEAR = MAX_REV.BUDGET_YEAR - 1
      AND ACTUAL_DATA.PERIOD_TYPE = @PERIOD
      AND ACTUAL_DATA.PROJECT_NO = @PROJECT_NO
      AND ACTUAL_DATA.BUDGET_ORDER_NO = MAX_REV.BUDGET_ORDER_NO
      AND ACTUAL_DATA.DATA_TYPE = 2

      LEFT OUTER JOIN BG_T_UPLOAD_DATA AS REVISE_DATA
      ON REVISE_DATA.BUDGET_YEAR = MAX_REV.BUDGET_YEAR - 1
      AND REVISE_DATA.PERIOD_TYPE = @PERIOD
      AND REVISE_DATA.PROJECT_NO = @PROJECT_NO
      AND REVISE_DATA.BUDGET_ORDER_NO = MAX_REV.BUDGET_ORDER_NO
      AND REVISE_DATA.DATA_TYPE = 1

      WHERE ACTUAL_DATA.H1 &lt;&gt; 0 OR MAX_REV.REVISE_SECOND_HALF &lt;&gt; 0 OR ISNULL(MASTER_DATA.M1, 0) &lt;&gt; 0 OR ISNULL(MASTER_DATA.M2, 0) &lt;&gt; 0
      OR ISNULL(MASTER_DATA.M2, 0) &lt;&gt; 0 OR ISNULL(MASTER_DATA.M3, 0) &lt;&gt; 0 OR ISNULL(MASTER_DATA.M4, 0) &lt;&gt; 0 OR ISNULL(MASTER_DATA.M5, 0) &lt;&gt; 0
      OR ISNULL(MASTER_DATA.M6, 0) &lt;&gt; 0 OR ISNULL(MASTER_DATA.M7, 0) &lt;&gt; 0 OR ISNULL(MASTER_DATA.M8, 0) &lt;&gt; 0 OR ISNULL(MASTER_DATA.M9, 0) &lt;&gt; 0
      OR ISNULL(MASTER_DATA.M10, 0) &lt;&gt; 0 OR ISNULL(MASTER_DATA.M11, 0) &lt;&gt; 0 OR ISNULL(MASTER_DATA.M12, 0) &lt;&gt; 0

      ORDER BY MAX_REV.ASSET_PROJECT, MAX_REV.ASSET_CATEGORY, MAX_REV.PERSON_IN_CHARGE_NO, MAX_REV.BUDGET_ORDER_NO

    </SELECT012_1 >
    <SELECT012_2>
      SELECT MAX_REV.ASSET_PROJECT, MAX_REV.ASSET_PROJECT_TXT AS ASSET_PROJECT_NAME,
      MAX_REV.ASSET_CATEGORY, MAX_REV.ASSET_CATEGORY_TXT AS ASSET_CATEGORY_NAME,
      MAX_REV.ASSET_GROUP_NO, MAX_REV.ASSET_GROUP_NAME, MAX_REV.BUDGET_ORDER_NAME,
      MAX_REV.BUDGET_ORDER_NO, MAX_REV.COST_CENTER, MAX_REV.PERSON_IN_CHARGE_NO,
      ISNULL(ACTUAL_DATA.H1, 0) AS ACTUAL_FIRST_HALF,
      ISNULL(REVISE_BUDGET.M7, 0) + ISNULL(REVISE_BUDGET.M8, 0) + ISNULL(REVISE_BUDGET.M9, 0) + ISNULL(REVISE_BUDGET.M10, 0) + ISNULL(REVISE_BUDGET.M11, 0) + ISNULL(REVISE_BUDGET.M12, 0) AS REVISE_SECOND_HALF,
      ISNULL(ACTUAL_DATA.M7, 0) AS M7, ISNULL(ACTUAL_DATA.M8, 0) AS M8, ISNULL(ACTUAL_DATA.M9, 0) AS M9,
      ISNULL(MASTER_DATA.M10, 0) AS M10, ISNULL(MASTER_DATA.M11, 0) AS M11, ISNULL(MASTER_DATA.M12, 0) AS M12,
      ISNULL(ACTUAL_DATA.M7, 0) + ISNULL(ACTUAL_DATA.M8, 0) + ISNULL(ACTUAL_DATA.M9, 0) + ISNULL(MASTER_DATA.M10, 0) + ISNULL(MASTER_DATA.M11,0) + ISNULL(MASTER_DATA.M12, 0) AS ESTIMATE_SECOND_HALF,
      ISNULL(ACTUAL_DATA.M7, 0) + ISNULL(ACTUAL_DATA.M8, 0) + ISNULL(ACTUAL_DATA.M9, 0) + ISNULL(MASTER_DATA.M10, 0) + ISNULL(MASTER_DATA.M11,0) + ISNULL(MASTER_DATA.M12, 0) - (ISNULL(REVISE_BUDGET.M7, 0) + ISNULL(REVISE_BUDGET.M8, 0) + ISNULL(REVISE_BUDGET.M9, 0) + ISNULL(REVISE_BUDGET.M10, 0) + ISNULL(REVISE_BUDGET.M11, 0) + ISNULL(REVISE_BUDGET.M12, 0)) AS DIFF_SECOND_HALF,
      ISNULL(ACTUAL_DATA.H1, 0) + ISNULL(ACTUAL_DATA.M7, 0) + ISNULL(ACTUAL_DATA.M8, 0) + ISNULL(ACTUAL_DATA.M9, 0) + ISNULL(MASTER_DATA.M10, 0) + ISNULL(MASTER_DATA.M11,0) + ISNULL(MASTER_DATA.M12, 0) AS ESTIMATE_TOTAL_YEAR
      FROM (
      SELECT ASSET_GROUP.ASSET_GROUP_NO, ASSET_GROUP.ASSET_GROUP_NAME, ASSET_GROUP.ASSET_PROJECT, ASSET_PROJECT.ASSET_PROJECT_TXT,
      ASSET_GROUP.ASSET_CATEGORY, CATEGORY.ASSET_CATEGORY_TXT, BUDGET_ORDER.BUDGET_ORDER_NO, BUDGET_DATA.BUDGET_YEAR,
      BUDGET_ORDER.COST_CENTER,
      BUDGET_DATA.PERIOD_TYPE,
      BUDGET_DATA.PROJECT_NO,
      MAX(BUDGET_DATA.REV_NO) AS REV_NO, BUDGET_ORDER.BUDGET_ORDER_NAME,
      BUDGET_ORDER.DEPT_NO, BUDGET_ORDER.PERSON_IN_CHARGE_NO
      FROM BG_M_ASSET_GROUP AS ASSET_GROUP
      INNER JOIN BG_M_ASSET_PROJECT AS ASSET_PROJECT ON ASSET_PROJECT.ASSET_PROJECT = ASSET_GROUP.ASSET_PROJECT
      INNER JOIN BG_M_ASSET_CATEGORY AS CATEGORY ON CATEGORY.ASSET_CATEGORY = ASSET_GROUP.ASSET_CATEGORY
      INNER JOIN BG_M_BUDGET_ORDER AS BUDGET_ORDER ON ASSET_GROUP.ASSET_GROUP_NO = BUDGET_ORDER.ASSET_GROUP_NO
      AND BUDGET_ORDER.BUDGET_TYPE = 'A' AND BUDGET_ORDER.ACTIVE_FLAG = 1
      LEFT OUTER JOIN BG_T_BUDGET_DATA AS BUDGET_DATA
      ON BUDGET_ORDER.BUDGET_ORDER_NO = BUDGET_DATA.BUDGET_ORDER_NO
      WHERE BUDGET_DATA.BUDGET_YEAR = @YEAR
      AND BUDGET_DATA.PERIOD_TYPE = @PERIOD
      AND BUDGET_DATA.PROJECT_NO = @PROJECT_NO
      @PICCONDITION

      GROUP BY ASSET_GROUP.ASSET_GROUP_NO, ASSET_GROUP.ASSET_GROUP_NAME, ASSET_GROUP.ASSET_PROJECT, ASSET_PROJECT.ASSET_PROJECT_TXT,
      ASSET_GROUP.ASSET_CATEGORY, CATEGORY.ASSET_CATEGORY_TXT, BUDGET_ORDER.BUDGET_ORDER_NO, BUDGET_DATA.BUDGET_YEAR, BUDGET_DATA.PERIOD_TYPE,BUDGET_DATA.PROJECT_NO,
      BUDGET_ORDER.BUDGET_ORDER_NAME, BUDGET_ORDER.DEPT_NO, BUDGET_ORDER.COST_CENTER,
      BUDGET_ORDER.PERSON_IN_CHARGE_NO) AS MAX_REV

      INNER JOIN BG_T_BUDGET_DATA AS MASTER_DATA
      ON MAX_REV.BUDGET_YEAR = MASTER_DATA.BUDGET_YEAR
      AND MAX_REV.PERIOD_TYPE = MASTER_DATA.PERIOD_TYPE
      AND MAX_REV.PROJECT_NO = MASTER_DATA.PROJECT_NO
      AND MAX_REV.BUDGET_ORDER_NO = MASTER_DATA.BUDGET_ORDER_NO
      AND MAX_REV.REV_NO = MASTER_DATA.REV_NO

      ---- change Revise to OB 02/05/2018
      --LEFT OUTER JOIN BG_T_UPLOAD_DATA AS REVISE_BUDGET
      --ON MAX_REV.BUDGET_YEAR = REVISE_BUDGET.BUDGET_YEAR
      ---- AND REVISE_BUDGET.PERIOD_TYPE = 2
      --AND REVISE_BUDGET.PERIOD_TYPE = 1
      --AND REVISE_BUDGET.PROJECT_NO = 1
      --AND MAX_REV.BUDGET_ORDER_NO = REVISE_BUDGET.BUDGET_ORDER_NO
      --AND REVISE_BUDGET.DATA_TYPE = 1


      LEFT JOIN BG_T_BUDGET_DATA AS REVISE_BUDGET
      ON  REVISE_BUDGET.BUDGET_YEAR =  MAX_REV.BUDGET_YEAR
      AND REVISE_BUDGET.PERIOD_TYPE = 1
      AND REVISE_BUDGET.PROJECT_NO = MAX_REV.PROJECT_NO
      AND REVISE_BUDGET.BUDGET_ORDER_NO = MAX_REV.BUDGET_ORDER_NO
      AND REVISE_BUDGET.REV_NO = MAX_REV.REV_NO

      LEFT OUTER JOIN BG_T_UPLOAD_DATA AS ACTUAL_DATA
      ON ACTUAL_DATA.BUDGET_YEAR = MAX_REV.BUDGET_YEAR
      AND ACTUAL_DATA.PERIOD_TYPE = @PERIOD
      AND ACTUAL_DATA.PROJECT_NO = @PROJECT_NO
      AND ACTUAL_DATA.BUDGET_ORDER_NO = MAX_REV.BUDGET_ORDER_NO
      AND ACTUAL_DATA.DATA_TYPE = 2

      WHERE ISNULL(ACTUAL_DATA.H1, 0) &lt;&gt; 0 
      OR ISNULL(REVISE_BUDGET.M7, 0) &lt;&gt; 0
      OR ISNULL(REVISE_BUDGET.M8, 0) &lt;&gt; 0
      OR ISNULL(REVISE_BUDGET.M9, 0) &lt;&gt; 0
      OR ISNULL(REVISE_BUDGET.M10, 0) &lt;&gt; 0
      OR ISNULL(REVISE_BUDGET.M11, 0) &lt;&gt; 0
      OR ISNULL(REVISE_BUDGET.M12, 0) &lt;&gt; 0
      OR ISNULL(ACTUAL_DATA.M7, 0) &lt;&gt; 0 OR ISNULL(ACTUAL_DATA.M8, 0) &lt;&gt; 0 OR ISNULL(ACTUAL_DATA.M9, 0) &lt;&gt; 0 OR
      ISNULL(MASTER_DATA.M10, 0) &lt;&gt; 0 OR ISNULL(MASTER_DATA.M11, 0) &lt;&gt; 0 OR ISNULL(MASTER_DATA.M12, 0) &lt;&gt; 0

      ORDER BY MAX_REV.ASSET_PROJECT, MAX_REV.ASSET_CATEGORY, MAX_REV.PERSON_IN_CHARGE_NO, MAX_REV.BUDGET_ORDER_NO
    </SELECT012_2>
    <SELECT012_3>
      SELECT MAX_REV.ASSET_PROJECT, MAX_REV.ASSET_PROJECT_TXT AS ASSET_PROJECT_NAME,
      MAX_REV.ASSET_CATEGORY, MAX_REV.ASSET_CATEGORY_TXT AS ASSET_CATEGORY_NAME,
      MAX_REV.ASSET_GROUP_NO, MAX_REV.ASSET_GROUP_NAME, MAX_REV.BUDGET_ORDER_NAME,
      MAX_REV.BUDGET_ORDER_NO, MAX_REV.COST_CENTER, MAX_REV.PERSON_IN_CHARGE_NO,
      ISNULL(ORIGINAL_BUDGET.H1, 0) AS ORIGINAL_FIRST_HALF,
      ISNULL(ACTUAL_DATA.M1, 0) AS M1, ISNULL(ACTUAL_DATA.M2, 0) AS M2,
      ISNULL(ACTUAL_DATA.M3, 0) AS M3, ISNULL(MASTER_DATA.M4, 0) AS M4,
      ISNULL(MASTER_DATA.M5, 0) AS M5, ISNULL(MASTER_DATA.M6, 0) AS M6,
      ISNULL(ACTUAL_DATA.M1, 0) + ISNULL(ACTUAL_DATA.M2, 0) + ISNULL(ACTUAL_DATA.M3, 0) + ISNULL(MASTER_DATA.M4, 0) + ISNULL(MASTER_DATA.M5, 0) + ISNULL(MASTER_DATA.M6, 0) AS ESTIMATE_FIRST_HALF,
      ISNULL(ACTUAL_DATA.M1, 0) + ISNULL(ACTUAL_DATA.M2, 0) + ISNULL(ACTUAL_DATA.M3, 0) + ISNULL(MASTER_DATA.M4, 0) + ISNULL(MASTER_DATA.M5, 0) + ISNULL(MASTER_DATA.M6, 0) - ISNULL(ORIGINAL_BUDGET.H1, 0) AS DIFF_FIRST_HALF,
      ISNULL(ORIGINAL_BUDGET.H2, 0) AS ORIGINAL_SECOND_HALF,
      ISNULL(MASTER_DATA.M7, 0) AS M7, ISNULL(MASTER_DATA.M8, 0) AS M8,
      ISNULL(MASTER_DATA.M9, 0) AS M9, ISNULL(MASTER_DATA.M10, 0) AS M10,
      ISNULL(MASTER_DATA.M11, 0) AS M11, ISNULL(MASTER_DATA.M12, 0) AS M12,
      ISNULL(MASTER_DATA.M7, 0) + ISNULL(MASTER_DATA.M8, 0) + ISNULL(MASTER_DATA.M9, 0) + ISNULL(MASTER_DATA.M10, 0) + ISNULL(MASTER_DATA.M11, 0) + ISNULL(MASTER_DATA.M12, 0) AS REVISE_SECOND_HALF,
      ISNULL(MASTER_DATA.M7, 0) + ISNULL(MASTER_DATA.M8, 0) + ISNULL(MASTER_DATA.M9, 0) + ISNULL(MASTER_DATA.M10, 0) + ISNULL(MASTER_DATA.M11, 0) + ISNULL(MASTER_DATA.M12, 0) - ISNULL(ORIGINAL_BUDGET.H2, 0) AS DIFF_SECOND_HALF,
      ISNULL(ACTUAL_DATA.M1, 0) + ISNULL(ACTUAL_DATA.M2, 0) + ISNULL(ACTUAL_DATA.M3, 0) + ISNULL(MASTER_DATA.M4, 0) + ISNULL(MASTER_DATA.M5, 0) + ISNULL(MASTER_DATA.M6, 0) + ISNULL(MASTER_DATA.M7, 0) + ISNULL(MASTER_DATA.M8, 0) + ISNULL(MASTER_DATA.M9, 0) + ISNULL(MASTER_DATA.M10, 0) + ISNULL(MASTER_DATA.M11, 0) + ISNULL(MASTER_DATA.M12, 0) AS REVISE_TOTAL_YEAR,
      ISNULL(ACTUAL_DATA.M1, 0) + ISNULL(ACTUAL_DATA.M2, 0) + ISNULL(ACTUAL_DATA.M3, 0) + ISNULL(MASTER_DATA.M4, 0) + ISNULL(MASTER_DATA.M5, 0) + ISNULL(MASTER_DATA.M6, 0) - ISNULL(ORIGINAL_BUDGET.H1, 0) + (ISNULL(MASTER_DATA.M7, 0) + ISNULL(MASTER_DATA.M8, 0) + ISNULL(MASTER_DATA.M9, 0) + ISNULL(MASTER_DATA.M10, 0) + ISNULL(MASTER_DATA.M11, 0) + ISNULL(MASTER_DATA.M12, 0) - ISNULL(ORIGINAL_BUDGET.H2, 0)) AS DIFF_TOTAL_YEAR,
      ISNULL(MASTER_DATA.RRT1, 0) AS RRT1,
      ISNULL(MASTER_DATA.RRT2, 0) AS RRT2,
      ISNULL(MASTER_DATA.RRT3, 0) AS RRT3,
      ISNULL(MASTER_DATA.RRT4, 0) AS RRT4,
      ISNULL(MASTER_DATA.RRT5, 0) AS RRT5
      FROM (
      SELECT ASSET_GROUP.ASSET_GROUP_NO, ASSET_GROUP.ASSET_GROUP_NAME, ASSET_GROUP.ASSET_PROJECT, ASSET_PROJECT.ASSET_PROJECT_TXT,
      ASSET_GROUP.ASSET_CATEGORY, CATEGORY.ASSET_CATEGORY_TXT, BUDGET_ORDER.BUDGET_ORDER_NO, BUDGET_DATA.BUDGET_YEAR,
      BUDGET_ORDER.COST_CENTER,
      BUDGET_DATA.PERIOD_TYPE,
      BUDGET_DATA.PROJECT_NO,
      MAX(BUDGET_DATA.REV_NO) AS REV_NO, BUDGET_ORDER.BUDGET_ORDER_NAME,
      BUDGET_ORDER.DEPT_NO, BUDGET_ORDER.PERSON_IN_CHARGE_NO
      FROM BG_M_ASSET_GROUP AS ASSET_GROUP
      INNER JOIN BG_M_ASSET_PROJECT AS ASSET_PROJECT ON ASSET_PROJECT.ASSET_PROJECT = ASSET_GROUP.ASSET_PROJECT
      INNER JOIN BG_M_ASSET_CATEGORY AS CATEGORY ON CATEGORY.ASSET_CATEGORY = ASSET_GROUP.ASSET_CATEGORY
      INNER JOIN BG_M_BUDGET_ORDER AS BUDGET_ORDER ON ASSET_GROUP.ASSET_GROUP_NO = BUDGET_ORDER.ASSET_GROUP_NO
      AND BUDGET_ORDER.BUDGET_TYPE = 'A' AND BUDGET_ORDER.ACTIVE_FLAG = 1
      LEFT OUTER JOIN BG_T_BUDGET_DATA AS BUDGET_DATA
      ON BUDGET_ORDER.BUDGET_ORDER_NO = BUDGET_DATA.BUDGET_ORDER_NO
      WHERE BUDGET_DATA.BUDGET_YEAR = @YEAR
      AND BUDGET_DATA.PERIOD_TYPE = @PERIOD
      AND BUDGET_DATA.PROJECT_NO = @PROJECT_NO
      @PICCONDITION

      GROUP BY ASSET_GROUP.ASSET_GROUP_NO, ASSET_GROUP.ASSET_GROUP_NAME, ASSET_GROUP.ASSET_PROJECT, ASSET_PROJECT.ASSET_PROJECT_TXT,
      ASSET_GROUP.ASSET_CATEGORY, CATEGORY.ASSET_CATEGORY_TXT, BUDGET_ORDER.BUDGET_ORDER_NO, BUDGET_DATA.BUDGET_YEAR, BUDGET_DATA.PERIOD_TYPE, BUDGET_DATA.PROJECT_NO,
      BUDGET_ORDER.BUDGET_ORDER_NAME, BUDGET_ORDER.DEPT_NO, BUDGET_ORDER.COST_CENTER,
      BUDGET_ORDER.PERSON_IN_CHARGE_NO) AS MAX_REV

      INNER JOIN BG_T_BUDGET_DATA AS MASTER_DATA
      ON MAX_REV.BUDGET_YEAR = MASTER_DATA.BUDGET_YEAR
      AND MAX_REV.PERIOD_TYPE = MASTER_DATA.PERIOD_TYPE
      AND MAX_REV.PROJECT_NO = MASTER_DATA.PROJECT_NO
      AND MAX_REV.BUDGET_ORDER_NO = MASTER_DATA.BUDGET_ORDER_NO
      AND MAX_REV.REV_NO = MASTER_DATA.REV_NO

      LEFT OUTER JOIN BG_T_UPLOAD_DATA AS ORIGINAL_BUDGET
      ON MAX_REV.BUDGET_YEAR = ORIGINAL_BUDGET.BUDGET_YEAR
      AND ORIGINAL_BUDGET.PERIOD_TYPE = @PERIOD
      AND ORIGINAL_BUDGET.PROJECT_NO = @PROJECT_NO
      AND MAX_REV.BUDGET_ORDER_NO = ORIGINAL_BUDGET.BUDGET_ORDER_NO
      AND ORIGINAL_BUDGET.DATA_TYPE = 1

      LEFT OUTER JOIN BG_T_UPLOAD_DATA AS ACTUAL_DATA
      ON ACTUAL_DATA.BUDGET_YEAR = MAX_REV.BUDGET_YEAR
      AND ACTUAL_DATA.PERIOD_TYPE = @PERIOD
      AND ACTUAL_DATA.PROJECT_NO = @PROJECT_NO
      AND ACTUAL_DATA.BUDGET_ORDER_NO = MAX_REV.BUDGET_ORDER_NO
      AND ACTUAL_DATA.DATA_TYPE = 2

      WHERE ISNULL(ORIGINAL_BUDGET.H1, 0) &lt;&gt; 0 OR ISNULL(ORIGINAL_BUDGET.H2, 0) &lt;&gt; 0 OR
      ISNULL(ACTUAL_DATA.M1, 0) &lt;&gt; 0 OR ISNULL(ACTUAL_DATA.M2, 0) &lt;&gt; 0 OR ISNULL(ACTUAL_DATA.M3, 0) &lt;&gt; 0 OR
      ISNULL(MASTER_DATA.M4, 0) &lt;&gt; 0 OR ISNULL(MASTER_DATA.M5, 0) &lt;&gt; 0 OR
      ISNULL(MASTER_DATA.M6, 0) &lt;&gt; 0 OR ISNULL(MASTER_DATA.M7, 0) &lt;&gt; 0 OR ISNULL(MASTER_DATA.M8, 0) &lt;&gt; 0 OR
      ISNULL(MASTER_DATA.M9, 0) &lt;&gt; 0 OR ISNULL(MASTER_DATA.M10, 0) &lt;&gt; 0 OR
      ISNULL(MASTER_DATA.M11, 0) &lt;&gt; 0 OR ISNULL(MASTER_DATA.M12, 0) &lt;&gt; 0 OR
      ISNULL(MASTER_DATA.RRT1, 0) &lt;&gt; 0 OR ISNULL(MASTER_DATA.RRT2, 0) &lt;&gt; 0 OR ISNULL(MASTER_DATA.RRT3, 0) &lt;&gt; 0
      OR ISNULL(MASTER_DATA.RRT4, 0) &lt;&gt; 0 OR ISNULL(MASTER_DATA.RRT5, 0) &lt;&gt; 0

      ORDER BY MAX_REV.ASSET_PROJECT, MAX_REV.ASSET_CATEGORY, MAX_REV.ASSET_GROUP_NO, MAX_REV.PERSON_IN_CHARGE_NO, MAX_REV.BUDGET_ORDER_NO

    </SELECT012_3 >

    <SELECT012_4>
      SELECT MAX_REV.ASSET_PROJECT, MAX_REV.ASSET_PROJECT_TXT AS ASSET_PROJECT_NAME,
      MAX_REV.ASSET_CATEGORY, MAX_REV.ASSET_CATEGORY_TXT AS ASSET_CATEGORY_NAME, MAX_REV.ASSET_GROUP_NO, MAX_REV.ASSET_GROUP_NAME,
      MAX_REV.BUDGET_ORDER_NO, MAX_REV.BUDGET_ORDER_NAME, MAX_REV.COST_CENTER, MAX_REV.PERSON_IN_CHARGE_NO,
      ISNULL(ACTUAL_DATA.H1, 0) AS ACTUAL_FIRST_HALF,

      --ISNULL(REVISE_DATA.H2, 0) AS REVISE_SECOND_HALF,
      ISNULL(MAX_REV.REVISE_SECOND_HALF, 0) AS REVISE_SECOND_HALF,
      ISNULL(MASTER_DATA.M1, 0) AS M1, ISNULL(MASTER_DATA.M2, 0) AS M2, ISNULL(MASTER_DATA.M3, 0) AS M3,
      ISNULL(MASTER_DATA.M4, 0) AS M4, ISNULL(MASTER_DATA.M5, 0) AS M5, ISNULL(MASTER_DATA.M6, 0) AS M6,
      (ISNULL(MASTER_DATA.M1, 0) + ISNULL(MASTER_DATA.M2, 0) + ISNULL(MASTER_DATA.M3, 0) + ISNULL(MASTER_DATA.M4, 0) + ISNULL(MASTER_DATA.M5,0) + ISNULL(MASTER_DATA.M6, 0)) AS FIRST_HALF_SUM,
      ISNULL(MASTER_DATA.M7, 0) AS M7, ISNULL(MASTER_DATA.M8, 0) AS M8, ISNULL(MASTER_DATA.M9, 0) AS M9,
      ISNULL(MASTER_DATA.M10, 0) AS M10, ISNULL(MASTER_DATA.M11, 0) AS M11, ISNULL(MASTER_DATA.M12, 0) AS M12,
      (ISNULL(MASTER_DATA.M7, 0) + ISNULL(MASTER_DATA.M8, 0) + ISNULL(MASTER_DATA.M9, 0) + ISNULL(MASTER_DATA.M10, 0) + ISNULL(MASTER_DATA.M11, 0)+ ISNULL(MASTER_DATA.M12, 0)) AS SECOND_HALF_SUM,
      (ISNULL(MASTER_DATA.M1, 0) + ISNULL(MASTER_DATA.M2, 0) + ISNULL(MASTER_DATA.M3, 0) + ISNULL(MASTER_DATA.M4, 0) + ISNULL(MASTER_DATA.M5,0) + ISNULL(MASTER_DATA.M6, 0) + ISNULL(MASTER_DATA.M7, 0) + ISNULL(MASTER_DATA.M8, 0) + ISNULL(MASTER_DATA.M9, 0) + ISNULL(MASTER_DATA.M10, 0) + ISNULL(MASTER_DATA.M11, 0)+ ISNULL(MASTER_DATA.M12, 0)) AS YEAR_SUM,

      --ISNULL(ACTUAL_DATA.H1, 0) + ISNULL(REVISE_DATA.H2, 0) AS LAST_YEAR_SUM,
      ISNULL(ACTUAL_DATA.H1, 0) + ISNULL(MAX_REV.REVISE_SECOND_HALF, 0) AS LAST_YEAR_SUM,

      (ISNULL(MASTER_DATA.M1, 0) + ISNULL(MASTER_DATA.M2, 0) + ISNULL(MASTER_DATA.M3, 0) + ISNULL(MASTER_DATA.M4, 0) + ISNULL(MASTER_DATA.M5,0) + ISNULL(MASTER_DATA.M6, 0) + ISNULL(MASTER_DATA.M7, 0) + ISNULL(MASTER_DATA.M8, 0) + ISNULL(MASTER_DATA.M9, 0) + ISNULL(MASTER_DATA.M10, 0) + ISNULL(MASTER_DATA.M11, 0)+ ISNULL(MASTER_DATA.M12, 0)) - (ISNULL(ACTUAL_DATA.H1, 0) + ISNULL(MAX_REV.REVISE_SECOND_HALF, 0)) AS DIFF_YEAR
      FROM (
      SELECT ASSET_GROUP.ASSET_GROUP_NO, ASSET_GROUP.ASSET_GROUP_NAME, ASSET_GROUP.ASSET_PROJECT, ASSET_PROJECT.ASSET_PROJECT_TXT,
      ASSET_GROUP.ASSET_CATEGORY, CATEGORY.ASSET_CATEGORY_TXT, BUDGET_ORDER.BUDGET_ORDER_NO, BUDGET_DATA.BUDGET_YEAR,
      BUDGET_ORDER.COST_CENTER,
      BUDGET_DATA.PERIOD_TYPE,
      BUDGET_DATA.PROJECT_NO,
      MAX(BUDGET_DATA.REV_NO) AS REV_NO, BUDGET_ORDER.BUDGET_ORDER_NAME,
      BUDGET_ORDER.DEPT_NO, BUDGET_ORDER.PERSON_IN_CHARGE_NO

      ,ISNULL((SELECT ISNULL(ISNULL(M10,0)+ISNULL(M11,0)+ISNULL(M12,0),0)
      FROM BG_T_BUDGET_DATA
      WHERE BUDGET_YEAR = (@YEAR-1)
      AND PERIOD_TYPE = 2
      AND REV_NO = (SELECT MAX(REV_NO) AS REV_NO FROM BG_T_BUDGET_DATA WHERE BUDGET_YEAR = (@YEAR-1) AND PERIOD_TYPE = 2 AND PROJECT_NO = @PROJECT_NO AND REV_NO = 1)
      AND PROJECT_NO = @PROJECT_NO
      AND BUDGET_ORDER_NO = BUDGET_ORDER.BUDGET_ORDER_NO),0)+
      ISNULL((SELECT ISNULL(M7,0)+ISNULL(M8,0)+ISNULL(M9,0)
      FROM BG_T_UPLOAD_DATA
      WHERE BUDGET_YEAR = (@YEAR-1)
      AND PERIOD_TYPE = 2
      AND PROJECT_NO = @PROJECT_NO
      AND DATA_TYPE = 2
      AND BUDGET_ORDER_NO = BUDGET_ORDER.BUDGET_ORDER_NO),0) AS REVISE_SECOND_HALF

      FROM BG_M_ASSET_GROUP AS ASSET_GROUP
      INNER JOIN BG_M_ASSET_PROJECT AS ASSET_PROJECT ON ASSET_GROUP.ASSET_PROJECT = ASSET_PROJECT.ASSET_PROJECT
      INNER JOIN BG_M_ASSET_CATEGORY AS CATEGORY ON ASSET_GROUP.ASSET_CATEGORY = CATEGORY.ASSET_CATEGORY
      INNER JOIN BG_M_BUDGET_ORDER AS BUDGET_ORDER ON ASSET_GROUP.ASSET_GROUP_NO = BUDGET_ORDER.ASSET_GROUP_NO
      AND BUDGET_ORDER.BUDGET_TYPE = 'A' AND BUDGET_ORDER.ACTIVE_FLAG = 1
      LEFT OUTER JOIN BG_T_BUDGET_DATA AS BUDGET_DATA
      ON BUDGET_ORDER.BUDGET_ORDER_NO = BUDGET_DATA.BUDGET_ORDER_NO
      WHERE BUDGET_DATA.BUDGET_YEAR = @YEAR
      AND BUDGET_DATA.PERIOD_TYPE = @PERIOD
      AND BUDGET_DATA.PROJECT_NO = @PROJECT_NO
      AND BUDGET_DATA.REV_NO = @REV_NO
      @PICCONDITION

      GROUP BY ASSET_GROUP.ASSET_GROUP_NO, ASSET_GROUP.ASSET_GROUP_NAME, ASSET_GROUP.ASSET_PROJECT, ASSET_PROJECT.ASSET_PROJECT_TXT,
      ASSET_GROUP.ASSET_CATEGORY, CATEGORY.ASSET_CATEGORY_TXT, BUDGET_ORDER.BUDGET_ORDER_NO, BUDGET_DATA.BUDGET_YEAR, BUDGET_DATA.PERIOD_TYPE, BUDGET_DATA.PROJECT_NO,
      BUDGET_ORDER.BUDGET_ORDER_NAME, BUDGET_ORDER.DEPT_NO, BUDGET_ORDER.COST_CENTER,
      BUDGET_ORDER.PERSON_IN_CHARGE_NO) AS MAX_REV

      INNER JOIN BG_T_BUDGET_DATA AS MASTER_DATA
      ON MAX_REV.BUDGET_YEAR = MASTER_DATA.BUDGET_YEAR
      AND MAX_REV.PERIOD_TYPE = MASTER_DATA.PERIOD_TYPE
      AND MAX_REV.PROJECT_NO = MASTER_DATA.PROJECT_NO
      AND MAX_REV.BUDGET_ORDER_NO = MASTER_DATA.BUDGET_ORDER_NO
      AND MAX_REV.REV_NO = MASTER_DATA.REV_NO

      LEFT OUTER JOIN BG_T_UPLOAD_DATA AS ACTUAL_DATA
      ON ACTUAL_DATA.BUDGET_YEAR = MAX_REV.BUDGET_YEAR - 1
      AND ACTUAL_DATA.PERIOD_TYPE = @PERIOD
      AND ACTUAL_DATA.PROJECT_NO = @PROJECT_NO
      AND ACTUAL_DATA.BUDGET_ORDER_NO = MAX_REV.BUDGET_ORDER_NO
      AND ACTUAL_DATA.DATA_TYPE = 2

      LEFT OUTER JOIN BG_T_UPLOAD_DATA AS REVISE_DATA
      ON REVISE_DATA.BUDGET_YEAR = MAX_REV.BUDGET_YEAR - 1
      AND REVISE_DATA.PERIOD_TYPE = @PERIOD
      AND REVISE_DATA.PROJECT_NO = @PROJECT_NO
      AND REVISE_DATA.BUDGET_ORDER_NO = MAX_REV.BUDGET_ORDER_NO
      AND REVISE_DATA.DATA_TYPE = 1

      WHERE ACTUAL_DATA.H1 &lt;&gt; 0 OR MAX_REV.REVISE_SECOND_HALF &lt;&gt; 0 OR ISNULL(MASTER_DATA.M1, 0) &lt;&gt; 0 OR ISNULL(MASTER_DATA.M2, 0) &lt;&gt; 0
      OR ISNULL(MASTER_DATA.M2, 0) &lt;&gt; 0 OR ISNULL(MASTER_DATA.M3, 0) &lt;&gt; 0 OR ISNULL(MASTER_DATA.M4, 0) &lt;&gt; 0 OR ISNULL(MASTER_DATA.M5, 0) &lt;&gt; 0
      OR ISNULL(MASTER_DATA.M6, 0) &lt;&gt; 0 OR ISNULL(MASTER_DATA.M7, 0) &lt;&gt; 0 OR ISNULL(MASTER_DATA.M8, 0) &lt;&gt; 0 OR ISNULL(MASTER_DATA.M9, 0) &lt;&gt; 0
      OR ISNULL(MASTER_DATA.M10, 0) &lt;&gt; 0 OR ISNULL(MASTER_DATA.M11, 0) &lt;&gt; 0 OR ISNULL(MASTER_DATA.M12, 0) &lt;&gt; 0

      ORDER BY MAX_REV.ASSET_PROJECT, MAX_REV.ASSET_CATEGORY, MAX_REV.PERSON_IN_CHARGE_NO, MAX_REV.BUDGET_ORDER_NO

    </SELECT012_4 >
    <SELECT012_5>
      SELECT MAX_REV.ASSET_PROJECT, MAX_REV.ASSET_PROJECT_TXT AS ASSET_PROJECT_NAME,
      MAX_REV.ASSET_CATEGORY, MAX_REV.ASSET_CATEGORY_TXT AS ASSET_CATEGORY_NAME,
      MAX_REV.ASSET_GROUP_NO, MAX_REV.ASSET_GROUP_NAME, MAX_REV.BUDGET_ORDER_NAME,
      MAX_REV.BUDGET_ORDER_NO, MAX_REV.COST_CENTER, MAX_REV.PERSON_IN_CHARGE_NO,
      ISNULL(ACTUAL_DATA.H1, 0) AS ACTUAL_FIRST_HALF,
      ISNULL(REVISE_BUDGET.M7, 0) + ISNULL(REVISE_BUDGET.M8, 0) + ISNULL(REVISE_BUDGET.M9, 0) + ISNULL(REVISE_BUDGET.M10, 0) + ISNULL(REVISE_BUDGET.M11, 0) + ISNULL(REVISE_BUDGET.M12, 0) AS REVISE_SECOND_HALF,
      ISNULL(ACTUAL_DATA.M7, 0) AS M7, ISNULL(ACTUAL_DATA.M8, 0) AS M8, ISNULL(ACTUAL_DATA.M9, 0) AS M9,
      ISNULL(MASTER_DATA.M10, 0) AS M10, ISNULL(MASTER_DATA.M11, 0) AS M11, ISNULL(MASTER_DATA.M12, 0) AS M12,
      ISNULL(ACTUAL_DATA.M7, 0) + ISNULL(ACTUAL_DATA.M8, 0) + ISNULL(ACTUAL_DATA.M9, 0) + ISNULL(MASTER_DATA.M10, 0) + ISNULL(MASTER_DATA.M11,0) + ISNULL(MASTER_DATA.M12, 0) AS ESTIMATE_SECOND_HALF,
      ISNULL(ACTUAL_DATA.M7, 0) + ISNULL(ACTUAL_DATA.M8, 0) + ISNULL(ACTUAL_DATA.M9, 0) + ISNULL(MASTER_DATA.M10, 0) + ISNULL(MASTER_DATA.M11,0) + ISNULL(MASTER_DATA.M12, 0) - (ISNULL(REVISE_BUDGET.M7, 0) + ISNULL(REVISE_BUDGET.M8, 0) + ISNULL(REVISE_BUDGET.M9, 0) + ISNULL(REVISE_BUDGET.M10, 0) + ISNULL(REVISE_BUDGET.M11, 0) + ISNULL(REVISE_BUDGET.M12, 0)) AS DIFF_SECOND_HALF,
      ISNULL(ACTUAL_DATA.H1, 0) + ISNULL(ACTUAL_DATA.M7, 0) + ISNULL(ACTUAL_DATA.M8, 0) + ISNULL(ACTUAL_DATA.M9, 0) + ISNULL(MASTER_DATA.M10, 0) + ISNULL(MASTER_DATA.M11,0) + ISNULL(MASTER_DATA.M12, 0) AS ESTIMATE_TOTAL_YEAR
      FROM (
      SELECT ASSET_GROUP.ASSET_GROUP_NO, ASSET_GROUP.ASSET_GROUP_NAME, ASSET_GROUP.ASSET_PROJECT, ASSET_PROJECT.ASSET_PROJECT_TXT,
      ASSET_GROUP.ASSET_CATEGORY, CATEGORY.ASSET_CATEGORY_TXT, BUDGET_ORDER.BUDGET_ORDER_NO, BUDGET_DATA.BUDGET_YEAR,
      BUDGET_ORDER.COST_CENTER,
      BUDGET_DATA.PERIOD_TYPE,
      BUDGET_DATA.PROJECT_NO,
      MAX(BUDGET_DATA.REV_NO) AS REV_NO, BUDGET_ORDER.BUDGET_ORDER_NAME,
      BUDGET_ORDER.DEPT_NO, BUDGET_ORDER.PERSON_IN_CHARGE_NO
      FROM BG_M_ASSET_GROUP AS ASSET_GROUP
      INNER JOIN BG_M_ASSET_PROJECT AS ASSET_PROJECT ON ASSET_PROJECT.ASSET_PROJECT = ASSET_GROUP.ASSET_PROJECT
      INNER JOIN BG_M_ASSET_CATEGORY AS CATEGORY ON CATEGORY.ASSET_CATEGORY = ASSET_GROUP.ASSET_CATEGORY
      INNER JOIN BG_M_BUDGET_ORDER AS BUDGET_ORDER ON ASSET_GROUP.ASSET_GROUP_NO = BUDGET_ORDER.ASSET_GROUP_NO
      AND BUDGET_ORDER.BUDGET_TYPE = 'A' AND BUDGET_ORDER.ACTIVE_FLAG = 1
      LEFT OUTER JOIN BG_T_BUDGET_DATA AS BUDGET_DATA
      ON BUDGET_ORDER.BUDGET_ORDER_NO = BUDGET_DATA.BUDGET_ORDER_NO
      WHERE BUDGET_DATA.BUDGET_YEAR = @YEAR
      AND BUDGET_DATA.PERIOD_TYPE = @PERIOD
      AND BUDGET_DATA.PROJECT_NO = @PROJECT_NO
      AND BUDGET_DATA.REV_NO = @REV_NO
      @PICCONDITION

      GROUP BY ASSET_GROUP.ASSET_GROUP_NO, ASSET_GROUP.ASSET_GROUP_NAME, ASSET_GROUP.ASSET_PROJECT, ASSET_PROJECT.ASSET_PROJECT_TXT,
      ASSET_GROUP.ASSET_CATEGORY, CATEGORY.ASSET_CATEGORY_TXT, BUDGET_ORDER.BUDGET_ORDER_NO, BUDGET_DATA.BUDGET_YEAR, BUDGET_DATA.PERIOD_TYPE,BUDGET_DATA.PROJECT_NO,
      BUDGET_ORDER.BUDGET_ORDER_NAME, BUDGET_ORDER.DEPT_NO, BUDGET_ORDER.COST_CENTER,
      BUDGET_ORDER.PERSON_IN_CHARGE_NO) AS MAX_REV

      INNER JOIN BG_T_BUDGET_DATA AS MASTER_DATA
      ON MAX_REV.BUDGET_YEAR = MASTER_DATA.BUDGET_YEAR
      AND MAX_REV.PERIOD_TYPE = MASTER_DATA.PERIOD_TYPE
      AND MAX_REV.PROJECT_NO = MASTER_DATA.PROJECT_NO
      AND MAX_REV.BUDGET_ORDER_NO = MASTER_DATA.BUDGET_ORDER_NO
      AND MAX_REV.REV_NO = MASTER_DATA.REV_NO

      ---- change Revise to OB 02/05/2018
      --LEFT OUTER JOIN BG_T_UPLOAD_DATA AS REVISE_BUDGET
      --ON MAX_REV.BUDGET_YEAR = REVISE_BUDGET.BUDGET_YEAR
      ---- AND REVISE_BUDGET.PERIOD_TYPE = 2
      --AND REVISE_BUDGET.PERIOD_TYPE = 1
      --AND REVISE_BUDGET.PROJECT_NO = 1
      --AND MAX_REV.BUDGET_ORDER_NO = REVISE_BUDGET.BUDGET_ORDER_NO
      --AND REVISE_BUDGET.DATA_TYPE = 1


      LEFT JOIN BG_T_BUDGET_DATA AS REVISE_BUDGET
      ON  REVISE_BUDGET.BUDGET_YEAR =  MAX_REV.BUDGET_YEAR
      AND REVISE_BUDGET.PERIOD_TYPE = 1
      AND REVISE_BUDGET.PROJECT_NO = MAX_REV.PROJECT_NO
      AND REVISE_BUDGET.BUDGET_ORDER_NO = MAX_REV.BUDGET_ORDER_NO
      AND REVISE_BUDGET.REV_NO = MAX_REV.REV_NO
      
      LEFT OUTER JOIN BG_T_UPLOAD_DATA AS ACTUAL_DATA
      ON ACTUAL_DATA.BUDGET_YEAR = MAX_REV.BUDGET_YEAR
      AND ACTUAL_DATA.PERIOD_TYPE = @PERIOD
      AND ACTUAL_DATA.PROJECT_NO = @PROJECT_NO
      AND ACTUAL_DATA.BUDGET_ORDER_NO = MAX_REV.BUDGET_ORDER_NO
      AND ACTUAL_DATA.DATA_TYPE = 2

      WHERE ISNULL(ACTUAL_DATA.H1, 0) &lt;&gt; 0 
      OR ISNULL(REVISE_BUDGET.M7, 0) &lt;&gt; 0
      OR ISNULL(REVISE_BUDGET.M8, 0) &lt;&gt; 0
      OR ISNULL(REVISE_BUDGET.M9, 0) &lt;&gt; 0
      OR ISNULL(REVISE_BUDGET.M10, 0) &lt;&gt; 0
      OR ISNULL(REVISE_BUDGET.M11, 0) &lt;&gt; 0
      OR ISNULL(REVISE_BUDGET.M12, 0) &lt;&gt; 0
      OR ISNULL(ACTUAL_DATA.M7, 0) &lt;&gt; 0 OR ISNULL(ACTUAL_DATA.M8, 0) &lt;&gt; 0 OR ISNULL(ACTUAL_DATA.M9, 0) &lt;&gt; 0 OR
      ISNULL(MASTER_DATA.M10, 0) &lt;&gt; 0 OR ISNULL(MASTER_DATA.M11, 0) &lt;&gt; 0 OR ISNULL(MASTER_DATA.M12, 0) &lt;&gt; 0

      ORDER BY MAX_REV.ASSET_PROJECT, MAX_REV.ASSET_CATEGORY, MAX_REV.PERSON_IN_CHARGE_NO, MAX_REV.BUDGET_ORDER_NO
    </SELECT012_5>
    <SELECT012_6>
      SELECT MAX_REV.ASSET_PROJECT, MAX_REV.ASSET_PROJECT_TXT AS ASSET_PROJECT_NAME,
      MAX_REV.ASSET_CATEGORY, MAX_REV.ASSET_CATEGORY_TXT AS ASSET_CATEGORY_NAME,
      MAX_REV.ASSET_GROUP_NO, MAX_REV.ASSET_GROUP_NAME, MAX_REV.BUDGET_ORDER_NAME,
      MAX_REV.BUDGET_ORDER_NO, MAX_REV.COST_CENTER, MAX_REV.PERSON_IN_CHARGE_NO,
      ISNULL(ORIGINAL_BUDGET.H1, 0) AS ORIGINAL_FIRST_HALF,
      ISNULL(ACTUAL_DATA.M1, 0) AS M1, ISNULL(ACTUAL_DATA.M2, 0) AS M2,
      ISNULL(ACTUAL_DATA.M3, 0) AS M3, ISNULL(MASTER_DATA.M4, 0) AS M4,
      ISNULL(MASTER_DATA.M5, 0) AS M5, ISNULL(MASTER_DATA.M6, 0) AS M6,
      ISNULL(ACTUAL_DATA.M1, 0) + ISNULL(ACTUAL_DATA.M2, 0) + ISNULL(ACTUAL_DATA.M3, 0) + ISNULL(MASTER_DATA.M4, 0) + ISNULL(MASTER_DATA.M5, 0) + ISNULL(MASTER_DATA.M6, 0) AS ESTIMATE_FIRST_HALF,
      ISNULL(ACTUAL_DATA.M1, 0) + ISNULL(ACTUAL_DATA.M2, 0) + ISNULL(ACTUAL_DATA.M3, 0) + ISNULL(MASTER_DATA.M4, 0) + ISNULL(MASTER_DATA.M5, 0) + ISNULL(MASTER_DATA.M6, 0) - ISNULL(ORIGINAL_BUDGET.H1, 0) AS DIFF_FIRST_HALF,
      ISNULL(ORIGINAL_BUDGET.H2, 0) AS ORIGINAL_SECOND_HALF,
      ISNULL(MASTER_DATA.M7, 0) AS M7, ISNULL(MASTER_DATA.M8, 0) AS M8,
      ISNULL(MASTER_DATA.M9, 0) AS M9, ISNULL(MASTER_DATA.M10, 0) AS M10,
      ISNULL(MASTER_DATA.M11, 0) AS M11, ISNULL(MASTER_DATA.M12, 0) AS M12,
      ISNULL(MASTER_DATA.M7, 0) + ISNULL(MASTER_DATA.M8, 0) + ISNULL(MASTER_DATA.M9, 0) + ISNULL(MASTER_DATA.M10, 0) + ISNULL(MASTER_DATA.M11, 0) + ISNULL(MASTER_DATA.M12, 0) AS REVISE_SECOND_HALF,
      ISNULL(MASTER_DATA.M7, 0) + ISNULL(MASTER_DATA.M8, 0) + ISNULL(MASTER_DATA.M9, 0) + ISNULL(MASTER_DATA.M10, 0) + ISNULL(MASTER_DATA.M11, 0) + ISNULL(MASTER_DATA.M12, 0) - ISNULL(ORIGINAL_BUDGET.H2, 0) AS DIFF_SECOND_HALF,
      ISNULL(ACTUAL_DATA.M1, 0) + ISNULL(ACTUAL_DATA.M2, 0) + ISNULL(ACTUAL_DATA.M3, 0) + ISNULL(MASTER_DATA.M4, 0) + ISNULL(MASTER_DATA.M5, 0) + ISNULL(MASTER_DATA.M6, 0) + ISNULL(MASTER_DATA.M7, 0) + ISNULL(MASTER_DATA.M8, 0) + ISNULL(MASTER_DATA.M9, 0) + ISNULL(MASTER_DATA.M10, 0) + ISNULL(MASTER_DATA.M11, 0) + ISNULL(MASTER_DATA.M12, 0) AS REVISE_TOTAL_YEAR,
      ISNULL(ACTUAL_DATA.M1, 0) + ISNULL(ACTUAL_DATA.M2, 0) + ISNULL(ACTUAL_DATA.M3, 0) + ISNULL(MASTER_DATA.M4, 0) + ISNULL(MASTER_DATA.M5, 0) + ISNULL(MASTER_DATA.M6, 0) - ISNULL(ORIGINAL_BUDGET.H1, 0) + (ISNULL(MASTER_DATA.M7, 0) + ISNULL(MASTER_DATA.M8, 0) + ISNULL(MASTER_DATA.M9, 0) + ISNULL(MASTER_DATA.M10, 0) + ISNULL(MASTER_DATA.M11, 0) + ISNULL(MASTER_DATA.M12, 0) - ISNULL(ORIGINAL_BUDGET.H2, 0)) AS DIFF_TOTAL_YEAR,
      ISNULL(MASTER_DATA.RRT1, 0) AS RRT1,
      ISNULL(MASTER_DATA.RRT2, 0) AS RRT2,
      ISNULL(MASTER_DATA.RRT3, 0) AS RRT3,
      ISNULL(MASTER_DATA.RRT4, 0) AS RRT4,
      ISNULL(MASTER_DATA.RRT5, 0) AS RRT5
      FROM (
      SELECT ASSET_GROUP.ASSET_GROUP_NO, ASSET_GROUP.ASSET_GROUP_NAME, ASSET_GROUP.ASSET_PROJECT, ASSET_PROJECT.ASSET_PROJECT_TXT,
      ASSET_GROUP.ASSET_CATEGORY, CATEGORY.ASSET_CATEGORY_TXT, BUDGET_ORDER.BUDGET_ORDER_NO, BUDGET_DATA.BUDGET_YEAR,
      BUDGET_ORDER.COST_CENTER,
      BUDGET_DATA.PERIOD_TYPE,
      BUDGET_DATA.PROJECT_NO,
      MAX(BUDGET_DATA.REV_NO) AS REV_NO, BUDGET_ORDER.BUDGET_ORDER_NAME,
      BUDGET_ORDER.DEPT_NO, BUDGET_ORDER.PERSON_IN_CHARGE_NO
      FROM BG_M_ASSET_GROUP AS ASSET_GROUP
      INNER JOIN BG_M_ASSET_PROJECT AS ASSET_PROJECT ON ASSET_PROJECT.ASSET_PROJECT = ASSET_GROUP.ASSET_PROJECT
      INNER JOIN BG_M_ASSET_CATEGORY AS CATEGORY ON CATEGORY.ASSET_CATEGORY = ASSET_GROUP.ASSET_CATEGORY
      INNER JOIN BG_M_BUDGET_ORDER AS BUDGET_ORDER ON ASSET_GROUP.ASSET_GROUP_NO = BUDGET_ORDER.ASSET_GROUP_NO
      AND BUDGET_ORDER.BUDGET_TYPE = 'A' AND BUDGET_ORDER.ACTIVE_FLAG = 1
      LEFT OUTER JOIN BG_T_BUDGET_DATA AS BUDGET_DATA
      ON BUDGET_ORDER.BUDGET_ORDER_NO = BUDGET_DATA.BUDGET_ORDER_NO
      WHERE BUDGET_DATA.BUDGET_YEAR = @YEAR
      AND BUDGET_DATA.PERIOD_TYPE = @PERIOD
      AND BUDGET_DATA.PROJECT_NO = @PROJECT_NO
      AND BUDGET_DATA.REV_NO = @REV_NO
      @PICCONDITION

      GROUP BY ASSET_GROUP.ASSET_GROUP_NO, ASSET_GROUP.ASSET_GROUP_NAME, ASSET_GROUP.ASSET_PROJECT, ASSET_PROJECT.ASSET_PROJECT_TXT,
      ASSET_GROUP.ASSET_CATEGORY, CATEGORY.ASSET_CATEGORY_TXT, BUDGET_ORDER.BUDGET_ORDER_NO, BUDGET_DATA.BUDGET_YEAR, BUDGET_DATA.PERIOD_TYPE, BUDGET_DATA.PROJECT_NO,
      BUDGET_ORDER.BUDGET_ORDER_NAME, BUDGET_ORDER.DEPT_NO, BUDGET_ORDER.COST_CENTER,
      BUDGET_ORDER.PERSON_IN_CHARGE_NO) AS MAX_REV

      INNER JOIN BG_T_BUDGET_DATA AS MASTER_DATA
      ON MAX_REV.BUDGET_YEAR = MASTER_DATA.BUDGET_YEAR
      AND MAX_REV.PERIOD_TYPE = MASTER_DATA.PERIOD_TYPE
      AND MAX_REV.PROJECT_NO = MASTER_DATA.PROJECT_NO
      AND MAX_REV.BUDGET_ORDER_NO = MASTER_DATA.BUDGET_ORDER_NO
      AND MAX_REV.REV_NO = MASTER_DATA.REV_NO

      LEFT OUTER JOIN BG_T_UPLOAD_DATA AS ORIGINAL_BUDGET
      ON MAX_REV.BUDGET_YEAR = ORIGINAL_BUDGET.BUDGET_YEAR
      AND ORIGINAL_BUDGET.PERIOD_TYPE = @PERIOD
      AND ORIGINAL_BUDGET.PROJECT_NO = @PROJECT_NO
      AND MAX_REV.BUDGET_ORDER_NO = ORIGINAL_BUDGET.BUDGET_ORDER_NO
      AND ORIGINAL_BUDGET.DATA_TYPE = 1

      LEFT OUTER JOIN BG_T_UPLOAD_DATA AS ACTUAL_DATA
      ON ACTUAL_DATA.BUDGET_YEAR = MAX_REV.BUDGET_YEAR
      AND ACTUAL_DATA.PERIOD_TYPE = @PERIOD
      AND ACTUAL_DATA.PROJECT_NO = @PROJECT_NO
      AND ACTUAL_DATA.BUDGET_ORDER_NO = MAX_REV.BUDGET_ORDER_NO
      AND ACTUAL_DATA.DATA_TYPE = 2

      WHERE ISNULL(ORIGINAL_BUDGET.H1, 0) &lt;&gt; 0 OR ISNULL(ORIGINAL_BUDGET.H2, 0) &lt;&gt; 0 OR
      ISNULL(ACTUAL_DATA.M1, 0) &lt;&gt; 0 OR ISNULL(ACTUAL_DATA.M2, 0) &lt;&gt; 0 OR ISNULL(ACTUAL_DATA.M3, 0) &lt;&gt; 0 OR
      ISNULL(MASTER_DATA.M4, 0) &lt;&gt; 0 OR ISNULL(MASTER_DATA.M5, 0) &lt;&gt; 0 OR
      ISNULL(MASTER_DATA.M6, 0) &lt;&gt; 0 OR ISNULL(MASTER_DATA.M7, 0) &lt;&gt; 0 OR ISNULL(MASTER_DATA.M8, 0) &lt;&gt; 0 OR
      ISNULL(MASTER_DATA.M9, 0) &lt;&gt; 0 OR ISNULL(MASTER_DATA.M10, 0) &lt;&gt; 0 OR
      ISNULL(MASTER_DATA.M11, 0) &lt;&gt; 0 OR ISNULL(MASTER_DATA.M12, 0) &lt;&gt; 0 OR
      ISNULL(MASTER_DATA.RRT1, 0) &lt;&gt; 0 OR ISNULL(MASTER_DATA.RRT2, 0) &lt;&gt; 0 OR ISNULL(MASTER_DATA.RRT3, 0) &lt;&gt; 0
      OR ISNULL(MASTER_DATA.RRT4, 0) &lt;&gt; 0 OR ISNULL(MASTER_DATA.RRT5, 0) &lt;&gt; 0

      ORDER BY MAX_REV.ASSET_PROJECT, MAX_REV.ASSET_CATEGORY, MAX_REV.PERSON_IN_CHARGE_NO, MAX_REV.BUDGET_ORDER_NO
      --ORDER BY MAX_REV.ASSET_PROJECT, MAX_REV.ASSET_CATEGORY, MAX_REV.ASSET_GROUP_NO, MAX_REV.PERSON_IN_CHARGE_NO, MAX_REV.BUDGET_ORDER_NO

    </SELECT012_6 >

    <SELECT12_7>
    </SELECT12_7>

    <SELECT12_8>
    </SELECT12_8>

    <SELECT12_9>
    </SELECT12_9>

    <SELECT013>
      SELECT
      BD.*,
      (BD.M1+BD.M2+BD.M3+BD.M4+BD.M5+BD.M6) AS H1,
      (BD.M7+BD.M8+BD.M9+BD.M10+BD.M11+BD.M12) AS H2,
      (BD.M1+BD.M2+BD.M3+BD.M4+BD.M5+BD.M6+BD.M7+BD.M8+BD.M9+BD.M10+BD.M11+BD.M12) AS Y1,
      BO.BUDGET_ORDER_NAME,
      AC.ACCOUNT_NO, AC.ACCOUNT_NAME,
      BO.COST, BO.COST_TYPE, DP.DEPT_NO, DP.DEPT_NAME,
      PIC.PERSON_IN_CHARGE_NO, PIC.PERSON_IN_CHARGE_NAME,
      ISNULL(MTP.RRT2,0) AS MTP_RRT1,

      --(ISNULL((SELECT ISNULL(ISNULL(M10,0)+ISNULL(M11,0)+ISNULL(M12,0),0)
      --FROM BG_T_BUDGET_DATA
      --WHERE BUDGET_YEAR = (@BudgetYear-1)
      --AND PERIOD_TYPE = 2
      --AND REV_NO = (SELECT MAX(REV_NO) AS REV_NO FROM BG_T_BUDGET_DATA WHERE BUDGET_YEAR = (@BudgetYear-1) AND PERIOD_TYPE = 2 AND PROJECT_NO = @ProjectNo)
      --AND PROJECT_NO = @ProjectNo
      --AND BUDGET_ORDER_NO = BD.BUDGET_ORDER_NO),0)+
      --ISNULL((SELECT ISNULL(M7,0)+ISNULL(M8,0)+ISNULL(M9,0)
      --FROM BG_T_UPLOAD_DATA
      --WHERE BUDGET_YEAR = (@BudgetYear-1)
      --AND PERIOD_TYPE = 2
      --AND PROJECT_NO = @ProjectNo
      --AND DATA_TYPE = 2
      --AND BUDGET_ORDER_NO = BD.BUDGET_ORDER_NO),0)) AS IMP2

      (ISNULL((SELECT ISNULL(ISNULL(M10,0)+ISNULL(M11,0)+ISNULL(M12,0),0)
      FROM BG_T_BUDGET_DATA
      WHERE BUDGET_YEAR = (@BudgetYear-1)
      AND PERIOD_TYPE = 2
      AND REV_NO = @RefEstRevNo
      AND PROJECT_NO = @RefEstProjectNo
      AND BUDGET_ORDER_NO = BD.BUDGET_ORDER_NO),0) +
      ISNULL((SELECT ISNULL(M7,0)+ISNULL(M8,0)+ISNULL(M9,0)
      FROM BG_T_UPLOAD_DATA
      WHERE BUDGET_YEAR = (@BudgetYear-1)
      AND PERIOD_TYPE = 2
      AND PROJECT_NO = @RefEstProjectNo
      AND DATA_TYPE = 2
      AND BUDGET_ORDER_NO = BD.BUDGET_ORDER_NO),0)) AS IMP2

      FROM
      BG_T_BUDGET_DATA AS BD
      LEFT JOIN BG_M_BUDGET_ORDER AS BO ON BD.BUDGET_ORDER_NO = BO.BUDGET_ORDER_NO
      LEFT JOIN BG_M_ACCOUNT AS AC ON BO.ACCOUNT_NO = AC.ACCOUNT_NO
      LEFT JOIN BG_M_DEPT AS DP ON BO.DEPT_NO = DP.DEPT_NO
      LEFT JOIN BG_M_PERSON_IN_CHARGE AS PIC ON BO.PERSON_IN_CHARGE_NO = PIC.PERSON_IN_CHARGE_NO
      --LEFT JOIN BG_T_BUDGET_DATA AS MTP ON BD.BUDGET_ORDER_NO = MTP.BUDGET_ORDER_NO AND MTP.BUDGET_YEAR=(@BudgetYear-1) AND MTP.PERIOD_TYPE = 10 AND MTP.PROJECT_NO = @MtpProjectNo AND MTP.REV_NO = '@MtpRevNo'
      LEFT JOIN BG_T_BUDGET_DATA AS MTP ON BD.BUDGET_ORDER_NO = MTP.BUDGET_ORDER_NO AND MTP.BUDGET_YEAR=@RefBudgetYear AND MTP.PERIOD_TYPE = @RefPeriodType AND MTP.PROJECT_NO = @RefProjectNo AND MTP.REV_NO = @RefRevNo
      LEFT JOIN BG_T_BUDGET_HEADER AS BH
      ON BD.BUDGET_YEAR = BH.BUDGET_YEAR AND
      BD.PERIOD_TYPE = BH.PERIOD_TYPE AND
      BO.PERSON_IN_CHARGE_NO = BH.PERSON_IN_CHARGE_NO AND
      BO.BUDGET_TYPE = BH.BUDGET_TYPE AND
      BD.REV_NO = BH.REV_NO AND
      BD.PROJECT_NO = BH.PROJECT_NO
      WHERE
      BD.BUDGET_YEAR = @BudgetYear AND BD.PERIOD_TYPE = @PeriodType AND BD.REV_NO = @RevNo AND BD.PROJECT_NO = @ProjectNo AND
      BO.BUDGET_TYPE = '@BudgetType' AND BO.ACTIVE_FLAG = 1 AND BH.Status >= @Status
      AND BD.BUDGET_ORDER_NO NOT IN
      (
      SELECT BUDGET_ORDER_NO
      FROM BG_T_BUDGET_DATA_REINPUT
      WHERE BUDGET_YEAR =@BudgetYear
      AND PERIOD_TYPE = @PeriodType
      AND REV_NO = @RevNo
      AND PROJECT_NO = @ProjectNo
      )
      ORDER BY BD.BUDGET_ORDER_NO
    </SELECT013>
    <SELECT014_1>
      SELECT MAX_REV.BUDGET_YEAR, MAX_REV.PERIOD_TYPE, MAX_REV.PROJECT_NO, MAX_REV.PERSON_IN_CHARGE_NO, MAX_REV.PERSON_IN_CHARGE_NAME, MAX_REV.PIC_SHOW_FLAG,
      SUM(ISNULL(ACTUAL_DATA.H1, 0)) AS ACTUAL_FIRST_HALF,

      --SUM(ISNULL(REVISE_DATA.H2, 0)) AS REVISE_SECOND_HALF,
      SUM(ISNULL(MAX_REV.REVISE_SECOND_HALF, 0)) AS REVISE_SECOND_HALF,

      SUM(ISNULL(MASTER_DATA.M1, 0)) AS M1, SUM(ISNULL(MASTER_DATA.M2, 0)) AS M2, SUM(ISNULL(MASTER_DATA.M3, 0)) AS M3,
      SUM(ISNULL(MASTER_DATA.M4, 0)) AS M4, SUM(ISNULL(MASTER_DATA.M5, 0)) AS M5, SUM(ISNULL(MASTER_DATA.M6, 0)) AS M6,

      SUM(ISNULL(ACTUAL_DATA.H1, 0) + ISNULL(MAX_REV.REVISE_SECOND_HALF, 0)) AS LAST_YEAR_SUM,

      SUM((ISNULL(MASTER_DATA.M1, 0) + ISNULL(MASTER_DATA.M2, 0) + ISNULL(MASTER_DATA.M3, 0) + ISNULL(MASTER_DATA.M4, 0) + ISNULL(MASTER_DATA.M5,0) + ISNULL(MASTER_DATA.M6, 0) + ISNULL(MASTER_DATA.M7, 0) + ISNULL(MASTER_DATA.M8, 0) + ISNULL(MASTER_DATA.M9, 0) + ISNULL(MASTER_DATA.M10, 0) + ISNULL(MASTER_DATA.M11, 0)+ ISNULL(MASTER_DATA.M12, 0))) - (SUM(ISNULL(ACTUAL_DATA.H1, 0)) + SUM(ISNULL(MAX_REV.REVISE_SECOND_HALF, 0))) AS DIFF_YEAR,
      SUM(CASE WHEN MAX_REV.COST_TYPE = 1 THEN MASTER_DATA.M1 ELSE 0 END) AS M1_FIXCOST,
      SUM(CASE WHEN MAX_REV.COST_TYPE = 2 THEN MASTER_DATA.M1 ELSE 0 END) AS M1_VARIABLECOST,
      SUM(CASE WHEN MAX_REV.COST_TYPE = 1 THEN MASTER_DATA.M2 ELSE 0 END) AS M2_FIXCOST,
      SUM(CASE WHEN MAX_REV.COST_TYPE = 2 THEN MASTER_DATA.M2 ELSE 0 END) AS M2_VARIABLECOST,
      SUM(CASE WHEN MAX_REV.COST_TYPE = 1 THEN MASTER_DATA.M3 ELSE 0 END) AS M3_FIXCOST,
      SUM(CASE WHEN MAX_REV.COST_TYPE = 2 THEN MASTER_DATA.M3 ELSE 0 END) AS M3_VARIABLECOST,
      SUM(CASE WHEN MAX_REV.COST_TYPE = 1 THEN MASTER_DATA.M4 ELSE 0 END) AS M4_FIXCOST,
      SUM(CASE WHEN MAX_REV.COST_TYPE = 2 THEN MASTER_DATA.M4 ELSE 0 END) AS M4_VARIABLECOST,
      SUM(CASE WHEN MAX_REV.COST_TYPE = 1 THEN MASTER_DATA.M5 ELSE 0 END) AS M5_FIXCOST,
      SUM(CASE WHEN MAX_REV.COST_TYPE = 2 THEN MASTER_DATA.M5 ELSE 0 END) AS M5_VARIABLECOST,
      SUM(CASE WHEN MAX_REV.COST_TYPE = 1 THEN MASTER_DATA.M6 ELSE 0 END) AS M6_FIXCOST,
      SUM(CASE WHEN MAX_REV.COST_TYPE = 2 THEN MASTER_DATA.M6 ELSE 0 END) AS M6_VARIABLECOST,
      SUM(CASE WHEN MAX_REV.COST_TYPE = 1 THEN ISNULL(ACTUAL_DATA.H1, 0) ELSE 0 END) AS ACTUAL_FIRST_HALF_FIXCOST,
      SUM(CASE WHEN MAX_REV.COST_TYPE = 2 THEN ISNULL(ACTUAL_DATA.H1, 0) ELSE 0 END) AS ACTUAL_FIRST_HALF_VARIABLECOST,
      SUM(CASE WHEN MAX_REV.COST_TYPE = 1 THEN ISNULL(MAX_REV.REVISE_SECOND_HALF, 0) ELSE 0 END) AS REVISE_SECOND_HALF_FIXCOST,
      SUM(CASE WHEN MAX_REV.COST_TYPE = 2 THEN ISNULL(MAX_REV.REVISE_SECOND_HALF, 0) ELSE 0 END) AS REVISE_SECOND_HALF_VARIABLECOST,
      SUM((ISNULL(MASTER_DATA.M1, 0) + ISNULL(MASTER_DATA.M2, 0) + ISNULL(MASTER_DATA.M3, 0) + ISNULL(MASTER_DATA.M4, 0) + ISNULL(MASTER_DATA.M5,0) + ISNULL(MASTER_DATA.M6, 0))) AS FIRST_HALF_SUM,
      SUM((ISNULL(MASTER_DATA.M7, 0) + ISNULL(MASTER_DATA.M8, 0) + ISNULL(MASTER_DATA.M9, 0) + ISNULL(MASTER_DATA.M10, 0) + ISNULL(MASTER_DATA.M11, 0)+ ISNULL(MASTER_DATA.M12, 0))) AS SECOND_HALF_SUM,
      SUM((ISNULL(MASTER_DATA.M1, 0) + ISNULL(MASTER_DATA.M2, 0) + ISNULL(MASTER_DATA.M3, 0) + ISNULL(MASTER_DATA.M4, 0) + ISNULL(MASTER_DATA.M5,0) + ISNULL(MASTER_DATA.M6, 0) + ISNULL(MASTER_DATA.M7, 0) + ISNULL(MASTER_DATA.M8, 0) + ISNULL(MASTER_DATA.M9, 0) + ISNULL(MASTER_DATA.M10, 0) + ISNULL(MASTER_DATA.M11, 0)+ ISNULL(MASTER_DATA.M12, 0))) AS YEAR_SUM,
      SUM(CASE WHEN MAX_REV.COST_TYPE = 1 THEN (ISNULL(MASTER_DATA.M1, 0) + ISNULL(MASTER_DATA.M2, 0) + ISNULL(MASTER_DATA.M3, 0) + ISNULL(MASTER_DATA.M4, 0) + ISNULL(MASTER_DATA.M5,0) + ISNULL(MASTER_DATA.M6, 0)) ELSE 0 END) AS FIRST_HALF_FIXCOST,
      SUM(CASE WHEN MAX_REV.COST_TYPE = 2 THEN (ISNULL(MASTER_DATA.M1, 0) + ISNULL(MASTER_DATA.M2, 0) + ISNULL(MASTER_DATA.M3, 0) + ISNULL(MASTER_DATA.M4, 0) + ISNULL(MASTER_DATA.M5,0) + ISNULL(MASTER_DATA.M6, 0)) ELSE 0 END) AS FIRST_HALF_VARIABLECOST,
      SUM(CASE WHEN MAX_REV.COST_TYPE = 1 THEN (ISNULL(MASTER_DATA.M7, 0) + ISNULL(MASTER_DATA.M8, 0) + ISNULL(MASTER_DATA.M9, 0) + ISNULL(MASTER_DATA.M10, 0) + ISNULL(MASTER_DATA.M11, 0)+ ISNULL(MASTER_DATA.M12, 0)) ELSE 0 END) AS SECOND_HALF_FIXCOST,
      SUM(CASE WHEN MAX_REV.COST_TYPE = 2 THEN (ISNULL(MASTER_DATA.M7, 0) + ISNULL(MASTER_DATA.M8, 0) + ISNULL(MASTER_DATA.M9, 0) + ISNULL(MASTER_DATA.M10, 0) + ISNULL(MASTER_DATA.M11, 0)+ ISNULL(MASTER_DATA.M12, 0)) ELSE 0 END) AS SECOND_HALF_VARIABLECOST,
      SUM(CASE WHEN MAX_REV.COST_TYPE = 1 THEN (ISNULL(MASTER_DATA.M1, 0) + ISNULL(MASTER_DATA.M2, 0) + ISNULL(MASTER_DATA.M3, 0) + ISNULL(MASTER_DATA.M4, 0) + ISNULL(MASTER_DATA.M5,0) + ISNULL(MASTER_DATA.M6, 0) + ISNULL(MASTER_DATA.M7, 0) + ISNULL(MASTER_DATA.M8, 0) + ISNULL(MASTER_DATA.M9, 0) + ISNULL(MASTER_DATA.M10, 0) + ISNULL(MASTER_DATA.M11, 0)+ ISNULL(MASTER_DATA.M12, 0)) ELSE 0 END) AS YEAR_FIXCOST,
      SUM(CASE WHEN MAX_REV.COST_TYPE = 2 THEN (ISNULL(MASTER_DATA.M1, 0) + ISNULL(MASTER_DATA.M2, 0) + ISNULL(MASTER_DATA.M3, 0) + ISNULL(MASTER_DATA.M4, 0) + ISNULL(MASTER_DATA.M5,0) + ISNULL(MASTER_DATA.M6, 0) + ISNULL(MASTER_DATA.M7, 0) + ISNULL(MASTER_DATA.M8, 0) + ISNULL(MASTER_DATA.M9, 0) + ISNULL(MASTER_DATA.M10, 0) + ISNULL(MASTER_DATA.M11, 0)+ ISNULL(MASTER_DATA.M12, 0)) ELSE 0 END) AS YEAR_VARIABLECOST,
      SUM(CASE WHEN MAX_REV.COST_TYPE = 1 THEN ISNULL(ACTUAL_DATA.H1, 0) + ISNULL(MAX_REV.REVISE_SECOND_HALF, 0) ELSE 0 END) AS LAST_YEAR_SUM_FIXCOST,
      SUM(CASE WHEN MAX_REV.COST_TYPE = 2 THEN ISNULL(ACTUAL_DATA.H1, 0) + ISNULL(MAX_REV.REVISE_SECOND_HALF, 0) ELSE 0 END) AS LAST_YEAR_SUM_VARIABLECOST,
      SUM(CASE WHEN MAX_REV.COST_TYPE = 1 THEN (ISNULL(MASTER_DATA.M1, 0) + ISNULL(MASTER_DATA.M2, 0) + ISNULL(MASTER_DATA.M3, 0) + ISNULL(MASTER_DATA.M4, 0) + ISNULL(MASTER_DATA.M5,0) + ISNULL(MASTER_DATA.M6, 0) + ISNULL(MASTER_DATA.M7, 0) + ISNULL(MASTER_DATA.M8, 0) + ISNULL(MASTER_DATA.M9, 0) + ISNULL(MASTER_DATA.M10, 0) + ISNULL(MASTER_DATA.M11, 0)+ ISNULL(MASTER_DATA.M12, 0)) - (ISNULL(ACTUAL_DATA.H1, 0) + ISNULL(MAX_REV.REVISE_SECOND_HALF, 0)) ELSE 0 END) AS DIFF_YEAR_FIXCOST,
      SUM(CASE WHEN MAX_REV.COST_TYPE = 2 THEN (ISNULL(MASTER_DATA.M1, 0) + ISNULL(MASTER_DATA.M2, 0) + ISNULL(MASTER_DATA.M3, 0) + ISNULL(MASTER_DATA.M4, 0) + ISNULL(MASTER_DATA.M5,0) + ISNULL(MASTER_DATA.M6, 0) + ISNULL(MASTER_DATA.M7, 0) + ISNULL(MASTER_DATA.M8, 0) + ISNULL(MASTER_DATA.M9, 0) + ISNULL(MASTER_DATA.M10, 0) + ISNULL(MASTER_DATA.M11, 0)+ ISNULL(MASTER_DATA.M12, 0)) - (ISNULL(ACTUAL_DATA.H1, 0) + ISNULL(MAX_REV.REVISE_SECOND_HALF, 0)) ELSE 0 END) AS DIFF_YEAR_VARIABLECOST
      ,SUM(ISNULL(MTP.RRT2,0)) AS MTP_RRT1
      ,SUM(CASE WHEN MAX_REV.COST_TYPE = 1 THEN ISNULL(MTP.RRT2,0) ELSE 0 END) AS MTP_RRT1_FIXCOST
      ,SUM(CASE WHEN MAX_REV.COST_TYPE = 2 THEN ISNULL(MTP.RRT2,0) ELSE 0 END) AS MTP_RRT1_VARIABLECOST
      ,SUM((ISNULL(MASTER_DATA.M1, 0) + ISNULL(MASTER_DATA.M2, 0) + ISNULL(MASTER_DATA.M3, 0) + ISNULL(MASTER_DATA.M4, 0) + ISNULL(MASTER_DATA.M5,0) + ISNULL(MASTER_DATA.M6, 0) + ISNULL(MASTER_DATA.M7, 0) + ISNULL(MASTER_DATA.M8, 0) + ISNULL(MASTER_DATA.M9, 0) + ISNULL(MASTER_DATA.M10, 0) + ISNULL(MASTER_DATA.M11, 0)+ ISNULL(MASTER_DATA.M12, 0)) - (ISNULL(MTP.RRT2,0))) AS DIFF_MTP
      ,SUM(CASE WHEN MAX_REV.COST_TYPE = 1 THEN (ISNULL(MASTER_DATA.M1, 0) + ISNULL(MASTER_DATA.M2, 0) + ISNULL(MASTER_DATA.M3, 0) + ISNULL(MASTER_DATA.M4, 0) + ISNULL(MASTER_DATA.M5,0) + ISNULL(MASTER_DATA.M6, 0) + ISNULL(MASTER_DATA.M7, 0) + ISNULL(MASTER_DATA.M8, 0) + ISNULL(MASTER_DATA.M9, 0) + ISNULL(MASTER_DATA.M10, 0) + ISNULL(MASTER_DATA.M11, 0)+ ISNULL(MASTER_DATA.M12, 0)) - (ISNULL(MTP.RRT2,0)) ELSE 0 END) AS DIFF_MTP_FIXCOST
      ,SUM(CASE WHEN MAX_REV.COST_TYPE = 2 THEN (ISNULL(MASTER_DATA.M1, 0) + ISNULL(MASTER_DATA.M2, 0) + ISNULL(MASTER_DATA.M3, 0) + ISNULL(MASTER_DATA.M4, 0) + ISNULL(MASTER_DATA.M5,0) + ISNULL(MASTER_DATA.M6, 0) + ISNULL(MASTER_DATA.M7, 0) + ISNULL(MASTER_DATA.M8, 0) + ISNULL(MASTER_DATA.M9, 0) + ISNULL(MASTER_DATA.M10, 0) + ISNULL(MASTER_DATA.M11, 0)+ ISNULL(MASTER_DATA.M12, 0)) - (ISNULL(MTP.RRT2,0)) ELSE 0 END) AS DIFF_MTP_VARIABLECOST

      ,SUM(ISNULL(MASTER_DATA.M7, 0)) AS M7, SUM(ISNULL(MASTER_DATA.M8, 0)) AS M8, SUM(ISNULL(MASTER_DATA.M9, 0)) AS M9,
      SUM(ISNULL(MASTER_DATA.M10, 0)) AS M10, SUM(ISNULL(MASTER_DATA.M11, 0)) AS M11, SUM(ISNULL(MASTER_DATA.M12, 0)) AS M12
      ,SUM(CASE WHEN MAX_REV.COST_TYPE = 1 THEN MASTER_DATA.M7 ELSE 0 END) AS M7_FIXCOST,
      SUM(CASE WHEN MAX_REV.COST_TYPE = 2 THEN MASTER_DATA.M7 ELSE 0 END) AS M7_VARIABLECOST,
      SUM(CASE WHEN MAX_REV.COST_TYPE = 1 THEN MASTER_DATA.M8 ELSE 0 END) AS M8_FIXCOST,
      SUM(CASE WHEN MAX_REV.COST_TYPE = 2 THEN MASTER_DATA.M8 ELSE 0 END) AS M8_VARIABLECOST,
      SUM(CASE WHEN MAX_REV.COST_TYPE = 1 THEN MASTER_DATA.M9 ELSE 0 END) AS M9_FIXCOST,
      SUM(CASE WHEN MAX_REV.COST_TYPE = 2 THEN MASTER_DATA.M9 ELSE 0 END) AS M9_VARIABLECOST,
      SUM(CASE WHEN MAX_REV.COST_TYPE = 1 THEN MASTER_DATA.M10 ELSE 0 END) AS M10_FIXCOST,
      SUM(CASE WHEN MAX_REV.COST_TYPE = 2 THEN MASTER_DATA.M10 ELSE 0 END) AS M10_VARIABLECOST,
      SUM(CASE WHEN MAX_REV.COST_TYPE = 1 THEN MASTER_DATA.M11 ELSE 0 END) AS M11_FIXCOST,
      SUM(CASE WHEN MAX_REV.COST_TYPE = 2 THEN MASTER_DATA.M11 ELSE 0 END) AS M11_VARIABLECOST,
      SUM(CASE WHEN MAX_REV.COST_TYPE = 1 THEN MASTER_DATA.M12 ELSE 0 END) AS M12_FIXCOST,
      SUM(CASE WHEN MAX_REV.COST_TYPE = 2 THEN MASTER_DATA.M12 ELSE 0 END) AS M12_VARIABLECOST

      FROM (
      SELECT BUDGET_DATA.BUDGET_ORDER_NO, BUDGET_DATA.BUDGET_YEAR, BUDGET_ORDER.COST_TYPE,
      BUDGET_DATA.PERIOD_TYPE, BUDGET_DATA.PROJECT_NO, MAX(BUDGET_DATA.REV_NO) AS REV_NO, BUDGET_ORDER.BUDGET_ORDER_NAME,
      BUDGET_ORDER.DEPT_NO, BUDGET_ORDER.PERSON_IN_CHARGE_NO, PIC.PERSON_IN_CHARGE_NAME, BUDGET_ORDER.PIC_SHOW_FLAG

      ,ISNULL((SELECT ISNULL(ISNULL(M10,0)+ISNULL(M11,0)+ISNULL(M12,0),0)
      FROM BG_T_BUDGET_DATA
      WHERE BUDGET_YEAR = (@YEAR-1)
      AND PERIOD_TYPE = 2
      -- AND REV_NO = (SELECT MAX(REV_NO) AS REV_NO FROM BG_T_BUDGET_DATA WHERE BUDGET_YEAR = (@YEAR-1) AND PERIOD_TYPE = 2 AND PROJECT_NO = @PROJECTNO)
      -- AND PROJECT_NO = @PROJECTNO
      AND REV_NO = @RefEstRevNo
      AND PROJECT_NO = @RefEstProjectNo
      AND BUDGET_ORDER_NO = BUDGET_DATA.BUDGET_ORDER_NO),0)+
      ISNULL((SELECT ISNULL(M7,0)+ISNULL(M8,0)+ISNULL(M9,0)
      FROM BG_T_UPLOAD_DATA
      WHERE BUDGET_YEAR = (@YEAR-1)
      AND PERIOD_TYPE = 2
      --AND PROJECT_NO = @PROJECTNO
      AND PROJECT_NO = @RefEstProjectNo
      AND DATA_TYPE = 2
      AND BUDGET_ORDER_NO = BUDGET_DATA.BUDGET_ORDER_NO),0) AS REVISE_SECOND_HALF

      FROM BG_T_BUDGET_DATA AS BUDGET_DATA
      INNER JOIN BG_M_BUDGET_ORDER AS BUDGET_ORDER
      ON BUDGET_ORDER.BUDGET_ORDER_NO = BUDGET_DATA.BUDGET_ORDER_NO AND BUDGET_ORDER.BUDGET_TYPE = 'E' AND BUDGET_ORDER.ACTIVE_FLAG = 1
      LEFT JOIN BG_M_PERSON_IN_CHARGE AS PIC ON PIC.PERSON_IN_CHARGE_NO = BUDGET_ORDER.PERSON_IN_CHARGE_NO
      WHERE BUDGET_DATA.BUDGET_YEAR = @YEAR
      AND BUDGET_DATA.PERIOD_TYPE = @PERIOD
      AND BUDGET_DATA.PROJECT_NO = @PROJECTNO
      GROUP BY BUDGET_DATA.BUDGET_ORDER_NO, BUDGET_DATA.BUDGET_YEAR, BUDGET_DATA.PERIOD_TYPE, BUDGET_DATA.PROJECT_NO, BUDGET_ORDER.BUDGET_ORDER_NAME, BUDGET_ORDER.DEPT_NO, BUDGET_ORDER.COST_TYPE,
      BUDGET_ORDER.PERSON_IN_CHARGE_NO, PIC.PERSON_IN_CHARGE_NAME, BUDGET_ORDER.PIC_SHOW_FLAG) AS MAX_REV

      INNER JOIN BG_T_BUDGET_DATA AS MASTER_DATA
      ON MAX_REV.BUDGET_YEAR = MASTER_DATA.BUDGET_YEAR
      AND MAX_REV.PERIOD_TYPE = MASTER_DATA.PERIOD_TYPE
      AND MAX_REV.PROJECT_NO = MASTER_DATA.PROJECT_NO
      AND MAX_REV.BUDGET_ORDER_NO = MASTER_DATA.BUDGET_ORDER_NO
      AND MAX_REV.REV_NO = MASTER_DATA.REV_NO

      LEFT OUTER JOIN BG_T_UPLOAD_DATA AS ACTUAL_DATA
      ON ACTUAL_DATA.BUDGET_YEAR = MAX_REV.BUDGET_YEAR - 1
      AND ACTUAL_DATA.PERIOD_TYPE = @PERIOD
      AND ACTUAL_DATA.PROJECT_NO = @PROJECTNO
      AND ACTUAL_DATA.BUDGET_ORDER_NO = MAX_REV.BUDGET_ORDER_NO
      AND ACTUAL_DATA.DATA_TYPE = 2

      LEFT OUTER JOIN BG_T_UPLOAD_DATA AS REVISE_DATA
      ON REVISE_DATA.BUDGET_YEAR = MAX_REV.BUDGET_YEAR - 1
      AND REVISE_DATA.PERIOD_TYPE = @PERIOD
      AND REVISE_DATA.PROJECT_NO = @PROJECTNO
      AND REVISE_DATA.BUDGET_ORDER_NO = MAX_REV.BUDGET_ORDER_NO
      AND REVISE_DATA.DATA_TYPE = 1

      LEFT JOIN BG_T_BUDGET_DATA AS MTP
      ON MAX_REV.BUDGET_ORDER_NO = MTP.BUDGET_ORDER_NO
      AND MTP.BUDGET_YEAR=(@YEAR-2)
      AND MTP.PERIOD_TYPE = 10
      AND MTP.PROJECT_NO = @MtpProjectNo
      AND MTP.REV_NO = @MtpRevNo
      --AND MTP.REV_NO = (SELECT ISNULL(MAX(REV_NO),1) AS MAX_REV_NO FROM BG_T_BUDGET_HEADER
      --WHERE BUDGET_YEAR = (@YEAR-1)
      --AND PERIOD_TYPE = 10 AND BUDGET_TYPE = 'E' AND PROJECT_NO = @MtpProjectNo)

      WHERE ISNULL(ACTUAL_DATA.H1, 0) &lt;&gt; 0 OR ISNULL(MAX_REV.REVISE_SECOND_HALF, 0) &lt;&gt; 0 OR (ISNULL(MASTER_DATA.M1, 0) &lt;&gt; 0
      OR ISNULL(MASTER_DATA.M2, 0) &lt;&gt; 0 OR ISNULL(MASTER_DATA.M3, 0) &lt;&gt; 0
      OR ISNULL(MASTER_DATA.M4, 0) &lt;&gt; 0 OR ISNULL(MASTER_DATA.M5, 0) &lt;&gt; 0
      OR ISNULL(MASTER_DATA.M6, 0) &lt;&gt; 0 OR ISNULL(MASTER_DATA.M7, 0) &lt;&gt; 0
      OR ISNULL(MASTER_DATA.M8, 0) &lt;&gt; 0 OR ISNULL(MASTER_DATA.M9, 0) &lt;&gt; 0
      OR ISNULL(MTP.RRT2,0) &lt;&gt; 0
      OR ISNULL(MASTER_DATA.M10, 0) &lt;&gt; 0 OR ISNULL(MASTER_DATA.M11, 0) &lt;&gt; 0 OR ISNULL(MASTER_DATA.M12, 0) &lt;&gt; 0)

      GROUP BY MAX_REV.BUDGET_YEAR, MAX_REV.PERIOD_TYPE, MAX_REV.PROJECT_NO, MAX_REV.PERSON_IN_CHARGE_NO, MAX_REV.PERSON_IN_CHARGE_NAME, MAX_REV.PIC_SHOW_FLAG
      ORDER BY MAX_REV.PERSON_IN_CHARGE_NO
    </SELECT014_1>
    <SELECT014_2>
      SELECT MAX_REV.BUDGET_YEAR, MAX_REV.PERIOD_TYPE, MAX_REV.PROJECT_NO, MAX_REV.PERSON_IN_CHARGE_NO, MAX_REV.PERSON_IN_CHARGE_NAME, MAX_REV.PIC_SHOW_FLAG,
      SUM(ISNULL(ACTUAL_DATA.H1, 0)) AS ACTUAL_FIRST_HALF,
      SUM(ISNULL(REVISE_BUDGET.M7, 0) + ISNULL(REVISE_BUDGET.M8, 0) + ISNULL(REVISE_BUDGET.M9, 0) + ISNULL(REVISE_BUDGET.M10, 0) + ISNULL(REVISE_BUDGET.M11, 0) + ISNULL(REVISE_BUDGET.M12, 0)) AS REVISE_SECOND_HALF,
      SUM(ISNULL(ACTUAL_DATA.M7, 0)) AS M7, SUM(ISNULL(ACTUAL_DATA.M8, 0)) AS M8,
      SUM(ISNULL(ACTUAL_DATA.M9, 0)) AS M9, SUM(ISNULL(MASTER_DATA.M10, 0)) AS M10,
      SUM(ISNULL(MASTER_DATA.M11, 0)) AS M11, SUM(ISNULL(MASTER_DATA.M12, 0)) AS M12,
      SUM(CASE WHEN MAX_REV.COST_TYPE = 1 THEN ISNULL(ACTUAL_DATA.M7, 0) ELSE 0 END) AS M7_FIXCOST,
      SUM(CASE WHEN MAX_REV.COST_TYPE = 2 THEN ISNULL(ACTUAL_DATA.M7, 0) ELSE 0 END) AS M7_VARIABLECOST,
      SUM(CASE WHEN MAX_REV.COST_TYPE = 1 THEN ISNULL(ACTUAL_DATA.M8, 0) ELSE 0 END) AS M8_FIXCOST,
      SUM(CASE WHEN MAX_REV.COST_TYPE = 2 THEN ISNULL(ACTUAL_DATA.M8, 0) ELSE 0 END) AS M8_VARIABLECOST,
      SUM(CASE WHEN MAX_REV.COST_TYPE = 1 THEN ISNULL(ACTUAL_DATA.M9, 0) ELSE 0 END) AS M9_FIXCOST,
      SUM(CASE WHEN MAX_REV.COST_TYPE = 2 THEN ISNULL(ACTUAL_DATA.M9, 0) ELSE 0 END) AS M9_VARIABLECOST,
      SUM(CASE WHEN MAX_REV.COST_TYPE = 1 THEN ISNULL(MASTER_DATA.M10, 0) ELSE 0 END) AS M10_FIXCOST,
      SUM(CASE WHEN MAX_REV.COST_TYPE = 2 THEN ISNULL(MASTER_DATA.M10, 0) ELSE 0 END) AS M10_VARIABLECOST,
      SUM(CASE WHEN MAX_REV.COST_TYPE = 1 THEN ISNULL(MASTER_DATA.M11, 0) ELSE 0 END) AS M11_FIXCOST,
      SUM(CASE WHEN MAX_REV.COST_TYPE = 2 THEN ISNULL(MASTER_DATA.M11, 0) ELSE 0 END) AS M11_VARIABLECOST,
      SUM(CASE WHEN MAX_REV.COST_TYPE = 1 THEN ISNULL(MASTER_DATA.M12, 0) ELSE 0 END) AS M12_FIXCOST,
      SUM(CASE WHEN MAX_REV.COST_TYPE = 2 THEN ISNULL(MASTER_DATA.M12, 0) ELSE 0 END) AS M12_VARIABLECOST,
      SUM(ISNULL(ACTUAL_DATA.M7, 0) + ISNULL(ACTUAL_DATA.M8, 0) + ISNULL(ACTUAL_DATA.M9, 0) + ISNULL(MASTER_DATA.M10, 0) + ISNULL(MASTER_DATA.M11,0) + ISNULL(MASTER_DATA.M12, 0)) AS ESTIMATE_SECOND_HALF,
      SUM(ISNULL(ACTUAL_DATA.M7, 0) + ISNULL(ACTUAL_DATA.M8, 0) + ISNULL(ACTUAL_DATA.M9, 0) + ISNULL(MASTER_DATA.M10, 0) + ISNULL(MASTER_DATA.M11,0) + ISNULL(MASTER_DATA.M12, 0) - (ISNULL(REVISE_BUDGET.M7, 0) + ISNULL(REVISE_BUDGET.M8, 0) + ISNULL(REVISE_BUDGET.M9, 0) + ISNULL(REVISE_BUDGET.M10, 0) + ISNULL(REVISE_BUDGET.M11, 0) + ISNULL(REVISE_BUDGET.M12, 0))) AS DIFFERENCE_SECOND_HALF,
      SUM(ISNULL(ACTUAL_DATA.H1, 0) + ISNULL(ACTUAL_DATA.M7, 0) + ISNULL(ACTUAL_DATA.M8, 0) + ISNULL(ACTUAL_DATA.M9, 0) + ISNULL(MASTER_DATA.M10, 0) + ISNULL(MASTER_DATA.M11,0) + ISNULL(MASTER_DATA.M12, 0)) AS ESTIMATE_TOTAL_YEAR,
      SUM(CASE WHEN MAX_REV.COST_TYPE = 1 THEN ISNULL(ACTUAL_DATA.H1, 0) ELSE 0 END) AS ACTUAL_FIRST_HALF_FIXCOST,
      SUM(CASE WHEN MAX_REV.COST_TYPE = 2 THEN ISNULL(ACTUAL_DATA.H1, 0) ELSE 0 END) AS ACTUAL_FIRST_HALF_VARIABLECOST,
      SUM(CASE WHEN MAX_REV.COST_TYPE = 1 THEN (ISNULL(REVISE_BUDGET.M7, 0) + ISNULL(REVISE_BUDGET.M8, 0) + ISNULL(REVISE_BUDGET.M9, 0) + ISNULL(REVISE_BUDGET.M10, 0) + ISNULL(REVISE_BUDGET.M11, 0) + ISNULL(REVISE_BUDGET.M12, 0)) ELSE 0 END) AS REVISE_SECOND_HALF_FIXCOST,
      SUM(CASE WHEN MAX_REV.COST_TYPE = 2 THEN (ISNULL(REVISE_BUDGET.M7, 0) + ISNULL(REVISE_BUDGET.M8, 0) + ISNULL(REVISE_BUDGET.M9, 0) + ISNULL(REVISE_BUDGET.M10, 0) + ISNULL(REVISE_BUDGET.M11, 0) + ISNULL(REVISE_BUDGET.M12, 0)) ELSE 0 END) AS REVISE_SECOND_HALF_VARIABLECOST,
      SUM(CASE WHEN MAX_REV.COST_TYPE = 1 THEN (ISNULL(ACTUAL_DATA.M7, 0) + ISNULL(ACTUAL_DATA.M8, 0) + ISNULL(ACTUAL_DATA.M9, 0) + ISNULL(MASTER_DATA.M10, 0) + ISNULL(MASTER_DATA.M11,0) + ISNULL(MASTER_DATA.M12, 0)) ELSE 0 END) AS ESTIMATE_SECOND_HALF_FIXCOST,
      SUM(CASE WHEN MAX_REV.COST_TYPE = 2 THEN (ISNULL(ACTUAL_DATA.M7, 0) + ISNULL(ACTUAL_DATA.M8, 0) + ISNULL(ACTUAL_DATA.M9, 0) + ISNULL(MASTER_DATA.M10, 0) + ISNULL(MASTER_DATA.M11,0) + ISNULL(MASTER_DATA.M12, 0)) ELSE 0 END) AS ESTIMATE_SECOND_HALF_VARIABLECOST,
      SUM(CASE WHEN MAX_REV.COST_TYPE = 1 THEN (ISNULL(ACTUAL_DATA.M7, 0) + ISNULL(ACTUAL_DATA.M8, 0) + ISNULL(ACTUAL_DATA.M9, 0) + ISNULL(MASTER_DATA.M10, 0) + ISNULL(MASTER_DATA.M11,0) + ISNULL(MASTER_DATA.M12, 0) - (ISNULL(REVISE_BUDGET.M7, 0) + ISNULL(REVISE_BUDGET.M8, 0) + ISNULL(REVISE_BUDGET.M9, 0) + ISNULL(REVISE_BUDGET.M10, 0) + ISNULL(REVISE_BUDGET.M11, 0) + ISNULL(REVISE_BUDGET.M12, 0))) ELSE 0 END) AS DIFFERENCE_SECOND_HALF_FIXCOST,
      SUM(CASE WHEN MAX_REV.COST_TYPE = 2 THEN (ISNULL(ACTUAL_DATA.M7, 0) + ISNULL(ACTUAL_DATA.M8, 0) + ISNULL(ACTUAL_DATA.M9, 0) + ISNULL(MASTER_DATA.M10, 0) + ISNULL(MASTER_DATA.M11,0) + ISNULL(MASTER_DATA.M12, 0) - (ISNULL(REVISE_BUDGET.M7, 0) + ISNULL(REVISE_BUDGET.M8, 0) + ISNULL(REVISE_BUDGET.M9, 0) + ISNULL(REVISE_BUDGET.M10, 0) + ISNULL(REVISE_BUDGET.M11, 0) + ISNULL(REVISE_BUDGET.M12, 0))) ELSE 0 END) AS DIFFERENCE_SECOND_HALF_VARIABLECOST,
      SUM(CASE WHEN MAX_REV.COST_TYPE = 1 THEN (ISNULL(ACTUAL_DATA.H1, 0) + ISNULL(ACTUAL_DATA.M7, 0) + ISNULL(ACTUAL_DATA.M8, 0) + ISNULL(ACTUAL_DATA.M9, 0) + ISNULL(MASTER_DATA.M10, 0) + ISNULL(MASTER_DATA.M11,0) + ISNULL(MASTER_DATA.M12, 0)) ELSE 0 END) AS ESTIMATE_TOTAL_YEAR_FIXCOST,
      SUM(CASE WHEN MAX_REV.COST_TYPE = 2 THEN (ISNULL(ACTUAL_DATA.H1, 0) + ISNULL(ACTUAL_DATA.M7, 0) + ISNULL(ACTUAL_DATA.M8, 0) + ISNULL(ACTUAL_DATA.M9, 0) + ISNULL(MASTER_DATA.M10, 0) + ISNULL(MASTER_DATA.M11,0) + ISNULL(MASTER_DATA.M12, 0)) ELSE 0 END) AS ESTIMATE_TOTAL_YEAR_VARIABLECOST
      FROM (
      SELECT BUDGET_DATA.BUDGET_ORDER_NO, BUDGET_DATA.BUDGET_YEAR, BUDGET_ORDER.COST_TYPE,
      BUDGET_DATA.PERIOD_TYPE, BUDGET_DATA.PROJECT_NO, MAX(BUDGET_DATA.REV_NO) AS REV_NO, BUDGET_ORDER.BUDGET_ORDER_NAME,
      BUDGET_ORDER.DEPT_NO, BUDGET_ORDER.PERSON_IN_CHARGE_NO, PIC.PERSON_IN_CHARGE_NAME, BUDGET_ORDER.PIC_SHOW_FLAG
      FROM BG_T_BUDGET_DATA AS BUDGET_DATA
      INNER JOIN BG_M_BUDGET_ORDER AS BUDGET_ORDER
      ON BUDGET_ORDER.BUDGET_ORDER_NO = BUDGET_DATA.BUDGET_ORDER_NO AND BUDGET_ORDER.BUDGET_TYPE = 'E' AND BUDGET_ORDER.ACTIVE_FLAG = 1
      LEFT JOIN BG_M_PERSON_IN_CHARGE AS PIC ON PIC.PERSON_IN_CHARGE_NO = BUDGET_ORDER.PERSON_IN_CHARGE_NO
      WHERE BUDGET_DATA.BUDGET_YEAR = @YEAR
      AND BUDGET_DATA.PERIOD_TYPE = @PERIOD
      AND BUDGET_DATA.PROJECT_NO = @PROJECTNO
      GROUP BY BUDGET_DATA.BUDGET_ORDER_NO, BUDGET_DATA.BUDGET_YEAR, BUDGET_DATA.PERIOD_TYPE, BUDGET_DATA.PROJECT_NO, BUDGET_ORDER.BUDGET_ORDER_NAME, BUDGET_ORDER.DEPT_NO, BUDGET_ORDER.COST_TYPE,
      BUDGET_ORDER.PERSON_IN_CHARGE_NO, PIC.PERSON_IN_CHARGE_NAME, BUDGET_ORDER.PIC_SHOW_FLAG) AS MAX_REV

      INNER JOIN BG_T_BUDGET_DATA AS MASTER_DATA
      ON MAX_REV.BUDGET_YEAR = MASTER_DATA.BUDGET_YEAR
      AND MASTER_DATA.PERIOD_TYPE = @PERIOD
      AND MASTER_DATA.PROJECT_NO = @PROJECTNO
      AND MAX_REV.BUDGET_ORDER_NO = MASTER_DATA.BUDGET_ORDER_NO
      AND MAX_REV.REV_NO = MASTER_DATA.REV_NO

      ---- change Revise to OB 02/05/2018
      --LEFT OUTER JOIN BG_T_UPLOAD_DATA AS REVISE_BUDGET
      --ON MAX_REV.BUDGET_YEAR = REVISE_BUDGET.BUDGET_YEAR
      ----AND REVISE_BUDGET.PERIOD_TYPE = 2
      --AND REVISE_BUDGET.PERIOD_TYPE = 1
      --AND REVISE_BUDGET.PROJECT_NO = 1
      --AND MAX_REV.BUDGET_ORDER_NO = REVISE_BUDGET.BUDGET_ORDER_NO
      --AND REVISE_BUDGET.DATA_TYPE = 1
      LEFT JOIN BG_T_BUDGET_DATA AS REVISE_BUDGET
      ON  REVISE_BUDGET.BUDGET_YEAR =  MAX_REV.BUDGET_YEAR
      AND REVISE_BUDGET.PERIOD_TYPE = 1
      AND REVISE_BUDGET.PROJECT_NO = MAX_REV.PROJECT_NO
      AND REVISE_BUDGET.BUDGET_ORDER_NO = MAX_REV.BUDGET_ORDER_NO
      AND REVISE_BUDGET.REV_NO = MAX_REV.REV_NO

      LEFT OUTER JOIN BG_T_UPLOAD_DATA AS ACTUAL_DATA
      ON ACTUAL_DATA.BUDGET_YEAR = MAX_REV.BUDGET_YEAR
      AND ACTUAL_DATA.PERIOD_TYPE = @PERIOD
      AND ACTUAL_DATA.PROJECT_NO = @PROJECTNO
      AND ACTUAL_DATA.BUDGET_ORDER_NO = MAX_REV.BUDGET_ORDER_NO
      AND ACTUAL_DATA.DATA_TYPE = 2

      WHERE ISNULL(ACTUAL_DATA.H1, 0) &lt;&gt; 0 
      OR ISNULL(REVISE_BUDGET.M7, 0) &lt;&gt; 0
      OR ISNULL(REVISE_BUDGET.M8, 0) &lt;&gt; 0
      OR ISNULL(REVISE_BUDGET.M9, 0) &lt;&gt; 0
      OR ISNULL(REVISE_BUDGET.M10, 0) &lt;&gt; 0
      OR ISNULL(REVISE_BUDGET.M11, 0) &lt;&gt; 0
      OR ISNULL(REVISE_BUDGET.M12, 0) &lt;&gt; 0
      OR ISNULL(ACTUAL_DATA.M7, 0) &lt;&gt; 0 
      OR ISNULL(ACTUAL_DATA.M8, 0) &lt;&gt; 0 OR ISNULL(ACTUAL_DATA.M9, 0) &lt;&gt; 0 OR
      ISNULL(MASTER_DATA.M10, 0) &lt;&gt; 0 OR ISNULL(MASTER_DATA.M11, 0) &lt;&gt; 0 OR ISNULL(MASTER_DATA.M12, 0) &lt;&gt; 0

      GROUP BY MAX_REV.BUDGET_YEAR, MAX_REV.PERIOD_TYPE, MAX_REV.PROJECT_NO, MAX_REV.PERSON_IN_CHARGE_NO, MAX_REV.PERSON_IN_CHARGE_NAME, MAX_REV.PIC_SHOW_FLAG
      ORDER BY MAX_REV.PERSON_IN_CHARGE_NO
    </SELECT014_2>
    <SELECT014_3>
      SELECT MAX_REV.BUDGET_YEAR, MAX_REV.PERIOD_TYPE, MAX_REV.PROJECT_NO, MAX_REV.PERSON_IN_CHARGE_NO, MAX_REV.PERSON_IN_CHARGE_NAME, MAX_REV.PIC_SHOW_FLAG,
      SUM(ISNULL(ORIGINAL_BUDGET.H1, 0)) AS ORIGINAL_FIRST_HALF,
      SUM(ISNULL(ACTUAL_DATA.M1, 0)) AS M1, SUM(ISNULL(ACTUAL_DATA.M2, 0)) AS M2,
      SUM(ISNULL(ACTUAL_DATA.M3, 0)) AS M3, SUM(ISNULL(MASTER_DATA.M4, 0)) AS M4,
      SUM(ISNULL(MASTER_DATA.M5, 0)) AS M5, SUM(ISNULL(MASTER_DATA.M6, 0)) AS M6,
      SUM(ISNULL(ACTUAL_DATA.M1, 0) + ISNULL(ACTUAL_DATA.M2, 0) + ISNULL(ACTUAL_DATA.M3, 0) + ISNULL(MASTER_DATA.M4, 0) + ISNULL(MASTER_DATA.M5, 0) + ISNULL(MASTER_DATA.M6, 0)) AS ESTIMATE_FIRST_HALF,
      SUM(ISNULL(ACTUAL_DATA.M1, 0) + ISNULL(ACTUAL_DATA.M2, 0) + ISNULL(ACTUAL_DATA.M3, 0) + ISNULL(MASTER_DATA.M4, 0) + ISNULL(MASTER_DATA.M5, 0) + ISNULL(MASTER_DATA.M6, 0) - ISNULL(ORIGINAL_BUDGET.H1, 0)) AS DIFF_FIRST_HALF,
      SUM(ISNULL(ORIGINAL_BUDGET.H2, 0)) AS ORIGINAL_SECOND_HALF,
      SUM(ISNULL(MASTER_DATA.M7, 0)) AS M7, SUM(ISNULL(MASTER_DATA.M8, 0)) AS M8,
      SUM(ISNULL(MASTER_DATA.M9, 0)) AS M9, SUM(ISNULL(MASTER_DATA.M10, 0)) AS M10,
      SUM(ISNULL(MASTER_DATA.M11, 0)) AS M11, SUM(ISNULL(MASTER_DATA.M12, 0)) AS M12,
      SUM(ISNULL(MASTER_DATA.M7, 0) + ISNULL(MASTER_DATA.M8, 0) + ISNULL(MASTER_DATA.M9, 0) + ISNULL(MASTER_DATA.M10, 0) + ISNULL(MASTER_DATA.M11, 0) + ISNULL(MASTER_DATA.M12, 0)) AS REVISE_SECOND_HALF,
      SUM(ISNULL(MASTER_DATA.M7, 0) + ISNULL(MASTER_DATA.M8, 0) + ISNULL(MASTER_DATA.M9, 0) + ISNULL(MASTER_DATA.M10, 0) + ISNULL(MASTER_DATA.M11, 0) + ISNULL(MASTER_DATA.M12, 0) - ISNULL(ORIGINAL_BUDGET.H2, 0)) AS DIFF_SECOND_HALF,
      SUM(ISNULL(ACTUAL_DATA.M1, 0) + ISNULL(ACTUAL_DATA.M2, 0) + ISNULL(ACTUAL_DATA.M3, 0) + ISNULL(MASTER_DATA.M4, 0) + ISNULL(MASTER_DATA.M5, 0) + ISNULL(MASTER_DATA.M6, 0) + ISNULL(MASTER_DATA.M7, 0) + ISNULL(MASTER_DATA.M8, 0) + ISNULL(MASTER_DATA.M9, 0) + ISNULL(MASTER_DATA.M10, 0) + ISNULL(MASTER_DATA.M11, 0) + ISNULL(MASTER_DATA.M12, 0)) AS REVISE_TOTAL_YEAR,
      SUM(ISNULL(ACTUAL_DATA.M1, 0) + ISNULL(ACTUAL_DATA.M2, 0) + ISNULL(ACTUAL_DATA.M3, 0) + ISNULL(MASTER_DATA.M4, 0) + ISNULL(MASTER_DATA.M5, 0) + ISNULL(MASTER_DATA.M6, 0) - ISNULL(ORIGINAL_BUDGET.H1, 0) + (ISNULL(MASTER_DATA.M7, 0) + ISNULL(MASTER_DATA.M8, 0) + ISNULL(MASTER_DATA.M9, 0) + ISNULL(MASTER_DATA.M10, 0) + ISNULL(MASTER_DATA.M11, 0) + ISNULL(MASTER_DATA.M12, 0) - ISNULL(ORIGINAL_BUDGET.H2, 0))) AS DIFF_TOTAL_YEAR,
      SUM(ISNULL(MASTER_DATA.RRT1, 0)) AS RRT1,
      SUM(ISNULL(MASTER_DATA.RRT2, 0)) AS RRT2,
      SUM(ISNULL(MASTER_DATA.RRT3, 0)) AS RRT3,
      SUM(ISNULL(MASTER_DATA.RRT4, 0)) AS RRT4,
      SUM(ISNULL(MASTER_DATA.RRT5, 0)) AS RRT5,
      SUM(CASE WHEN MAX_REV.COST_TYPE = 1 THEN ISNULL(MASTER_DATA.RRT1, 0) ELSE 0 END) AS RRT1_FIXCOST,
      SUM(CASE WHEN MAX_REV.COST_TYPE = 2 THEN ISNULL(MASTER_DATA.RRT1, 0) ELSE 0 END) AS RRT1_VARIABLECOST,
      SUM(CASE WHEN MAX_REV.COST_TYPE = 1 THEN ISNULL(MASTER_DATA.RRT2, 0) ELSE 0 END) AS RRT2_FIXCOST,
      SUM(CASE WHEN MAX_REV.COST_TYPE = 2 THEN ISNULL(MASTER_DATA.RRT2, 0) ELSE 0 END) AS RRT2_VARIABLECOST,
      SUM(CASE WHEN MAX_REV.COST_TYPE = 1 THEN ISNULL(MASTER_DATA.RRT3, 0) ELSE 0 END) AS RRT3_FIXCOST,
      SUM(CASE WHEN MAX_REV.COST_TYPE = 2 THEN ISNULL(MASTER_DATA.RRT3, 0) ELSE 0 END) AS RRT3_VARIABLECOST,
      SUM(CASE WHEN MAX_REV.COST_TYPE = 1 THEN ISNULL(MASTER_DATA.RRT4, 0) ELSE 0 END) AS RRT4_FIXCOST,
      SUM(CASE WHEN MAX_REV.COST_TYPE = 2 THEN ISNULL(MASTER_DATA.RRT4, 0) ELSE 0 END) AS RRT4_VARIABLECOST,
      SUM(CASE WHEN MAX_REV.COST_TYPE = 1 THEN ISNULL(MASTER_DATA.RRT5, 0) ELSE 0 END) AS RRT5_FIXCOST,
      SUM(CASE WHEN MAX_REV.COST_TYPE = 2 THEN ISNULL(MASTER_DATA.RRT5, 0) ELSE 0 END) AS RRT5_VARIABLECOST,
      SUM(CASE WHEN MAX_REV.COST_TYPE = 1 THEN ISNULL(ORIGINAL_BUDGET.H1, 0) ELSE 0 END) AS ORIGINAL_FIRST_HALF_FIXCOST,
      SUM(CASE WHEN MAX_REV.COST_TYPE = 2 THEN ISNULL(ORIGINAL_BUDGET.H1, 0) ELSE 0 END) AS ORIGINAL_FIRST_HALF_VARIABLECOST,
      SUM(CASE WHEN MAX_REV.COST_TYPE = 1 THEN ISNULL(ACTUAL_DATA.M1, 0) ELSE 0 END) AS M1_FIXCOST,
      SUM(CASE WHEN MAX_REV.COST_TYPE = 2 THEN ISNULL(ACTUAL_DATA.M1, 0) ELSE 0 END) AS M1_VARIABLECOST,
      SUM(CASE WHEN MAX_REV.COST_TYPE = 1 THEN ISNULL(ACTUAL_DATA.M2, 0) ELSE 0 END) AS M2_FIXCOST,
      SUM(CASE WHEN MAX_REV.COST_TYPE = 2 THEN ISNULL(ACTUAL_DATA.M2, 0) ELSE 0 END) AS M2_VARIABLECOST,
      SUM(CASE WHEN MAX_REV.COST_TYPE = 1 THEN ISNULL(ACTUAL_DATA.M3, 0) ELSE 0 END) AS M3_FIXCOST,
      SUM(CASE WHEN MAX_REV.COST_TYPE = 2 THEN ISNULL(ACTUAL_DATA.M3, 0) ELSE 0 END) AS M3_VARIABLECOST,
      SUM(CASE WHEN MAX_REV.COST_TYPE = 1 THEN ISNULL(MASTER_DATA.M4, 0) ELSE 0 END) AS M4_FIXCOST,
      SUM(CASE WHEN MAX_REV.COST_TYPE = 2 THEN ISNULL(MASTER_DATA.M4, 0) ELSE 0 END) AS M4_VARIABLECOST,
      SUM(CASE WHEN MAX_REV.COST_TYPE = 1 THEN ISNULL(MASTER_DATA.M5, 0) ELSE 0 END) AS M5_FIXCOST,
      SUM(CASE WHEN MAX_REV.COST_TYPE = 2 THEN ISNULL(MASTER_DATA.M5, 0) ELSE 0 END) AS M5_VARIABLECOST,
      SUM(CASE WHEN MAX_REV.COST_TYPE = 1 THEN ISNULL(MASTER_DATA.M6, 0) ELSE 0 END) AS M6_FIXCOST,
      SUM(CASE WHEN MAX_REV.COST_TYPE = 2 THEN ISNULL(MASTER_DATA.M6, 0) ELSE 0 END) AS M6_VARIABLECOST,
      SUM(CASE WHEN MAX_REV.COST_TYPE = 1 THEN ISNULL(ACTUAL_DATA.M1, 0) + ISNULL(ACTUAL_DATA.M2, 0) + ISNULL(ACTUAL_DATA.M3, 0) + ISNULL(MASTER_DATA.M4, 0) + ISNULL(MASTER_DATA.M5, 0) + ISNULL(MASTER_DATA.M6, 0) ELSE 0 END) AS ESTIMATE_FIRST_HALF_FIXCOST,
      SUM(CASE WHEN MAX_REV.COST_TYPE = 2 THEN ISNULL(ACTUAL_DATA.M1, 0) + ISNULL(ACTUAL_DATA.M2, 0) + ISNULL(ACTUAL_DATA.M3, 0) + ISNULL(MASTER_DATA.M4, 0) + ISNULL(MASTER_DATA.M5, 0) + ISNULL(MASTER_DATA.M6, 0) ELSE 0 END) AS ESTIMATE_FIRST_HALF_VARIABLECOST,
      SUM(CASE WHEN MAX_REV.COST_TYPE = 1 THEN ISNULL(ACTUAL_DATA.M1, 0) + ISNULL(ACTUAL_DATA.M2, 0) + ISNULL(ACTUAL_DATA.M3, 0) + ISNULL(MASTER_DATA.M4, 0) + ISNULL(MASTER_DATA.M5, 0) + ISNULL(MASTER_DATA.M6, 0) - ISNULL(ORIGINAL_BUDGET.H1, 0) ELSE 0 END) AS DIFF_FIRST_HALF_FIXCOST,
      SUM(CASE WHEN MAX_REV.COST_TYPE = 2 THEN ISNULL(ACTUAL_DATA.M1, 0) + ISNULL(ACTUAL_DATA.M2, 0) + ISNULL(ACTUAL_DATA.M3, 0) + ISNULL(MASTER_DATA.M4, 0) + ISNULL(MASTER_DATA.M5, 0) + ISNULL(MASTER_DATA.M6, 0) - ISNULL(ORIGINAL_BUDGET.H1, 0) ELSE 0 END) AS DIFF_FIRST_HALF_VARIABLECOST,
      SUM(CASE WHEN MAX_REV.COST_TYPE = 1 THEN ISNULL(ORIGINAL_BUDGET.H2, 0) ELSE 0 END) AS ORIGINAL_SECOND_HALF_FIXCOST,
      SUM(CASE WHEN MAX_REV.COST_TYPE = 2 THEN ISNULL(ORIGINAL_BUDGET.H2, 0) ELSE 0 END) AS ORIGINAL_SECOND_HALF_VARIABLECOST,
      SUM(CASE WHEN MAX_REV.COST_TYPE = 1 THEN ISNULL(MASTER_DATA.M7, 0) ELSE 0 END) AS M7_FIXCOST,
      SUM(CASE WHEN MAX_REV.COST_TYPE = 2 THEN ISNULL(MASTER_DATA.M7, 0) ELSE 0 END) AS M7_VARIABLECOST,
      SUM(CASE WHEN MAX_REV.COST_TYPE = 1 THEN ISNULL(MASTER_DATA.M8, 0) ELSE 0 END) AS M8_FIXCOST,
      SUM(CASE WHEN MAX_REV.COST_TYPE = 2 THEN ISNULL(MASTER_DATA.M8, 0) ELSE 0 END) AS M8_VARIABLECOST,
      SUM(CASE WHEN MAX_REV.COST_TYPE = 1 THEN ISNULL(MASTER_DATA.M9, 0) ELSE 0 END) AS M9_FIXCOST,
      SUM(CASE WHEN MAX_REV.COST_TYPE = 2 THEN ISNULL(MASTER_DATA.M9, 0) ELSE 0 END) AS M9_VARIABLECOST,
      SUM(CASE WHEN MAX_REV.COST_TYPE = 1 THEN ISNULL(MASTER_DATA.M10, 0) ELSE 0 END) AS M10_FIXCOST,
      SUM(CASE WHEN MAX_REV.COST_TYPE = 2 THEN ISNULL(MASTER_DATA.M10, 0) ELSE 0 END) AS M10_VARIABLECOST,
      SUM(CASE WHEN MAX_REV.COST_TYPE = 1 THEN ISNULL(MASTER_DATA.M11, 0) ELSE 0 END) AS M11_FIXCOST,
      SUM(CASE WHEN MAX_REV.COST_TYPE = 2 THEN ISNULL(MASTER_DATA.M11, 0) ELSE 0 END) AS M11_VARIABLECOST,
      SUM(CASE WHEN MAX_REV.COST_TYPE = 1 THEN ISNULL(MASTER_DATA.M12, 0) ELSE 0 END) AS M12_FIXCOST,
      SUM(CASE WHEN MAX_REV.COST_TYPE = 2 THEN ISNULL(MASTER_DATA.M12, 0) ELSE 0 END) AS M12_VARIABLECOST,
      SUM(CASE WHEN MAX_REV.COST_TYPE = 1 THEN ISNULL(MASTER_DATA.M7, 0) + ISNULL(MASTER_DATA.M8, 0) + ISNULL(MASTER_DATA.M9, 0) + ISNULL(MASTER_DATA.M10, 0) + ISNULL(MASTER_DATA.M11, 0) + ISNULL(MASTER_DATA.M12, 0) ELSE 0 END) AS REVISE_SECOND_HALF_FIXCOST,
      SUM(CASE WHEN MAX_REV.COST_TYPE = 2 THEN ISNULL(MASTER_DATA.M7, 0) + ISNULL(MASTER_DATA.M8, 0) + ISNULL(MASTER_DATA.M9, 0) + ISNULL(MASTER_DATA.M10, 0) + ISNULL(MASTER_DATA.M11, 0) + ISNULL(MASTER_DATA.M12, 0) ELSE 0 END) AS REVISE_SECOND_HALF_VARIABLECOST,
      SUM(CASE WHEN MAX_REV.COST_TYPE = 1 THEN ISNULL(MASTER_DATA.M7, 0) + ISNULL(MASTER_DATA.M8, 0) + ISNULL(MASTER_DATA.M9, 0) + ISNULL(MASTER_DATA.M10, 0) + ISNULL(MASTER_DATA.M11, 0) + ISNULL(MASTER_DATA.M12, 0) - ISNULL(ORIGINAL_BUDGET.H2, 0) ELSE 0 END) AS DIFF_SECOND_HALF_FIXCOST,
      SUM(CASE WHEN MAX_REV.COST_TYPE = 2 THEN ISNULL(MASTER_DATA.M7, 0) + ISNULL(MASTER_DATA.M8, 0) + ISNULL(MASTER_DATA.M9, 0) + ISNULL(MASTER_DATA.M10, 0) + ISNULL(MASTER_DATA.M11, 0) + ISNULL(MASTER_DATA.M12, 0) - ISNULL(ORIGINAL_BUDGET.H2, 0) ELSE 0 END) AS DIFF_SECOND_HALF_VARIABLECOST,
      SUM(CASE WHEN MAX_REV.COST_TYPE = 1 THEN ISNULL(ACTUAL_DATA.M1, 0) + ISNULL(ACTUAL_DATA.M2, 0) + ISNULL(ACTUAL_DATA.M3, 0) + ISNULL(MASTER_DATA.M4, 0) + ISNULL(MASTER_DATA.M5, 0) + ISNULL(MASTER_DATA.M6, 0) + ISNULL(MASTER_DATA.M7, 0) + ISNULL(MASTER_DATA.M8, 0) + ISNULL(MASTER_DATA.M9, 0) + ISNULL(MASTER_DATA.M10, 0) + ISNULL(MASTER_DATA.M11, 0) + ISNULL(MASTER_DATA.M12, 0) ELSE 0 END) AS REVISE_TOTAL_YEAR_FIXCOST,
      SUM(CASE WHEN MAX_REV.COST_TYPE = 2 THEN ISNULL(ACTUAL_DATA.M1, 0) + ISNULL(ACTUAL_DATA.M2, 0) + ISNULL(ACTUAL_DATA.M3, 0) + ISNULL(MASTER_DATA.M4, 0) + ISNULL(MASTER_DATA.M5, 0) + ISNULL(MASTER_DATA.M6, 0) + ISNULL(MASTER_DATA.M7, 0) + ISNULL(MASTER_DATA.M8, 0) + ISNULL(MASTER_DATA.M9, 0) + ISNULL(MASTER_DATA.M10, 0) + ISNULL(MASTER_DATA.M11, 0) + ISNULL(MASTER_DATA.M12, 0) ELSE 0 END) AS REVISE_TOTAL_YEAR_VARIABLECOST,
      SUM(CASE WHEN MAX_REV.COST_TYPE = 1 THEN ISNULL(ACTUAL_DATA.M1, 0) + ISNULL(ACTUAL_DATA.M2, 0) + ISNULL(ACTUAL_DATA.M3, 0) + ISNULL(MASTER_DATA.M4, 0) + ISNULL(MASTER_DATA.M5, 0) + ISNULL(MASTER_DATA.M6, 0) - ISNULL(ORIGINAL_BUDGET.H1, 0) + (ISNULL(MASTER_DATA.M7, 0) + ISNULL(MASTER_DATA.M8, 0) + ISNULL(MASTER_DATA.M9, 0) + ISNULL(MASTER_DATA.M10, 0) + ISNULL(MASTER_DATA.M11, 0) + ISNULL(MASTER_DATA.M12, 0) - ISNULL(ORIGINAL_BUDGET.H2, 0)) ELSE 0 END) AS DIFF_TOTAL_YEAR_FIXCOST,
      SUM(CASE WHEN MAX_REV.COST_TYPE = 2 THEN ISNULL(ACTUAL_DATA.M1, 0) + ISNULL(ACTUAL_DATA.M2, 0) + ISNULL(ACTUAL_DATA.M3, 0) + ISNULL(MASTER_DATA.M4, 0) + ISNULL(MASTER_DATA.M5, 0) + ISNULL(MASTER_DATA.M6, 0) - ISNULL(ORIGINAL_BUDGET.H1, 0) + (ISNULL(MASTER_DATA.M7, 0) + ISNULL(MASTER_DATA.M8, 0) + ISNULL(MASTER_DATA.M9, 0) + ISNULL(MASTER_DATA.M10, 0) + ISNULL(MASTER_DATA.M11, 0) + ISNULL(MASTER_DATA.M12, 0) - ISNULL(ORIGINAL_BUDGET.H2, 0)) ELSE 0 END) AS DIFF_TOTAL_YEAR_VARIABLECOST
      FROM (
      SELECT BUDGET_DATA.BUDGET_ORDER_NO, BUDGET_DATA.BUDGET_YEAR, BUDGET_ORDER.COST_TYPE,
      BUDGET_DATA.PERIOD_TYPE, BUDGET_DATA.PROJECT_NO, MAX(BUDGET_DATA.REV_NO) AS REV_NO, BUDGET_ORDER.BUDGET_ORDER_NAME,
      BUDGET_ORDER.DEPT_NO, BUDGET_ORDER.PERSON_IN_CHARGE_NO, PIC.PERSON_IN_CHARGE_NAME, BUDGET_ORDER.PIC_SHOW_FLAG
      FROM BG_T_BUDGET_DATA AS BUDGET_DATA
      INNER JOIN BG_M_BUDGET_ORDER AS BUDGET_ORDER
      ON BUDGET_ORDER.BUDGET_ORDER_NO = BUDGET_DATA.BUDGET_ORDER_NO AND BUDGET_ORDER.BUDGET_TYPE = 'E' AND BUDGET_ORDER.ACTIVE_FLAG = 1
      LEFT JOIN BG_M_PERSON_IN_CHARGE AS PIC ON PIC.PERSON_IN_CHARGE_NO = BUDGET_ORDER.PERSON_IN_CHARGE_NO
      WHERE BUDGET_DATA.BUDGET_YEAR = @YEAR
      AND BUDGET_DATA.PERIOD_TYPE = @PERIOD
      AND BUDGET_DATA.PROJECT_NO = @PROJECTNO

      GROUP BY BUDGET_DATA.BUDGET_ORDER_NO, BUDGET_DATA.BUDGET_YEAR, BUDGET_DATA.PERIOD_TYPE, BUDGET_DATA.PROJECT_NO, BUDGET_ORDER.BUDGET_ORDER_NAME, BUDGET_ORDER.DEPT_NO, BUDGET_ORDER.COST_TYPE,
      BUDGET_ORDER.PERSON_IN_CHARGE_NO, PIC.PERSON_IN_CHARGE_NAME, BUDGET_ORDER.PIC_SHOW_FLAG) AS MAX_REV

      INNER JOIN BG_T_BUDGET_DATA AS MASTER_DATA
      ON MAX_REV.BUDGET_YEAR = MASTER_DATA.BUDGET_YEAR
      AND MAX_REV.PERIOD_TYPE = MASTER_DATA.PERIOD_TYPE
      AND MAX_REV.PROJECT_NO = MASTER_DATA.PROJECT_NO
      AND MAX_REV.BUDGET_ORDER_NO = MASTER_DATA.BUDGET_ORDER_NO
      AND MAX_REV.REV_NO = MASTER_DATA.REV_NO

      LEFT OUTER JOIN BG_T_UPLOAD_DATA AS ORIGINAL_BUDGET
      ON MAX_REV.BUDGET_YEAR = ORIGINAL_BUDGET.BUDGET_YEAR
      AND ORIGINAL_BUDGET.PERIOD_TYPE = @PERIOD
      AND ORIGINAL_BUDGET.PROJECT_NO = @PROJECTNO
      AND MAX_REV.BUDGET_ORDER_NO = ORIGINAL_BUDGET.BUDGET_ORDER_NO
      AND ORIGINAL_BUDGET.DATA_TYPE = 1

      LEFT OUTER JOIN BG_T_UPLOAD_DATA AS ACTUAL_DATA
      ON ACTUAL_DATA.BUDGET_YEAR = MAX_REV.BUDGET_YEAR
      AND ACTUAL_DATA.PERIOD_TYPE = @PERIOD
      AND ACTUAL_DATA.PROJECT_NO = @PROJECTNO
      AND ACTUAL_DATA.BUDGET_ORDER_NO = MAX_REV.BUDGET_ORDER_NO
      AND ACTUAL_DATA.DATA_TYPE = 2

      WHERE ISNULL(ORIGINAL_BUDGET.H1, 0) &lt;&gt; 0 OR ISNULL(ORIGINAL_BUDGET.H2, 0) &lt;&gt; 0 OR
      ISNULL(ACTUAL_DATA.M1, 0) &lt;&gt; 0 OR ISNULL(ACTUAL_DATA.M2, 0) &lt;&gt; 0 OR ISNULL(ACTUAL_DATA.M3, 0) &lt;&gt; 0 OR
      ISNULL(MASTER_DATA.M4, 0) &lt;&gt; 0 OR ISNULL(MASTER_DATA.M5, 0) &lt;&gt; 0 OR ISNULL(MASTER_DATA.M6, 0) &lt;&gt; 0 OR
      ISNULL(MASTER_DATA.M7, 0) &lt;&gt; 0 OR ISNULL(MASTER_DATA.M8, 0) &lt;&gt; 0 OR ISNULL(MASTER_DATA.M9, 0) &lt;&gt; 0 OR
      ISNULL(MASTER_DATA.M10, 0) &lt;&gt; 0 OR ISNULL(MASTER_DATA.M11, 0) &lt;&gt; 0 OR ISNULL(MASTER_DATA.M12, 0) &lt;&gt; 0 OR
      ISNULL(MASTER_DATA.RRT1, 0) &lt;&gt; 0 OR ISNULL(MASTER_DATA.RRT2, 0) &lt;&gt; 0 OR ISNULL(MASTER_DATA.RRT3, 0) &lt;&gt; 0
      OR ISNULL(MASTER_DATA.RRT4, 0) &lt;&gt; 0 OR ISNULL(MASTER_DATA.RRT5, 0) &lt;&gt; 0

      GROUP BY MAX_REV.BUDGET_YEAR, MAX_REV.PERIOD_TYPE, MAX_REV.PROJECT_NO, MAX_REV.PERSON_IN_CHARGE_NO, MAX_REV.PERSON_IN_CHARGE_NAME, MAX_REV.PIC_SHOW_FLAG
      ORDER BY MAX_REV.PERSON_IN_CHARGE_NO
    </SELECT014_3 >
    <SELECT014_4>
      SELECT MAX_REV.BUDGET_YEAR, MAX_REV.PERIOD_TYPE, MAX_REV.PROJECT_NO, MAX_REV.PERSON_IN_CHARGE_NO, MAX_REV.PERSON_IN_CHARGE_NAME, MAX_REV.PIC_SHOW_FLAG,
      SUM(ISNULL(ACTUAL_DATA.H1, 0)) AS ACTUAL_FIRST_HALF,

      SUM(ISNULL(MAX_REV.REVISE_SECOND_HALF, 0)) AS REVISE_SECOND_HALF,

      SUM(ISNULL(MASTER_DATA.M1, 0)) AS M1, SUM(ISNULL(MASTER_DATA.M2, 0)) AS M2, SUM(ISNULL(MASTER_DATA.M3, 0)) AS M3,
      SUM(ISNULL(MASTER_DATA.M4, 0)) AS M4, SUM(ISNULL(MASTER_DATA.M5, 0)) AS M5, SUM(ISNULL(MASTER_DATA.M6, 0)) AS M6,

      SUM(ISNULL(ACTUAL_DATA.H1, 0) + ISNULL(MAX_REV.REVISE_SECOND_HALF, 0)) AS LAST_YEAR_SUM,

      SUM((ISNULL(MASTER_DATA.M1, 0) + ISNULL(MASTER_DATA.M2, 0) + ISNULL(MASTER_DATA.M3, 0) + ISNULL(MASTER_DATA.M4, 0) + ISNULL(MASTER_DATA.M5,0) + ISNULL(MASTER_DATA.M6, 0) + ISNULL(MASTER_DATA.M7, 0) + ISNULL(MASTER_DATA.M8, 0) + ISNULL(MASTER_DATA.M9, 0) + ISNULL(MASTER_DATA.M10, 0) + ISNULL(MASTER_DATA.M11, 0)+ ISNULL(MASTER_DATA.M12, 0))) - (SUM(ISNULL(ACTUAL_DATA.H1, 0)) + SUM(ISNULL(MAX_REV.REVISE_SECOND_HALF, 0))) AS DIFF_YEAR,
      SUM(CASE WHEN MAX_REV.COST_TYPE = 1 THEN MASTER_DATA.M1 ELSE 0 END) AS M1_FIXCOST,
      SUM(CASE WHEN MAX_REV.COST_TYPE = 2 THEN MASTER_DATA.M1 ELSE 0 END) AS M1_VARIABLECOST,
      SUM(CASE WHEN MAX_REV.COST_TYPE = 1 THEN MASTER_DATA.M2 ELSE 0 END) AS M2_FIXCOST,
      SUM(CASE WHEN MAX_REV.COST_TYPE = 2 THEN MASTER_DATA.M2 ELSE 0 END) AS M2_VARIABLECOST,
      SUM(CASE WHEN MAX_REV.COST_TYPE = 1 THEN MASTER_DATA.M3 ELSE 0 END) AS M3_FIXCOST,
      SUM(CASE WHEN MAX_REV.COST_TYPE = 2 THEN MASTER_DATA.M3 ELSE 0 END) AS M3_VARIABLECOST,
      SUM(CASE WHEN MAX_REV.COST_TYPE = 1 THEN MASTER_DATA.M4 ELSE 0 END) AS M4_FIXCOST,
      SUM(CASE WHEN MAX_REV.COST_TYPE = 2 THEN MASTER_DATA.M4 ELSE 0 END) AS M4_VARIABLECOST,
      SUM(CASE WHEN MAX_REV.COST_TYPE = 1 THEN MASTER_DATA.M5 ELSE 0 END) AS M5_FIXCOST,
      SUM(CASE WHEN MAX_REV.COST_TYPE = 2 THEN MASTER_DATA.M5 ELSE 0 END) AS M5_VARIABLECOST,
      SUM(CASE WHEN MAX_REV.COST_TYPE = 1 THEN MASTER_DATA.M6 ELSE 0 END) AS M6_FIXCOST,
      SUM(CASE WHEN MAX_REV.COST_TYPE = 2 THEN MASTER_DATA.M6 ELSE 0 END) AS M6_VARIABLECOST,
      SUM(CASE WHEN MAX_REV.COST_TYPE = 1 THEN ISNULL(ACTUAL_DATA.H1, 0) ELSE 0 END) AS ACTUAL_FIRST_HALF_FIXCOST,
      SUM(CASE WHEN MAX_REV.COST_TYPE = 2 THEN ISNULL(ACTUAL_DATA.H1, 0) ELSE 0 END) AS ACTUAL_FIRST_HALF_VARIABLECOST,
      SUM(CASE WHEN MAX_REV.COST_TYPE = 1 THEN ISNULL(MAX_REV.REVISE_SECOND_HALF, 0) ELSE 0 END) AS REVISE_SECOND_HALF_FIXCOST,
      SUM(CASE WHEN MAX_REV.COST_TYPE = 2 THEN ISNULL(MAX_REV.REVISE_SECOND_HALF, 0) ELSE 0 END) AS REVISE_SECOND_HALF_VARIABLECOST,
      SUM((ISNULL(MASTER_DATA.M1, 0) + ISNULL(MASTER_DATA.M2, 0) + ISNULL(MASTER_DATA.M3, 0) + ISNULL(MASTER_DATA.M4, 0) + ISNULL(MASTER_DATA.M5,0) + ISNULL(MASTER_DATA.M6, 0))) AS FIRST_HALF_SUM,
      SUM((ISNULL(MASTER_DATA.M7, 0) + ISNULL(MASTER_DATA.M8, 0) + ISNULL(MASTER_DATA.M9, 0) + ISNULL(MASTER_DATA.M10, 0) + ISNULL(MASTER_DATA.M11, 0)+ ISNULL(MASTER_DATA.M12, 0))) AS SECOND_HALF_SUM,
      SUM((ISNULL(MASTER_DATA.M1, 0) + ISNULL(MASTER_DATA.M2, 0) + ISNULL(MASTER_DATA.M3, 0) + ISNULL(MASTER_DATA.M4, 0) + ISNULL(MASTER_DATA.M5,0) + ISNULL(MASTER_DATA.M6, 0) + ISNULL(MASTER_DATA.M7, 0) + ISNULL(MASTER_DATA.M8, 0) + ISNULL(MASTER_DATA.M9, 0) + ISNULL(MASTER_DATA.M10, 0) + ISNULL(MASTER_DATA.M11, 0)+ ISNULL(MASTER_DATA.M12, 0))) AS YEAR_SUM,
      SUM(CASE WHEN MAX_REV.COST_TYPE = 1 THEN (ISNULL(MASTER_DATA.M1, 0) + ISNULL(MASTER_DATA.M2, 0) + ISNULL(MASTER_DATA.M3, 0) + ISNULL(MASTER_DATA.M4, 0) + ISNULL(MASTER_DATA.M5,0) + ISNULL(MASTER_DATA.M6, 0)) ELSE 0 END) AS FIRST_HALF_FIXCOST,
      SUM(CASE WHEN MAX_REV.COST_TYPE = 2 THEN (ISNULL(MASTER_DATA.M1, 0) + ISNULL(MASTER_DATA.M2, 0) + ISNULL(MASTER_DATA.M3, 0) + ISNULL(MASTER_DATA.M4, 0) + ISNULL(MASTER_DATA.M5,0) + ISNULL(MASTER_DATA.M6, 0)) ELSE 0 END) AS FIRST_HALF_VARIABLECOST,
      SUM(CASE WHEN MAX_REV.COST_TYPE = 1 THEN (ISNULL(MASTER_DATA.M7, 0) + ISNULL(MASTER_DATA.M8, 0) + ISNULL(MASTER_DATA.M9, 0) + ISNULL(MASTER_DATA.M10, 0) + ISNULL(MASTER_DATA.M11, 0)+ ISNULL(MASTER_DATA.M12, 0)) ELSE 0 END) AS SECOND_HALF_FIXCOST,
      SUM(CASE WHEN MAX_REV.COST_TYPE = 2 THEN (ISNULL(MASTER_DATA.M7, 0) + ISNULL(MASTER_DATA.M8, 0) + ISNULL(MASTER_DATA.M9, 0) + ISNULL(MASTER_DATA.M10, 0) + ISNULL(MASTER_DATA.M11, 0)+ ISNULL(MASTER_DATA.M12, 0)) ELSE 0 END) AS SECOND_HALF_VARIABLECOST,
      SUM(CASE WHEN MAX_REV.COST_TYPE = 1 THEN (ISNULL(MASTER_DATA.M1, 0) + ISNULL(MASTER_DATA.M2, 0) + ISNULL(MASTER_DATA.M3, 0) + ISNULL(MASTER_DATA.M4, 0) + ISNULL(MASTER_DATA.M5,0) + ISNULL(MASTER_DATA.M6, 0) + ISNULL(MASTER_DATA.M7, 0) + ISNULL(MASTER_DATA.M8, 0) + ISNULL(MASTER_DATA.M9, 0) + ISNULL(MASTER_DATA.M10, 0) + ISNULL(MASTER_DATA.M11, 0)+ ISNULL(MASTER_DATA.M12, 0)) ELSE 0 END) AS YEAR_FIXCOST,
      SUM(CASE WHEN MAX_REV.COST_TYPE = 2 THEN (ISNULL(MASTER_DATA.M1, 0) + ISNULL(MASTER_DATA.M2, 0) + ISNULL(MASTER_DATA.M3, 0) + ISNULL(MASTER_DATA.M4, 0) + ISNULL(MASTER_DATA.M5,0) + ISNULL(MASTER_DATA.M6, 0) + ISNULL(MASTER_DATA.M7, 0) + ISNULL(MASTER_DATA.M8, 0) + ISNULL(MASTER_DATA.M9, 0) + ISNULL(MASTER_DATA.M10, 0) + ISNULL(MASTER_DATA.M11, 0)+ ISNULL(MASTER_DATA.M12, 0)) ELSE 0 END) AS YEAR_VARIABLECOST,
      SUM(CASE WHEN MAX_REV.COST_TYPE = 1 THEN ISNULL(ACTUAL_DATA.H1, 0) + ISNULL(MAX_REV.REVISE_SECOND_HALF, 0) ELSE 0 END) AS LAST_YEAR_SUM_FIXCOST,
      SUM(CASE WHEN MAX_REV.COST_TYPE = 2 THEN ISNULL(ACTUAL_DATA.H1, 0) + ISNULL(MAX_REV.REVISE_SECOND_HALF, 0) ELSE 0 END) AS LAST_YEAR_SUM_VARIABLECOST,
      SUM(CASE WHEN MAX_REV.COST_TYPE = 1 THEN (ISNULL(MASTER_DATA.M1, 0) + ISNULL(MASTER_DATA.M2, 0) + ISNULL(MASTER_DATA.M3, 0) + ISNULL(MASTER_DATA.M4, 0) + ISNULL(MASTER_DATA.M5,0) + ISNULL(MASTER_DATA.M6, 0) + ISNULL(MASTER_DATA.M7, 0) + ISNULL(MASTER_DATA.M8, 0) + ISNULL(MASTER_DATA.M9, 0) + ISNULL(MASTER_DATA.M10, 0) + ISNULL(MASTER_DATA.M11, 0)+ ISNULL(MASTER_DATA.M12, 0)) - (ISNULL(ACTUAL_DATA.H1, 0) + ISNULL(MAX_REV.REVISE_SECOND_HALF, 0)) ELSE 0 END) AS DIFF_YEAR_FIXCOST,
      SUM(CASE WHEN MAX_REV.COST_TYPE = 2 THEN (ISNULL(MASTER_DATA.M1, 0) + ISNULL(MASTER_DATA.M2, 0) + ISNULL(MASTER_DATA.M3, 0) + ISNULL(MASTER_DATA.M4, 0) + ISNULL(MASTER_DATA.M5,0) + ISNULL(MASTER_DATA.M6, 0) + ISNULL(MASTER_DATA.M7, 0) + ISNULL(MASTER_DATA.M8, 0) + ISNULL(MASTER_DATA.M9, 0) + ISNULL(MASTER_DATA.M10, 0) + ISNULL(MASTER_DATA.M11, 0)+ ISNULL(MASTER_DATA.M12, 0)) - (ISNULL(ACTUAL_DATA.H1, 0) + ISNULL(MAX_REV.REVISE_SECOND_HALF, 0)) ELSE 0 END) AS DIFF_YEAR_VARIABLECOST
      ,SUM(ISNULL(MTP.RRT2,0)) AS MTP_RRT1
      ,SUM(CASE WHEN MAX_REV.COST_TYPE = 1 THEN ISNULL(MTP.RRT2,0) ELSE 0 END) AS MTP_RRT1_FIXCOST
      ,SUM(CASE WHEN MAX_REV.COST_TYPE = 2 THEN ISNULL(MTP.RRT2,0) ELSE 0 END) AS MTP_RRT1_VARIABLECOST
      ,SUM((ISNULL(MASTER_DATA.M1, 0) + ISNULL(MASTER_DATA.M2, 0) + ISNULL(MASTER_DATA.M3, 0) + ISNULL(MASTER_DATA.M4, 0) + ISNULL(MASTER_DATA.M5,0) + ISNULL(MASTER_DATA.M6, 0) + ISNULL(MASTER_DATA.M7, 0) + ISNULL(MASTER_DATA.M8, 0) + ISNULL(MASTER_DATA.M9, 0) + ISNULL(MASTER_DATA.M10, 0) + ISNULL(MASTER_DATA.M11, 0)+ ISNULL(MASTER_DATA.M12, 0)) - (ISNULL(MTP.RRT2,0))) AS DIFF_MTP
      ,SUM(CASE WHEN MAX_REV.COST_TYPE = 1 THEN (ISNULL(MASTER_DATA.M1, 0) + ISNULL(MASTER_DATA.M2, 0) + ISNULL(MASTER_DATA.M3, 0) + ISNULL(MASTER_DATA.M4, 0) + ISNULL(MASTER_DATA.M5,0) + ISNULL(MASTER_DATA.M6, 0) + ISNULL(MASTER_DATA.M7, 0) + ISNULL(MASTER_DATA.M8, 0) + ISNULL(MASTER_DATA.M9, 0) + ISNULL(MASTER_DATA.M10, 0) + ISNULL(MASTER_DATA.M11, 0)+ ISNULL(MASTER_DATA.M12, 0)) - (ISNULL(MTP.RRT2,0)) ELSE 0 END) AS DIFF_MTP_FIXCOST
      ,SUM(CASE WHEN MAX_REV.COST_TYPE = 2 THEN (ISNULL(MASTER_DATA.M1, 0) + ISNULL(MASTER_DATA.M2, 0) + ISNULL(MASTER_DATA.M3, 0) + ISNULL(MASTER_DATA.M4, 0) + ISNULL(MASTER_DATA.M5,0) + ISNULL(MASTER_DATA.M6, 0) + ISNULL(MASTER_DATA.M7, 0) + ISNULL(MASTER_DATA.M8, 0) + ISNULL(MASTER_DATA.M9, 0) + ISNULL(MASTER_DATA.M10, 0) + ISNULL(MASTER_DATA.M11, 0)+ ISNULL(MASTER_DATA.M12, 0)) - (ISNULL(MTP.RRT2,0)) ELSE 0 END) AS DIFF_MTP_VARIABLECOST

      ,SUM(ISNULL(MASTER_DATA.M7, 0)) AS M7, SUM(ISNULL(MASTER_DATA.M8, 0)) AS M8, SUM(ISNULL(MASTER_DATA.M9, 0)) AS M9,
      SUM(ISNULL(MASTER_DATA.M10, 0)) AS M10, SUM(ISNULL(MASTER_DATA.M11, 0)) AS M11, SUM(ISNULL(MASTER_DATA.M12, 0)) AS M12
      ,SUM(CASE WHEN MAX_REV.COST_TYPE = 1 THEN MASTER_DATA.M7 ELSE 0 END) AS M7_FIXCOST,
      SUM(CASE WHEN MAX_REV.COST_TYPE = 2 THEN MASTER_DATA.M7 ELSE 0 END) AS M7_VARIABLECOST,
      SUM(CASE WHEN MAX_REV.COST_TYPE = 1 THEN MASTER_DATA.M8 ELSE 0 END) AS M8_FIXCOST,
      SUM(CASE WHEN MAX_REV.COST_TYPE = 2 THEN MASTER_DATA.M8 ELSE 0 END) AS M8_VARIABLECOST,
      SUM(CASE WHEN MAX_REV.COST_TYPE = 1 THEN MASTER_DATA.M9 ELSE 0 END) AS M9_FIXCOST,
      SUM(CASE WHEN MAX_REV.COST_TYPE = 2 THEN MASTER_DATA.M9 ELSE 0 END) AS M9_VARIABLECOST,
      SUM(CASE WHEN MAX_REV.COST_TYPE = 1 THEN MASTER_DATA.M10 ELSE 0 END) AS M10_FIXCOST,
      SUM(CASE WHEN MAX_REV.COST_TYPE = 2 THEN MASTER_DATA.M10 ELSE 0 END) AS M10_VARIABLECOST,
      SUM(CASE WHEN MAX_REV.COST_TYPE = 1 THEN MASTER_DATA.M11 ELSE 0 END) AS M11_FIXCOST,
      SUM(CASE WHEN MAX_REV.COST_TYPE = 2 THEN MASTER_DATA.M11 ELSE 0 END) AS M11_VARIABLECOST,
      SUM(CASE WHEN MAX_REV.COST_TYPE = 1 THEN MASTER_DATA.M12 ELSE 0 END) AS M12_FIXCOST,
      SUM(CASE WHEN MAX_REV.COST_TYPE = 2 THEN MASTER_DATA.M12 ELSE 0 END) AS M12_VARIABLECOST

      FROM (
      SELECT BUDGET_DATA.BUDGET_ORDER_NO, BUDGET_DATA.BUDGET_YEAR, BUDGET_ORDER.COST_TYPE,
      BUDGET_DATA.PERIOD_TYPE, BUDGET_DATA.PROJECT_NO, MAX(BUDGET_DATA.REV_NO) AS REV_NO, BUDGET_ORDER.BUDGET_ORDER_NAME,
      BUDGET_ORDER.DEPT_NO, BUDGET_ORDER.PERSON_IN_CHARGE_NO, PIC.PERSON_IN_CHARGE_NAME, BUDGET_ORDER.PIC_SHOW_FLAG

      ,ISNULL((SELECT ISNULL(ISNULL(M10,0)+ISNULL(M11,0)+ISNULL(M12,0),0)
      FROM BG_T_BUDGET_DATA
      WHERE BUDGET_YEAR = (@YEAR-1)
      AND PERIOD_TYPE = 2
      -- AND REV_NO = (SELECT MAX(REV_NO) AS REV_NO FROM BG_T_BUDGET_DATA WHERE BUDGET_YEAR = (@YEAR-1) AND PERIOD_TYPE = 2 AND PROJECT_NO = @PROJECTNO)
      -- AND PROJECT_NO = @PROJECTNO
      AND REV_NO = @RefEstRevNo
      AND PROJECT_NO = @RefEstProjectNo
      AND BUDGET_ORDER_NO = BUDGET_DATA.BUDGET_ORDER_NO),0)+
      ISNULL((SELECT ISNULL(M7,0)+ISNULL(M8,0)+ISNULL(M9,0)
      FROM BG_T_UPLOAD_DATA
      WHERE BUDGET_YEAR = (@YEAR-1)
      AND PERIOD_TYPE = 2
      --AND PROJECT_NO = @PROJECTNO
      AND PROJECT_NO = @RefEstProjectNo
      AND DATA_TYPE = 2
      AND BUDGET_ORDER_NO = BUDGET_DATA.BUDGET_ORDER_NO),0) AS REVISE_SECOND_HALF

      FROM BG_T_BUDGET_DATA AS BUDGET_DATA
      INNER JOIN BG_M_BUDGET_ORDER AS BUDGET_ORDER
      ON BUDGET_ORDER.BUDGET_ORDER_NO = BUDGET_DATA.BUDGET_ORDER_NO AND BUDGET_ORDER.BUDGET_TYPE = 'E' AND BUDGET_ORDER.ACTIVE_FLAG = 1
      LEFT JOIN BG_M_PERSON_IN_CHARGE AS PIC ON PIC.PERSON_IN_CHARGE_NO = BUDGET_ORDER.PERSON_IN_CHARGE_NO
      WHERE BUDGET_DATA.BUDGET_YEAR = @YEAR
      AND BUDGET_DATA.PERIOD_TYPE = @PERIOD
      AND BUDGET_DATA.PROJECT_NO = @PROJECTNO
      AND BUDGET_DATA.REV_NO = @REVNO
      GROUP BY BUDGET_DATA.BUDGET_ORDER_NO, BUDGET_DATA.BUDGET_YEAR, BUDGET_DATA.PERIOD_TYPE, BUDGET_DATA.PROJECT_NO, BUDGET_ORDER.BUDGET_ORDER_NAME, BUDGET_ORDER.DEPT_NO, BUDGET_ORDER.COST_TYPE,
      BUDGET_ORDER.PERSON_IN_CHARGE_NO, PIC.PERSON_IN_CHARGE_NAME, BUDGET_ORDER.PIC_SHOW_FLAG) AS MAX_REV

      INNER JOIN BG_T_BUDGET_DATA AS MASTER_DATA
      ON MAX_REV.BUDGET_YEAR = MASTER_DATA.BUDGET_YEAR
      AND MAX_REV.PERIOD_TYPE = MASTER_DATA.PERIOD_TYPE
      AND MAX_REV.PROJECT_NO = MASTER_DATA.PROJECT_NO
      AND MAX_REV.BUDGET_ORDER_NO = MASTER_DATA.BUDGET_ORDER_NO
      AND MAX_REV.REV_NO = MASTER_DATA.REV_NO

      LEFT OUTER JOIN BG_T_UPLOAD_DATA AS ACTUAL_DATA
      ON ACTUAL_DATA.BUDGET_YEAR = MAX_REV.BUDGET_YEAR - 1
      AND ACTUAL_DATA.PERIOD_TYPE = @PERIOD
      AND ACTUAL_DATA.PROJECT_NO = @PROJECTNO
      AND ACTUAL_DATA.BUDGET_ORDER_NO = MAX_REV.BUDGET_ORDER_NO
      AND ACTUAL_DATA.DATA_TYPE = 2

      LEFT OUTER JOIN BG_T_UPLOAD_DATA AS REVISE_DATA
      ON REVISE_DATA.BUDGET_YEAR = MAX_REV.BUDGET_YEAR - 1
      AND REVISE_DATA.PERIOD_TYPE = @PERIOD
      AND REVISE_DATA.PROJECT_NO = @PROJECTNO
      AND REVISE_DATA.BUDGET_ORDER_NO = MAX_REV.BUDGET_ORDER_NO
      AND REVISE_DATA.DATA_TYPE = 1

      LEFT JOIN BG_T_BUDGET_DATA AS MTP
      ON MAX_REV.BUDGET_ORDER_NO = MTP.BUDGET_ORDER_NO
      AND MTP.BUDGET_YEAR=(@YEAR-2)
      AND MTP.PERIOD_TYPE = 10
      AND MTP.PROJECT_NO = @MtpProjectNo
      AND MTP.REV_NO = '@MtpRevNo'

      WHERE ISNULL(ACTUAL_DATA.H1, 0) &lt;&gt; 0 OR ISNULL(MAX_REV.REVISE_SECOND_HALF, 0) &lt;&gt; 0 OR (ISNULL(MASTER_DATA.M1, 0) &lt;&gt; 0
      OR ISNULL(MASTER_DATA.M2, 0) &lt;&gt; 0 OR ISNULL(MASTER_DATA.M3, 0) &lt;&gt; 0
      OR ISNULL(MASTER_DATA.M4, 0) &lt;&gt; 0 OR ISNULL(MASTER_DATA.M5, 0) &lt;&gt; 0
      OR ISNULL(MASTER_DATA.M6, 0) &lt;&gt; 0 OR ISNULL(MASTER_DATA.M7, 0) &lt;&gt; 0
      OR ISNULL(MASTER_DATA.M8, 0) &lt;&gt; 0 OR ISNULL(MASTER_DATA.M9, 0) &lt;&gt; 0
      OR ISNULL(MTP.RRT2,0) &lt;&gt; 0
      OR ISNULL(MASTER_DATA.M10, 0) &lt;&gt; 0 OR ISNULL(MASTER_DATA.M11, 0) &lt;&gt; 0 OR ISNULL(MASTER_DATA.M12, 0) &lt;&gt; 0)

      GROUP BY MAX_REV.BUDGET_YEAR, MAX_REV.PERIOD_TYPE, MAX_REV.PROJECT_NO, MAX_REV.PERSON_IN_CHARGE_NO, MAX_REV.PERSON_IN_CHARGE_NAME, MAX_REV.PIC_SHOW_FLAG
      ORDER BY MAX_REV.PERSON_IN_CHARGE_NO
    </SELECT014_4>
    <SELECT014_5>
      SELECT MAX_REV.BUDGET_YEAR, MAX_REV.PERIOD_TYPE, MAX_REV.PROJECT_NO, MAX_REV.PERSON_IN_CHARGE_NO, MAX_REV.PERSON_IN_CHARGE_NAME, MAX_REV.PIC_SHOW_FLAG,
      SUM(ISNULL(ACTUAL_DATA.H1, 0)) AS ACTUAL_FIRST_HALF,
      SUM(ISNULL(REVISE_BUDGET.M7, 0) + ISNULL(REVISE_BUDGET.M8, 0) + ISNULL(REVISE_BUDGET.M9, 0) + ISNULL(REVISE_BUDGET.M10, 0) + ISNULL(REVISE_BUDGET.M11, 0) + ISNULL(REVISE_BUDGET.M12, 0)) AS REVISE_SECOND_HALF,
      SUM(ISNULL(ACTUAL_DATA.M7, 0)) AS M7, SUM(ISNULL(ACTUAL_DATA.M8, 0)) AS M8,
      SUM(ISNULL(ACTUAL_DATA.M9, 0)) AS M9, SUM(ISNULL(MASTER_DATA.M10, 0)) AS M10,
      SUM(ISNULL(MASTER_DATA.M11, 0)) AS M11, SUM(ISNULL(MASTER_DATA.M12, 0)) AS M12,
      SUM(CASE WHEN MAX_REV.COST_TYPE = 1 THEN ISNULL(ACTUAL_DATA.M7, 0) ELSE 0 END) AS M7_FIXCOST,
      SUM(CASE WHEN MAX_REV.COST_TYPE = 2 THEN ISNULL(ACTUAL_DATA.M7, 0) ELSE 0 END) AS M7_VARIABLECOST,
      SUM(CASE WHEN MAX_REV.COST_TYPE = 1 THEN ISNULL(ACTUAL_DATA.M8, 0) ELSE 0 END) AS M8_FIXCOST,
      SUM(CASE WHEN MAX_REV.COST_TYPE = 2 THEN ISNULL(ACTUAL_DATA.M8, 0) ELSE 0 END) AS M8_VARIABLECOST,
      SUM(CASE WHEN MAX_REV.COST_TYPE = 1 THEN ISNULL(ACTUAL_DATA.M9, 0) ELSE 0 END) AS M9_FIXCOST,
      SUM(CASE WHEN MAX_REV.COST_TYPE = 2 THEN ISNULL(ACTUAL_DATA.M9, 0) ELSE 0 END) AS M9_VARIABLECOST,
      SUM(CASE WHEN MAX_REV.COST_TYPE = 1 THEN ISNULL(MASTER_DATA.M10, 0) ELSE 0 END) AS M10_FIXCOST,
      SUM(CASE WHEN MAX_REV.COST_TYPE = 2 THEN ISNULL(MASTER_DATA.M10, 0) ELSE 0 END) AS M10_VARIABLECOST,
      SUM(CASE WHEN MAX_REV.COST_TYPE = 1 THEN ISNULL(MASTER_DATA.M11, 0) ELSE 0 END) AS M11_FIXCOST,
      SUM(CASE WHEN MAX_REV.COST_TYPE = 2 THEN ISNULL(MASTER_DATA.M11, 0) ELSE 0 END) AS M11_VARIABLECOST,
      SUM(CASE WHEN MAX_REV.COST_TYPE = 1 THEN ISNULL(MASTER_DATA.M12, 0) ELSE 0 END) AS M12_FIXCOST,
      SUM(CASE WHEN MAX_REV.COST_TYPE = 2 THEN ISNULL(MASTER_DATA.M12, 0) ELSE 0 END) AS M12_VARIABLECOST,
      SUM(ISNULL(ACTUAL_DATA.M7, 0) + ISNULL(ACTUAL_DATA.M8, 0) + ISNULL(ACTUAL_DATA.M9, 0) + ISNULL(MASTER_DATA.M10, 0) + ISNULL(MASTER_DATA.M11,0) + ISNULL(MASTER_DATA.M12, 0)) AS ESTIMATE_SECOND_HALF,
      SUM(ISNULL(ACTUAL_DATA.M7, 0) + ISNULL(ACTUAL_DATA.M8, 0) + ISNULL(ACTUAL_DATA.M9, 0) + ISNULL(MASTER_DATA.M10, 0) + ISNULL(MASTER_DATA.M11,0) + ISNULL(MASTER_DATA.M12, 0) - (ISNULL(REVISE_BUDGET.M7, 0) + ISNULL(REVISE_BUDGET.M8, 0) + ISNULL(REVISE_BUDGET.M9, 0) + ISNULL(REVISE_BUDGET.M10, 0) + ISNULL(REVISE_BUDGET.M11, 0) + ISNULL(REVISE_BUDGET.M12, 0))) AS DIFFERENCE_SECOND_HALF,
      SUM(ISNULL(ACTUAL_DATA.H1, 0) + ISNULL(ACTUAL_DATA.M7, 0) + ISNULL(ACTUAL_DATA.M8, 0) + ISNULL(ACTUAL_DATA.M9, 0) + ISNULL(MASTER_DATA.M10, 0) + ISNULL(MASTER_DATA.M11,0) + ISNULL(MASTER_DATA.M12, 0)) AS ESTIMATE_TOTAL_YEAR,
      SUM(CASE WHEN MAX_REV.COST_TYPE = 1 THEN ISNULL(ACTUAL_DATA.H1, 0) ELSE 0 END) AS ACTUAL_FIRST_HALF_FIXCOST,
      SUM(CASE WHEN MAX_REV.COST_TYPE = 2 THEN ISNULL(ACTUAL_DATA.H1, 0) ELSE 0 END) AS ACTUAL_FIRST_HALF_VARIABLECOST,
      SUM(CASE WHEN MAX_REV.COST_TYPE = 1 THEN (ISNULL(REVISE_BUDGET.M7, 0) + ISNULL(REVISE_BUDGET.M8, 0) + ISNULL(REVISE_BUDGET.M9, 0) + ISNULL(REVISE_BUDGET.M10, 0) + ISNULL(REVISE_BUDGET.M11, 0) + ISNULL(REVISE_BUDGET.M12, 0)) ELSE 0 END) AS REVISE_SECOND_HALF_FIXCOST,
      SUM(CASE WHEN MAX_REV.COST_TYPE = 2 THEN (ISNULL(REVISE_BUDGET.M7, 0) + ISNULL(REVISE_BUDGET.M8, 0) + ISNULL(REVISE_BUDGET.M9, 0) + ISNULL(REVISE_BUDGET.M10, 0) + ISNULL(REVISE_BUDGET.M11, 0) + ISNULL(REVISE_BUDGET.M12, 0)) ELSE 0 END) AS REVISE_SECOND_HALF_VARIABLECOST,
      SUM(CASE WHEN MAX_REV.COST_TYPE = 1 THEN (ISNULL(ACTUAL_DATA.M7, 0) + ISNULL(ACTUAL_DATA.M8, 0) + ISNULL(ACTUAL_DATA.M9, 0) + ISNULL(MASTER_DATA.M10, 0) + ISNULL(MASTER_DATA.M11,0) + ISNULL(MASTER_DATA.M12, 0)) ELSE 0 END) AS ESTIMATE_SECOND_HALF_FIXCOST,
      SUM(CASE WHEN MAX_REV.COST_TYPE = 2 THEN (ISNULL(ACTUAL_DATA.M7, 0) + ISNULL(ACTUAL_DATA.M8, 0) + ISNULL(ACTUAL_DATA.M9, 0) + ISNULL(MASTER_DATA.M10, 0) + ISNULL(MASTER_DATA.M11,0) + ISNULL(MASTER_DATA.M12, 0)) ELSE 0 END) AS ESTIMATE_SECOND_HALF_VARIABLECOST,
      SUM(CASE WHEN MAX_REV.COST_TYPE = 1 THEN (ISNULL(ACTUAL_DATA.M7, 0) + ISNULL(ACTUAL_DATA.M8, 0) + ISNULL(ACTUAL_DATA.M9, 0) + ISNULL(MASTER_DATA.M10, 0) + ISNULL(MASTER_DATA.M11,0) + ISNULL(MASTER_DATA.M12, 0) - (ISNULL(REVISE_BUDGET.M7, 0) + ISNULL(REVISE_BUDGET.M8, 0) + ISNULL(REVISE_BUDGET.M9, 0) + ISNULL(REVISE_BUDGET.M10, 0) + ISNULL(REVISE_BUDGET.M11, 0) + ISNULL(REVISE_BUDGET.M12, 0))) ELSE 0 END) AS DIFFERENCE_SECOND_HALF_FIXCOST,
      SUM(CASE WHEN MAX_REV.COST_TYPE = 2 THEN (ISNULL(ACTUAL_DATA.M7, 0) + ISNULL(ACTUAL_DATA.M8, 0) + ISNULL(ACTUAL_DATA.M9, 0) + ISNULL(MASTER_DATA.M10, 0) + ISNULL(MASTER_DATA.M11,0) + ISNULL(MASTER_DATA.M12, 0) - (ISNULL(REVISE_BUDGET.M7, 0) + ISNULL(REVISE_BUDGET.M8, 0) + ISNULL(REVISE_BUDGET.M9, 0) + ISNULL(REVISE_BUDGET.M10, 0) + ISNULL(REVISE_BUDGET.M11, 0) + ISNULL(REVISE_BUDGET.M12, 0))) ELSE 0 END) AS DIFFERENCE_SECOND_HALF_VARIABLECOST,
      SUM(CASE WHEN MAX_REV.COST_TYPE = 1 THEN (ISNULL(ACTUAL_DATA.H1, 0) + ISNULL(ACTUAL_DATA.M7, 0) + ISNULL(ACTUAL_DATA.M8, 0) + ISNULL(ACTUAL_DATA.M9, 0) + ISNULL(MASTER_DATA.M10, 0) + ISNULL(MASTER_DATA.M11,0) + ISNULL(MASTER_DATA.M12, 0)) ELSE 0 END) AS ESTIMATE_TOTAL_YEAR_FIXCOST,
      SUM(CASE WHEN MAX_REV.COST_TYPE = 2 THEN (ISNULL(ACTUAL_DATA.H1, 0) + ISNULL(ACTUAL_DATA.M7, 0) + ISNULL(ACTUAL_DATA.M8, 0) + ISNULL(ACTUAL_DATA.M9, 0) + ISNULL(MASTER_DATA.M10, 0) + ISNULL(MASTER_DATA.M11,0) + ISNULL(MASTER_DATA.M12, 0)) ELSE 0 END) AS ESTIMATE_TOTAL_YEAR_VARIABLECOST
      FROM (
      SELECT BUDGET_DATA.BUDGET_ORDER_NO, BUDGET_DATA.BUDGET_YEAR, BUDGET_ORDER.COST_TYPE,
      BUDGET_DATA.PERIOD_TYPE, BUDGET_DATA.PROJECT_NO, MAX(BUDGET_DATA.REV_NO) AS REV_NO, BUDGET_ORDER.BUDGET_ORDER_NAME,
      BUDGET_ORDER.DEPT_NO, BUDGET_ORDER.PERSON_IN_CHARGE_NO, PIC.PERSON_IN_CHARGE_NAME, BUDGET_ORDER.PIC_SHOW_FLAG
      FROM BG_T_BUDGET_DATA AS BUDGET_DATA
      INNER JOIN BG_M_BUDGET_ORDER AS BUDGET_ORDER
      ON BUDGET_ORDER.BUDGET_ORDER_NO = BUDGET_DATA.BUDGET_ORDER_NO AND BUDGET_ORDER.BUDGET_TYPE = 'E' AND BUDGET_ORDER.ACTIVE_FLAG = 1
      LEFT JOIN BG_M_PERSON_IN_CHARGE AS PIC ON PIC.PERSON_IN_CHARGE_NO = BUDGET_ORDER.PERSON_IN_CHARGE_NO
      WHERE BUDGET_DATA.BUDGET_YEAR = @YEAR
      AND BUDGET_DATA.PERIOD_TYPE = @PERIOD
      AND BUDGET_DATA.PROJECT_NO = @PROJECTNO
      AND BUDGET_DATA.REV_NO = @REVNO
      GROUP BY BUDGET_DATA.BUDGET_ORDER_NO, BUDGET_DATA.BUDGET_YEAR, BUDGET_DATA.PERIOD_TYPE, BUDGET_DATA.PROJECT_NO, BUDGET_ORDER.BUDGET_ORDER_NAME, BUDGET_ORDER.DEPT_NO, BUDGET_ORDER.COST_TYPE,
      BUDGET_ORDER.PERSON_IN_CHARGE_NO, PIC.PERSON_IN_CHARGE_NAME, BUDGET_ORDER.PIC_SHOW_FLAG) AS MAX_REV

      INNER JOIN BG_T_BUDGET_DATA AS MASTER_DATA
      ON MAX_REV.BUDGET_YEAR = MASTER_DATA.BUDGET_YEAR
      AND MASTER_DATA.PERIOD_TYPE = @PERIOD
      AND MASTER_DATA.PROJECT_NO = @PROJECTNO
      AND MAX_REV.BUDGET_ORDER_NO = MASTER_DATA.BUDGET_ORDER_NO
      AND MAX_REV.REV_NO = MASTER_DATA.REV_NO

      ---- change Revise to OB 02/05/2018
      --LEFT OUTER JOIN BG_T_UPLOAD_DATA AS REVISE_BUDGET
      --ON MAX_REV.BUDGET_YEAR = REVISE_BUDGET.BUDGET_YEAR
      ----AND REVISE_BUDGET.PERIOD_TYPE = 2
      --AND REVISE_BUDGET.PERIOD_TYPE = 1
      --AND REVISE_BUDGET.PROJECT_NO = 1
      --AND MAX_REV.BUDGET_ORDER_NO = REVISE_BUDGET.BUDGET_ORDER_NO
      --AND REVISE_BUDGET.DATA_TYPE = 1
      LEFT JOIN BG_T_BUDGET_DATA AS REVISE_BUDGET
      ON  REVISE_BUDGET.BUDGET_YEAR =  MAX_REV.BUDGET_YEAR
      AND REVISE_BUDGET.PERIOD_TYPE = 1
      AND REVISE_BUDGET.PROJECT_NO = MAX_REV.PROJECT_NO
      AND REVISE_BUDGET.BUDGET_ORDER_NO = MAX_REV.BUDGET_ORDER_NO
      AND REVISE_BUDGET.REV_NO = MAX_REV.REV_NO

      LEFT OUTER JOIN BG_T_UPLOAD_DATA AS ACTUAL_DATA
      ON ACTUAL_DATA.BUDGET_YEAR = MAX_REV.BUDGET_YEAR
      AND ACTUAL_DATA.PERIOD_TYPE = @PERIOD
      AND ACTUAL_DATA.PROJECT_NO = @PROJECTNO
      AND ACTUAL_DATA.BUDGET_ORDER_NO = MAX_REV.BUDGET_ORDER_NO
      AND ACTUAL_DATA.DATA_TYPE = 2

      WHERE ISNULL(ACTUAL_DATA.H1, 0) &lt;&gt; 0 
      OR ISNULL(REVISE_BUDGET.M7, 0) &lt;&gt; 0
      OR ISNULL(REVISE_BUDGET.M8, 0) &lt;&gt; 0
      OR ISNULL(REVISE_BUDGET.M9, 0) &lt;&gt; 0
      OR ISNULL(REVISE_BUDGET.M10, 0) &lt;&gt; 0
      OR ISNULL(REVISE_BUDGET.M11, 0) &lt;&gt; 0
      OR ISNULL(REVISE_BUDGET.M12, 0) &lt;&gt; 0      
      OR ISNULL(ACTUAL_DATA.M7, 0) &lt;&gt; 0 OR ISNULL(ACTUAL_DATA.M8, 0) &lt;&gt; 0 OR ISNULL(ACTUAL_DATA.M9, 0) &lt;&gt; 0 OR
      ISNULL(MASTER_DATA.M10, 0) &lt;&gt; 0 OR ISNULL(MASTER_DATA.M11, 0) &lt;&gt; 0 OR ISNULL(MASTER_DATA.M12, 0) &lt;&gt; 0

      GROUP BY MAX_REV.BUDGET_YEAR, MAX_REV.PERIOD_TYPE, MAX_REV.PROJECT_NO, MAX_REV.PERSON_IN_CHARGE_NO, MAX_REV.PERSON_IN_CHARGE_NAME, MAX_REV.PIC_SHOW_FLAG
      ORDER BY MAX_REV.PERSON_IN_CHARGE_NO
    </SELECT014_5>
    <SELECT014_6>
      SELECT MAX_REV.BUDGET_YEAR, MAX_REV.PERIOD_TYPE, MAX_REV.PROJECT_NO, MAX_REV.PERSON_IN_CHARGE_NO, MAX_REV.PERSON_IN_CHARGE_NAME, MAX_REV.PIC_SHOW_FLAG,
      SUM(ISNULL(ORIGINAL_BUDGET.H1, 0)) AS ORIGINAL_FIRST_HALF,
      SUM(ISNULL(ACTUAL_DATA.M1, 0)) AS M1, SUM(ISNULL(ACTUAL_DATA.M2, 0)) AS M2,
      SUM(ISNULL(ACTUAL_DATA.M3, 0)) AS M3, SUM(ISNULL(MASTER_DATA.M4, 0)) AS M4,
      SUM(ISNULL(MASTER_DATA.M5, 0)) AS M5, SUM(ISNULL(MASTER_DATA.M6, 0)) AS M6,
      SUM(ISNULL(ACTUAL_DATA.M1, 0) + ISNULL(ACTUAL_DATA.M2, 0) + ISNULL(ACTUAL_DATA.M3, 0) + ISNULL(MASTER_DATA.M4, 0) + ISNULL(MASTER_DATA.M5, 0) + ISNULL(MASTER_DATA.M6, 0)) AS ESTIMATE_FIRST_HALF,
      SUM(ISNULL(ACTUAL_DATA.M1, 0) + ISNULL(ACTUAL_DATA.M2, 0) + ISNULL(ACTUAL_DATA.M3, 0) + ISNULL(MASTER_DATA.M4, 0) + ISNULL(MASTER_DATA.M5, 0) + ISNULL(MASTER_DATA.M6, 0) - ISNULL(ORIGINAL_BUDGET.H1, 0)) AS DIFF_FIRST_HALF,
      SUM(ISNULL(ORIGINAL_BUDGET.H2, 0)) AS ORIGINAL_SECOND_HALF,
      SUM(ISNULL(MASTER_DATA.M7, 0)) AS M7, SUM(ISNULL(MASTER_DATA.M8, 0)) AS M8,
      SUM(ISNULL(MASTER_DATA.M9, 0)) AS M9, SUM(ISNULL(MASTER_DATA.M10, 0)) AS M10,
      SUM(ISNULL(MASTER_DATA.M11, 0)) AS M11, SUM(ISNULL(MASTER_DATA.M12, 0)) AS M12,
      SUM(ISNULL(MASTER_DATA.M7, 0) + ISNULL(MASTER_DATA.M8, 0) + ISNULL(MASTER_DATA.M9, 0) + ISNULL(MASTER_DATA.M10, 0) + ISNULL(MASTER_DATA.M11, 0) + ISNULL(MASTER_DATA.M12, 0)) AS REVISE_SECOND_HALF,
      SUM(ISNULL(MASTER_DATA.M7, 0) + ISNULL(MASTER_DATA.M8, 0) + ISNULL(MASTER_DATA.M9, 0) + ISNULL(MASTER_DATA.M10, 0) + ISNULL(MASTER_DATA.M11, 0) + ISNULL(MASTER_DATA.M12, 0) - ISNULL(ORIGINAL_BUDGET.H2, 0)) AS DIFF_SECOND_HALF,
      SUM(ISNULL(ACTUAL_DATA.M1, 0) + ISNULL(ACTUAL_DATA.M2, 0) + ISNULL(ACTUAL_DATA.M3, 0) + ISNULL(MASTER_DATA.M4, 0) + ISNULL(MASTER_DATA.M5, 0) + ISNULL(MASTER_DATA.M6, 0) + ISNULL(MASTER_DATA.M7, 0) + ISNULL(MASTER_DATA.M8, 0) + ISNULL(MASTER_DATA.M9, 0) + ISNULL(MASTER_DATA.M10, 0) + ISNULL(MASTER_DATA.M11, 0) + ISNULL(MASTER_DATA.M12, 0)) AS REVISE_TOTAL_YEAR,
      SUM(ISNULL(ACTUAL_DATA.M1, 0) + ISNULL(ACTUAL_DATA.M2, 0) + ISNULL(ACTUAL_DATA.M3, 0) + ISNULL(MASTER_DATA.M4, 0) + ISNULL(MASTER_DATA.M5, 0) + ISNULL(MASTER_DATA.M6, 0) - ISNULL(ORIGINAL_BUDGET.H1, 0) + (ISNULL(MASTER_DATA.M7, 0) + ISNULL(MASTER_DATA.M8, 0) + ISNULL(MASTER_DATA.M9, 0) + ISNULL(MASTER_DATA.M10, 0) + ISNULL(MASTER_DATA.M11, 0) + ISNULL(MASTER_DATA.M12, 0) - ISNULL(ORIGINAL_BUDGET.H2, 0))) AS DIFF_TOTAL_YEAR,
      SUM(ISNULL(MASTER_DATA.RRT1, 0)) AS RRT1,
      SUM(ISNULL(MASTER_DATA.RRT2, 0)) AS RRT2,
      SUM(ISNULL(MASTER_DATA.RRT3, 0)) AS RRT3,
      SUM(ISNULL(MASTER_DATA.RRT4, 0)) AS RRT4,
      SUM(ISNULL(MASTER_DATA.RRT5, 0)) AS RRT5,
      SUM(CASE WHEN MAX_REV.COST_TYPE = 1 THEN ISNULL(MASTER_DATA.RRT1, 0) ELSE 0 END) AS RRT1_FIXCOST,
      SUM(CASE WHEN MAX_REV.COST_TYPE = 2 THEN ISNULL(MASTER_DATA.RRT1, 0) ELSE 0 END) AS RRT1_VARIABLECOST,
      SUM(CASE WHEN MAX_REV.COST_TYPE = 1 THEN ISNULL(MASTER_DATA.RRT2, 0) ELSE 0 END) AS RRT2_FIXCOST,
      SUM(CASE WHEN MAX_REV.COST_TYPE = 2 THEN ISNULL(MASTER_DATA.RRT2, 0) ELSE 0 END) AS RRT2_VARIABLECOST,
      SUM(CASE WHEN MAX_REV.COST_TYPE = 1 THEN ISNULL(MASTER_DATA.RRT3, 0) ELSE 0 END) AS RRT3_FIXCOST,
      SUM(CASE WHEN MAX_REV.COST_TYPE = 2 THEN ISNULL(MASTER_DATA.RRT3, 0) ELSE 0 END) AS RRT3_VARIABLECOST,
      SUM(CASE WHEN MAX_REV.COST_TYPE = 1 THEN ISNULL(MASTER_DATA.RRT4, 0) ELSE 0 END) AS RRT4_FIXCOST,
      SUM(CASE WHEN MAX_REV.COST_TYPE = 2 THEN ISNULL(MASTER_DATA.RRT4, 0) ELSE 0 END) AS RRT4_VARIABLECOST,
      SUM(CASE WHEN MAX_REV.COST_TYPE = 1 THEN ISNULL(MASTER_DATA.RRT5, 0) ELSE 0 END) AS RRT5_FIXCOST,
      SUM(CASE WHEN MAX_REV.COST_TYPE = 2 THEN ISNULL(MASTER_DATA.RRT5, 0) ELSE 0 END) AS RRT5_VARIABLECOST,
      SUM(CASE WHEN MAX_REV.COST_TYPE = 1 THEN ISNULL(ORIGINAL_BUDGET.H1, 0) ELSE 0 END) AS ORIGINAL_FIRST_HALF_FIXCOST,
      SUM(CASE WHEN MAX_REV.COST_TYPE = 2 THEN ISNULL(ORIGINAL_BUDGET.H1, 0) ELSE 0 END) AS ORIGINAL_FIRST_HALF_VARIABLECOST,
      SUM(CASE WHEN MAX_REV.COST_TYPE = 1 THEN ISNULL(ACTUAL_DATA.M1, 0) ELSE 0 END) AS M1_FIXCOST,
      SUM(CASE WHEN MAX_REV.COST_TYPE = 2 THEN ISNULL(ACTUAL_DATA.M1, 0) ELSE 0 END) AS M1_VARIABLECOST,
      SUM(CASE WHEN MAX_REV.COST_TYPE = 1 THEN ISNULL(ACTUAL_DATA.M2, 0) ELSE 0 END) AS M2_FIXCOST,
      SUM(CASE WHEN MAX_REV.COST_TYPE = 2 THEN ISNULL(ACTUAL_DATA.M2, 0) ELSE 0 END) AS M2_VARIABLECOST,
      SUM(CASE WHEN MAX_REV.COST_TYPE = 1 THEN ISNULL(ACTUAL_DATA.M3, 0) ELSE 0 END) AS M3_FIXCOST,
      SUM(CASE WHEN MAX_REV.COST_TYPE = 2 THEN ISNULL(ACTUAL_DATA.M3, 0) ELSE 0 END) AS M3_VARIABLECOST,
      SUM(CASE WHEN MAX_REV.COST_TYPE = 1 THEN ISNULL(MASTER_DATA.M4, 0) ELSE 0 END) AS M4_FIXCOST,
      SUM(CASE WHEN MAX_REV.COST_TYPE = 2 THEN ISNULL(MASTER_DATA.M4, 0) ELSE 0 END) AS M4_VARIABLECOST,
      SUM(CASE WHEN MAX_REV.COST_TYPE = 1 THEN ISNULL(MASTER_DATA.M5, 0) ELSE 0 END) AS M5_FIXCOST,
      SUM(CASE WHEN MAX_REV.COST_TYPE = 2 THEN ISNULL(MASTER_DATA.M5, 0) ELSE 0 END) AS M5_VARIABLECOST,
      SUM(CASE WHEN MAX_REV.COST_TYPE = 1 THEN ISNULL(MASTER_DATA.M6, 0) ELSE 0 END) AS M6_FIXCOST,
      SUM(CASE WHEN MAX_REV.COST_TYPE = 2 THEN ISNULL(MASTER_DATA.M6, 0) ELSE 0 END) AS M6_VARIABLECOST,
      SUM(CASE WHEN MAX_REV.COST_TYPE = 1 THEN ISNULL(ACTUAL_DATA.M1, 0) + ISNULL(ACTUAL_DATA.M2, 0) + ISNULL(ACTUAL_DATA.M3, 0) + ISNULL(MASTER_DATA.M4, 0) + ISNULL(MASTER_DATA.M5, 0) + ISNULL(MASTER_DATA.M6, 0) ELSE 0 END) AS ESTIMATE_FIRST_HALF_FIXCOST,
      SUM(CASE WHEN MAX_REV.COST_TYPE = 2 THEN ISNULL(ACTUAL_DATA.M1, 0) + ISNULL(ACTUAL_DATA.M2, 0) + ISNULL(ACTUAL_DATA.M3, 0) + ISNULL(MASTER_DATA.M4, 0) + ISNULL(MASTER_DATA.M5, 0) + ISNULL(MASTER_DATA.M6, 0) ELSE 0 END) AS ESTIMATE_FIRST_HALF_VARIABLECOST,
      SUM(CASE WHEN MAX_REV.COST_TYPE = 1 THEN ISNULL(ACTUAL_DATA.M1, 0) + ISNULL(ACTUAL_DATA.M2, 0) + ISNULL(ACTUAL_DATA.M3, 0) + ISNULL(MASTER_DATA.M4, 0) + ISNULL(MASTER_DATA.M5, 0) + ISNULL(MASTER_DATA.M6, 0) - ISNULL(ORIGINAL_BUDGET.H1, 0) ELSE 0 END) AS DIFF_FIRST_HALF_FIXCOST,
      SUM(CASE WHEN MAX_REV.COST_TYPE = 2 THEN ISNULL(ACTUAL_DATA.M1, 0) + ISNULL(ACTUAL_DATA.M2, 0) + ISNULL(ACTUAL_DATA.M3, 0) + ISNULL(MASTER_DATA.M4, 0) + ISNULL(MASTER_DATA.M5, 0) + ISNULL(MASTER_DATA.M6, 0) - ISNULL(ORIGINAL_BUDGET.H1, 0) ELSE 0 END) AS DIFF_FIRST_HALF_VARIABLECOST,
      SUM(CASE WHEN MAX_REV.COST_TYPE = 1 THEN ISNULL(ORIGINAL_BUDGET.H2, 0) ELSE 0 END) AS ORIGINAL_SECOND_HALF_FIXCOST,
      SUM(CASE WHEN MAX_REV.COST_TYPE = 2 THEN ISNULL(ORIGINAL_BUDGET.H2, 0) ELSE 0 END) AS ORIGINAL_SECOND_HALF_VARIABLECOST,
      SUM(CASE WHEN MAX_REV.COST_TYPE = 1 THEN ISNULL(MASTER_DATA.M7, 0) ELSE 0 END) AS M7_FIXCOST,
      SUM(CASE WHEN MAX_REV.COST_TYPE = 2 THEN ISNULL(MASTER_DATA.M7, 0) ELSE 0 END) AS M7_VARIABLECOST,
      SUM(CASE WHEN MAX_REV.COST_TYPE = 1 THEN ISNULL(MASTER_DATA.M8, 0) ELSE 0 END) AS M8_FIXCOST,
      SUM(CASE WHEN MAX_REV.COST_TYPE = 2 THEN ISNULL(MASTER_DATA.M8, 0) ELSE 0 END) AS M8_VARIABLECOST,
      SUM(CASE WHEN MAX_REV.COST_TYPE = 1 THEN ISNULL(MASTER_DATA.M9, 0) ELSE 0 END) AS M9_FIXCOST,
      SUM(CASE WHEN MAX_REV.COST_TYPE = 2 THEN ISNULL(MASTER_DATA.M9, 0) ELSE 0 END) AS M9_VARIABLECOST,
      SUM(CASE WHEN MAX_REV.COST_TYPE = 1 THEN ISNULL(MASTER_DATA.M10, 0) ELSE 0 END) AS M10_FIXCOST,
      SUM(CASE WHEN MAX_REV.COST_TYPE = 2 THEN ISNULL(MASTER_DATA.M10, 0) ELSE 0 END) AS M10_VARIABLECOST,
      SUM(CASE WHEN MAX_REV.COST_TYPE = 1 THEN ISNULL(MASTER_DATA.M11, 0) ELSE 0 END) AS M11_FIXCOST,
      SUM(CASE WHEN MAX_REV.COST_TYPE = 2 THEN ISNULL(MASTER_DATA.M11, 0) ELSE 0 END) AS M11_VARIABLECOST,
      SUM(CASE WHEN MAX_REV.COST_TYPE = 1 THEN ISNULL(MASTER_DATA.M12, 0) ELSE 0 END) AS M12_FIXCOST,
      SUM(CASE WHEN MAX_REV.COST_TYPE = 2 THEN ISNULL(MASTER_DATA.M12, 0) ELSE 0 END) AS M12_VARIABLECOST,
      SUM(CASE WHEN MAX_REV.COST_TYPE = 1 THEN ISNULL(MASTER_DATA.M7, 0) + ISNULL(MASTER_DATA.M8, 0) + ISNULL(MASTER_DATA.M9, 0) + ISNULL(MASTER_DATA.M10, 0) + ISNULL(MASTER_DATA.M11, 0) + ISNULL(MASTER_DATA.M12, 0) ELSE 0 END) AS REVISE_SECOND_HALF_FIXCOST,
      SUM(CASE WHEN MAX_REV.COST_TYPE = 2 THEN ISNULL(MASTER_DATA.M7, 0) + ISNULL(MASTER_DATA.M8, 0) + ISNULL(MASTER_DATA.M9, 0) + ISNULL(MASTER_DATA.M10, 0) + ISNULL(MASTER_DATA.M11, 0) + ISNULL(MASTER_DATA.M12, 0) ELSE 0 END) AS REVISE_SECOND_HALF_VARIABLECOST,
      SUM(CASE WHEN MAX_REV.COST_TYPE = 1 THEN ISNULL(MASTER_DATA.M7, 0) + ISNULL(MASTER_DATA.M8, 0) + ISNULL(MASTER_DATA.M9, 0) + ISNULL(MASTER_DATA.M10, 0) + ISNULL(MASTER_DATA.M11, 0) + ISNULL(MASTER_DATA.M12, 0) - ISNULL(ORIGINAL_BUDGET.H2, 0) ELSE 0 END) AS DIFF_SECOND_HALF_FIXCOST,
      SUM(CASE WHEN MAX_REV.COST_TYPE = 2 THEN ISNULL(MASTER_DATA.M7, 0) + ISNULL(MASTER_DATA.M8, 0) + ISNULL(MASTER_DATA.M9, 0) + ISNULL(MASTER_DATA.M10, 0) + ISNULL(MASTER_DATA.M11, 0) + ISNULL(MASTER_DATA.M12, 0) - ISNULL(ORIGINAL_BUDGET.H2, 0) ELSE 0 END) AS DIFF_SECOND_HALF_VARIABLECOST,
      SUM(CASE WHEN MAX_REV.COST_TYPE = 1 THEN ISNULL(ACTUAL_DATA.M1, 0) + ISNULL(ACTUAL_DATA.M2, 0) + ISNULL(ACTUAL_DATA.M3, 0) + ISNULL(MASTER_DATA.M4, 0) + ISNULL(MASTER_DATA.M5, 0) + ISNULL(MASTER_DATA.M6, 0) + ISNULL(MASTER_DATA.M7, 0) + ISNULL(MASTER_DATA.M8, 0) + ISNULL(MASTER_DATA.M9, 0) + ISNULL(MASTER_DATA.M10, 0) + ISNULL(MASTER_DATA.M11, 0) + ISNULL(MASTER_DATA.M12, 0) ELSE 0 END) AS REVISE_TOTAL_YEAR_FIXCOST,
      SUM(CASE WHEN MAX_REV.COST_TYPE = 2 THEN ISNULL(ACTUAL_DATA.M1, 0) + ISNULL(ACTUAL_DATA.M2, 0) + ISNULL(ACTUAL_DATA.M3, 0) + ISNULL(MASTER_DATA.M4, 0) + ISNULL(MASTER_DATA.M5, 0) + ISNULL(MASTER_DATA.M6, 0) + ISNULL(MASTER_DATA.M7, 0) + ISNULL(MASTER_DATA.M8, 0) + ISNULL(MASTER_DATA.M9, 0) + ISNULL(MASTER_DATA.M10, 0) + ISNULL(MASTER_DATA.M11, 0) + ISNULL(MASTER_DATA.M12, 0) ELSE 0 END) AS REVISE_TOTAL_YEAR_VARIABLECOST,
      SUM(CASE WHEN MAX_REV.COST_TYPE = 1 THEN ISNULL(ACTUAL_DATA.M1, 0) + ISNULL(ACTUAL_DATA.M2, 0) + ISNULL(ACTUAL_DATA.M3, 0) + ISNULL(MASTER_DATA.M4, 0) + ISNULL(MASTER_DATA.M5, 0) + ISNULL(MASTER_DATA.M6, 0) - ISNULL(ORIGINAL_BUDGET.H1, 0) + (ISNULL(MASTER_DATA.M7, 0) + ISNULL(MASTER_DATA.M8, 0) + ISNULL(MASTER_DATA.M9, 0) + ISNULL(MASTER_DATA.M10, 0) + ISNULL(MASTER_DATA.M11, 0) + ISNULL(MASTER_DATA.M12, 0) - ISNULL(ORIGINAL_BUDGET.H2, 0)) ELSE 0 END) AS DIFF_TOTAL_YEAR_FIXCOST,
      SUM(CASE WHEN MAX_REV.COST_TYPE = 2 THEN ISNULL(ACTUAL_DATA.M1, 0) + ISNULL(ACTUAL_DATA.M2, 0) + ISNULL(ACTUAL_DATA.M3, 0) + ISNULL(MASTER_DATA.M4, 0) + ISNULL(MASTER_DATA.M5, 0) + ISNULL(MASTER_DATA.M6, 0) - ISNULL(ORIGINAL_BUDGET.H1, 0) + (ISNULL(MASTER_DATA.M7, 0) + ISNULL(MASTER_DATA.M8, 0) + ISNULL(MASTER_DATA.M9, 0) + ISNULL(MASTER_DATA.M10, 0) + ISNULL(MASTER_DATA.M11, 0) + ISNULL(MASTER_DATA.M12, 0) - ISNULL(ORIGINAL_BUDGET.H2, 0)) ELSE 0 END) AS DIFF_TOTAL_YEAR_VARIABLECOST
      FROM (
      SELECT BUDGET_DATA.BUDGET_ORDER_NO, BUDGET_DATA.BUDGET_YEAR, BUDGET_ORDER.COST_TYPE,
      BUDGET_DATA.PERIOD_TYPE, BUDGET_DATA.PROJECT_NO, MAX(BUDGET_DATA.REV_NO) AS REV_NO, BUDGET_ORDER.BUDGET_ORDER_NAME,
      BUDGET_ORDER.DEPT_NO, BUDGET_ORDER.PERSON_IN_CHARGE_NO, PIC.PERSON_IN_CHARGE_NAME, BUDGET_ORDER.PIC_SHOW_FLAG

      FROM BG_T_BUDGET_DATA AS BUDGET_DATA
      INNER JOIN BG_M_BUDGET_ORDER AS BUDGET_ORDER
      ON BUDGET_ORDER.BUDGET_ORDER_NO = BUDGET_DATA.BUDGET_ORDER_NO AND BUDGET_ORDER.BUDGET_TYPE = 'E' AND BUDGET_ORDER.ACTIVE_FLAG = 1
      LEFT JOIN BG_M_PERSON_IN_CHARGE AS PIC ON PIC.PERSON_IN_CHARGE_NO = BUDGET_ORDER.PERSON_IN_CHARGE_NO
      WHERE BUDGET_DATA.BUDGET_YEAR = @YEAR
      AND BUDGET_DATA.PERIOD_TYPE = @PERIOD
      AND BUDGET_DATA.PROJECT_NO = @PROJECTNO
      AND BUDGET_DATA.REV_NO = @REVNO
      GROUP BY BUDGET_DATA.BUDGET_ORDER_NO, BUDGET_DATA.BUDGET_YEAR, BUDGET_DATA.PERIOD_TYPE, BUDGET_DATA.PROJECT_NO, BUDGET_ORDER.BUDGET_ORDER_NAME, BUDGET_ORDER.DEPT_NO, BUDGET_ORDER.COST_TYPE,
      BUDGET_ORDER.PERSON_IN_CHARGE_NO, PIC.PERSON_IN_CHARGE_NAME, BUDGET_ORDER.PIC_SHOW_FLAG) AS MAX_REV

      INNER JOIN BG_T_BUDGET_DATA AS MASTER_DATA
      ON MAX_REV.BUDGET_YEAR = MASTER_DATA.BUDGET_YEAR
      AND MAX_REV.PERIOD_TYPE = MASTER_DATA.PERIOD_TYPE
      AND MAX_REV.PROJECT_NO = MASTER_DATA.PROJECT_NO
      AND MAX_REV.BUDGET_ORDER_NO = MASTER_DATA.BUDGET_ORDER_NO
      AND MAX_REV.REV_NO = MASTER_DATA.REV_NO

      LEFT OUTER JOIN BG_T_UPLOAD_DATA AS ORIGINAL_BUDGET
      ON MAX_REV.BUDGET_YEAR = ORIGINAL_BUDGET.BUDGET_YEAR
      AND ORIGINAL_BUDGET.PERIOD_TYPE = @PERIOD
      AND ORIGINAL_BUDGET.PROJECT_NO = @PROJECTNO
      AND MAX_REV.BUDGET_ORDER_NO = ORIGINAL_BUDGET.BUDGET_ORDER_NO
      AND ORIGINAL_BUDGET.DATA_TYPE = 1

      LEFT OUTER JOIN BG_T_UPLOAD_DATA AS ACTUAL_DATA
      ON ACTUAL_DATA.BUDGET_YEAR = MAX_REV.BUDGET_YEAR
      AND ACTUAL_DATA.PERIOD_TYPE = @PERIOD
      AND ACTUAL_DATA.PROJECT_NO = @PROJECTNO
      AND ACTUAL_DATA.BUDGET_ORDER_NO = MAX_REV.BUDGET_ORDER_NO
      AND ACTUAL_DATA.DATA_TYPE = 2

      WHERE ISNULL(ORIGINAL_BUDGET.H1, 0) &lt;&gt; 0 OR ISNULL(ORIGINAL_BUDGET.H2, 0) &lt;&gt; 0 OR
      ISNULL(ACTUAL_DATA.M1, 0) &lt;&gt; 0 OR ISNULL(ACTUAL_DATA.M2, 0) &lt;&gt; 0 OR ISNULL(ACTUAL_DATA.M3, 0) &lt;&gt; 0 OR
      ISNULL(MASTER_DATA.M4, 0) &lt;&gt; 0 OR ISNULL(MASTER_DATA.M5, 0) &lt;&gt; 0 OR ISNULL(MASTER_DATA.M6, 0) &lt;&gt; 0 OR
      ISNULL(MASTER_DATA.M7, 0) &lt;&gt; 0 OR ISNULL(MASTER_DATA.M8, 0) &lt;&gt; 0 OR ISNULL(MASTER_DATA.M9, 0) &lt;&gt; 0 OR
      ISNULL(MASTER_DATA.M10, 0) &lt;&gt; 0 OR ISNULL(MASTER_DATA.M11, 0) &lt;&gt; 0 OR ISNULL(MASTER_DATA.M12, 0) &lt;&gt; 0 OR
      ISNULL(MASTER_DATA.RRT1, 0) &lt;&gt; 0 OR ISNULL(MASTER_DATA.RRT2, 0) &lt;&gt; 0 OR ISNULL(MASTER_DATA.RRT3, 0) &lt;&gt; 0
      OR ISNULL(MASTER_DATA.RRT4, 0) &lt;&gt; 0 OR ISNULL(MASTER_DATA.RRT5, 0) &lt;&gt; 0

      GROUP BY MAX_REV.BUDGET_YEAR, MAX_REV.PERIOD_TYPE, MAX_REV.PROJECT_NO, MAX_REV.PERSON_IN_CHARGE_NO, MAX_REV.PERSON_IN_CHARGE_NAME, MAX_REV.PIC_SHOW_FLAG
      ORDER BY MAX_REV.PERSON_IN_CHARGE_NO
    </SELECT014_6>
    <SELECT015_1>
      SELECT MAX_REV.BUDGET_YEAR, MAX_REV.PERIOD_TYPE, MAX_REV.PROJECT_NO, MAX_REV.ACCOUNT_NO, MAX_REV.ACCOUNT_NAME, MAX_REV.BUDGET_TYPE, MAX_REV.EXPENSE_TYPE,
      SUM(ISNULL(ACTUAL_DATA.H1,0)) AS ACTUAL_1ST_HALF,

      --SUM(ISNULL(REVISE_BUDGET.H2,0)) AS REVISE_2ND_HALF,
      SUM(ISNULL(MAX_REV.REVISE_SECOND_HALF,0)) AS REVISE_2ND_HALF,

      SUM(ISNULL(MASTER_DATA.M1, 0)) AS M1, SUM(ISNULL(MASTER_DATA.M2, 0)) AS M2, SUM(ISNULL(MASTER_DATA.M3, 0)) AS M3, SUM(ISNULL(MASTER_DATA.M4, 0)) AS M4, SUM(ISNULL(MASTER_DATA.M5, 0)) AS M5, SUM(ISNULL(MASTER_DATA.M6, 0)) AS M6,
      SUM(ISNULL(MASTER_DATA.M7, 0)) AS M7, SUM(ISNULL(MASTER_DATA.M8, 0)) AS M8, SUM(ISNULL(MASTER_DATA.M9, 0)) AS M9, SUM(ISNULL(MASTER_DATA.M10, 0)) AS M10, SUM(ISNULL(MASTER_DATA.M11, 0)) AS M11, SUM(ISNULL(MASTER_DATA.M12, 0)) AS M12,
      0 AS INVESTMENT_ACTUAL_1ST_HALF,
      0 AS INVESTMENT_REVISE_2ND_HALF,
      0 AS INVESTMENT_M1,
      0 AS INVESTMENT_M2,
      0 AS INVESTMENT_M3,
      0 AS INVESTMENT_M4,
      0 AS INVESTMENT_M5,
      0 AS INVESTMENT_M6,
      0 AS INVESTMENT_2ND_HALF,
      SUM(CASE WHEN MAX_REV.COST = @Admin THEN ISNULL(ACTUAL_DATA.H1,0) ELSE 0 END ) AS ADMIN_ACTUAL_1ST_HALF,
      SUM(CASE WHEN MAX_REV.COST = @FC THEN ISNULL(ACTUAL_DATA.H1,0) ELSE 0 END ) AS FC_ACTUAL_1ST_HALF,
      SUM(CASE WHEN MAX_REV.COST = @Admin THEN ISNULL(MAX_REV.REVISE_SECOND_HALF,0) ELSE 0 END ) AS ADMIN_REVISE_2ND_HALF,
      SUM(CASE WHEN MAX_REV.COST = @FC THEN ISNULL(MAX_REV.REVISE_SECOND_HALF,0) ELSE 0 END ) AS FC_REVISE_2ND_HALF,
      SUM(CASE WHEN MAX_REV.COST = @Admin THEN ISNULL(MASTER_DATA.M1,0) ELSE 0 END ) AS ADMIN_M1,
      SUM(CASE WHEN MAX_REV.COST = @FC THEN ISNULL(MASTER_DATA.M1,0) ELSE 0 END ) AS FC_M1,
      SUM(CASE WHEN MAX_REV.COST = @Admin THEN ISNULL(MASTER_DATA.M2,0) ELSE 0 END ) AS ADMIN_M2,
      SUM(CASE WHEN MAX_REV.COST = @FC THEN ISNULL(MASTER_DATA.M2,0) ELSE 0 END ) AS FC_M2,
      SUM(CASE WHEN MAX_REV.COST = @Admin THEN ISNULL(MASTER_DATA.M3,0) ELSE 0 END ) AS ADMIN_M3,
      SUM(CASE WHEN MAX_REV.COST = @FC THEN ISNULL(MASTER_DATA.M3,0) ELSE 0 END ) AS FC_M3,
      SUM(CASE WHEN MAX_REV.COST = @Admin THEN ISNULL(MASTER_DATA.M4,0) ELSE 0 END ) AS ADMIN_M4,
      SUM(CASE WHEN MAX_REV.COST = @FC THEN ISNULL(MASTER_DATA.M4,0) ELSE 0 END ) AS FC_M4,
      SUM(CASE WHEN MAX_REV.COST = @Admin THEN ISNULL(MASTER_DATA.M5,0) ELSE 0 END )AS ADMIN_M5,
      SUM(CASE WHEN MAX_REV.COST = @FC THEN ISNULL(MASTER_DATA.M5,0) ELSE 0 END ) AS FC_M5,
      SUM(CASE WHEN MAX_REV.COST = @Admin THEN ISNULL(MASTER_DATA.M6,0) ELSE 0 END )AS ADMIN_M6,
      SUM(CASE WHEN MAX_REV.COST = @FC THEN ISNULL(MASTER_DATA.M6,0) ELSE 0 END ) AS FC_M6,
      SUM(CASE WHEN MAX_REV.COST = @Admin THEN ISNULL(MASTER_DATA.M7,0) ELSE 0 END ) AS ADMIN_M7,
      SUM(CASE WHEN MAX_REV.COST = @FC THEN ISNULL(MASTER_DATA.M7,0) ELSE 0 END )AS FC_M7,
      SUM(CASE WHEN MAX_REV.COST = @Admin THEN ISNULL(MASTER_DATA.M8,0) ELSE 0 END )AS ADMIN_M8,
      SUM(CASE WHEN MAX_REV.COST = @FC THEN ISNULL(MASTER_DATA.M8,0) ELSE 0 END )AS FC_M8,
      SUM(CASE WHEN MAX_REV.COST = @Admin THEN ISNULL(MASTER_DATA.M9,0) ELSE 0 END )AS ADMIN_M9,
      SUM(CASE WHEN MAX_REV.COST = @FC THEN ISNULL(MASTER_DATA.M9,0) ELSE 0 END ) AS FC_M9,
      SUM(CASE WHEN MAX_REV.COST = @Admin THEN ISNULL(MASTER_DATA.M10,0) ELSE 0 END ) AS ADMIN_M10,
      SUM(CASE WHEN MAX_REV.COST = @FC THEN ISNULL(MASTER_DATA.M10,0) ELSE 0 END ) AS FC_M10,
      SUM(CASE WHEN MAX_REV.COST = @Admin THEN ISNULL(MASTER_DATA.M11,0) ELSE 0 END ) AS ADMIN_M11,
      SUM(CASE WHEN MAX_REV.COST = @FC THEN ISNULL(MASTER_DATA.M11,0) ELSE 0 END ) AS FC_M11,
      SUM(CASE WHEN MAX_REV.COST = @Admin THEN ISNULL(MASTER_DATA.M12,0) ELSE 0 END ) AS ADMIN_M12,
      SUM(CASE WHEN MAX_REV.COST = @FC THEN ISNULL(MASTER_DATA.M12,0) ELSE 0 END ) AS FC_M12,
      SUM(CASE WHEN MAX_REV.COST = @Admin THEN ISNULL(MASTER_DATA.M1,0) + ISNULL(MASTER_DATA.M2,0) + ISNULL(MASTER_DATA.M3,0) + ISNULL(MASTER_DATA.M4,0) + ISNULL(MASTER_DATA.M5,0) + ISNULL(MASTER_DATA.M6,0) ELSE 0 END ) AS ADMIN_1ST_HALF,
      SUM(CASE WHEN MAX_REV.COST = @FC THEN ISNULL(MASTER_DATA.M1,0) + ISNULL(MASTER_DATA.M2,0) + ISNULL(MASTER_DATA.M3,0) + ISNULL(MASTER_DATA.M4,0) + ISNULL(MASTER_DATA.M5,0) + ISNULL(MASTER_DATA.M6,0) ELSE 0 END ) AS FC_1ST_HALF,
      SUM(CASE WHEN MAX_REV.COST = @Admin THEN ISNULL(MASTER_DATA.M7,0) + ISNULL(MASTER_DATA.M8,0) + ISNULL(MASTER_DATA.M9,0) + ISNULL(MASTER_DATA.M10,0) + ISNULL(MASTER_DATA.M11,0) + ISNULL(MASTER_DATA.M12,0) ELSE 0 END ) AS ADMIN_2ND_HALF,
      SUM(CASE WHEN MAX_REV.COST = @FC THEN ISNULL(MASTER_DATA.M7,0) + ISNULL(MASTER_DATA.M8,0) + ISNULL(MASTER_DATA.M9,0) + ISNULL(MASTER_DATA.M10,0) + ISNULL(MASTER_DATA.M11,0) + ISNULL(MASTER_DATA.M12,0) ELSE 0 END ) AS FC_2ND_HALF,
      SUM(CASE WHEN MAX_REV.COST = @Admin THEN ISNULL(MASTER_DATA.M1,0) + ISNULL(MASTER_DATA.M2,0) + ISNULL(MASTER_DATA.M3,0) + ISNULL(MASTER_DATA.M4,0) + ISNULL(MASTER_DATA.M5,0) + ISNULL(MASTER_DATA.M6,0) + ISNULL(MASTER_DATA.M7,0) + ISNULL(MASTER_DATA.M8,0) + ISNULL(MASTER_DATA.M9,0) + ISNULL(MASTER_DATA.M10,0) + ISNULL(MASTER_DATA.M11,0) + ISNULL(MASTER_DATA.M12,0) ELSE 0 END ) AS ADMIN_TOTAL_YEAR,
      SUM(CASE WHEN MAX_REV.COST = @FC THEN ISNULL(MASTER_DATA.M1,0) + ISNULL(MASTER_DATA.M2,0) + ISNULL(MASTER_DATA.M3,0) + ISNULL(MASTER_DATA.M4,0) + ISNULL(MASTER_DATA.M5,0) + ISNULL(MASTER_DATA.M6,0) + ISNULL(MASTER_DATA.M7,0) + ISNULL(MASTER_DATA.M8,0) + ISNULL(MASTER_DATA.M9,0) + ISNULL(MASTER_DATA.M10,0) + ISNULL(MASTER_DATA.M11,0) + ISNULL(MASTER_DATA.M12,0) ELSE 0 END ) AS FC_TOTAL_YEAR,
      (SELECT ISNULL(WKH1,0) FROM BG_T_BUDGET_ADJUST WHERE BUDGET_YEAR=@BudgetYear AND PERIOD_TYPE=@PeriodType AND PROJECT_NO = @ProjectNo AND REV_NO= (SELECT MAX(REV_NO) AS REV_NO FROM BG_T_BUDGET_DATA WHERE BUDGET_YEAR = @BudgetYear AND PERIOD_TYPE = @PeriodType AND PROJECT_NO = @ProjectNo)) AS WB_ACTUAL_1ST_HALF,
      (SELECT ISNULL(WKH2,0) FROM BG_T_BUDGET_ADJUST WHERE BUDGET_YEAR=@BudgetYear AND PERIOD_TYPE=@PeriodType AND PROJECT_NO = @ProjectNo AND REV_NO= (SELECT MAX(REV_NO) AS REV_NO FROM BG_T_BUDGET_DATA WHERE BUDGET_YEAR = @BudgetYear AND PERIOD_TYPE = @PeriodType AND PROJECT_NO = @ProjectNo)) AS WB_REVISE_2ND_HALF,
      SUM(ISNULL(ROUND(MIN_REV.M1,2),0) -   ISNULL(ROUND(MASTER_DATA.M1,2),0)) AS WB_M1,
      SUM(ISNULL(ROUND(MIN_REV.M2,2),0) -   ISNULL(ROUND(MASTER_DATA.M2,2),0)) AS WB_M2,
      SUM(ISNULL(ROUND(MIN_REV.M3,2),0) -   ISNULL(ROUND(MASTER_DATA.M3,2),0)) AS WB_M3,
      SUM(ISNULL(ROUND(MIN_REV.M4,2),0) -   ISNULL(ROUND(MASTER_DATA.M4,2),0)) AS WB_M4,
      SUM(ISNULL(ROUND(MIN_REV.M5,2),0) -   ISNULL(ROUND(MASTER_DATA.M5,2),0)) AS WB_M5,
      SUM(ISNULL(ROUND(MIN_REV.M6,2),0) -   ISNULL(ROUND(MASTER_DATA.M6,2),0)) AS WB_M6,
      SUM(ISNULL(ROUND(MIN_REV.M7,2),0) -   ISNULL(ROUND(MASTER_DATA.M7,2),0)) AS WB_M7,
      SUM(ISNULL(ROUND(MIN_REV.M8,2),0) -   ISNULL(ROUND(MASTER_DATA.M8,2),0)) AS WB_M8,
      SUM(ISNULL(ROUND(MIN_REV.M9,2),0) -   ISNULL(ROUND(MASTER_DATA.M9,2),0)) AS WB_M9,
      SUM(ISNULL(ROUND(MIN_REV.M10,2),0) -   ISNULL(ROUND(MASTER_DATA.M10,2),0)) AS WB_M10,
      SUM(ISNULL(ROUND(MIN_REV.M11,2),0) -   ISNULL(ROUND(MASTER_DATA.M11,2),0)) AS WB_M11,
      SUM(ISNULL(ROUND(MIN_REV.M12,2),0) -   ISNULL(ROUND(MASTER_DATA.M12,2),0)) AS WB_M12,
      SUM(ISNULL(ROUND(MTP_MIN_REV.RRT2,2),0) -   ISNULL(ROUND(MTP.RRT2,2),0)) AS MTPWB,
      SUM(ISNULL(ROUND(MTP_MIN_REV.RRT2,2),0) -   ISNULL(ROUND(MTP.RRT2,2),0)) AS WB_MTP_RRT1,
      0 AS WB_TOTAL_1ST_HALF,
      0 AS WB_TOTAL_2ND_HALF
      ,SUM(ISNULL(MTP.RRT2,0)) AS MTP_RRT1
      ,SUM(CASE WHEN MAX_REV.COST = @Admin THEN ISNULL(MTP.RRT2,0) ELSE 0 END) AS MTP_RRT1_ADMIN
      ,SUM(CASE WHEN MAX_REV.COST = @FC THEN ISNULL(MTP.RRT2,0) ELSE 0 END) AS MTP_RRT1_FC


      ,0 AS INVESTMENT_M7
      ,0 AS INVESTMENT_M8
      ,0 AS INVESTMENT_M9
      ,0 AS INVESTMENT_M10
      ,0 AS INVESTMENT_M11
      ,0 AS INVESTMENT_M12


      FROM (
      SELECT BUDGET_DATA.BUDGET_ORDER_NO, BUDGET_DATA.BUDGET_YEAR, BUDGET_DATA.PERIOD_TYPE, BUDGET_DATA.PROJECT_NO,
      BUDGET_ORDER.ACCOUNT_NO, ACCOUNT.ACCOUNT_NAME,
      BUDGET_ORDER.BUDGET_TYPE, BUDGET_ORDER.EXPENSE_TYPE, BUDGET_ORDER.COST,
      MAX(BUDGET_DATA.REV_NO) AS REV_NO

      ,ISNULL((SELECT ISNULL(ISNULL(M10,0)+ISNULL(M11,0)+ISNULL(M12,0),0)
      FROM BG_T_BUDGET_DATA
      WHERE BUDGET_YEAR = (@BudgetYear-1)
      AND PERIOD_TYPE = 2
      --AND REV_NO = (SELECT MAX(REV_NO) AS REV_NO FROM BG_T_BUDGET_DATA WHERE BUDGET_YEAR = (@BudgetYear-1) AND PERIOD_TYPE = 2 AND PROJECT_NO = @ProjectNo)
      --AND PROJECT_NO = @ProjectNo
      AND REV_NO = @RefEstRevNo
      AND PROJECT_NO = @RefEstProjectNo
      AND BUDGET_ORDER_NO = BUDGET_DATA.BUDGET_ORDER_NO),0)+
      ISNULL((SELECT ISNULL(M7,0)+ISNULL(M8,0)+ISNULL(M9,0)
      FROM BG_T_UPLOAD_DATA
      WHERE BUDGET_YEAR = (@BudgetYear-1)
      AND PERIOD_TYPE = 2
      --AND PROJECT_NO = @ProjectNo
      AND PROJECT_NO = @RefEstProjectNo
      AND DATA_TYPE = 2
      AND BUDGET_ORDER_NO = BUDGET_DATA.BUDGET_ORDER_NO),0) AS REVISE_SECOND_HALF

      FROM BG_T_BUDGET_DATA AS BUDGET_DATA
      INNER JOIN BG_M_BUDGET_ORDER AS BUDGET_ORDER
      ON BUDGET_ORDER.BUDGET_ORDER_NO = BUDGET_DATA.BUDGET_ORDER_NO
      INNER JOIN BG_M_ACCOUNT AS ACCOUNT
      ON ACCOUNT.ACCOUNT_NO = BUDGET_ORDER.ACCOUNT_NO AND BUDGET_ORDER.ACTIVE_FLAG = 1
      WHERE BUDGET_DATA.BUDGET_YEAR = @BudgetYear
      AND BUDGET_DATA.PERIOD_TYPE = @PeriodType
      AND BUDGET_DATA.PROJECT_NO = @ProjectNo
      AND BUDGET_ORDER.BUDGET_TYPE= 'E'
      GROUP BY BUDGET_DATA.BUDGET_ORDER_NO, BUDGET_DATA.BUDGET_YEAR, BUDGET_DATA.PERIOD_TYPE, BUDGET_DATA.PROJECT_NO,
      BUDGET_ORDER.ACCOUNT_NO, ACCOUNT.ACCOUNT_NAME,
      BUDGET_ORDER.BUDGET_TYPE, BUDGET_ORDER.EXPENSE_TYPE, BUDGET_ORDER.COST) AS MAX_REV

      INNER JOIN BG_T_BUDGET_DATA AS MASTER_DATA
      ON MAX_REV.BUDGET_YEAR = MASTER_DATA.BUDGET_YEAR
      AND MAX_REV.PERIOD_TYPE = MASTER_DATA.PERIOD_TYPE
      AND MAX_REV.PROJECT_NO = MASTER_DATA.PROJECT_NO
      AND MAX_REV.BUDGET_ORDER_NO = MASTER_DATA.BUDGET_ORDER_NO
      AND MAX_REV.REV_NO = MASTER_DATA.REV_NO

      LEFT OUTER JOIN BG_T_UPLOAD_DATA AS REVISE_BUDGET
      ON REVISE_BUDGET.BUDGET_YEAR = MAX_REV.BUDGET_YEAR- 1
      AND REVISE_BUDGET.PERIOD_TYPE = @PeriodType
      AND REVISE_BUDGET.PROJECT_NO = @ProjectNo
      AND REVISE_BUDGET.BUDGET_ORDER_NO = MAX_REV.BUDGET_ORDER_NO
      AND REVISE_BUDGET.DATA_TYPE = 1

      LEFT OUTER JOIN BG_T_UPLOAD_DATA AS ACTUAL_DATA
      ON ACTUAL_DATA.BUDGET_YEAR = MAX_REV.BUDGET_YEAR- 1
      AND ACTUAL_DATA.PERIOD_TYPE = @PeriodType
      AND ACTUAL_DATA.PROJECT_NO = @ProjectNo
      AND ACTUAL_DATA.BUDGET_ORDER_NO = MAX_REV.BUDGET_ORDER_NO
      AND ACTUAL_DATA.DATA_TYPE = 2

      LEFT JOIN BG_T_BUDGET_DATA AS MIN_REV
      ON MIN_REV.BUDGET_YEAR = MASTER_DATA.BUDGET_YEAR
      AND MIN_REV.PERIOD_TYPE = MASTER_DATA.PERIOD_TYPE
      AND MIN_REV.PROJECT_NO = @ProjectNo
      AND MIN_REV.BUDGET_ORDER_NO = MASTER_DATA.BUDGET_ORDER_NO
      AND MIN_REV.REV_NO = 1

      LEFT JOIN BG_T_BUDGET_DATA AS MTP
      ON MAX_REV.BUDGET_ORDER_NO = MTP.BUDGET_ORDER_NO
      AND MTP.BUDGET_YEAR=(@BudgetYear-2)
      AND MTP.PERIOD_TYPE = 10
      AND MTP.PROJECT_NO = @MtpProjectNo
      AND MTP.REV_NO = @MtpRevNo
      --AND MTP.REV_NO = (SELECT ISNULL(MAX(REV_NO),1) AS MAX_REV_NO FROM BG_T_BUDGET_HEADER
      --WHERE BUDGET_YEAR = (@BudgetYear-1)
      --AND PERIOD_TYPE = 10 AND BUDGET_TYPE = 'E' AND PROJECT_NO = @MtpProjectNo)

      LEFT JOIN BG_T_BUDGET_DATA AS MTP_MIN_REV
      ON MTP_MIN_REV.BUDGET_YEAR = (@BudgetYear-2)
      AND MTP_MIN_REV.PERIOD_TYPE = 10
      AND MTP_MIN_REV.PROJECT_NO = @MtpProjectNo
      AND MTP_MIN_REV.BUDGET_ORDER_NO = MTP.BUDGET_ORDER_NO
      AND MTP_MIN_REV.REV_NO = 1

      WHERE
      ( ISNULL(ACTUAL_DATA.H1,0) &lt;&gt; 0
      OR ISNULL(MAX_REV.REVISE_SECOND_HALF,0) &lt;&gt; 0
      OR ISNULL(MASTER_DATA.M1,0) &lt;&gt; 0
      OR ISNULL(MASTER_DATA.M2,0) &lt;&gt; 0
      OR ISNULL(MASTER_DATA.M3,0) &lt;&gt; 0
      OR ISNULL(MASTER_DATA.M4, 0) &lt;&gt; 0
      OR ISNULL(MASTER_DATA.M5, 0) &lt;&gt; 0
      OR ISNULL(MASTER_DATA.M6, 0) &lt;&gt; 0
      OR ISNULL(MASTER_DATA.M7, 0) &lt;&gt; 0
      OR ISNULL(MASTER_DATA.M8, 0) &lt;&gt; 0
      OR ISNULL(MASTER_DATA.M9, 0) &lt;&gt; 0
      OR ISNULL(MASTER_DATA.M10, 0) &lt;&gt; 0
      OR ISNULL(MASTER_DATA.M11, 0) &lt;&gt; 0
      OR ISNULL(MASTER_DATA.M12, 0) &lt;&gt; 0
      OR ISNULL(MIN_REV.M1,0) &lt;&gt; 0
      OR ISNULL(MIN_REV.M2,0) &lt;&gt; 0
      OR ISNULL(MIN_REV.M3,0) &lt;&gt; 0
      OR ISNULL(MIN_REV.M4, 0) &lt;&gt; 0
      OR ISNULL(MIN_REV.M5, 0) &lt;&gt; 0
      OR ISNULL(MIN_REV.M6, 0) &lt;&gt; 0
      OR ISNULL(MIN_REV.M7, 0) &lt;&gt; 0
      OR ISNULL(MIN_REV.M8, 0) &lt;&gt; 0
      OR ISNULL(MIN_REV.M9, 0) &lt;&gt; 0
      OR ISNULL(MIN_REV.M10, 0) &lt;&gt; 0
      OR ISNULL(MIN_REV.M11, 0) &lt;&gt; 0
      OR ISNULL(MIN_REV.M12, 0) &lt;&gt; 0
      OR ISNULL(MTP.RRT2,0) &lt;&gt; 0
      OR ISNULL(MTP_MIN_REV.RRT2,0) &lt;&gt; 0
      )
      GROUP BY MAX_REV.BUDGET_YEAR, MAX_REV.PERIOD_TYPE, MAX_REV.PROJECT_NO, MAX_REV.ACCOUNT_NO, MAX_REV.ACCOUNT_NAME, MAX_REV.BUDGET_TYPE, MAX_REV.EXPENSE_TYPE
      UNION
      SELECT MAX_REV.BUDGET_YEAR, MAX_REV.PERIOD_TYPE, MAX_REV.PROJECT_NO, MAX_REV.ACCOUNT_NO, MAX_REV.ACCOUNT_NAME, MAX_REV.BUDGET_TYPE, MAX_REV.EXPENSE_TYPE,
      0 AS ACTUAL_1ST_HALF,
      0 AS REVISE_2ND_HALF,
      0 AS M1, 0 AS M2, 0 AS M3, 0 AS M4, 0 AS M5, 0 AS M6,
      0 AS M7, 0 AS M8, 0 AS M9, 0 AS M10, 0 AS M11, 0 AS M12,
      SUM(ISNULL(ACTUAL_DATA.H1,0)) AS INVESTMENT_ACTUAL_1ST_HALF,

      --SUM(ISNULL(REVISE_BUDGET.H2,0)) AS INVESTMENT_REVISE_2ND_HALF,
      SUM(ISNULL(MAX_REV.REVISE_SECOND_HALF,0)) AS INVESTMENT_REVISE_2ND_HALF,

      SUM(ISNULL(MASTER_DATA.M1,0)) AS INVESTMENT_M1,
      SUM(ISNULL(MASTER_DATA.M2,0)) AS INVESTMENT_M2,
      SUM(ISNULL(MASTER_DATA.M3,0)) AS INVESTMENT_M3,
      SUM(ISNULL(MASTER_DATA.M4,0)) AS INVESTMENT_M4,
      SUM(ISNULL(MASTER_DATA.M5,0)) AS INVESTMENT_M5,
      SUM(ISNULL(MASTER_DATA.M6,0)) AS INVESTMENT_M6,
      SUM(ISNULL(MASTER_DATA.M7,0)+ISNULL(MASTER_DATA.M8,0)+ISNULL(MASTER_DATA.M9,0)+ISNULL(MASTER_DATA.M10,0)+ISNULL(MASTER_DATA.M11,0)+ISNULL(MASTER_DATA.M12,0)) AS INVESTMENT_2ND_HALF,
      0 AS ADMIN_ACTUAL_1ST_HALF,
      0 AS FC_ACTUAL_1ST_HALF,
      0 AS ADMIN_REVISE_2ND_HALF,
      0 AS FC_REVISE_2ND_HALF,
      0 AS ADMIN_M1,
      0 AS FC_M1,
      0 AS ADMIN_M2,
      0 AS FC_M2,
      0 AS ADMIN_M3,
      0 AS FC_M3,
      0 AS ADMIN_M4,
      0 AS FC_M4,
      0 AS ADMIN_M5,
      0 AS FC_M5,
      0 AS ADMIN_M6,
      0 AS FC_M6,
      0 AS ADMIN_M7,
      0 AS FC_M7,
      0 AS ADMIN_M8,
      0 AS FC_M8,
      0 AS ADMIN_M9,
      0 AS FC_M9,
      0 AS ADMIN_M10,
      0 AS FC_M10,
      0 AS ADMIN_M11,
      0 AS FC_M11,
      0 AS ADMIN_M12,
      0 AS FC_M12,
      0 AS ADMIN_1ST_HALF,
      0 AS FC_1ST_HALF,
      0 AS ADMIN_2ND_HALF,
      0 AS FC_2ND_HALF,
      0 AS ADMIN_TOTAL_YEAR,
      0 AS FC_TOTAL_YEAR,
      0 AS WB_ACTUAL_1ST_HALF,
      0 AS WB_REVISE_2ND_HALF,
      0 AS WB_M1,
      0 AS WB_M2,
      0 AS WB_M3,
      0 AS WB_M4,
      0 AS WB_M5,
      0 AS WB_M6,
      0 AS WB_M7,
      0 AS WB_M8,
      0 AS WB_M9,
      0 AS WB_M10,
      0 AS WB_M11,
      0 AS WB_M12,
      0 AS MTPWB,
      ISNULL(BD.MTP_SUM2,0) AS MTP_RRT1,
      0 AS WB_TOTAL_1ST_HALF,
      0 AS WB_TOTAL_2ND_HALF
      ,0 AS MTP_RRT1
      ,0 AS MTP_RRT1_ADMIN
      ,0 AS MTP_RRT1_FC


      ,SUM(ISNULL(MASTER_DATA.M7,0)) AS INVESTMENT_M7
      ,SUM(ISNULL(MASTER_DATA.M8,0)) AS INVESTMENT_M8
      ,SUM(ISNULL(MASTER_DATA.M9,0)) AS INVESTMENT_M9
      ,SUM(ISNULL(MASTER_DATA.M10,0)) AS INVESTMENT_M10
      ,SUM(ISNULL(MASTER_DATA.M11,0)) AS INVESTMENT_M11
      ,SUM(ISNULL(MASTER_DATA.M12,0)) AS INVESTMENT_M12


      FROM (
      SELECT BUDGET_DATA.BUDGET_ORDER_NO, BUDGET_DATA.BUDGET_YEAR, BUDGET_DATA.PERIOD_TYPE, BUDGET_DATA.PROJECT_NO,
      BUDGET_ORDER.ACCOUNT_NO, ACCOUNT.ACCOUNT_NAME,
      BUDGET_ORDER.BUDGET_TYPE, BUDGET_ORDER.EXPENSE_TYPE, BUDGET_ORDER.COST,
      MAX(BUDGET_DATA.REV_NO) AS REV_NO

      ,ISNULL((SELECT ISNULL(ISNULL(M10,0)+ISNULL(M11,0)+ISNULL(M12,0),0)
      FROM BG_T_BUDGET_DATA
      WHERE BUDGET_YEAR = (@BudgetYear-1)
      AND PERIOD_TYPE = 2
      AND REV_NO = (SELECT MAX(REV_NO) AS REV_NO FROM BG_T_BUDGET_DATA WHERE BUDGET_YEAR = (@BudgetYear-1) AND PERIOD_TYPE = 2 AND PROJECT_NO = @ProjectNo AND REV_NO = 1)
      AND PROJECT_NO = @ProjectNo
      AND BUDGET_ORDER_NO = BUDGET_DATA.BUDGET_ORDER_NO),0)+
      ISNULL((SELECT ISNULL(M7,0)+ISNULL(M8,0)+ISNULL(M9,0)
      FROM BG_T_UPLOAD_DATA
      WHERE BUDGET_YEAR = (@BudgetYear-1)
      AND PERIOD_TYPE = 2
      AND PROJECT_NO = @ProjectNo
      AND DATA_TYPE = 2
      AND BUDGET_ORDER_NO = BUDGET_DATA.BUDGET_ORDER_NO),0) AS REVISE_SECOND_HALF

      FROM BG_T_BUDGET_DATA AS BUDGET_DATA
      INNER JOIN BG_M_BUDGET_ORDER AS BUDGET_ORDER
      ON BUDGET_ORDER.BUDGET_ORDER_NO = BUDGET_DATA.BUDGET_ORDER_NO
      INNER JOIN BG_M_ACCOUNT AS ACCOUNT
      ON ACCOUNT.ACCOUNT_NO = BUDGET_ORDER.ACCOUNT_NO AND BUDGET_ORDER.ACTIVE_FLAG = 1
      WHERE BUDGET_DATA.BUDGET_YEAR = @BudgetYear
      AND BUDGET_DATA.PERIOD_TYPE = @PeriodType
      AND BUDGET_DATA.PROJECT_NO = @ProjectNo
      AND BUDGET_ORDER.BUDGET_TYPE= 'A'
      GROUP BY BUDGET_DATA.BUDGET_ORDER_NO, BUDGET_DATA.BUDGET_YEAR, BUDGET_DATA.PERIOD_TYPE, BUDGET_DATA.PROJECT_NO,
      BUDGET_ORDER.ACCOUNT_NO, ACCOUNT.ACCOUNT_NAME,
      BUDGET_ORDER.BUDGET_TYPE, BUDGET_ORDER.EXPENSE_TYPE, BUDGET_ORDER.COST) AS MAX_REV
      INNER JOIN BG_T_BUDGET_DATA AS MASTER_DATA
      ON MAX_REV.BUDGET_YEAR = MASTER_DATA.BUDGET_YEAR
      AND MAX_REV.PERIOD_TYPE = MASTER_DATA.PERIOD_TYPE
      AND MAX_REV.PROJECT_NO = MASTER_DATA.PROJECT_NO
      AND MAX_REV.BUDGET_ORDER_NO = MASTER_DATA.BUDGET_ORDER_NO
      AND MAX_REV.REV_NO = MASTER_DATA.REV_NO
      LEFT OUTER JOIN BG_T_UPLOAD_DATA AS REVISE_BUDGET
      ON REVISE_BUDGET.BUDGET_YEAR = MAX_REV.BUDGET_YEAR- 1
      AND REVISE_BUDGET.PERIOD_TYPE = @PeriodType
      AND REVISE_BUDGET.PROJECT_NO = @ProjectNo
      AND REVISE_BUDGET.BUDGET_ORDER_NO = MAX_REV.BUDGET_ORDER_NO
      AND REVISE_BUDGET.DATA_TYPE = 1
      LEFT OUTER JOIN BG_T_UPLOAD_DATA AS ACTUAL_DATA
      ON ACTUAL_DATA.BUDGET_YEAR = MAX_REV.BUDGET_YEAR- 1
      AND ACTUAL_DATA.PERIOD_TYPE = @PeriodType
      AND ACTUAL_DATA.PROJECT_NO = @ProjectNo
      AND ACTUAL_DATA.BUDGET_ORDER_NO = MAX_REV.BUDGET_ORDER_NO
      AND ACTUAL_DATA.DATA_TYPE = 2
      INNER JOIN BG_T_BUDGET_DATA AS MIN_REV
      ON MIN_REV.BUDGET_YEAR = MASTER_DATA.BUDGET_YEAR
      AND MIN_REV.PERIOD_TYPE = MASTER_DATA.PERIOD_TYPE
      AND MIN_REV.PROJECT_NO = @ProjectNo
      AND MIN_REV.BUDGET_ORDER_NO = MASTER_DATA.BUDGET_ORDER_NO
      AND MIN_REV.REV_NO = 1
      LEFT JOIN BG_T_BUDGET_ADJUST2 AS BD
      ON BD.BUDGET_YEAR = (@BudgetYear-2)
      AND BD.PERIOD_TYPE = 10
      AND BD.REV_NO = '@MtpRevNo'
      AND BD.PROJECT_NO = @MtpProjectNo
      WHERE
      ( ISNULL(ACTUAL_DATA.H1,0) &lt;&gt; 0
      OR ISNULL(MAX_REV.REVISE_SECOND_HALF,0) &lt;&gt; 0
      OR ISNULL(MASTER_DATA.M1,0) &lt;&gt; 0
      OR ISNULL(MASTER_DATA.M2,0) &lt;&gt; 0
      OR ISNULL(MASTER_DATA.M3,0) &lt;&gt; 0
      OR ISNULL(MASTER_DATA.M4, 0) &lt;&gt; 0
      OR ISNULL(MASTER_DATA.M5, 0) &lt;&gt; 0
      OR ISNULL(MASTER_DATA.M6, 0) &lt;&gt; 0
      OR ISNULL(MASTER_DATA.M7, 0) &lt;&gt; 0
      OR ISNULL(MASTER_DATA.M8, 0) &lt;&gt; 0
      OR ISNULL(MASTER_DATA.M9, 0) &lt;&gt; 0
      OR ISNULL(MASTER_DATA.M10, 0) &lt;&gt; 0
      OR ISNULL(MASTER_DATA.M11, 0) &lt;&gt; 0
      OR ISNULL(MASTER_DATA.M12, 0) &lt;&gt; 0
      )
      GROUP BY MAX_REV.BUDGET_YEAR, MAX_REV.PERIOD_TYPE, MAX_REV.PROJECT_NO, MAX_REV.ACCOUNT_NO, MAX_REV.ACCOUNT_NAME, MAX_REV.BUDGET_TYPE, MAX_REV.EXPENSE_TYPE,BD.MTP_SUM2
      UNION
      SELECT BUDGET_YEAR, PERIOD_TYPE, PROJECT_NO, '' AS ACCOUNT_NO, '' AS ACCOUNT_NAME, 'A' AS BUDGET_TYPE, 0 AS EXPENSE_TYPE,
      0 AS ACTUAL_1ST_HALF,
      0 AS REVISE_2ND_HALF,
      0 AS M1,
      0 AS M2,
      0 AS M3,
      0 AS M4,
      0 AS M5,
      0 AS M6,
      0 AS M7,
      0 AS M8,
      0 AS M9,
      0 AS M10,
      0 AS M11,
      0 AS M12,
      0 AS INVESTMENT_ACTUAL_1ST_HALF,
      0 AS INVESTMENT_REVISE_2ND_HALF,
      0 AS INVESTMENT_M1,
      0 AS INVESTMENT_M2,
      0 AS INVESTMENT_M3,
      0 AS INVESTMENT_M4,
      0 AS INVESTMENT_M5,
      0 AS INVESTMENT_M6,
      0 AS INVESTMENT_2ND_HALF,
      0 AS ADMIN_ACTUAL_1ST_HALF,
      0 AS FC_ACTUAL_1ST_HALF,
      0 AS ADMIN_REVISE_2ND_HALF,
      0 AS FC_REVISE_2ND_HALF,
      0 AS ADMIN_M1,
      0 AS FC_M1,
      0 AS ADMIN_M2,
      0 AS FC_M2,
      0 AS ADMIN_M3,
      0 AS FC_M3,
      0 AS ADMIN_M4,
      0 AS FC_M4,
      0 AS ADMIN_M5,
      0 AS FC_M5,
      0 AS ADMIN_M6,
      0 AS FC_M6,
      0 AS ADMIN_M7,
      0 AS FC_M7,
      0 AS ADMIN_M8,
      0 AS FC_M8,
      0 AS ADMIN_M9,
      0 AS FC_M9,
      0 AS ADMIN_M10,
      0 AS FC_M10,
      0 AS ADMIN_M11,
      0 AS FC_M11,
      0 AS ADMIN_M12,
      0 AS FC_M12,
      0 AS ADMIN_1ST_HALF,
      0 AS FC_1ST_HALF,
      0 AS ADMIN_2ND_HALF,
      0 AS FC_2ND_HALF,
      0 AS ADMIN_TOTAL_YEAR,
      0 AS FC_TOTAL_YEAR,
      0 AS WB_ACTUAL_1ST_HALF,
      0 AS WB_REVISE_2ND_HALF,
      0 AS WB_M1,
      0 AS WB_M2,
      0 AS WB_M3,
      0 AS WB_M4,
      0 AS WB_M5,
      0 AS WB_M6,
      0 AS WB_M7,
      0 AS WB_M8,
      0 AS WB_M9,
      0 AS WB_M10,
      0 AS WB_M11,
      0 AS WB_M12,
      0 AS MTPWB,
      0 AS WB_MTP_RRT1,
      0 AS WB_TOTAL_1ST_HALF,
      0 AS WB_TOTAL_2ND_HALF
      ,MTP_SUM1 AS MTP_RRT1
      ,0 AS MTP_RRT1_ADMIN
      ,0 AS MTP_RRT1_FC


      ,0 AS INVESTMENT_M7
      ,0 AS INVESTMENT_M8
      ,0 AS INVESTMENT_M9
      ,0 AS INVESTMENT_M10
      ,0 AS INVESTMENT_M11
      ,0 AS INVESTMENT_M12


      FROM BG_T_BUDGET_ADJUST2
      WHERE BUDGET_YEAR = (@BudgetYear-1)
      AND PERIOD_TYPE = 10
      AND REV_NO = '@MtpRevNo'
      AND PROJECT_NO = @MtpProjectNo

      UNION
      SELECT BUDGET_YEAR, PERIOD_TYPE, PROJECT_NO, '' AS ACCOUNT_NO, '' AS ACCOUNT_NAME, '' AS BUDGET_TYPE, 0 AS EXPENSE_TYPE,
      0 AS ACTUAL_1ST_HALF,
      0 AS REVISE_2ND_HALF,
      0 AS M1,
      0 AS M2,
      0 AS M3,
      0 AS M4,
      0 AS M5,
      0 AS M6,
      0 AS M7,
      0 AS M8,
      0 AS M9,
      0 AS M10,
      0 AS M11,
      0 AS M12,
      0 AS INVESTMENT_ACTUAL_1ST_HALF,
      0 AS INVESTMENT_REVISE_2ND_HALF,
      0 AS INVESTMENT_M1,
      0 AS INVESTMENT_M2,
      0 AS INVESTMENT_M3,
      0 AS INVESTMENT_M4,
      0 AS INVESTMENT_M5,
      0 AS INVESTMENT_M6,
      0 AS INVESTMENT_2ND_HALF,
      0 AS ADMIN_ACTUAL_1ST_HALF,
      0 AS FC_ACTUAL_1ST_HALF,
      0 AS ADMIN_REVISE_2ND_HALF,
      0 AS FC_REVISE_2ND_HALF,
      0 AS ADMIN_M1,
      0 AS FC_M1,
      0 AS ADMIN_M2,
      0 AS FC_M2,
      0 AS ADMIN_M3,
      0 AS FC_M3,
      0 AS ADMIN_M4,
      0 AS FC_M4,
      0 AS ADMIN_M5,
      0 AS FC_M5,
      0 AS ADMIN_M6,
      0 AS FC_M6,
      0 AS ADMIN_M7,
      0 AS FC_M7,
      0 AS ADMIN_M8,
      0 AS FC_M8,
      0 AS ADMIN_M9,
      0 AS FC_M9,
      0 AS ADMIN_M10,
      0 AS FC_M10,
      0 AS ADMIN_M11,
      0 AS FC_M11,
      0 AS ADMIN_M12,
      0 AS FC_M12,
      0 AS ADMIN_1ST_HALF,
      0 AS FC_1ST_HALF,
      0 AS ADMIN_2ND_HALF,
      0 AS FC_2ND_HALF,
      0 AS ADMIN_TOTAL_YEAR,
      0 AS FC_TOTAL_YEAR,
      0 AS WB_ACTUAL_1ST_HALF,
      0 AS WB_REVISE_2ND_HALF,
      0 AS WB_M1,
      0 AS WB_M2,
      0 AS WB_M3,
      0 AS WB_M4,
      0 AS WB_M5,
      0 AS WB_M6,
      0 AS WB_M7,
      0 AS WB_M8,
      0 AS WB_M9,
      0 AS WB_M10,
      0 AS WB_M11,
      0 AS WB_M12,
      0 AS MTPWB,
      0 AS WB_MTP_RRT1,
      0 AS WB_TOTAL_1ST_HALF,
      0 AS WB_TOTAL_2ND_HALF
      ,0 MTP_RRT1
      ,0 AS MTP_RRT1_ADMIN
      ,0 AS MTP_RRT1_FC


      ,0 AS INVESTMENT_M7
      ,0 AS INVESTMENT_M8
      ,0 AS INVESTMENT_M9
      ,0 AS INVESTMENT_M10
      ,0 AS INVESTMENT_M11
      ,0 AS INVESTMENT_M12


      FROM BG_T_BUDGET_ADJUST
      WHERE BUDGET_YEAR = @BudgetYear
      AND PERIOD_TYPE = @PeriodType
      AND PROJECT_NO = @ProjectNo
      AND REV_NO = (SELECT MAX(REV_NO) AS REV_NO FROM BG_T_BUDGET_DATA WHERE BUDGET_YEAR = @BudgetYear AND PERIOD_TYPE = @PeriodType AND PROJECT_NO = @ProjectNo)

    </SELECT015_1>
    <SELECT015_2>
      SELECT MAX_REV.BUDGET_YEAR, MAX_REV.PERIOD_TYPE, MAX_REV.PROJECT_NO, MAX_REV.ACCOUNT_NO, MAX_REV.ACCOUNT_NAME, MAX_REV.BUDGET_TYPE, MAX_REV.EXPENSE_TYPE,
      SUM(ISNULL(ACTUAL_DATA.M7, 0)) AS M7, SUM(ISNULL(ACTUAL_DATA.M8, 0)) AS M8, SUM(ISNULL(ACTUAL_DATA.M9, 0)) AS M9,
      SUM(ISNULL(MASTER_DATA.M10, 0)) AS M10, SUM(ISNULL(MASTER_DATA.M11, 0)) AS M11, SUM(ISNULL(MASTER_DATA.M12, 0)) AS M12,
      SUM(ISNULL(ACTUAL_DATA.H1,0)) AS ACTUAL_1ST_HALF,
      SUM(ISNULL(REVISE_BUDGET.M7, 0) + ISNULL(REVISE_BUDGET.M8, 0) + ISNULL(REVISE_BUDGET.M9, 0) + ISNULL(REVISE_BUDGET.M10, 0) + ISNULL(REVISE_BUDGET.M11, 0) + ISNULL(REVISE_BUDGET.M12, 0)) AS REVISE_2ND_HALF,
      SUM(ISNULL(ACTUAL_DATA.M7, 0) + ISNULL(ACTUAL_DATA.M8, 0) + ISNULL(ACTUAL_DATA.M9, 0) + ISNULL(MASTER_DATA.M10, 0) + ISNULL(MASTER_DATA.M11,0) + ISNULL(MASTER_DATA.M12, 0)) AS ESTIMATE_2ND_HALF,
      SUM((ISNULL(ACTUAL_DATA.M7, 0) + ISNULL(ACTUAL_DATA.M8, 0) + ISNULL(ACTUAL_DATA.M9, 0) + ISNULL(MASTER_DATA.M10, 0) + ISNULL(MASTER_DATA.M11,0) + ISNULL(MASTER_DATA.M12, 0)) - (ISNULL(REVISE_BUDGET.M7, 0) + ISNULL(REVISE_BUDGET.M8, 0) + ISNULL(REVISE_BUDGET.M9, 0) + ISNULL(REVISE_BUDGET.M10, 0) + ISNULL(REVISE_BUDGET.M11, 0) + ISNULL(REVISE_BUDGET.M12, 0))) AS DIFFERENCE_2ND_HALF,
      SUM(ISNULL(ACTUAL_DATA.H1,0) + ISNULL(ACTUAL_DATA.M7, 0) + ISNULL(ACTUAL_DATA.M8, 0) + ISNULL(ACTUAL_DATA.M9, 0) + ISNULL(MASTER_DATA.M10, 0) + ISNULL(MASTER_DATA.M11,0) + ISNULL(MASTER_DATA.M12, 0)) AS ESTIMATE_TOTAL_YEAR,
      0 AS INVESTMENT_ACTUAL_1ST_HALF,
      0 AS INVESTMENT_REVISE_2ND_HALF,
      0 AS INVESTMENT_ACTUAL_JUL,
      0 AS INVESTMENT_ACTUAL_AUG,
      0 AS INVESTMENT_ACTUAL_SEP,
      0 AS INVESTMENT_ESTIMATE_OCT,
      0 AS INVESTMENT_ESTIMATE_NOV,
      0 AS INVESTMENT_ESTIMATE_DEC,
      SUM(CASE WHEN MAX_REV.COST = @Admin  THEN ISNULL(ACTUAL_DATA.M7, 0) ELSE 0 END) AS ADMIN_M7,
      SUM(CASE WHEN MAX_REV.COST = @FC  THEN ISNULL(ACTUAL_DATA.M7, 0) ELSE 0 END) AS FC_M7,
      SUM(CASE WHEN MAX_REV.COST = @Admin  THEN ISNULL(ACTUAL_DATA.M8, 0) ELSE 0 END) AS ADMIN_M8,
      SUM(CASE WHEN MAX_REV.COST = @FC  THEN ISNULL(ACTUAL_DATA.M8, 0) ELSE 0 END) AS FC_M8,
      SUM(CASE WHEN MAX_REV.COST = @Admin  THEN ISNULL(ACTUAL_DATA.M9, 0) ELSE 0 END) AS ADMIN_M9,
      SUM(CASE WHEN MAX_REV.COST = @FC  THEN ISNULL(ACTUAL_DATA.M9, 0) ELSE 0 END) AS FC_M9,
      SUM(CASE WHEN MAX_REV.COST = @Admin  THEN ISNULL(MASTER_DATA.M10, 0) ELSE 0 END) AS ADMIN_M10,
      SUM(CASE WHEN MAX_REV.COST = @FC  THEN ISNULL(MASTER_DATA.M10, 0) ELSE 0 END) AS FC_M10,
      SUM(CASE WHEN MAX_REV.COST = @Admin  THEN ISNULL(MASTER_DATA.M11, 0) ELSE 0 END) AS ADMIN_M11,
      SUM(CASE WHEN MAX_REV.COST = @FC  THEN ISNULL(MASTER_DATA.M11, 0) ELSE 0 END) AS FC_M11,
      SUM(CASE WHEN MAX_REV.COST = @Admin  THEN ISNULL(MASTER_DATA.M12, 0) ELSE 0 END) AS ADMIN_M12,
      SUM(CASE WHEN MAX_REV.COST = @FC  THEN ISNULL(MASTER_DATA.M12, 0) ELSE 0 END) AS FC_M12,
      SUM(CASE WHEN MAX_REV.COST = @Admin  THEN ISNULL(ACTUAL_DATA.H1,0) ELSE 0 END) AS ACTUAL_ADMIN_1ST_HALF,
      SUM(CASE WHEN MAX_REV.COST = @FC  THEN ISNULL(ACTUAL_DATA.H1,0) ELSE 0 END) AS ACTUAL_FC_1ST_HALF,
      SUM(CASE WHEN MAX_REV.COST = @Admin  THEN (ISNULL(REVISE_BUDGET.M7, 0) + ISNULL(REVISE_BUDGET.M8, 0) + ISNULL(REVISE_BUDGET.M9, 0) + ISNULL(REVISE_BUDGET.M10, 0) + ISNULL(REVISE_BUDGET.M11, 0) + ISNULL(REVISE_BUDGET.M12, 0)) ELSE 0 END) AS REVISE_ADMIN_2ND_HALF,
      SUM(CASE WHEN MAX_REV.COST = @FC  THEN (ISNULL(REVISE_BUDGET.M7, 0) + ISNULL(REVISE_BUDGET.M8, 0) + ISNULL(REVISE_BUDGET.M9, 0) + ISNULL(REVISE_BUDGET.M10, 0) + ISNULL(REVISE_BUDGET.M11, 0) + ISNULL(REVISE_BUDGET.M12, 0)) ELSE 0 END) AS REVISE_FC_2ND_HALF,
      SUM(CASE WHEN MAX_REV.COST = @Admin  THEN (ISNULL(ACTUAL_DATA.M7, 0) + ISNULL(ACTUAL_DATA.M8, 0) + ISNULL(ACTUAL_DATA.M9, 0) + ISNULL(MASTER_DATA.M10, 0) + ISNULL(MASTER_DATA.M11,0) + ISNULL(MASTER_DATA.M12, 0)) ELSE 0 END) AS ESTIMATE_ADMIN_2ND_HALF,
      SUM(CASE WHEN MAX_REV.COST = @FC  THEN (ISNULL(ACTUAL_DATA.M7, 0) + ISNULL(ACTUAL_DATA.M8, 0) + ISNULL(ACTUAL_DATA.M9, 0) + ISNULL(MASTER_DATA.M10, 0) + ISNULL(MASTER_DATA.M11,0) + ISNULL(MASTER_DATA.M12, 0)) ELSE 0 END) AS ESTIMATE_FC_2ND_HALF,
      SUM(CASE WHEN MAX_REV.COST = @Admin  THEN (ISNULL(ACTUAL_DATA.M7, 0) + ISNULL(ACTUAL_DATA.M8, 0) + ISNULL(ACTUAL_DATA.M9, 0) + ISNULL(MASTER_DATA.M10, 0) + ISNULL(MASTER_DATA.M11,0) + ISNULL(MASTER_DATA.M12, 0) - (ISNULL(REVISE_BUDGET.M7, 0) + ISNULL(REVISE_BUDGET.M8, 0) + ISNULL(REVISE_BUDGET.M9, 0) + ISNULL(REVISE_BUDGET.M10, 0) + ISNULL(REVISE_BUDGET.M11, 0) + ISNULL(REVISE_BUDGET.M12, 0))) ELSE 0 END) AS DIFFERENCE_ADMIN_2ND_HALF,
      SUM(CASE WHEN MAX_REV.COST = @FC  THEN (ISNULL(ACTUAL_DATA.M7, 0) + ISNULL(ACTUAL_DATA.M8, 0) + ISNULL(ACTUAL_DATA.M9, 0) + ISNULL(MASTER_DATA.M10, 0) + ISNULL(MASTER_DATA.M11,0) + ISNULL(MASTER_DATA.M12, 0) - (ISNULL(REVISE_BUDGET.M7, 0) + ISNULL(REVISE_BUDGET.M8, 0) + ISNULL(REVISE_BUDGET.M9, 0) + ISNULL(REVISE_BUDGET.M10, 0) + ISNULL(REVISE_BUDGET.M11, 0) + ISNULL(REVISE_BUDGET.M12, 0))) ELSE 0 END) AS DIFFERENCE_FC_2ND_HALF,
      SUM(CASE WHEN MAX_REV.COST = @Admin  THEN ISNULL(ACTUAL_DATA.H1,0) + (ISNULL(ACTUAL_DATA.M7, 0) + ISNULL(ACTUAL_DATA.M8, 0) + ISNULL(ACTUAL_DATA.M9, 0) + ISNULL(MASTER_DATA.M10, 0) + ISNULL(MASTER_DATA.M11,0) + ISNULL(MASTER_DATA.M12, 0)) ELSE 0 END) AS ESTIMATE_ADMIN_TOTAL_YEAR,
      SUM(CASE WHEN MAX_REV.COST = @FC  THEN ISNULL(ACTUAL_DATA.H1,0) + (ISNULL(ACTUAL_DATA.M7, 0) + ISNULL(ACTUAL_DATA.M8, 0) + ISNULL(ACTUAL_DATA.M9, 0) + ISNULL(MASTER_DATA.M10, 0) + ISNULL(MASTER_DATA.M11,0) + ISNULL(MASTER_DATA.M12, 0)) ELSE 0 END) AS ESTIMATE_FC_TOTAL_YEAR,
      --(SELECT ISNULL(WKH1,0) FROM BG_T_BUDGET_ADJUST WHERE BUDGET_YEAR=@BudgetYear AND PERIOD_TYPE=@PeriodType AND PROJECT_NO=@ProjectNo AND REV_NO= (SELECT MAX(REV_NO) AS REV_NO FROM BG_T_BUDGET_DATA WHERE BUDGET_YEAR = @BudgetYear AND PERIOD_TYPE = @PeriodType AND PROJECT_NO=@ProjectNo)) AS WB_ACTUAL_1ST_HALF,
      --(SELECT ISNULL(WKH2,0) FROM BG_T_BUDGET_ADJUST WHERE BUDGET_YEAR=@BudgetYear AND PERIOD_TYPE=@PeriodType AND PROJECT_NO=@ProjectNo AND REV_NO= (SELECT MAX(REV_NO) AS REV_NO FROM BG_T_BUDGET_DATA WHERE BUDGET_YEAR = @BudgetYear AND PERIOD_TYPE = @PeriodType AND PROJECT_NO=@ProjectNo)) AS WB_REVISE_2ND_HALF,
      (SELECT ISNULL(WKH1,0) FROM BG_T_BUDGET_ADJUST WHERE BUDGET_YEAR=@BudgetYear AND PERIOD_TYPE=@PeriodType AND PROJECT_NO=@ProjectNo AND REV_NO= @RevNo) AS WB_ACTUAL_1ST_HALF,
      (SELECT ISNULL(WKH2,0) FROM BG_T_BUDGET_ADJUST WHERE BUDGET_YEAR=@BudgetYear AND PERIOD_TYPE=@PeriodType AND PROJECT_NO=@ProjectNo AND REV_NO= @RevNo) AS WB_REVISE_2ND_HALF,
      0 AS WB_ACTUAL_M7,
      0 AS WB_ACTUAL_M8,
      0 AS WB_ACTUAL_M9,
      SUM(ISNULL(ROUND(MIN_REV.M10,2),0) - ISNULL(ROUND(MASTER_DATA.M10,2),0)) AS WB_ESTIMATE_M10,
      SUM(ISNULL(ROUND(MIN_REV.M11,2),0) - ISNULL(ROUND(MASTER_DATA.M11,2),0)) AS WB_ESTIMATE_M11,
      SUM(ISNULL(ROUND(MIN_REV.M12,2),0) - ISNULL(ROUND(MASTER_DATA.M12,2),0)) AS WB_ESTIMATE_M12,
      0 AS WB_ESTIMATE_2ND_HALF,
      0 AS WB_DIFFERENCE_2ND_HALF,
      0 AS WB_ESTIMATE_TOTAL_YEAR
      FROM (
      SELECT BUDGET_DATA.BUDGET_ORDER_NO, BUDGET_DATA.BUDGET_YEAR, BUDGET_DATA.PERIOD_TYPE,BUDGET_DATA.PROJECT_NO,
      BUDGET_ORDER.ACCOUNT_NO, ACCOUNT.ACCOUNT_NAME,
      BUDGET_ORDER.BUDGET_TYPE, BUDGET_ORDER.EXPENSE_TYPE, BUDGET_ORDER.COST,
      MAX(BUDGET_DATA.REV_NO) AS REV_NO
      FROM BG_T_BUDGET_DATA AS BUDGET_DATA
      INNER JOIN BG_M_BUDGET_ORDER AS BUDGET_ORDER
      ON BUDGET_ORDER.BUDGET_ORDER_NO = BUDGET_DATA.BUDGET_ORDER_NO
      INNER JOIN BG_M_ACCOUNT AS ACCOUNT
      ON ACCOUNT.ACCOUNT_NO = BUDGET_ORDER.ACCOUNT_NO
      AND BUDGET_ORDER.ACTIVE_FLAG = 1
      WHERE BUDGET_DATA.BUDGET_YEAR = @BudgetYear
      AND BUDGET_DATA.PERIOD_TYPE = @PeriodType
      AND BUDGET_DATA.PROJECT_NO = @ProjectNo
      AND BUDGET_ORDER.BUDGET_TYPE= 'E'
      GROUP BY BUDGET_DATA.BUDGET_ORDER_NO, BUDGET_DATA.BUDGET_YEAR, BUDGET_DATA.PERIOD_TYPE,BUDGET_DATA.PROJECT_NO,
      BUDGET_ORDER.ACCOUNT_NO, ACCOUNT.ACCOUNT_NAME,
      BUDGET_ORDER.BUDGET_TYPE, BUDGET_ORDER.EXPENSE_TYPE, BUDGET_ORDER.COST) AS MAX_REV
      INNER JOIN BG_T_BUDGET_DATA AS MASTER_DATA
      ON MAX_REV.BUDGET_YEAR = MASTER_DATA.BUDGET_YEAR
      AND MASTER_DATA.PERIOD_TYPE = 2
      AND MASTER_DATA.PROJECT_NO = @ProjectNo
      AND MAX_REV.BUDGET_ORDER_NO = MASTER_DATA.BUDGET_ORDER_NO
      AND MAX_REV.REV_NO = MASTER_DATA.REV_NO

      ---- change Revise to OB 02/05/2018
      --LEFT OUTER JOIN BG_T_UPLOAD_DATA AS REVISE_BUDGET
      --ON MAX_REV.BUDGET_YEAR = REVISE_BUDGET.BUDGET_YEAR
      ----AND REVISE_BUDGET.PERIOD_TYPE = 2
      --AND REVISE_BUDGET.PERIOD_TYPE = 1
      --AND REVISE_BUDGET.PROJECT_NO = 1
      --AND MAX_REV.BUDGET_ORDER_NO = REVISE_BUDGET.BUDGET_ORDER_NO
      --AND REVISE_BUDGET.DATA_TYPE = 1

      LEFT JOIN BG_T_BUDGET_DATA AS REVISE_BUDGET
      ON  REVISE_BUDGET.BUDGET_YEAR =  MAX_REV.BUDGET_YEAR
      AND REVISE_BUDGET.PERIOD_TYPE = 1
      AND REVISE_BUDGET.PROJECT_NO = MAX_REV.PROJECT_NO
      AND REVISE_BUDGET.BUDGET_ORDER_NO = MAX_REV.BUDGET_ORDER_NO
      AND REVISE_BUDGET.REV_NO = MAX_REV.REV_NO


      LEFT OUTER JOIN BG_T_UPLOAD_DATA AS ACTUAL_DATA
      ON ACTUAL_DATA.BUDGET_YEAR = MAX_REV.BUDGET_YEAR
      AND ACTUAL_DATA.PERIOD_TYPE = @PeriodType
      AND ACTUAL_DATA.PROJECT_NO = @ProjectNo
      AND ACTUAL_DATA.BUDGET_ORDER_NO = MAX_REV.BUDGET_ORDER_NO
      AND ACTUAL_DATA.DATA_TYPE = 2
      INNER JOIN BG_T_BUDGET_DATA AS MIN_REV
      ON MIN_REV.BUDGET_YEAR = MASTER_DATA.BUDGET_YEAR
      AND MIN_REV.PERIOD_TYPE = MASTER_DATA.PERIOD_TYPE
      AND MIN_REV.PROJECT_NO = MASTER_DATA.PROJECT_NO
      AND MIN_REV.BUDGET_ORDER_NO = MASTER_DATA.BUDGET_ORDER_NO
      AND MIN_REV.REV_NO = 1
      LEFT OUTER JOIN BG_T_BUDGET_ADJUST AS BUDGET_ADJUST
      ON MAX_REV.BUDGET_YEAR = BUDGET_ADJUST.BUDGET_YEAR
      AND MAX_REV.PERIOD_TYPE = BUDGET_ADJUST.PERIOD_TYPE
      AND MAX_REV.PROJECT_NO = BUDGET_ADJUST.PROJECT_NO
      AND MAX_REV.REV_NO = BUDGET_ADJUST.REV_NO
      WHERE
      (
      ISNULL(ACTUAL_DATA.H1,0) &lt;&gt; 0
      OR ISNULL(REVISE_BUDGET.M7,0) &lt;&gt; 0
      OR ISNULL(REVISE_BUDGET.M8,0) &lt;&gt; 0
      OR ISNULL(REVISE_BUDGET.M9,0) &lt;&gt; 0
      OR ISNULL(REVISE_BUDGET.M10,0) &lt;&gt; 0
      OR ISNULL(REVISE_BUDGET.M11,0) &lt;&gt; 0
      OR ISNULL(REVISE_BUDGET.M12,0) &lt;&gt; 0
      OR ISNULL(ACTUAL_DATA.M7, 0) &lt;&gt; 0
      OR ISNULL(ACTUAL_DATA.M8, 0) &lt;&gt; 0
      OR ISNULL(ACTUAL_DATA.M9, 0) &lt;&gt; 0
      OR ISNULL(MASTER_DATA.M10, 0) &lt;&gt; 0
      OR ISNULL(MASTER_DATA.M11, 0) &lt;&gt; 0
      OR ISNULL(MASTER_DATA.M12, 0) &lt;&gt; 0
      OR ISNULL(MIN_REV.M10, 0) &lt;&gt; 0
      OR ISNULL(MIN_REV.M11, 0) &lt;&gt; 0
      OR ISNULL(MIN_REV.M12, 0) &lt;&gt; 0
      )
      GROUP BY  MAX_REV.BUDGET_YEAR, MAX_REV.PERIOD_TYPE, MAX_REV.PROJECT_NO ,MAX_REV.ACCOUNT_NO, MAX_REV.ACCOUNT_NAME,MAX_REV.BUDGET_TYPE, MAX_REV.EXPENSE_TYPE
      UNION
      SELECT MAX_REV.BUDGET_YEAR, MAX_REV.PERIOD_TYPE, MAX_REV.PROJECT_NO , MAX_REV.ACCOUNT_NO, MAX_REV.ACCOUNT_NAME, MAX_REV.BUDGET_TYPE, MAX_REV.EXPENSE_TYPE,
      0 AS M7, 0 AS M8, 0 AS M9,
      0 AS M10, 0 AS M11, 0 AS M12,
      0 AS ACTUAL_1ST_HALF,
      0 AS REVISE_2ND_HALF,
      0 AS ESTIMATE_2ND_HALF,
      0 AS DIFFERENCE_2ND_HALF,
      0 AS ESTIMATE_TOTAL_YEAR,
      SUM(ISNULL(ACTUAL_DATA.H1,0)) AS INVESTMENT_ACTUAL_1ST_HALF,
      SUM(ISNULL(REVISE_BUDGET.M7, 0) + ISNULL(REVISE_BUDGET.M8, 0) + ISNULL(REVISE_BUDGET.M9, 0) + ISNULL(REVISE_BUDGET.M10, 0) + ISNULL(REVISE_BUDGET.M11, 0) + ISNULL(REVISE_BUDGET.M12, 0)) AS INVESTMENT_REVISE_2ND_HALF,
      SUM(ISNULL(ACTUAL_DATA.M7, 0)) AS INVESTMENT_ACTUAL_JUL,
      SUM(ISNULL(ACTUAL_DATA.M8, 0)) AS INVESTMENT_ACTUAL_AUG,
      SUM(ISNULL(ACTUAL_DATA.M9, 0) ) AS INVESTMENT_ACTUAL_SEP,
      SUM(ISNULL(MASTER_DATA.M10, 0)) AS INVESTMENT_ESTIMATE_OCT,
      SUM(ISNULL(MASTER_DATA.M11, 0)) AS INVESTMENT_ESTIMATE_NOV,
      SUM(ISNULL(MASTER_DATA.M12, 0)) AS INVESTMENT_ESTIMATE_DEC,
      0 AS ADMIN_M7,
      0 AS FC_M7,
      0 AS ADMIN_M8,
      0 AS FC_M8,
      0 AS ADMIN_M9,
      0 AS FC_M9,
      0 AS ADMIN_M10,
      0 AS FC_M10,
      0 AS ADMIN_M11,
      0 AS FC_M11,
      0 AS ADMIN_M12,
      0 AS FC_M12,
      0 AS ACTUAL_ADMIN_1ST_HALF,
      0 AS ACTUAL_FC_1ST_HALF,
      0 AS REVISE_ADMIN_2ND_HALF,
      0 AS REVISE_FC_2ND_HALF,
      0 AS ESTIMATE_ADMIN_2ND_HALF,
      0 AS ESTIMATE_FC_2ND_HALF,
      0 AS DIFFERENCE_ADMIN_2ND_HALF,
      0 AS DIFFERENCE_FC_2ND_HALF,
      0 AS ESTIMATE_ADMIN_TOTAL_YEAR,
      0 AS ESTIMATE_FC_TOTAL_YEAR,
      0 AS WB_ACTUAL_1ST_HALF,
      0 AS WB_REVISE_2ND_HALF,
      0 AS WB_ACTUAL_M7,
      0 AS WB_ACTUAL_M8,
      0 AS WB_ACTUAL_M9,
      0 AS WB_ESTIMATE_M10,
      0 AS WB_ESTIMATE_M11,
      0 AS WB_ESTIMATE_M12,
      0 AS WB_ESTIMATE_2ND_HALF,
      0 AS WB_DIFFERENCE_2ND_HALF,
      0 AS WB_ESTIMATE_TOTAL_YEAR
      FROM (
      /*SELECT BUDGET_DATA.BUDGET_ORDER_NO, BUDGET_DATA.BUDGET_YEAR, BUDGET_DATA.PERIOD_TYPE, BUDGET_DATA.PROJECT_NO,
      BUDGET_ORDER.ACCOUNT_NO, ACCOUNT.ACCOUNT_NAME,
      BUDGET_ORDER.BUDGET_TYPE, BUDGET_ORDER.EXPENSE_TYPE, BUDGET_ORDER.COST,
      MAX(BUDGET_DATA.REV_NO) AS REV_NO
      FROM BG_T_BUDGET_DATA AS BUDGET_DATA
      INNER JOIN BG_M_BUDGET_ORDER AS BUDGET_ORDER
      ON BUDGET_ORDER.BUDGET_ORDER_NO = BUDGET_DATA.BUDGET_ORDER_NO
      INNER JOIN BG_M_ACCOUNT AS ACCOUNT
      ON ACCOUNT.ACCOUNT_NO = BUDGET_ORDER.ACCOUNT_NO
      AND BUDGET_ORDER.ACTIVE_FLAG = 1
      WHERE BUDGET_DATA.BUDGET_YEAR = @BudgetYear
      AND BUDGET_DATA.PERIOD_TYPE = @PeriodType
      AND BUDGET_DATA.PROJECT_NO = @ProjectNo
      AND BUDGET_ORDER.BUDGET_TYPE= 'A'
      GROUP BY BUDGET_DATA.BUDGET_ORDER_NO, BUDGET_DATA.BUDGET_YEAR, BUDGET_DATA.PERIOD_TYPE, BUDGET_DATA.PROJECT_NO,
      BUDGET_ORDER.ACCOUNT_NO, ACCOUNT.ACCOUNT_NAME,
      BUDGET_ORDER.BUDGET_TYPE, BUDGET_ORDER.EXPENSE_TYPE, BUDGET_ORDER.COST) AS MAX_REV*/

      SELECT BUDGET_DATA.BUDGET_ORDER_NO, BUDGET_DATA.BUDGET_YEAR, BUDGET_DATA.PERIOD_TYPE, BUDGET_DATA.PROJECT_NO,
      BUDGET_ORDER.ACCOUNT_NO, ACCOUNT.ACCOUNT_NAME,
      BUDGET_ORDER.BUDGET_TYPE, BUDGET_ORDER.EXPENSE_TYPE, BUDGET_ORDER.COST,
      MAX(BUDGET_DATA.REV_NO) AS REV_NO
      FROM BG_T_BUDGET_DATA AS BUDGET_DATA
      INNER JOIN BG_M_BUDGET_ORDER AS BUDGET_ORDER
      ON BUDGET_ORDER.BUDGET_ORDER_NO = BUDGET_DATA.BUDGET_ORDER_NO
      INNER JOIN BG_M_ACCOUNT AS ACCOUNT
      ON ACCOUNT.ACCOUNT_NO = BUDGET_ORDER.ACCOUNT_NO
      AND BUDGET_ORDER.ACTIVE_FLAG = 1
      WHERE BUDGET_DATA.BUDGET_YEAR = @BudgetYear
      AND BUDGET_DATA.PERIOD_TYPE = @PeriodType
      AND BUDGET_DATA.PROJECT_NO = @ProjectNo
      AND BUDGET_DATA.REV_NO = (SELECT MAX(REV_NO) AS REV_NO
      FROM BG_T_BUDGET_HEADER
      WHERE BUDGET_YEAR = @BudgetYear
      AND PERIOD_TYPE = @PeriodType
      AND PROJECT_NO = @ProjectNo
      AND BUDGET_TYPE= 'A')
      AND BUDGET_ORDER.BUDGET_TYPE= 'A'
      GROUP BY BUDGET_DATA.BUDGET_ORDER_NO, BUDGET_DATA.BUDGET_YEAR, BUDGET_DATA.PERIOD_TYPE, BUDGET_DATA.PROJECT_NO,
      BUDGET_ORDER.ACCOUNT_NO, ACCOUNT.ACCOUNT_NAME,
      BUDGET_ORDER.BUDGET_TYPE, BUDGET_ORDER.EXPENSE_TYPE, BUDGET_ORDER.COST) AS MAX_REV

      INNER JOIN BG_T_BUDGET_DATA AS MASTER_DATA
      ON MAX_REV.BUDGET_YEAR = MASTER_DATA.BUDGET_YEAR
      AND MASTER_DATA.PERIOD_TYPE = 2
      AND MASTER_DATA.PROJECT_NO = @ProjectNo
      AND MAX_REV.BUDGET_ORDER_NO = MASTER_DATA.BUDGET_ORDER_NO
      AND MAX_REV.REV_NO = MASTER_DATA.REV_NO

      ---- change Revise to OB 02/05/2018
      --LEFT OUTER JOIN BG_T_UPLOAD_DATA AS REVISE_BUDGET
      --ON MAX_REV.BUDGET_YEAR = REVISE_BUDGET.BUDGET_YEAR
      ----AND REVISE_BUDGET.PERIOD_TYPE = 2
      --AND REVISE_BUDGET.PERIOD_TYPE = 1
      --AND REVISE_BUDGET.PROJECT_NO = 1
      --AND MAX_REV.BUDGET_ORDER_NO = REVISE_BUDGET.BUDGET_ORDER_NO
      --AND REVISE_BUDGET.DATA_TYPE = 1

      LEFT JOIN BG_T_BUDGET_DATA AS REVISE_BUDGET
      ON  REVISE_BUDGET.BUDGET_YEAR =  MAX_REV.BUDGET_YEAR
      AND REVISE_BUDGET.PERIOD_TYPE = 1
      AND REVISE_BUDGET.PROJECT_NO = MAX_REV.PROJECT_NO
      AND REVISE_BUDGET.BUDGET_ORDER_NO = MAX_REV.BUDGET_ORDER_NO
      AND REVISE_BUDGET.REV_NO = MAX_REV.REV_NO

      LEFT OUTER JOIN BG_T_UPLOAD_DATA AS ACTUAL_DATA
      ON ACTUAL_DATA.BUDGET_YEAR = MAX_REV.BUDGET_YEAR
      AND ACTUAL_DATA.PERIOD_TYPE = @PeriodType
      AND ACTUAL_DATA.PROJECT_NO = @ProjectNo
      AND ACTUAL_DATA.BUDGET_ORDER_NO = MAX_REV.BUDGET_ORDER_NO
      AND ACTUAL_DATA.DATA_TYPE = 2
      INNER JOIN BG_T_BUDGET_DATA AS MIN_REV
      ON MIN_REV.BUDGET_YEAR = MASTER_DATA.BUDGET_YEAR
      AND MIN_REV.PERIOD_TYPE = MASTER_DATA.PERIOD_TYPE
      AND MIN_REV.PROJECT_NO = MASTER_DATA.PROJECT_NO
      AND MIN_REV.BUDGET_ORDER_NO = MASTER_DATA.BUDGET_ORDER_NO
      AND MIN_REV.REV_NO = 1
      LEFT OUTER JOIN BG_T_BUDGET_ADJUST AS BUDGET_ADJUST
      ON MAX_REV.BUDGET_YEAR = BUDGET_ADJUST.BUDGET_YEAR
      AND MAX_REV.PERIOD_TYPE = BUDGET_ADJUST.PERIOD_TYPE
      AND MAX_REV.PROJECT_NO = BUDGET_ADJUST.PROJECT_NO
      AND MAX_REV.REV_NO = BUDGET_ADJUST.REV_NO
      WHERE
      (
      ISNULL(ACTUAL_DATA.H1,0) &lt;&gt; 0
      OR ISNULL(REVISE_BUDGET.M7,0) &lt;&gt; 0
      OR ISNULL(REVISE_BUDGET.M8,0) &lt;&gt; 0
      OR ISNULL(REVISE_BUDGET.M9,0) &lt;&gt; 0
      OR ISNULL(REVISE_BUDGET.M10,0) &lt;&gt; 0
      OR ISNULL(REVISE_BUDGET.M11,0) &lt;&gt; 0
      OR ISNULL(REVISE_BUDGET.M12,0) &lt;&gt; 0
      OR ISNULL(ACTUAL_DATA.M7, 0) &lt;&gt; 0
      OR ISNULL(ACTUAL_DATA.M8, 0) &lt;&gt; 0
      OR ISNULL(ACTUAL_DATA.M9, 0) &lt;&gt; 0
      OR ISNULL(MASTER_DATA.M10, 0) &lt;&gt; 0
      OR ISNULL(MASTER_DATA.M11, 0) &lt;&gt; 0
      OR ISNULL(MASTER_DATA.M12, 0) &lt;&gt; 0
      )
      GROUP BY  MAX_REV.BUDGET_YEAR, MAX_REV.PERIOD_TYPE, MAX_REV.PROJECT_NO, MAX_REV.ACCOUNT_NO, MAX_REV.ACCOUNT_NAME,MAX_REV.BUDGET_TYPE, MAX_REV.EXPENSE_TYPE
    </SELECT015_2>
    <SELECT015_3>
      SELECT MAX_REV.BUDGET_YEAR, MAX_REV.PERIOD_TYPE, MAX_REV.PROJECT_NO, MAX_REV.ACCOUNT_NO , MAX_REV.ACCOUNT_NAME , MAX_REV.BUDGET_TYPE , MAX_REV.EXPENSE_TYPE,
      SUM(ISNULL(ORIGINAL_BUDGET.H1,0)) AS ORIGINAL_1ST_HALF,
      SUM(ISNULL(ACTUAL_DATA.M1, 0)) AS ACTUAL_M1,
      SUM(ISNULL(ACTUAL_DATA.M2, 0)) AS ACTUAL_M2,
      SUM(ISNULL(ACTUAL_DATA.M3, 0)) AS ACTUAL_M3,
      SUM(ISNULL(ESTIMATE_BUDGET.M4, 0)) AS ESTIMATE_M4,
      SUM(ISNULL(ESTIMATE_BUDGET.M5, 0)) AS ESTIMATE_M5,
      SUM(ISNULL(ESTIMATE_BUDGET.M6, 0)) AS ESTIMATE_M6,
      SUM(ISNULL(ACTUAL_DATA.M1, 0) + ISNULL(ACTUAL_DATA.M2, 0) + ISNULL(ACTUAL_DATA.M3, 0) + ISNULL(ESTIMATE_BUDGET.M4, 0) + ISNULL(ESTIMATE_BUDGET.M5, 0) + ISNULL(ESTIMATE_BUDGET.M6, 0)) AS ESTIMATE_1ST_HALF,
      SUM((ISNULL(ACTUAL_DATA.M1, 0) + ISNULL(ACTUAL_DATA.M2, 0) + ISNULL(ACTUAL_DATA.M3, 0) + ISNULL(ESTIMATE_BUDGET.M4, 0) + ISNULL(ESTIMATE_BUDGET.M5, 0) + ISNULL(ESTIMATE_BUDGET.M6, 0)) - ISNULL(ORIGINAL_BUDGET.H1,0)) AS DIFF_1ST_HALF,
      SUM(ISNULL(ORIGINAL_BUDGET.H2,0)) AS ORIGINAL_2ND_HALF,
      SUM(ISNULL(MASTER_DATA.M7, 0)) AS REVISE_M7, SUM(ISNULL(MASTER_DATA.M8, 0)) AS REVISE_M8, SUM(ISNULL(MASTER_DATA.M9, 0)) AS REVISE_M9,
      SUM(ISNULL(MASTER_DATA.M10, 0)) AS REVISE_M10, SUM(ISNULL(MASTER_DATA.M11, 0)) AS REVISE_M11, SUM(ISNULL(MASTER_DATA.M12, 0)) AS REVISE_M12,
      SUM(ISNULL(MASTER_DATA.M7, 0) + ISNULL(MASTER_DATA.M8, 0) + ISNULL(MASTER_DATA.M9, 0) + ISNULL(MASTER_DATA.M10, 0) + ISNULL(MASTER_DATA.M11, 0) + ISNULL(MASTER_DATA.M12, 0)) AS REVISE_2ND_HALF,
      SUM(ISNULL(MASTER_DATA.M7, 0) + ISNULL(MASTER_DATA.M8, 0) + ISNULL(MASTER_DATA.M9, 0) + ISNULL(MASTER_DATA.M10, 0) + ISNULL(MASTER_DATA.M11, 0) + ISNULL(MASTER_DATA.M12, 0) - ISNULL(ORIGINAL_BUDGET.H2,0)) AS DIFF_2ND_HALF,
      SUM(ISNULL(ACTUAL_DATA.M1, 0) + ISNULL(ACTUAL_DATA.M2, 0) + ISNULL(ACTUAL_DATA.M3, 0) + ISNULL(ESTIMATE_BUDGET.M4, 0) + ISNULL(ESTIMATE_BUDGET.M5, 0) + ISNULL(ESTIMATE_BUDGET.M6, 0) + ISNULL(MASTER_DATA.M7, 0) + ISNULL(MASTER_DATA.M8, 0) + ISNULL(MASTER_DATA.M9, 0) + ISNULL(MASTER_DATA.M10, 0) + ISNULL(MASTER_DATA.M11, 0) + ISNULL(MASTER_DATA.M12, 0)) AS REVISE_TOTAL_YEAR,
      SUM((ISNULL(ACTUAL_DATA.M1, 0) + ISNULL(ACTUAL_DATA.M2, 0) + ISNULL(ACTUAL_DATA.M3, 0) + ISNULL(ESTIMATE_BUDGET.M4, 0) + ISNULL(ESTIMATE_BUDGET.M5, 0) + ISNULL(ESTIMATE_BUDGET.M6, 0)) - ISNULL(ORIGINAL_BUDGET.H1,0) + ISNULL(MASTER_DATA.M7, 0) + ISNULL(MASTER_DATA.M8, 0) + ISNULL(MASTER_DATA.M9, 0) + ISNULL(MASTER_DATA.M10, 0) + ISNULL(MASTER_DATA.M11, 0) + ISNULL(MASTER_DATA.M12, 0) - ISNULL(ORIGINAL_BUDGET.H2,0) ) AS DIFF_TOTAL_YEAR,
      SUM(ISNULL(MASTER_DATA.RRT1 ,0)) AS RRT1,
      SUM(ISNULL(MASTER_DATA.RRT2 ,0)) AS RRT2,
      SUM(ISNULL(MASTER_DATA.RRT3 ,0)) AS RRT3,
      SUM(ISNULL(MASTER_DATA.RRT4 ,0)) AS RRT4,
      SUM(ISNULL(MASTER_DATA.RRT5 ,0)) AS RRT5,
      0 AS INVESTMENT_ORIGINAL_1ST_HALF,
      0 AS INVESTMENT_ACTUAL_JAN,
      0 AS INVESTMENT_ACTUAL_FEB,
      0 AS INVESTMENT_ACTUAL_MAR,
      0 AS INVESTMENT_ESTIMATE_APR,
      0 AS INVESTMENT_ESTIMATE_MAY,
      0 AS INVESTMENT_ESTIMATE_JUN,
      0 AS INVESTMENT_ORIGINAL_2ND_HALF,
      0 AS INVESTMENT_REVISE_JUL,
      0 AS INVESTMENT_REVISE_AUG,
      0 AS INVESTMENT_REVISE_SEP,
      0 AS INVESTMENT_REVISE_OCT,
      0 AS INVESTMENT_REVISE_NOV,
      0 AS INVESTMENT_REVISE_DEC,
      0 AS INVESTMENT_RRT1,
      0 AS INVESTMENT_RRT2,
      0 AS INVESTMENT_RRT3,
      0 AS INVESTMENT_RRT4,
      0 AS INVESTMENT_RRT5,
      SUM(CASE WHEN MAX_REV.COST = @Admin  THEN ISNULL(ORIGINAL_BUDGET.H1,0) ELSE 0 END) AS ADMIN_ORIGINAL_1ST_HALF,
      SUM(CASE WHEN MAX_REV.COST = @FC  THEN ISNULL(ORIGINAL_BUDGET.H1,0) ELSE 0 END) AS FC_ORIGINAL_1ST_HALF,
      SUM(CASE WHEN MAX_REV.COST = @Admin  THEN ISNULL(ACTUAL_DATA.M1, 0) ELSE 0 END) AS ADMIN_ACTUAL_M1,
      SUM(CASE WHEN MAX_REV.COST = @FC  THEN ISNULL(ACTUAL_DATA.M1, 0) ELSE 0 END) AS FC_ACTUAL_M1,
      SUM(CASE WHEN MAX_REV.COST = @Admin  THEN ISNULL(ACTUAL_DATA.M2, 0) ELSE 0 END) AS ADMIN_ACTUAL_M2,
      SUM(CASE WHEN MAX_REV.COST = @FC  THEN ISNULL(ACTUAL_DATA.M2, 0) ELSE 0 END) AS FC_ACTUAL_M2,
      SUM(CASE WHEN MAX_REV.COST = @Admin  THEN ISNULL(ACTUAL_DATA.M3, 0) ELSE 0 END) AS ADMIN_ACTUAL_M3,
      SUM(CASE WHEN MAX_REV.COST = @FC  THEN ISNULL(ACTUAL_DATA.M3, 0) ELSE 0 END) AS FC_ACTUAL_M3,
      SUM(CASE WHEN MAX_REV.COST = @Admin  THEN ISNULL(ESTIMATE_BUDGET.M4, 0) ELSE 0 END) AS ADMIN_ESTIMATE_M4,
      SUM(CASE WHEN MAX_REV.COST = @FC  THEN ISNULL(ESTIMATE_BUDGET.M4, 0) ELSE 0 END) AS FC_ESTIMATE_M4,
      SUM(CASE WHEN MAX_REV.COST = @Admin  THEN ISNULL(ESTIMATE_BUDGET.M5, 0) ELSE 0 END) AS ADMIN_ESTIMATE_M5,
      SUM(CASE WHEN MAX_REV.COST = @FC  THEN ISNULL(ESTIMATE_BUDGET.M5, 0) ELSE 0 END) AS FC_ESTIMATE_M5,
      SUM(CASE WHEN MAX_REV.COST = @Admin  THEN ISNULL(ESTIMATE_BUDGET.M6, 0) ELSE 0 END) AS ADMIN_ESTIMATE_M6,
      SUM(CASE WHEN MAX_REV.COST = @FC  THEN ISNULL(ESTIMATE_BUDGET.M6, 0) ELSE 0 END) AS FC_ESTIMATE_M6,
      SUM(CASE WHEN MAX_REV.COST = @Admin  THEN ISNULL(ACTUAL_DATA.M1, 0) + ISNULL(ACTUAL_DATA.M2, 0) + ISNULL(ACTUAL_DATA.M3, 0) + ISNULL(ESTIMATE_BUDGET.M4, 0) + ISNULL(ESTIMATE_BUDGET.M5, 0) + ISNULL(ESTIMATE_BUDGET.M6, 0) ELSE 0 END) AS ADMIN_ESTIMATE_1ST_HALF,
      SUM(CASE WHEN MAX_REV.COST = @FC  THEN ISNULL(ACTUAL_DATA.M1, 0) + ISNULL(ACTUAL_DATA.M2, 0) + ISNULL(ACTUAL_DATA.M3, 0) + ISNULL(ESTIMATE_BUDGET.M4, 0) + ISNULL(ESTIMATE_BUDGET.M5, 0) + ISNULL(ESTIMATE_BUDGET.M6, 0) ELSE 0 END) AS FC_ESTIMATE_1ST_HALF,
      SUM(CASE WHEN MAX_REV.COST = @Admin  THEN (ISNULL(ACTUAL_DATA.M1, 0) + ISNULL(ACTUAL_DATA.M2, 0) + ISNULL(ACTUAL_DATA.M3, 0) + ISNULL(ESTIMATE_BUDGET.M4, 0) + ISNULL(ESTIMATE_BUDGET.M5, 0) + ISNULL(ESTIMATE_BUDGET.M6, 0) - ISNULL(ORIGINAL_BUDGET.H1,0)) ELSE 0 END)AS ADMIN_DIFF_1ST_HALF,
      SUM(CASE WHEN MAX_REV.COST = @FC  THEN (ISNULL(ACTUAL_DATA.M1, 0) + ISNULL(ACTUAL_DATA.M2, 0) + ISNULL(ACTUAL_DATA.M3, 0) + ISNULL(ESTIMATE_BUDGET.M4, 0) + ISNULL(ESTIMATE_BUDGET.M5, 0) + ISNULL(ESTIMATE_BUDGET.M6, 0) - ISNULL(ORIGINAL_BUDGET.H1,0)) ELSE 0 END) AS FC_DIFF_1ST_HALF,
      SUM(CASE WHEN MAX_REV.COST = @Admin  THEN ISNULL(ORIGINAL_BUDGET.H2,0) ELSE 0 END) AS ADMIN_ORIGINAL_2ND_HALF,
      SUM(CASE WHEN MAX_REV.COST = @FC  THEN ISNULL(ORIGINAL_BUDGET.H2,0) ELSE 0 END) AS FC_ORIGINAL_2ND_HALF,
      SUM(CASE WHEN MAX_REV.COST = @Admin  THEN ISNULL(MASTER_DATA.M7, 0) ELSE 0 END) AS ADMIN_REVISE_M7,
      SUM(CASE WHEN MAX_REV.COST = @FC  THEN ISNULL(MASTER_DATA.M7, 0) ELSE 0 END) AS FC_REVISE_M7,
      SUM(CASE WHEN MAX_REV.COST = @Admin  THEN ISNULL(MASTER_DATA.M8, 0) ELSE 0 END) AS ADMIN_REVISE_M8,
      SUM(CASE WHEN MAX_REV.COST = @FC  THEN ISNULL(MASTER_DATA.M8, 0) ELSE 0 END) AS FC_REVISE_M8,
      SUM(CASE WHEN MAX_REV.COST = @Admin  THEN ISNULL(MASTER_DATA.M9, 0) ELSE 0 END) AS ADMIN_REVISE_M9,
      SUM(CASE WHEN MAX_REV.COST = @FC  THEN ISNULL(MASTER_DATA.M9, 0) ELSE 0 END) AS FC_REVISE_M9,
      SUM(CASE WHEN MAX_REV.COST = @Admin  THEN ISNULL(MASTER_DATA.M10, 0) ELSE 0 END) AS ADMIN_REVISE_M10,
      SUM(CASE WHEN MAX_REV.COST = @FC  THEN ISNULL(MASTER_DATA.M10, 0) ELSE 0 END) AS FC_REVISE_M10,
      SUM(CASE WHEN MAX_REV.COST = @Admin  THEN ISNULL(MASTER_DATA.M11, 0) ELSE 0 END) AS ADMIN_REVISE_M11,
      SUM(CASE WHEN MAX_REV.COST = @FC  THEN ISNULL(MASTER_DATA.M11, 0) ELSE 0 END) AS FC_REVISE_M11,
      SUM(CASE WHEN MAX_REV.COST = @Admin  THEN ISNULL(MASTER_DATA.M12, 0) ELSE 0 END) AS ADMIN_REVISE_M12,
      SUM(CASE WHEN MAX_REV.COST = @FC  THEN ISNULL(MASTER_DATA.M12, 0) ELSE 0 END) AS FC_REVISE_M12,
      SUM(CASE WHEN MAX_REV.COST = @Admin  THEN ISNULL(MASTER_DATA.M7, 0) + ISNULL(MASTER_DATA.M8, 0) + ISNULL(MASTER_DATA.M9, 0) + ISNULL(MASTER_DATA.M10, 0) + ISNULL(MASTER_DATA.M11, 0) + ISNULL(MASTER_DATA.M12, 0) ELSE 0 END) AS ADMIN_REVISE_2ND_HALF,
      SUM(CASE WHEN MAX_REV.COST = @FC  THEN ISNULL(MASTER_DATA.M7, 0) + ISNULL(MASTER_DATA.M8, 0) + ISNULL(MASTER_DATA.M9, 0) + ISNULL(MASTER_DATA.M10, 0) + ISNULL(MASTER_DATA.M11, 0) + ISNULL(MASTER_DATA.M12, 0) ELSE 0 END) AS FC_REVISE_2ND_HALF,
      SUM(CASE WHEN MAX_REV.COST = @Admin  THEN (ISNULL(MASTER_DATA.M7, 0) + ISNULL(MASTER_DATA.M8, 0) + ISNULL(MASTER_DATA.M9, 0) + ISNULL(MASTER_DATA.M10, 0) + ISNULL(MASTER_DATA.M11, 0) + ISNULL(MASTER_DATA.M12, 0) - ISNULL(ORIGINAL_BUDGET.H2,0)) ELSE 0 END) AS ADMIN_DIFF_2ND_HALF,
      SUM(CASE WHEN MAX_REV.COST = @FC  THEN (ISNULL(MASTER_DATA.M7, 0) + ISNULL(MASTER_DATA.M8, 0) + ISNULL(MASTER_DATA.M9, 0) + ISNULL(MASTER_DATA.M10, 0) + ISNULL(MASTER_DATA.M11, 0) + ISNULL(MASTER_DATA.M12, 0) - ISNULL(ORIGINAL_BUDGET.H2,0)) ELSE 0 END) AS FC_DIFF_2ND_HALF,
      SUM(CASE WHEN MAX_REV.COST = @Admin  THEN ( ISNULL(ACTUAL_DATA.M1, 0) + ISNULL(ACTUAL_DATA.M2, 0) + ISNULL(ACTUAL_DATA.M3, 0) + ISNULL(ESTIMATE_BUDGET.M4, 0) + ISNULL(ESTIMATE_BUDGET.M5, 0) + ISNULL(ESTIMATE_BUDGET.M6, 0) +  ISNULL(MASTER_DATA.M7, 0) + ISNULL(MASTER_DATA.M8, 0) + ISNULL(MASTER_DATA.M9, 0) + ISNULL(MASTER_DATA.M10, 0) + ISNULL(MASTER_DATA.M11, 0) + ISNULL(MASTER_DATA.M12, 0) ) ELSE 0 END) AS ADMIN_REVISE_TOTAL_YEAR,
      SUM(CASE WHEN MAX_REV.COST = @FC  THEN ( ISNULL(ACTUAL_DATA.M1, 0) + ISNULL(ACTUAL_DATA.M2, 0) + ISNULL(ACTUAL_DATA.M3, 0) + ISNULL(ESTIMATE_BUDGET.M4, 0) + ISNULL(ESTIMATE_BUDGET.M5, 0) + ISNULL(ESTIMATE_BUDGET.M6, 0) +  ISNULL(MASTER_DATA.M7, 0) + ISNULL(MASTER_DATA.M8, 0) + ISNULL(MASTER_DATA.M9, 0) + ISNULL(MASTER_DATA.M10, 0) + ISNULL(MASTER_DATA.M11, 0) + ISNULL(MASTER_DATA.M12, 0) ) ELSE 0 END) AS FC_REVISE_TOTAL_YEAR,
      SUM(CASE WHEN MAX_REV.COST = @Admin  THEN (ISNULL(ACTUAL_DATA.M1, 0) + ISNULL(ACTUAL_DATA.M2, 0) + ISNULL(ACTUAL_DATA.M3, 0) + ISNULL(ESTIMATE_BUDGET.M4, 0) + ISNULL(ESTIMATE_BUDGET.M5, 0) + ISNULL(ESTIMATE_BUDGET.M6, 0) - ISNULL(ORIGINAL_BUDGET.H1,0)) + (ISNULL(MASTER_DATA.M7, 0) + ISNULL(MASTER_DATA.M8, 0) + ISNULL(MASTER_DATA.M9, 0) + ISNULL(MASTER_DATA.M10, 0) + ISNULL(MASTER_DATA.M11, 0) + ISNULL(MASTER_DATA.M12, 0) - ISNULL(ORIGINAL_BUDGET.H2,0)) ELSE 0 END) AS ADMIN_DIFF_TOTAL_YEAR,
      SUM(CASE WHEN MAX_REV.COST = @FC  THEN (ISNULL(ACTUAL_DATA.M1, 0) + ISNULL(ACTUAL_DATA.M2, 0) + ISNULL(ACTUAL_DATA.M3, 0) + ISNULL(ESTIMATE_BUDGET.M4, 0) + ISNULL(ESTIMATE_BUDGET.M5, 0) + ISNULL(ESTIMATE_BUDGET.M6, 0) - ISNULL(ORIGINAL_BUDGET.H1,0)) + (ISNULL(MASTER_DATA.M7, 0) + ISNULL(MASTER_DATA.M8, 0) + ISNULL(MASTER_DATA.M9, 0) + ISNULL(MASTER_DATA.M10, 0) + ISNULL(MASTER_DATA.M11, 0) + ISNULL(MASTER_DATA.M12, 0) - ISNULL(ORIGINAL_BUDGET.H2,0)) ELSE 0 END) AS FC_DIFF_TOTAL_YEAR,
      SUM(CASE WHEN MAX_REV.COST = @Admin  THEN ISNULL(MASTER_DATA.RRT1, 0) ELSE 0 END) AS ADMIN_RRT1,
      SUM(CASE WHEN MAX_REV.COST = @FC  THEN ISNULL(MASTER_DATA.RRT1, 0) ELSE 0 END) AS FC_RRT1,
      SUM(CASE WHEN MAX_REV.COST = @Admin  THEN ISNULL(MASTER_DATA.RRT2, 0) ELSE 0 END) AS ADMIN_RRT2,
      SUM(CASE WHEN MAX_REV.COST = @FC  THEN ISNULL(MASTER_DATA.RRT2, 0) ELSE 0 END) AS FC_RRT2,
      SUM(CASE WHEN MAX_REV.COST = @Admin  THEN ISNULL(MASTER_DATA.RRT3, 0) ELSE 0 END) AS ADMIN_RRT3,
      SUM(CASE WHEN MAX_REV.COST = @FC  THEN ISNULL(MASTER_DATA.RRT3, 0) ELSE 0 END) AS FC_RRT3,
      SUM(CASE WHEN MAX_REV.COST = @Admin  THEN ISNULL(MASTER_DATA.RRT4, 0) ELSE 0 END) AS ADMIN_RRT4,
      SUM(CASE WHEN MAX_REV.COST = @FC  THEN ISNULL(MASTER_DATA.RRT4, 0) ELSE 0 END) AS FC_RRT4,
      SUM(CASE WHEN MAX_REV.COST = @Admin  THEN ISNULL(MASTER_DATA.RRT5, 0) ELSE 0 END) AS ADMIN_RRT5,
      SUM(CASE WHEN MAX_REV.COST = @FC  THEN ISNULL(MASTER_DATA.RRT5, 0) ELSE 0 END) AS FC_RRT5,
      (SELECT ISNULL(WKH1,0) FROM BG_T_BUDGET_ADJUST WHERE BUDGET_YEAR=@BudgetYear AND PERIOD_TYPE=@PeriodType AND PROJECT_NO=@ProjectNo AND REV_NO= (SELECT MAX(REV_NO) AS REV_NO FROM BG_T_BUDGET_DATA WHERE BUDGET_YEAR = @BudgetYear AND PERIOD_TYPE = @PeriodType AND PROJECT_NO=@ProjectNo)) AS WB_ORIGINAL_1ST_HALF,
      0 AS WB_ACTUAL_M1,
      0 AS WB_ACTUAL_M2,
      0 AS WB_ACTUAL_M3,
      SUM(ROUND(ISNULL(MIN_REV.M4,0),2) - ROUND(ISNULL(ESTIMATE_BUDGET.M4, 0),2)) AS WB_ESTIMATE_M4,
      SUM(ROUND(ISNULL(MIN_REV.M5,0),2) - ROUND(ISNULL(ESTIMATE_BUDGET.M5, 0),2)) AS WB_ESTIMATE_M5,
      SUM(ROUND(ISNULL(MIN_REV.M6,0),2) - ROUND(ISNULL(ESTIMATE_BUDGET.M6, 0),2)) AS WB_ESTIMATE_M6,
      0 AS WB_ESTIMATE_1ST_HALF,
      0 AS WB_DIFF_1ST_HALF,
      (SELECT ISNULL(WKH2,0) FROM BG_T_BUDGET_ADJUST WHERE BUDGET_YEAR=@BudgetYear AND PERIOD_TYPE=@PeriodType AND PROJECT_NO=@ProjectNo AND REV_NO= (SELECT MAX(REV_NO) AS REV_NO FROM BG_T_BUDGET_DATA WHERE BUDGET_YEAR = @BudgetYear AND PERIOD_TYPE = @PeriodType AND PROJECT_NO=@ProjectNo)) AS WB_ORIGINAL_2ND_HALF,
      SUM(ROUND(ISNULL(MIN_REV.M7,0),2) - ROUND(ISNULL(MASTER_DATA.M7, 0),2)) AS WB_REVISE_M7,
      SUM(ROUND(ISNULL(MIN_REV.M8,0),2) - ROUND(ISNULL(MASTER_DATA.M8, 0),2)) AS WB_REVISE_M8,
      SUM(ROUND(ISNULL(MIN_REV.M9,0),2) - ROUND(ISNULL(MASTER_DATA.M9, 0),2)) AS WB_REVISE_M9,
      SUM(ROUND(ISNULL(MIN_REV.M10,0),2) - ROUND(ISNULL(MASTER_DATA.M10, 0),2)) AS WB_REVISE_M10,
      SUM(ROUND(ISNULL(MIN_REV.M11,0),2) - ROUND(ISNULL(MASTER_DATA.M11, 0),2)) AS WB_REVISE_M11,
      SUM(ROUND(ISNULL(MIN_REV.M12,0),2) - ROUND(ISNULL(MASTER_DATA.M12, 0),2)) AS WB_REVISE_M12,
      0 AS WB_REVISE_2ND_HALF,
      0 AS WB_DIFF_2ND_HALF,
      0 AS WB_REVISE_TOTAL_YEAR,
      0 AS WB_DIFF_TOTAL_YEAR,
      --0 AS WB_RRT1,
      SUM(ROUND(ISNULL(MIN_REV.RRT1 ,0),2)) - SUM(ROUND(ISNULL(MASTER_DATA.RRT1 ,0),2)) AS WB_RRT1,
      --0 AS WB_RRT2,
      SUM(ROUND(ISNULL(MIN_REV.RRT2 ,0),2)) - SUM(ROUND(ISNULL(MASTER_DATA.RRT2 ,0),2)) AS WB_RRT2,
      --0 AS WB_RRT3,
      SUM(ROUND(ISNULL(MIN_REV.RRT3 ,0),2)) - SUM(ROUND(ISNULL(MASTER_DATA.RRT3 ,0),2)) AS WB_RRT3,
      --0 AS WB_RRT4,
      SUM(ROUND(ISNULL(MIN_REV.RRT4 ,0),2)) - SUM(ROUND(ISNULL(MASTER_DATA.RRT4 ,0),2)) AS WB_RRT4,
      --0 AS WB_RRT5
      SUM(ROUND(ISNULL(MIN_REV.RRT5 ,0),2)) - SUM(ROUND(ISNULL(MASTER_DATA.RRT5 ,0),2)) AS WB_RRT5
      FROM (
      SELECT BUDGET_DATA.BUDGET_ORDER_NO, BUDGET_DATA.BUDGET_YEAR, BUDGET_DATA.PERIOD_TYPE, BUDGET_DATA.PROJECT_NO,
      BUDGET_ORDER.ACCOUNT_NO, ACC.ACCOUNT_NAME,
      BUDGET_ORDER.BUDGET_TYPE, BUDGET_ORDER.EXPENSE_TYPE, BUDGET_ORDER.COST,
      MAX(BUDGET_DATA.REV_NO) AS REV_NO
      FROM BG_T_BUDGET_DATA AS BUDGET_DATA
      INNER JOIN BG_M_BUDGET_ORDER AS BUDGET_ORDER
      ON BUDGET_ORDER.BUDGET_ORDER_NO = BUDGET_DATA.BUDGET_ORDER_NO AND BUDGET_ORDER.ACTIVE_FLAG = 1
      INNER JOIN BG_M_ACCOUNT AS ACC ON ACC.ACCOUNT_NO = BUDGET_ORDER.ACCOUNT_NO
      WHERE BUDGET_DATA.BUDGET_YEAR = @BudgetYear
      AND BUDGET_DATA.PERIOD_TYPE = @PeriodType
      AND BUDGET_DATA.PROJECT_NO = @ProjectNo
      AND BUDGET_ORDER.BUDGET_TYPE= 'E'
      GROUP BY BUDGET_DATA.BUDGET_ORDER_NO, BUDGET_DATA.BUDGET_YEAR, BUDGET_DATA.PERIOD_TYPE, BUDGET_DATA.PROJECT_NO,
      BUDGET_ORDER.ACCOUNT_NO, ACC.ACCOUNT_NAME,
      BUDGET_ORDER.BUDGET_TYPE, BUDGET_ORDER.EXPENSE_TYPE, BUDGET_ORDER.COST) AS MAX_REV
      INNER JOIN BG_T_BUDGET_DATA AS MASTER_DATA
      ON MAX_REV.BUDGET_YEAR = MASTER_DATA.BUDGET_YEAR
      AND MAX_REV.PERIOD_TYPE = MASTER_DATA.PERIOD_TYPE
      AND MAX_REV.PROJECT_NO = MASTER_DATA.PROJECT_NO
      AND MAX_REV.BUDGET_ORDER_NO = MASTER_DATA.BUDGET_ORDER_NO
      AND MAX_REV.REV_NO = MASTER_DATA.REV_NO
      LEFT OUTER JOIN BG_T_UPLOAD_DATA AS ORIGINAL_BUDGET
      ON MAX_REV.BUDGET_YEAR = ORIGINAL_BUDGET.BUDGET_YEAR
      AND ORIGINAL_BUDGET.PERIOD_TYPE = @PeriodType
      AND ORIGINAL_BUDGET.PROJECT_NO = @ProjectNo
      AND MAX_REV.BUDGET_ORDER_NO = ORIGINAL_BUDGET.BUDGET_ORDER_NO
      AND ORIGINAL_BUDGET.DATA_TYPE = 1
      LEFT OUTER JOIN BG_T_BUDGET_DATA AS ESTIMATE_BUDGET
      ON MAX_REV.BUDGET_YEAR = ESTIMATE_BUDGET.BUDGET_YEAR
      AND ESTIMATE_BUDGET.PERIOD_TYPE = @PeriodType
      AND ESTIMATE_BUDGET.PROJECT_NO = @ProjectNo
      AND MAX_REV.BUDGET_ORDER_NO = ESTIMATE_BUDGET.BUDGET_ORDER_NO
      AND MAX_REV.REV_NO = ESTIMATE_BUDGET.REV_NO
      LEFT OUTER JOIN BG_T_UPLOAD_DATA AS ACTUAL_DATA
      ON MAX_REV.BUDGET_YEAR = ACTUAL_DATA.BUDGET_YEAR
      AND ACTUAL_DATA.PERIOD_TYPE = @PeriodType
      AND ACTUAL_DATA.PROJECT_NO = @ProjectNo
      AND MAX_REV.BUDGET_ORDER_NO = ACTUAL_DATA.BUDGET_ORDER_NO
      AND ACTUAL_DATA.DATA_TYPE = 2
      INNER JOIN BG_T_BUDGET_DATA AS MIN_REV
      ON MIN_REV.BUDGET_YEAR = MASTER_DATA.BUDGET_YEAR
      AND MIN_REV.PERIOD_TYPE = MASTER_DATA.PERIOD_TYPE
      AND MIN_REV.PROJECT_NO = MASTER_DATA.PROJECT_NO
      AND MIN_REV.BUDGET_ORDER_NO = MASTER_DATA.BUDGET_ORDER_NO
      AND MIN_REV.REV_NO = 1
      LEFT OUTER JOIN BG_T_BUDGET_ADJUST AS BUDGET_ADJUST
      ON MAX_REV.BUDGET_YEAR = BUDGET_ADJUST.BUDGET_YEAR
      AND MAX_REV.PERIOD_TYPE = BUDGET_ADJUST.PERIOD_TYPE
      AND MAX_REV.PROJECT_NO = BUDGET_ADJUST.PROJECT_NO
      AND MAX_REV.REV_NO = BUDGET_ADJUST.REV_NO
      WHERE
      (ISNULL(ORIGINAL_BUDGET.H1,0) &lt;&gt; 0
      OR ISNULL(ORIGINAL_BUDGET.H2,0) &lt;&gt; 0
      OR ISNULL(ACTUAL_DATA.M1, 0) &lt;&gt; 0
      OR ISNULL(ACTUAL_DATA.M2, 0) &lt;&gt; 0
      OR ISNULL(ACTUAL_DATA.M3, 0) &lt;&gt; 0
      OR ISNULL(MASTER_DATA.M4, 0) &lt;&gt; 0
      OR ISNULL(MASTER_DATA.M5, 0) &lt;&gt; 0
      OR ISNULL(MASTER_DATA.M6, 0) &lt;&gt; 0
      OR ISNULL(MASTER_DATA.M7, 0) &lt;&gt; 0
      OR ISNULL(MASTER_DATA.M8, 0) &lt;&gt; 0
      OR ISNULL(MASTER_DATA.M9, 0) &lt;&gt; 0
      OR ISNULL(MASTER_DATA.M10, 0) &lt;&gt; 0
      OR ISNULL(MASTER_DATA.M11, 0) &lt;&gt; 0
      OR ISNULL(MASTER_DATA.M12, 0) &lt;&gt; 0
      OR ISNULL(MASTER_DATA.RRT1 ,0) &lt;&gt; 0
      OR ISNULL(MASTER_DATA.RRT2 ,0) &lt;&gt; 0
      OR ISNULL(MASTER_DATA.RRT3 ,0) &lt;&gt; 0
      OR ISNULL(MASTER_DATA.RRT4 ,0) &lt;&gt; 0
      OR ISNULL(MASTER_DATA.RRT5 ,0) &lt;&gt; 0
      OR ISNULL(MIN_REV.M4, 0) &lt;&gt; 0
      OR ISNULL(MIN_REV.M5, 0) &lt;&gt; 0
      OR ISNULL(MIN_REV.M6, 0) &lt;&gt; 0
      OR ISNULL(MIN_REV.M7, 0) &lt;&gt; 0
      OR ISNULL(MIN_REV.M8, 0) &lt;&gt; 0
      OR ISNULL(MIN_REV.M9, 0) &lt;&gt; 0
      OR ISNULL(MIN_REV.M10, 0) &lt;&gt; 0
      OR ISNULL(MIN_REV.M11, 0) &lt;&gt; 0
      OR ISNULL(MIN_REV.M12, 0) &lt;&gt; 0
      OR ISNULL(MIN_REV.RRT1 ,0) &lt;&gt; 0
      OR ISNULL(MIN_REV.RRT2 ,0) &lt;&gt; 0
      OR ISNULL(MIN_REV.RRT3 ,0) &lt;&gt; 0
      OR ISNULL(MIN_REV.RRT4 ,0) &lt;&gt; 0
      OR ISNULL(MIN_REV.RRT5 ,0) &lt;&gt; 0
      )
      GROUP BY MAX_REV.BUDGET_YEAR, MAX_REV.PERIOD_TYPE, MAX_REV.PROJECT_NO, MAX_REV.ACCOUNT_NO, MAX_REV.ACCOUNT_NAME , MAX_REV.BUDGET_TYPE , MAX_REV.EXPENSE_TYPE
      UNION
      SELECT MAX_REV.BUDGET_YEAR, MAX_REV.PERIOD_TYPE, MAX_REV.PROJECT_NO, MAX_REV.ACCOUNT_NO , MAX_REV.ACCOUNT_NAME , MAX_REV.BUDGET_TYPE , MAX_REV.EXPENSE_TYPE,
      0 AS ORIGINAL_1ST_HALF,
      0 AS ACTUAL_M1,
      0 AS ACTUAL_M2,
      0 AS ACTUAL_M3,
      0 AS ESTIMATE_M4,
      0 AS ESTIMATE_M5,
      0 AS ESTIMATE_M6,
      0 AS ESTIMATE_1ST_HALF,
      0 AS DIFF_1ST_HALF,
      0 AS ORIGINAL_2ND_HALF,
      0 AS REVISE_M7, 0 AS REVISE_M8, 0 AS REVISE_M9,
      0 AS REVISE_M10, 0 AS REVISE_M11, 0 AS REVISE_M12,
      0 AS REVISE_2ND_HALF,
      0 AS DIFF_2ND_HALF,
      0 AS REVISE_TOTAL_YEAR,
      0 AS DIFF_TOTAL_YEAR,
      0 AS RRT1,
      0 AS RRT2,
      0 AS RRT3,
      0 AS RRT4,
      0 AS RRT5,
      SUM(ISNULL(ORIGINAL_BUDGET.H1,0) ) AS INVESTMENT_ORIGINAL_1ST_HALF,
      SUM(ISNULL(ACTUAL_DATA.M1, 0) ) AS INVESTMENT_ACTUAL_JAN,
      SUM(ISNULL(ACTUAL_DATA.M2, 0) ) AS INVESTMENT_ACTUAL_FEB,
      SUM(ISNULL(ACTUAL_DATA.M3, 0) ) AS INVESTMENT_ACTUAL_MAR,
      SUM(ISNULL(ESTIMATE_BUDGET.M4, 0) ) AS INVESTMENT_ESTIMATE_APR,
      SUM(ISNULL(ESTIMATE_BUDGET.M5, 0) ) AS INVESTMENT_ESTIMATE_MAY,
      SUM(ISNULL(ESTIMATE_BUDGET.M6, 0) ) AS INVESTMENT_ESTIMATE_JUN,
      SUM(ISNULL(ORIGINAL_BUDGET.H2,0) ) AS INVESTMENT_ORIGINAL_2ND_HALF,
      SUM(ISNULL(MASTER_DATA.M7, 0) ) AS INVESTMENT_REVISE_JUL,
      SUM(ISNULL(MASTER_DATA.M8, 0) ) AS INVESTMENT_REVISE_AUG,
      SUM(ISNULL(MASTER_DATA.M9, 0) ) AS INVESTMENT_REVISE_SEP,
      SUM(ISNULL(MASTER_DATA.M10, 0) ) AS INVESTMENT_REVISE_OCT,
      SUM(ISNULL(MASTER_DATA.M11, 0) ) AS INVESTMENT_REVISE_NOV,
      SUM(ISNULL(MASTER_DATA.M12, 0) ) AS INVESTMENT_REVISE_DEC,

      --SUM(ISNULL(MASTER_DATA.RRT1 ,0) ) AS INVESTMENT_RRT1,
      (SELECT ISNULL(MTP_SUM1 ,0) FROM BG_T_BUDGET_ADJUST2
      WHERE BUDGET_YEAR=@BudgetYear
      AND PERIOD_TYPE = @PeriodType
      AND PROJECT_NO = @ProjectNo
      AND REV_NO= (SELECT MAX(BUDGET_DATA.REV_NO) AS REV_NO
      FROM BG_T_BUDGET_DATA AS BUDGET_DATA
      INNER JOIN BG_M_BUDGET_ORDER AS BUDGET_ORDER
      ON BUDGET_ORDER.BUDGET_ORDER_NO = BUDGET_DATA.BUDGET_ORDER_NO
      AND BUDGET_ORDER.ACTIVE_FLAG = 1
      WHERE BUDGET_DATA.BUDGET_YEAR = @BudgetYear
      AND BUDGET_DATA.PERIOD_TYPE = @PeriodType
      AND BUDGET_DATA.PROJECT_NO = @ProjectNo
      AND BUDGET_ORDER.BUDGET_TYPE= 'A')
      ) AS INVESTMENT_RRT1,

      ----SUM(ISNULL(MASTER_DATA.RRT2 ,0) ) AS INVESTMENT_RRT2,
      (SELECT ISNULL(MTP_SUM2 ,0) FROM BG_T_BUDGET_ADJUST2
      WHERE BUDGET_YEAR=@BudgetYear
      AND PERIOD_TYPE = @PeriodType
      AND PROJECT_NO = @ProjectNo
      AND REV_NO= (SELECT MAX(BUDGET_DATA.REV_NO) AS REV_NO
      FROM BG_T_BUDGET_DATA AS BUDGET_DATA
      INNER JOIN BG_M_BUDGET_ORDER AS BUDGET_ORDER
      ON BUDGET_ORDER.BUDGET_ORDER_NO = BUDGET_DATA.BUDGET_ORDER_NO
      AND BUDGET_ORDER.ACTIVE_FLAG = 1
      WHERE BUDGET_DATA.BUDGET_YEAR = @BudgetYear
      AND BUDGET_DATA.PERIOD_TYPE = @PeriodType
      AND BUDGET_DATA.PROJECT_NO = @ProjectNo
      AND BUDGET_ORDER.BUDGET_TYPE= 'A')
      ) AS INVESTMENT_RRT2,

      ----SUM(ISNULL(MASTER_DATA.RRT3 ,0) ) AS INVESTMENT_RRT3,
      (SELECT ISNULL(MTP_SUM3 ,0) FROM BG_T_BUDGET_ADJUST2
      WHERE BUDGET_YEAR=@BudgetYear
      AND PERIOD_TYPE = @PeriodType
      AND PROJECT_NO = @ProjectNo
      AND REV_NO= (SELECT MAX(BUDGET_DATA.REV_NO) AS REV_NO
      FROM BG_T_BUDGET_DATA AS BUDGET_DATA
      INNER JOIN BG_M_BUDGET_ORDER AS BUDGET_ORDER
      ON BUDGET_ORDER.BUDGET_ORDER_NO = BUDGET_DATA.BUDGET_ORDER_NO
      AND BUDGET_ORDER.ACTIVE_FLAG = 1
      WHERE BUDGET_DATA.BUDGET_YEAR = @BudgetYear
      AND BUDGET_DATA.PERIOD_TYPE = @PeriodType
      AND BUDGET_DATA.PROJECT_NO = @ProjectNo
      AND BUDGET_ORDER.BUDGET_TYPE= 'A')
      ) AS INVESTMENT_RRT3,

      ----SUM(ISNULL(MASTER_DATA.RRT4 ,0) ) AS INVESTMENT_RRT4,
      (SELECT ISNULL(MTP_SUM4 ,0) FROM BG_T_BUDGET_ADJUST2
      WHERE BUDGET_YEAR=@BudgetYear
      AND PERIOD_TYPE = @PeriodType
      AND PROJECT_NO = @ProjectNo
      AND REV_NO= (SELECT MAX(BUDGET_DATA.REV_NO) AS REV_NO
      FROM BG_T_BUDGET_DATA AS BUDGET_DATA
      INNER JOIN BG_M_BUDGET_ORDER AS BUDGET_ORDER
      ON BUDGET_ORDER.BUDGET_ORDER_NO = BUDGET_DATA.BUDGET_ORDER_NO
      AND BUDGET_ORDER.ACTIVE_FLAG = 1
      WHERE BUDGET_DATA.BUDGET_YEAR = @BudgetYear
      AND BUDGET_DATA.PERIOD_TYPE = @PeriodType
      AND BUDGET_DATA.PROJECT_NO = @ProjectNo
      AND BUDGET_ORDER.BUDGET_TYPE= 'A')
      ) AS INVESTMENT_RRT4,

      ----SUM(ISNULL(MASTER_DATA.RRT5 ,0) ) AS INVESTMENT_RRT5,
      (SELECT ISNULL(MTP_SUM5 ,0) FROM BG_T_BUDGET_ADJUST2
      WHERE BUDGET_YEAR=@BudgetYear
      AND PERIOD_TYPE = @PeriodType
      AND PROJECT_NO = @ProjectNo
      AND REV_NO= (SELECT MAX(BUDGET_DATA.REV_NO) AS REV_NO
      FROM BG_T_BUDGET_DATA AS BUDGET_DATA
      INNER JOIN BG_M_BUDGET_ORDER AS BUDGET_ORDER
      ON BUDGET_ORDER.BUDGET_ORDER_NO = BUDGET_DATA.BUDGET_ORDER_NO
      AND BUDGET_ORDER.ACTIVE_FLAG = 1
      WHERE BUDGET_DATA.BUDGET_YEAR = @BudgetYear
      AND BUDGET_DATA.PERIOD_TYPE = @PeriodType
      AND BUDGET_DATA.PROJECT_NO = @ProjectNo
      AND BUDGET_ORDER.BUDGET_TYPE= 'A')
      ) AS INVESTMENT_RRT5,

      0 AS ADMIN_ORIGINAL_1ST_HALF,
      0 AS FC_ORIGINAL_1ST_HALF,
      0 AS ADMIN_ACTUAL_M1,
      0 AS FC_ACTUAL_M1,
      0 AS ADMIN_ACTUAL_M2,
      0 AS FC_ACTUAL_M2,
      0 AS ADMIN_ACTUAL_M3,
      0 AS FC_ACTUAL_M3,
      0 AS ADMIN_ESTIMATE_M4,
      0 AS FC_ESTIMATE_M4,
      0 AS ADMIN_ESTIMATE_M5,
      0 AS FC_ESTIMATE_M5,
      0 AS ADMIN_ESTIMATE_M6,
      0 AS FC_ESTIMATE_M6,
      0 AS ADMIN_ESTIMATE_1ST_HALF,
      0 AS FC_ESTIMATE_1ST_HALF,
      0 AS ADMIN_DIFF_1ST_HALF,
      0 AS FC_DIFF_1ST_HALF,
      0 AS ADMIN_ORIGINAL_2ND_HALF,
      0 AS FC_ORIGINAL_2ND_HALF,
      0 AS ADMIN_REVISE_M7,
      0 AS FC_REVISE_M7,
      0 AS ADMIN_REVISE_M8,
      0 AS FC_REVISE_M8,
      0 AS ADMIN_REVISE_M9,
      0 AS FC_REVISE_M9,
      0 AS ADMIN_REVISE_M10,
      0 AS FC_REVISE_M10,
      0 AS ADMIN_REVISE_M11,
      0 AS FC_REVISE_M11,
      0 AS ADMIN_REVISE_M12,
      0 AS FC_REVISE_M12,
      0 AS ADMIN_REVISE_2ND_HALF,
      0 AS FC_REVISE_2ND_HALF,
      0 AS ADMIN_DIFF_2ND_HALF,
      0 AS FC_DIFF_2ND_HALF,
      0 AS ADMIN_REVISE_TOTAL_YEAR,
      0 AS FC_REVISE_TOTAL_YEAR,
      0 AS ADMIN_DIFF_TOTAL_YEAR,
      0 AS FC_DIFF_TOTAL_YEAR,
      0 AS ADMIN_RRT1,
      0 AS FC_RRT1,
      0 AS ADMIN_RRT2,
      0 AS FC_RRT2,
      0 AS ADMIN_RRT3,
      0 AS FC_RRT3,
      0 AS ADMIN_RRT4,
      0 AS FC_RRT4,
      0 AS ADMIN_RRT5,
      0 AS FC_RRT5,
      0 AS WB_ORIGINAL_1ST_HALF,
      0 AS WB_ACTUAL_M1,
      0 AS WB_ACTUAL_M2,
      0 AS WB_ACTUAL_M3,
      0 AS WB_ESTIMATE_M4,
      0 AS WB_ESTIMATE_M5,
      0 AS WB_ESTIMATE_M6,
      0 AS WB_ESTIMATE_1ST_HALF,
      0 AS WB_DIFF_1ST_HALF,
      0 AS WB_ORIGINAL_2ND_HALF,
      0 AS WB_REVISE_M7,
      0 AS WB_REVISE_M8,
      0 AS WB_REVISE_M9,
      0 AS WB_REVISE_M10,
      0 AS WB_REVISE_M11,
      0 AS WB_REVISE_M12,
      0 AS WB_REVISE_2ND_HALF,
      0 AS WB_DIFF_2ND_HALF,
      0 AS WB_REVISE_TOTAL_YEAR,
      0 AS WB_DIFF_TOTAL_YEAR,
      0 AS WB_RRT1,
      0 AS WB_RRT2,
      0 AS WB_RRT3,
      0 AS WB_RRT4,
      0 AS WB_RRT5
      FROM (
      SELECT BUDGET_DATA.BUDGET_ORDER_NO, BUDGET_DATA.BUDGET_YEAR, BUDGET_DATA.PERIOD_TYPE, BUDGET_DATA.PROJECT_NO,
      BUDGET_ORDER.ACCOUNT_NO, ACC.ACCOUNT_NAME,
      BUDGET_ORDER.BUDGET_TYPE, BUDGET_ORDER.EXPENSE_TYPE, BUDGET_ORDER.COST,
      MAX(BUDGET_DATA.REV_NO) AS REV_NO
      FROM BG_T_BUDGET_DATA AS BUDGET_DATA
      INNER JOIN BG_M_BUDGET_ORDER AS BUDGET_ORDER
      ON BUDGET_ORDER.BUDGET_ORDER_NO = BUDGET_DATA.BUDGET_ORDER_NO AND BUDGET_ORDER.ACTIVE_FLAG = 1
      INNER JOIN BG_M_ACCOUNT AS ACC ON ACC.ACCOUNT_NO = BUDGET_ORDER.ACCOUNT_NO
      WHERE BUDGET_DATA.BUDGET_YEAR = @BudgetYear
      AND BUDGET_DATA.PERIOD_TYPE = @PeriodType
      AND BUDGET_DATA.PROJECT_NO = @ProjectNo
      AND BUDGET_ORDER.BUDGET_TYPE= 'A'
      GROUP BY BUDGET_DATA.BUDGET_ORDER_NO, BUDGET_DATA.BUDGET_YEAR, BUDGET_DATA.PERIOD_TYPE, BUDGET_DATA.PROJECT_NO,
      BUDGET_ORDER.ACCOUNT_NO, ACC.ACCOUNT_NAME,
      BUDGET_ORDER.BUDGET_TYPE, BUDGET_ORDER.EXPENSE_TYPE, BUDGET_ORDER.COST) AS MAX_REV
      INNER JOIN BG_T_BUDGET_DATA AS MASTER_DATA
      ON MAX_REV.BUDGET_YEAR = MASTER_DATA.BUDGET_YEAR
      AND MAX_REV.PERIOD_TYPE = MASTER_DATA.PERIOD_TYPE
      AND MAX_REV.PROJECT_NO = MASTER_DATA.PROJECT_NO
      AND MAX_REV.BUDGET_ORDER_NO = MASTER_DATA.BUDGET_ORDER_NO
      AND MAX_REV.REV_NO = MASTER_DATA.REV_NO
      LEFT OUTER JOIN BG_T_UPLOAD_DATA AS ORIGINAL_BUDGET
      ON MAX_REV.BUDGET_YEAR = ORIGINAL_BUDGET.BUDGET_YEAR
      AND ORIGINAL_BUDGET.PERIOD_TYPE = @PeriodType
      AND ORIGINAL_BUDGET.PROJECT_NO = @ProjectNo
      AND MAX_REV.BUDGET_ORDER_NO = ORIGINAL_BUDGET.BUDGET_ORDER_NO
      AND ORIGINAL_BUDGET.DATA_TYPE = 1
      LEFT OUTER JOIN BG_T_BUDGET_DATA AS ESTIMATE_BUDGET
      ON MAX_REV.BUDGET_YEAR = ESTIMATE_BUDGET.BUDGET_YEAR
      AND ESTIMATE_BUDGET.PERIOD_TYPE = @PeriodType
      AND ESTIMATE_BUDGET.PROJECT_NO = @ProjectNo
      AND MAX_REV.BUDGET_ORDER_NO = ESTIMATE_BUDGET.BUDGET_ORDER_NO
      AND MAX_REV.REV_NO = ESTIMATE_BUDGET.REV_NO
      LEFT OUTER JOIN BG_T_UPLOAD_DATA AS ACTUAL_DATA
      ON MAX_REV.BUDGET_YEAR = ACTUAL_DATA.BUDGET_YEAR
      AND ACTUAL_DATA.PERIOD_TYPE = @PeriodType
      AND ACTUAL_DATA.PROJECT_NO = @ProjectNo
      AND MAX_REV.BUDGET_ORDER_NO = ACTUAL_DATA.BUDGET_ORDER_NO
      AND ACTUAL_DATA.DATA_TYPE = 2
      INNER JOIN BG_T_BUDGET_DATA AS MIN_REV
      ON MIN_REV.BUDGET_YEAR = MASTER_DATA.BUDGET_YEAR
      AND MIN_REV.PERIOD_TYPE = MASTER_DATA.PERIOD_TYPE
      AND MIN_REV.PROJECT_NO = MASTER_DATA.PROJECT_NO
      AND MIN_REV.BUDGET_ORDER_NO = MASTER_DATA.BUDGET_ORDER_NO
      AND MIN_REV.REV_NO = 1
      LEFT OUTER JOIN BG_T_BUDGET_ADJUST AS BUDGET_ADJUST
      ON MAX_REV.BUDGET_YEAR = BUDGET_ADJUST.BUDGET_YEAR
      AND MAX_REV.PERIOD_TYPE = BUDGET_ADJUST.PERIOD_TYPE
      AND MAX_REV.PROJECT_NO = BUDGET_ADJUST.PROJECT_NO
      AND MAX_REV.REV_NO = BUDGET_ADJUST.REV_NO
      WHERE
      (ISNULL(ORIGINAL_BUDGET.H1,0) &lt;&gt; 0
      OR ISNULL(ORIGINAL_BUDGET.H2,0) &lt;&gt; 0
      OR ISNULL(ACTUAL_DATA.M1, 0) &lt;&gt; 0
      OR ISNULL(ACTUAL_DATA.M2, 0) &lt;&gt; 0
      OR ISNULL(ACTUAL_DATA.M3, 0) &lt;&gt; 0
      OR ISNULL(MASTER_DATA.M4, 0) &lt;&gt; 0
      OR ISNULL(MASTER_DATA.M5, 0) &lt;&gt; 0
      OR ISNULL(MASTER_DATA.M6, 0) &lt;&gt; 0
      OR ISNULL(MASTER_DATA.M7, 0) &lt;&gt; 0
      OR ISNULL(MASTER_DATA.M8, 0) &lt;&gt; 0
      OR ISNULL(MASTER_DATA.M9, 0) &lt;&gt; 0
      OR ISNULL(MASTER_DATA.M10, 0) &lt;&gt; 0
      OR ISNULL(MASTER_DATA.M11, 0) &lt;&gt; 0
      OR ISNULL(MASTER_DATA.M12, 0) &lt;&gt; 0
      )
      GROUP BY MAX_REV.BUDGET_YEAR, MAX_REV.PERIOD_TYPE, MAX_REV.PROJECT_NO, MAX_REV.ACCOUNT_NO, MAX_REV.ACCOUNT_NAME , MAX_REV.BUDGET_TYPE , MAX_REV.EXPENSE_TYPE
    </SELECT015_3>

    <SELECT015_4>
      SELECT MAX_REV.BUDGET_YEAR, MAX_REV.PERIOD_TYPE, MAX_REV.PROJECT_NO, MAX_REV.ACCOUNT_NO, MAX_REV.ACCOUNT_NAME, MAX_REV.BUDGET_TYPE, MAX_REV.EXPENSE_TYPE,
      SUM(ISNULL(ACTUAL_DATA.H1,0)) AS ACTUAL_1ST_HALF,

      --SUM(ISNULL(REVISE_BUDGET.H2,0)) AS REVISE_2ND_HALF,
      SUM(ISNULL(MAX_REV.REVISE_SECOND_HALF,0)) AS REVISE_2ND_HALF,

      SUM(ISNULL(MASTER_DATA.M1, 0)) AS M1, SUM(ISNULL(MASTER_DATA.M2, 0)) AS M2, SUM(ISNULL(MASTER_DATA.M3, 0)) AS M3, SUM(ISNULL(MASTER_DATA.M4, 0)) AS M4, SUM(ISNULL(MASTER_DATA.M5, 0)) AS M5, SUM(ISNULL(MASTER_DATA.M6, 0)) AS M6,
      SUM(ISNULL(MASTER_DATA.M7, 0)) AS M7, SUM(ISNULL(MASTER_DATA.M8, 0)) AS M8, SUM(ISNULL(MASTER_DATA.M9, 0)) AS M9, SUM(ISNULL(MASTER_DATA.M10, 0)) AS M10, SUM(ISNULL(MASTER_DATA.M11, 0)) AS M11, SUM(ISNULL(MASTER_DATA.M12, 0)) AS M12,
      0 AS INVESTMENT_ACTUAL_1ST_HALF,
      0 AS INVESTMENT_REVISE_2ND_HALF,
      0 AS INVESTMENT_M1,
      0 AS INVESTMENT_M2,
      0 AS INVESTMENT_M3,
      0 AS INVESTMENT_M4,
      0 AS INVESTMENT_M5,
      0 AS INVESTMENT_M6,
      0 AS INVESTMENT_2ND_HALF,
      SUM(CASE WHEN MAX_REV.COST = @Admin THEN ISNULL(ACTUAL_DATA.H1,0) ELSE 0 END ) AS ADMIN_ACTUAL_1ST_HALF,
      SUM(CASE WHEN MAX_REV.COST = @FC THEN ISNULL(ACTUAL_DATA.H1,0) ELSE 0 END ) AS FC_ACTUAL_1ST_HALF,
      SUM(CASE WHEN MAX_REV.COST = @Admin THEN ISNULL(MAX_REV.REVISE_SECOND_HALF,0) ELSE 0 END ) AS ADMIN_REVISE_2ND_HALF,
      SUM(CASE WHEN MAX_REV.COST = @FC THEN ISNULL(MAX_REV.REVISE_SECOND_HALF,0) ELSE 0 END ) AS FC_REVISE_2ND_HALF,
      SUM(CASE WHEN MAX_REV.COST = @Admin THEN ISNULL(MASTER_DATA.M1,0) ELSE 0 END ) AS ADMIN_M1,
      SUM(CASE WHEN MAX_REV.COST = @FC THEN ISNULL(MASTER_DATA.M1,0) ELSE 0 END ) AS FC_M1,
      SUM(CASE WHEN MAX_REV.COST = @Admin THEN ISNULL(MASTER_DATA.M2,0) ELSE 0 END ) AS ADMIN_M2,
      SUM(CASE WHEN MAX_REV.COST = @FC THEN ISNULL(MASTER_DATA.M2,0) ELSE 0 END ) AS FC_M2,
      SUM(CASE WHEN MAX_REV.COST = @Admin THEN ISNULL(MASTER_DATA.M3,0) ELSE 0 END ) AS ADMIN_M3,
      SUM(CASE WHEN MAX_REV.COST = @FC THEN ISNULL(MASTER_DATA.M3,0) ELSE 0 END ) AS FC_M3,
      SUM(CASE WHEN MAX_REV.COST = @Admin THEN ISNULL(MASTER_DATA.M4,0) ELSE 0 END ) AS ADMIN_M4,
      SUM(CASE WHEN MAX_REV.COST = @FC THEN ISNULL(MASTER_DATA.M4,0) ELSE 0 END ) AS FC_M4,
      SUM(CASE WHEN MAX_REV.COST = @Admin THEN ISNULL(MASTER_DATA.M5,0) ELSE 0 END )AS ADMIN_M5,
      SUM(CASE WHEN MAX_REV.COST = @FC THEN ISNULL(MASTER_DATA.M5,0) ELSE 0 END ) AS FC_M5,
      SUM(CASE WHEN MAX_REV.COST = @Admin THEN ISNULL(MASTER_DATA.M6,0) ELSE 0 END )AS ADMIN_M6,
      SUM(CASE WHEN MAX_REV.COST = @FC THEN ISNULL(MASTER_DATA.M6,0) ELSE 0 END ) AS FC_M6,
      SUM(CASE WHEN MAX_REV.COST = @Admin THEN ISNULL(MASTER_DATA.M7,0) ELSE 0 END ) AS ADMIN_M7,
      SUM(CASE WHEN MAX_REV.COST = @FC THEN ISNULL(MASTER_DATA.M7,0) ELSE 0 END )AS FC_M7,
      SUM(CASE WHEN MAX_REV.COST = @Admin THEN ISNULL(MASTER_DATA.M8,0) ELSE 0 END )AS ADMIN_M8,
      SUM(CASE WHEN MAX_REV.COST = @FC THEN ISNULL(MASTER_DATA.M8,0) ELSE 0 END )AS FC_M8,
      SUM(CASE WHEN MAX_REV.COST = @Admin THEN ISNULL(MASTER_DATA.M9,0) ELSE 0 END )AS ADMIN_M9,
      SUM(CASE WHEN MAX_REV.COST = @FC THEN ISNULL(MASTER_DATA.M9,0) ELSE 0 END ) AS FC_M9,
      SUM(CASE WHEN MAX_REV.COST = @Admin THEN ISNULL(MASTER_DATA.M10,0) ELSE 0 END ) AS ADMIN_M10,
      SUM(CASE WHEN MAX_REV.COST = @FC THEN ISNULL(MASTER_DATA.M10,0) ELSE 0 END ) AS FC_M10,
      SUM(CASE WHEN MAX_REV.COST = @Admin THEN ISNULL(MASTER_DATA.M11,0) ELSE 0 END ) AS ADMIN_M11,
      SUM(CASE WHEN MAX_REV.COST = @FC THEN ISNULL(MASTER_DATA.M11,0) ELSE 0 END ) AS FC_M11,
      SUM(CASE WHEN MAX_REV.COST = @Admin THEN ISNULL(MASTER_DATA.M12,0) ELSE 0 END ) AS ADMIN_M12,
      SUM(CASE WHEN MAX_REV.COST = @FC THEN ISNULL(MASTER_DATA.M12,0) ELSE 0 END ) AS FC_M12,
      SUM(CASE WHEN MAX_REV.COST = @Admin THEN ISNULL(MASTER_DATA.M1,0) + ISNULL(MASTER_DATA.M2,0) + ISNULL(MASTER_DATA.M3,0) + ISNULL(MASTER_DATA.M4,0) + ISNULL(MASTER_DATA.M5,0) + ISNULL(MASTER_DATA.M6,0) ELSE 0 END ) AS ADMIN_1ST_HALF,
      SUM(CASE WHEN MAX_REV.COST = @FC THEN ISNULL(MASTER_DATA.M1,0) + ISNULL(MASTER_DATA.M2,0) + ISNULL(MASTER_DATA.M3,0) + ISNULL(MASTER_DATA.M4,0) + ISNULL(MASTER_DATA.M5,0) + ISNULL(MASTER_DATA.M6,0) ELSE 0 END ) AS FC_1ST_HALF,
      SUM(CASE WHEN MAX_REV.COST = @Admin THEN ISNULL(MASTER_DATA.M7,0) + ISNULL(MASTER_DATA.M8,0) + ISNULL(MASTER_DATA.M9,0) + ISNULL(MASTER_DATA.M10,0) + ISNULL(MASTER_DATA.M11,0) + ISNULL(MASTER_DATA.M12,0) ELSE 0 END ) AS ADMIN_2ND_HALF,
      SUM(CASE WHEN MAX_REV.COST = @FC THEN ISNULL(MASTER_DATA.M7,0) + ISNULL(MASTER_DATA.M8,0) + ISNULL(MASTER_DATA.M9,0) + ISNULL(MASTER_DATA.M10,0) + ISNULL(MASTER_DATA.M11,0) + ISNULL(MASTER_DATA.M12,0) ELSE 0 END ) AS FC_2ND_HALF,
      SUM(CASE WHEN MAX_REV.COST = @Admin THEN ISNULL(MASTER_DATA.M1,0) + ISNULL(MASTER_DATA.M2,0) + ISNULL(MASTER_DATA.M3,0) + ISNULL(MASTER_DATA.M4,0) + ISNULL(MASTER_DATA.M5,0) + ISNULL(MASTER_DATA.M6,0) + ISNULL(MASTER_DATA.M7,0) + ISNULL(MASTER_DATA.M8,0) + ISNULL(MASTER_DATA.M9,0) + ISNULL(MASTER_DATA.M10,0) + ISNULL(MASTER_DATA.M11,0) + ISNULL(MASTER_DATA.M12,0) ELSE 0 END ) AS ADMIN_TOTAL_YEAR,
      SUM(CASE WHEN MAX_REV.COST = @FC THEN ISNULL(MASTER_DATA.M1,0) + ISNULL(MASTER_DATA.M2,0) + ISNULL(MASTER_DATA.M3,0) + ISNULL(MASTER_DATA.M4,0) + ISNULL(MASTER_DATA.M5,0) + ISNULL(MASTER_DATA.M6,0) + ISNULL(MASTER_DATA.M7,0) + ISNULL(MASTER_DATA.M8,0) + ISNULL(MASTER_DATA.M9,0) + ISNULL(MASTER_DATA.M10,0) + ISNULL(MASTER_DATA.M11,0) + ISNULL(MASTER_DATA.M12,0) ELSE 0 END ) AS FC_TOTAL_YEAR,
      (SELECT ISNULL(WKH1,0) FROM BG_T_BUDGET_ADJUST WHERE BUDGET_YEAR=@BudgetYear AND PERIOD_TYPE=@PeriodType AND PROJECT_NO = @ProjectNo AND REV_NO= @RevNo) AS WB_ACTUAL_1ST_HALF,
      (SELECT ISNULL(WKH2,0) FROM BG_T_BUDGET_ADJUST WHERE BUDGET_YEAR=@BudgetYear AND PERIOD_TYPE=@PeriodType AND PROJECT_NO = @ProjectNo AND REV_NO= @RevNo) AS WB_REVISE_2ND_HALF,
      SUM(ISNULL(ROUND(MIN_REV.M1,2),0) -   ISNULL(ROUND(MASTER_DATA.M1,2),0)) AS WB_M1,
      SUM(ISNULL(ROUND(MIN_REV.M2,2),0) -   ISNULL(ROUND(MASTER_DATA.M2,2),0)) AS WB_M2,
      SUM(ISNULL(ROUND(MIN_REV.M3,2),0) -   ISNULL(ROUND(MASTER_DATA.M3,2),0)) AS WB_M3,
      SUM(ISNULL(ROUND(MIN_REV.M4,2),0) -   ISNULL(ROUND(MASTER_DATA.M4,2),0)) AS WB_M4,
      SUM(ISNULL(ROUND(MIN_REV.M5,2),0) -   ISNULL(ROUND(MASTER_DATA.M5,2),0)) AS WB_M5,
      SUM(ISNULL(ROUND(MIN_REV.M6,2),0) -   ISNULL(ROUND(MASTER_DATA.M6,2),0)) AS WB_M6,
      SUM(ISNULL(ROUND(MIN_REV.M7,2),0) -   ISNULL(ROUND(MASTER_DATA.M7,2),0)) AS WB_M7,
      SUM(ISNULL(ROUND(MIN_REV.M8,2),0) -   ISNULL(ROUND(MASTER_DATA.M8,2),0)) AS WB_M8,
      SUM(ISNULL(ROUND(MIN_REV.M9,2),0) -   ISNULL(ROUND(MASTER_DATA.M9,2),0)) AS WB_M9,
      SUM(ISNULL(ROUND(MIN_REV.M10,2),0) -   ISNULL(ROUND(MASTER_DATA.M10,2),0)) AS WB_M10,
      SUM(ISNULL(ROUND(MIN_REV.M11,2),0) -   ISNULL(ROUND(MASTER_DATA.M11,2),0)) AS WB_M11,
      SUM(ISNULL(ROUND(MIN_REV.M12,2),0) -   ISNULL(ROUND(MASTER_DATA.M12,2),0)) AS WB_M12,
      SUM(ISNULL(ROUND(MTP_MIN_REV.RRT2,2),0) -   ISNULL(ROUND(MTP.RRT2,2),0)) AS MTPWB,
      SUM(ISNULL(ROUND(MTP_MIN_REV.RRT2,2),0) -   ISNULL(ROUND(MTP.RRT2,2),0)) AS WB_MTP_RRT1,
      0 AS WB_TOTAL_1ST_HALF,
      0 AS WB_TOTAL_2ND_HALF
      ,SUM(ISNULL(MTP.RRT2,0)) AS MTP_RRT1
      ,SUM(CASE WHEN MAX_REV.COST = @Admin THEN ISNULL(MTP.RRT2,0) ELSE 0 END) AS MTP_RRT1_ADMIN
      ,SUM(CASE WHEN MAX_REV.COST = @FC THEN ISNULL(MTP.RRT2,0) ELSE 0 END) AS MTP_RRT1_FC


      ,0 AS INVESTMENT_M7
      ,0 AS INVESTMENT_M8
      ,0 AS INVESTMENT_M9
      ,0 AS INVESTMENT_M10
      ,0 AS INVESTMENT_M11
      ,0 AS INVESTMENT_M12


      FROM (
      SELECT BUDGET_DATA.BUDGET_ORDER_NO, BUDGET_DATA.BUDGET_YEAR, BUDGET_DATA.PERIOD_TYPE, BUDGET_DATA.PROJECT_NO,
      BUDGET_ORDER.ACCOUNT_NO, ACCOUNT.ACCOUNT_NAME,
      BUDGET_ORDER.BUDGET_TYPE, BUDGET_ORDER.EXPENSE_TYPE, BUDGET_ORDER.COST,
      MAX(BUDGET_DATA.REV_NO) AS REV_NO

      ,ISNULL((SELECT ISNULL(ISNULL(M10,0)+ISNULL(M11,0)+ISNULL(M12,0),0)
      FROM BG_T_BUDGET_DATA
      WHERE BUDGET_YEAR = (@BudgetYear-1)
      AND PERIOD_TYPE = 2
      --AND REV_NO = (SELECT MAX(REV_NO) AS REV_NO FROM BG_T_BUDGET_DATA WHERE BUDGET_YEAR = (@BudgetYear-1) AND PERIOD_TYPE = 2 AND PROJECT_NO = @ProjectNo)
      --AND PROJECT_NO = @ProjectNo
      AND REV_NO = @RefEstRevNo
      AND PROJECT_NO = @RefEstProjectNo
      AND BUDGET_ORDER_NO = BUDGET_DATA.BUDGET_ORDER_NO),0)+
      ISNULL((SELECT ISNULL(M7,0)+ISNULL(M8,0)+ISNULL(M9,0)
      FROM BG_T_UPLOAD_DATA
      WHERE BUDGET_YEAR = (@BudgetYear-1)
      AND PERIOD_TYPE = 2
      --AND PROJECT_NO = @ProjectNo
      AND PROJECT_NO = @RefEstProjectNo
      AND DATA_TYPE = 2
      AND BUDGET_ORDER_NO = BUDGET_DATA.BUDGET_ORDER_NO),0) AS REVISE_SECOND_HALF

      FROM BG_T_BUDGET_DATA AS BUDGET_DATA
      INNER JOIN BG_M_BUDGET_ORDER AS BUDGET_ORDER
      ON BUDGET_ORDER.BUDGET_ORDER_NO = BUDGET_DATA.BUDGET_ORDER_NO
      INNER JOIN BG_M_ACCOUNT AS ACCOUNT
      ON ACCOUNT.ACCOUNT_NO = BUDGET_ORDER.ACCOUNT_NO AND BUDGET_ORDER.ACTIVE_FLAG = 1
      WHERE BUDGET_DATA.BUDGET_YEAR = @BudgetYear
      AND BUDGET_DATA.PERIOD_TYPE = @PeriodType
      AND BUDGET_DATA.PROJECT_NO = @ProjectNo
      AND BUDGET_DATA.REV_NO = @RevNo
      AND BUDGET_ORDER.BUDGET_TYPE= 'E'
      GROUP BY BUDGET_DATA.BUDGET_ORDER_NO, BUDGET_DATA.BUDGET_YEAR, BUDGET_DATA.PERIOD_TYPE, BUDGET_DATA.PROJECT_NO,
      BUDGET_ORDER.ACCOUNT_NO, ACCOUNT.ACCOUNT_NAME,
      BUDGET_ORDER.BUDGET_TYPE, BUDGET_ORDER.EXPENSE_TYPE, BUDGET_ORDER.COST) AS MAX_REV

      INNER JOIN BG_T_BUDGET_DATA AS MASTER_DATA
      ON MAX_REV.BUDGET_YEAR = MASTER_DATA.BUDGET_YEAR
      AND MAX_REV.PERIOD_TYPE = MASTER_DATA.PERIOD_TYPE
      AND MAX_REV.PROJECT_NO = MASTER_DATA.PROJECT_NO
      AND MAX_REV.BUDGET_ORDER_NO = MASTER_DATA.BUDGET_ORDER_NO
      AND MAX_REV.REV_NO = MASTER_DATA.REV_NO

      LEFT OUTER JOIN BG_T_UPLOAD_DATA AS REVISE_BUDGET
      ON REVISE_BUDGET.BUDGET_YEAR = MAX_REV.BUDGET_YEAR- 1
      AND REVISE_BUDGET.PERIOD_TYPE = @PeriodType
      AND REVISE_BUDGET.PROJECT_NO = @ProjectNo
      AND REVISE_BUDGET.BUDGET_ORDER_NO = MAX_REV.BUDGET_ORDER_NO
      AND REVISE_BUDGET.DATA_TYPE = 1

      LEFT OUTER JOIN BG_T_UPLOAD_DATA AS ACTUAL_DATA
      ON ACTUAL_DATA.BUDGET_YEAR = MAX_REV.BUDGET_YEAR- 1
      AND ACTUAL_DATA.PERIOD_TYPE = @PeriodType
      AND ACTUAL_DATA.PROJECT_NO = @ProjectNo
      AND ACTUAL_DATA.BUDGET_ORDER_NO = MAX_REV.BUDGET_ORDER_NO
      AND ACTUAL_DATA.DATA_TYPE = 2

      LEFT JOIN BG_T_BUDGET_DATA AS MIN_REV
      ON MIN_REV.BUDGET_YEAR = MASTER_DATA.BUDGET_YEAR
      AND MIN_REV.PERIOD_TYPE = MASTER_DATA.PERIOD_TYPE
      AND MIN_REV.PROJECT_NO = @ProjectNo
      AND MIN_REV.BUDGET_ORDER_NO = MASTER_DATA.BUDGET_ORDER_NO
      AND MIN_REV.REV_NO = 1

      LEFT JOIN BG_T_BUDGET_DATA AS MTP
      ON MAX_REV.BUDGET_ORDER_NO = MTP.BUDGET_ORDER_NO
      AND MTP.BUDGET_YEAR=(@BudgetYear-2)
      AND MTP.PERIOD_TYPE = 10
      AND MTP.PROJECT_NO = @MtpProjectNo
      AND MTP.REV_NO = '@MtpRevNo'

      LEFT JOIN BG_T_BUDGET_DATA AS MTP_MIN_REV
      ON MTP_MIN_REV.BUDGET_YEAR = (@BudgetYear-2)
      AND MTP_MIN_REV.PERIOD_TYPE = 10
      AND MTP_MIN_REV.PROJECT_NO = @MtpProjectNo
      AND MTP_MIN_REV.BUDGET_ORDER_NO = MTP.BUDGET_ORDER_NO
      AND MTP_MIN_REV.REV_NO = 1

      WHERE
      ( ISNULL(ACTUAL_DATA.H1, 0) &lt;&gt; 0
      OR ISNULL(MAX_REV.REVISE_SECOND_HALF, 0) &lt;&gt; 0
      OR ISNULL(MASTER_DATA.M1, 0) &lt;&gt; 0
      OR ISNULL(MASTER_DATA.M2, 0) &lt;&gt; 0
      OR ISNULL(MASTER_DATA.M3, 0) &lt;&gt; 0
      OR ISNULL(MASTER_DATA.M4, 0) &lt;&gt; 0
      OR ISNULL(MASTER_DATA.M5, 0) &lt;&gt; 0
      OR ISNULL(MASTER_DATA.M6, 0) &lt;&gt; 0
      OR ISNULL(MASTER_DATA.M7, 0) &lt;&gt; 0
      OR ISNULL(MASTER_DATA.M8, 0) &lt;&gt; 0
      OR ISNULL(MASTER_DATA.M9, 0) &lt;&gt; 0
      OR ISNULL(MASTER_DATA.M10, 0) &lt;&gt; 0
      OR ISNULL(MASTER_DATA.M11, 0) &lt;&gt; 0
      OR ISNULL(MASTER_DATA.M12, 0) &lt;&gt; 0
      OR ISNULL(MIN_REV.M1, 0) &lt;&gt; 0
      OR ISNULL(MIN_REV.M2, 0) &lt;&gt; 0
      OR ISNULL(MIN_REV.M3, 0) &lt;&gt; 0
      OR ISNULL(MIN_REV.M4, 0) &lt;&gt; 0
      OR ISNULL(MIN_REV.M5, 0) &lt;&gt; 0
      OR ISNULL(MIN_REV.M6, 0) &lt;&gt; 0
      OR ISNULL(MIN_REV.M7, 0) &lt;&gt; 0
      OR ISNULL(MIN_REV.M8, 0) &lt;&gt; 0
      OR ISNULL(MIN_REV.M9, 0) &lt;&gt; 0
      OR ISNULL(MIN_REV.M10, 0) &lt;&gt; 0
      OR ISNULL(MIN_REV.M11, 0) &lt;&gt; 0
      OR ISNULL(MIN_REV.M12, 0) &lt;&gt; 0
      OR ISNULL(MTP.RRT2, 0) &lt;&gt; 0
      OR ISNULL(MTP_MIN_REV.RRT2, 0) &lt;&gt; 0
      )
      GROUP BY MAX_REV.BUDGET_YEAR, MAX_REV.PERIOD_TYPE, MAX_REV.PROJECT_NO, MAX_REV.ACCOUNT_NO, MAX_REV.ACCOUNT_NAME, MAX_REV.BUDGET_TYPE, MAX_REV.EXPENSE_TYPE
      UNION
      SELECT MAX_REV.BUDGET_YEAR, MAX_REV.PERIOD_TYPE, MAX_REV.PROJECT_NO, MAX_REV.ACCOUNT_NO, MAX_REV.ACCOUNT_NAME, MAX_REV.BUDGET_TYPE, MAX_REV.EXPENSE_TYPE,
      0 AS ACTUAL_1ST_HALF,
      0 AS REVISE_2ND_HALF,
      0 AS M1, 0 AS M2, 0 AS M3, 0 AS M4, 0 AS M5, 0 AS M6,
      0 AS M7, 0 AS M8, 0 AS M9, 0 AS M10, 0 AS M11, 0 AS M12,
      SUM(ISNULL(ACTUAL_DATA.H1,0)) AS INVESTMENT_ACTUAL_1ST_HALF,
      --SUM(ISNULL(REVISE_BUDGET.H2,0)) AS INVESTMENT_REVISE_2ND_HALF,
      SUM(ISNULL(MAX_REV.REVISE_SECOND_HALF,0)) AS INVESTMENT_REVISE_2ND_HALF,
      SUM(ISNULL(MASTER_DATA.M1,0)) AS INVESTMENT_M1,
      SUM(ISNULL(MASTER_DATA.M2,0)) AS INVESTMENT_M2,
      SUM(ISNULL(MASTER_DATA.M3,0)) AS INVESTMENT_M3,
      SUM(ISNULL(MASTER_DATA.M4,0)) AS INVESTMENT_M4,
      SUM(ISNULL(MASTER_DATA.M5,0)) AS INVESTMENT_M5,
      SUM(ISNULL(MASTER_DATA.M6,0)) AS INVESTMENT_M6,
      SUM(ISNULL(MASTER_DATA.M7,0)+ISNULL(MASTER_DATA.M8,0)+ISNULL(MASTER_DATA.M9,0)+ISNULL(MASTER_DATA.M10,0)+ISNULL(MASTER_DATA.M11,0)+ISNULL(MASTER_DATA.M12,0)) AS INVESTMENT_2ND_HALF,
      0 AS ADMIN_ACTUAL_1ST_HALF,
      0 AS FC_ACTUAL_1ST_HALF,
      0 AS ADMIN_REVISE_2ND_HALF,
      0 AS FC_REVISE_2ND_HALF,
      0 AS ADMIN_M1,
      0 AS FC_M1,
      0 AS ADMIN_M2,
      0 AS FC_M2,
      0 AS ADMIN_M3,
      0 AS FC_M3,
      0 AS ADMIN_M4,
      0 AS FC_M4,
      0 AS ADMIN_M5,
      0 AS FC_M5,
      0 AS ADMIN_M6,
      0 AS FC_M6,
      0 AS ADMIN_M7,
      0 AS FC_M7,
      0 AS ADMIN_M8,
      0 AS FC_M8,
      0 AS ADMIN_M9,
      0 AS FC_M9,
      0 AS ADMIN_M10,
      0 AS FC_M10,
      0 AS ADMIN_M11,
      0 AS FC_M11,
      0 AS ADMIN_M12,
      0 AS FC_M12,
      0 AS ADMIN_1ST_HALF,
      0 AS FC_1ST_HALF,
      0 AS ADMIN_2ND_HALF,
      0 AS FC_2ND_HALF,
      0 AS ADMIN_TOTAL_YEAR,
      0 AS FC_TOTAL_YEAR,
      0 AS WB_ACTUAL_1ST_HALF,
      0 AS WB_REVISE_2ND_HALF,
      0 AS WB_M1,
      0 AS WB_M2,
      0 AS WB_M3,
      0 AS WB_M4,
      0 AS WB_M5,
      0 AS WB_M6,
      0 AS WB_M7,
      0 AS WB_M8,
      0 AS WB_M9,
      0 AS WB_M10,
      0 AS WB_M11,
      0 AS WB_M12,
      0 AS MTPWB,
      0 AS WB_MTP_RRT1,
      0 AS WB_TOTAL_1ST_HALF,
      0 AS WB_TOTAL_2ND_HALF
      , ISNULL(BD.MTP_SUM2,0) AS MTP_RRT1
      ,0 AS MTP_RRT1_ADMIN
      ,0 AS MTP_RRT1_FC

      ,SUM(ISNULL(MASTER_DATA.M7,0)) AS INVESTMENT_M7
      ,SUM(ISNULL(MASTER_DATA.M8,0)) AS INVESTMENT_M8
      ,SUM(ISNULL(MASTER_DATA.M9,0)) AS INVESTMENT_M9
      ,SUM(ISNULL(MASTER_DATA.M10,0)) AS INVESTMENT_M10
      ,SUM(ISNULL(MASTER_DATA.M11,0)) AS INVESTMENT_M11
      ,SUM(ISNULL(MASTER_DATA.M12,0)) AS INVESTMENT_M12

      FROM (
      SELECT BUDGET_DATA.BUDGET_ORDER_NO, BUDGET_DATA.BUDGET_YEAR, BUDGET_DATA.PERIOD_TYPE, BUDGET_DATA.PROJECT_NO,
      BUDGET_ORDER.ACCOUNT_NO, ACCOUNT.ACCOUNT_NAME,
      BUDGET_ORDER.BUDGET_TYPE, BUDGET_ORDER.EXPENSE_TYPE, BUDGET_ORDER.COST,
      MAX(BUDGET_DATA.REV_NO) AS REV_NO

      ,ISNULL((SELECT ISNULL(ISNULL(M10,0)+ISNULL(M11,0)+ISNULL(M12,0),0)
      FROM BG_T_BUDGET_DATA
      WHERE BUDGET_YEAR = (@BudgetYear-1)
      AND PERIOD_TYPE = 2
      AND REV_NO = (SELECT MAX(REV_NO) AS REV_NO FROM BG_T_BUDGET_DATA WHERE BUDGET_YEAR = (@BudgetYear-1) AND PERIOD_TYPE = 2 AND PROJECT_NO = @ProjectNo AND REV_NO = 1)
      AND PROJECT_NO = @ProjectNo
      AND BUDGET_ORDER_NO = BUDGET_DATA.BUDGET_ORDER_NO),0)+
      ISNULL((SELECT ISNULL(M7,0)+ISNULL(M8,0)+ISNULL(M9,0)
      FROM BG_T_UPLOAD_DATA
      WHERE BUDGET_YEAR = (@BudgetYear-1)
      AND PERIOD_TYPE = 2
      AND PROJECT_NO = @ProjectNo
      AND DATA_TYPE = 2
      AND BUDGET_ORDER_NO = BUDGET_DATA.BUDGET_ORDER_NO),0) AS REVISE_SECOND_HALF

      FROM BG_T_BUDGET_DATA AS BUDGET_DATA
      INNER JOIN BG_M_BUDGET_ORDER AS BUDGET_ORDER
      ON BUDGET_ORDER.BUDGET_ORDER_NO = BUDGET_DATA.BUDGET_ORDER_NO
      INNER JOIN BG_M_ACCOUNT AS ACCOUNT
      ON ACCOUNT.ACCOUNT_NO = BUDGET_ORDER.ACCOUNT_NO AND BUDGET_ORDER.ACTIVE_FLAG = 1
      WHERE BUDGET_DATA.BUDGET_YEAR = @BudgetYear
      AND BUDGET_DATA.PERIOD_TYPE = @PeriodType
      AND BUDGET_DATA.PROJECT_NO = @ProjectNo
      AND BUDGET_DATA.REV_NO = (SELECT MAX(BUDGET_DATA.REV_NO) AS REV_NO
      FROM BG_T_BUDGET_DATA AS BUDGET_DATA
      INNER JOIN BG_M_BUDGET_ORDER AS BUDGET_ORDER
      ON BUDGET_ORDER.BUDGET_ORDER_NO = BUDGET_DATA.BUDGET_ORDER_NO
      AND BUDGET_ORDER.ACTIVE_FLAG = 1
      WHERE BUDGET_DATA.BUDGET_YEAR = @BudgetYear
      AND BUDGET_DATA.PERIOD_TYPE = @PeriodType
      AND BUDGET_DATA.PROJECT_NO = @ProjectNo
      AND BUDGET_ORDER.BUDGET_TYPE= 'A')
      AND BUDGET_ORDER.BUDGET_TYPE= 'A'
      GROUP BY BUDGET_DATA.BUDGET_ORDER_NO, BUDGET_DATA.BUDGET_YEAR, BUDGET_DATA.PERIOD_TYPE, BUDGET_DATA.PROJECT_NO,
      BUDGET_ORDER.ACCOUNT_NO, ACCOUNT.ACCOUNT_NAME,
      BUDGET_ORDER.BUDGET_TYPE, BUDGET_ORDER.EXPENSE_TYPE, BUDGET_ORDER.COST) AS MAX_REV
      INNER JOIN BG_T_BUDGET_DATA AS MASTER_DATA
      ON MAX_REV.BUDGET_YEAR = MASTER_DATA.BUDGET_YEAR
      AND MAX_REV.PERIOD_TYPE = MASTER_DATA.PERIOD_TYPE
      AND MAX_REV.PROJECT_NO = MASTER_DATA.PROJECT_NO
      AND MAX_REV.BUDGET_ORDER_NO = MASTER_DATA.BUDGET_ORDER_NO
      AND MAX_REV.REV_NO = MASTER_DATA.REV_NO
      LEFT OUTER JOIN BG_T_UPLOAD_DATA AS REVISE_BUDGET
      ON REVISE_BUDGET.BUDGET_YEAR = MAX_REV.BUDGET_YEAR- 1
      AND REVISE_BUDGET.PERIOD_TYPE = @PeriodType
      AND REVISE_BUDGET.PROJECT_NO = @ProjectNo
      AND REVISE_BUDGET.BUDGET_ORDER_NO = MAX_REV.BUDGET_ORDER_NO
      AND REVISE_BUDGET.DATA_TYPE = 1
      LEFT OUTER JOIN BG_T_UPLOAD_DATA AS ACTUAL_DATA
      ON ACTUAL_DATA.BUDGET_YEAR = MAX_REV.BUDGET_YEAR- 1
      AND ACTUAL_DATA.PERIOD_TYPE = @PeriodType
      AND ACTUAL_DATA.PROJECT_NO = @ProjectNo
      AND ACTUAL_DATA.BUDGET_ORDER_NO = MAX_REV.BUDGET_ORDER_NO
      AND ACTUAL_DATA.DATA_TYPE = 2
      INNER JOIN BG_T_BUDGET_DATA AS MIN_REV
      ON MIN_REV.BUDGET_YEAR = MASTER_DATA.BUDGET_YEAR
      AND MIN_REV.PERIOD_TYPE = MASTER_DATA.PERIOD_TYPE
      AND MIN_REV.PROJECT_NO = @ProjectNo
      AND MIN_REV.BUDGET_ORDER_NO = MASTER_DATA.BUDGET_ORDER_NO
      AND MIN_REV.REV_NO = 1

      LEFT JOIN BG_T_BUDGET_ADJUST2 AS BD
      ON BD.BUDGET_YEAR = (@BudgetYear-2)
      AND BD.PERIOD_TYPE = 10
      AND BD.REV_NO = '@MtpRevNo'
      AND BD.PROJECT_NO = @MtpProjectNo


      WHERE
      ( ISNULL(ACTUAL_DATA.H1,0) &lt;&gt; 0
      OR ISNULL(MAX_REV.REVISE_SECOND_HALF,0) &lt;&gt; 0
      OR ISNULL(MASTER_DATA.M1,0) &lt;&gt; 0
      OR ISNULL(MASTER_DATA.M2,0) &lt;&gt; 0
      OR ISNULL(MASTER_DATA.M3,0) &lt;&gt; 0
      OR ISNULL(MASTER_DATA.M4, 0) &lt;&gt; 0
      OR ISNULL(MASTER_DATA.M5, 0) &lt;&gt; 0
      OR ISNULL(MASTER_DATA.M6, 0) &lt;&gt; 0
      OR ISNULL(MASTER_DATA.M7, 0) &lt;&gt; 0
      OR ISNULL(MASTER_DATA.M8, 0) &lt;&gt; 0
      OR ISNULL(MASTER_DATA.M9, 0) &lt;&gt; 0
      OR ISNULL(MASTER_DATA.M10, 0) &lt;&gt; 0
      OR ISNULL(MASTER_DATA.M11, 0) &lt;&gt; 0
      OR ISNULL(MASTER_DATA.M12, 0) &lt;&gt; 0
      )
      GROUP BY MAX_REV.BUDGET_YEAR, MAX_REV.PERIOD_TYPE, MAX_REV.PROJECT_NO, MAX_REV.ACCOUNT_NO, MAX_REV.ACCOUNT_NAME, MAX_REV.BUDGET_TYPE, MAX_REV.EXPENSE_TYPE,BD.MTP_SUM2
      UNION
      SELECT BUDGET_YEAR, PERIOD_TYPE, PROJECT_NO, '' AS ACCOUNT_NO, '' AS ACCOUNT_NAME, 'A' AS BUDGET_TYPE, 0 AS EXPENSE_TYPE,
      0 AS ACTUAL_1ST_HALF,
      0 AS REVISE_2ND_HALF,
      0 AS M1,
      0 AS M2,
      0 AS M3,
      0 AS M4,
      0 AS M5,
      0 AS M6,
      0 AS M7,
      0 AS M8,
      0 AS M9,
      0 AS M10,
      0 AS M11,
      0 AS M12,
      0 AS INVESTMENT_ACTUAL_1ST_HALF,
      0 AS INVESTMENT_REVISE_2ND_HALF,
      0 AS INVESTMENT_M1,
      0 AS INVESTMENT_M2,
      0 AS INVESTMENT_M3,
      0 AS INVESTMENT_M4,
      0 AS INVESTMENT_M5,
      0 AS INVESTMENT_M6,
      0 AS INVESTMENT_2ND_HALF,
      0 AS ADMIN_ACTUAL_1ST_HALF,
      0 AS FC_ACTUAL_1ST_HALF,
      0 AS ADMIN_REVISE_2ND_HALF,
      0 AS FC_REVISE_2ND_HALF,
      0 AS ADMIN_M1,
      0 AS FC_M1,
      0 AS ADMIN_M2,
      0 AS FC_M2,
      0 AS ADMIN_M3,
      0 AS FC_M3,
      0 AS ADMIN_M4,
      0 AS FC_M4,
      0 AS ADMIN_M5,
      0 AS FC_M5,
      0 AS ADMIN_M6,
      0 AS FC_M6,
      0 AS ADMIN_M7,
      0 AS FC_M7,
      0 AS ADMIN_M8,
      0 AS FC_M8,
      0 AS ADMIN_M9,
      0 AS FC_M9,
      0 AS ADMIN_M10,
      0 AS FC_M10,
      0 AS ADMIN_M11,
      0 AS FC_M11,
      0 AS ADMIN_M12,
      0 AS FC_M12,
      0 AS ADMIN_1ST_HALF,
      0 AS FC_1ST_HALF,
      0 AS ADMIN_2ND_HALF,
      0 AS FC_2ND_HALF,
      0 AS ADMIN_TOTAL_YEAR,
      0 AS FC_TOTAL_YEAR,
      0 AS WB_ACTUAL_1ST_HALF,
      0 AS WB_REVISE_2ND_HALF,
      0 AS WB_M1,
      0 AS WB_M2,
      0 AS WB_M3,
      0 AS WB_M4,
      0 AS WB_M5,
      0 AS WB_M6,
      0 AS WB_M7,
      0 AS WB_M8,
      0 AS WB_M9,
      0 AS WB_M10,
      0 AS WB_M11,
      0 AS WB_M12,
      0 AS MTPWB,
      0 AS WB_MTP_RRT1,
      0 AS WB_TOTAL_1ST_HALF,
      0 AS WB_TOTAL_2ND_HALF
      ,MTP_SUM1 AS MTP_RRT1
      ,0 AS MTP_RRT1_ADMIN
      ,0 AS MTP_RRT1_FC

      ,0 AS INVESTMENT_M7
      ,0 AS INVESTMENT_M8
      ,0 AS INVESTMENT_M9
      ,0 AS INVESTMENT_M10
      ,0 AS INVESTMENT_M11
      ,0 AS INVESTMENT_M12


      FROM BG_T_BUDGET_ADJUST2
      WHERE BUDGET_YEAR = (@BudgetYear-1)
      AND PERIOD_TYPE = 10
      AND REV_NO = '@MtpRevNo'
      AND PROJECT_NO = @MtpProjectNo

      UNION
      SELECT BUDGET_YEAR, PERIOD_TYPE, PROJECT_NO, '' AS ACCOUNT_NO, '' AS ACCOUNT_NAME, '' AS BUDGET_TYPE, 0 AS EXPENSE_TYPE,
      0 AS ACTUAL_1ST_HALF,
      0 AS REVISE_2ND_HALF,
      0 AS M1,
      0 AS M2,
      0 AS M3,
      0 AS M4,
      0 AS M5,
      0 AS M6,
      0 AS M7,
      0 AS M8,
      0 AS M9,
      0 AS M10,
      0 AS M11,
      0 AS M12,
      0 AS INVESTMENT_ACTUAL_1ST_HALF,
      0 AS INVESTMENT_REVISE_2ND_HALF,
      0 AS INVESTMENT_M1,
      0 AS INVESTMENT_M2,
      0 AS INVESTMENT_M3,
      0 AS INVESTMENT_M4,
      0 AS INVESTMENT_M5,
      0 AS INVESTMENT_M6,
      0 AS INVESTMENT_2ND_HALF,
      0 AS ADMIN_ACTUAL_1ST_HALF,
      0 AS FC_ACTUAL_1ST_HALF,
      0 AS ADMIN_REVISE_2ND_HALF,
      0 AS FC_REVISE_2ND_HALF,
      0 AS ADMIN_M1,
      0 AS FC_M1,
      0 AS ADMIN_M2,
      0 AS FC_M2,
      0 AS ADMIN_M3,
      0 AS FC_M3,
      0 AS ADMIN_M4,
      0 AS FC_M4,
      0 AS ADMIN_M5,
      0 AS FC_M5,
      0 AS ADMIN_M6,
      0 AS FC_M6,
      0 AS ADMIN_M7,
      0 AS FC_M7,
      0 AS ADMIN_M8,
      0 AS FC_M8,
      0 AS ADMIN_M9,
      0 AS FC_M9,
      0 AS ADMIN_M10,
      0 AS FC_M10,
      0 AS ADMIN_M11,
      0 AS FC_M11,
      0 AS ADMIN_M12,
      0 AS FC_M12,
      0 AS ADMIN_1ST_HALF,
      0 AS FC_1ST_HALF,
      0 AS ADMIN_2ND_HALF,
      0 AS FC_2ND_HALF,
      0 AS ADMIN_TOTAL_YEAR,
      0 AS FC_TOTAL_YEAR,
      0 AS WB_ACTUAL_1ST_HALF,
      0 AS WB_REVISE_2ND_HALF,
      0 AS WB_M1,
      0 AS WB_M2,
      0 AS WB_M3,
      0 AS WB_M4,
      0 AS WB_M5,
      0 AS WB_M6,
      0 AS WB_M7,
      0 AS WB_M8,
      0 AS WB_M9,
      0 AS WB_M10,
      0 AS WB_M11,
      0 AS WB_M12,
      0 AS MTPWB,
      0 AS WB_MTP_RRT1,
      0 AS WB_TOTAL_1ST_HALF,
      0 AS WB_TOTAL_2ND_HALF
      ,0 MTP_RRT1
      ,0 AS MTP_RRT1_ADMIN
      ,0 AS MTP_RRT1_FC
      ,0 AS INVESTMENT_M1
      ,0 AS INVESTMENT_M2
      ,0 AS INVESTMENT_M3
      ,0 AS INVESTMENT_M4
      ,0 AS INVESTMENT_M5
      ,0 AS INVESTMENT_M6

      FROM BG_T_BUDGET_ADJUST
      WHERE BUDGET_YEAR = @BudgetYear
      AND PERIOD_TYPE = @PeriodType
      AND PROJECT_NO = @ProjectNo
      AND REV_NO = @RevNo

    </SELECT015_4>
    <SELECT015_5>
      SELECT MAX_REV.BUDGET_YEAR, MAX_REV.PERIOD_TYPE, MAX_REV.PROJECT_NO, MAX_REV.ACCOUNT_NO, MAX_REV.ACCOUNT_NAME, MAX_REV.BUDGET_TYPE, MAX_REV.EXPENSE_TYPE,
      SUM(ISNULL(ACTUAL_DATA.M7, 0)) AS M7, SUM(ISNULL(ACTUAL_DATA.M8, 0)) AS M8, SUM(ISNULL(ACTUAL_DATA.M9, 0)) AS M9,
      SUM(ISNULL(MASTER_DATA.M10, 0)) AS M10, SUM(ISNULL(MASTER_DATA.M11, 0)) AS M11, SUM(ISNULL(MASTER_DATA.M12, 0)) AS M12,
      SUM(ISNULL(ACTUAL_DATA.H1,0)) AS ACTUAL_1ST_HALF,
      SUM(ISNULL(REVISE_BUDGET.M7, 0) + ISNULL(REVISE_BUDGET.M8, 0) + ISNULL(REVISE_BUDGET.M9, 0) + ISNULL(REVISE_BUDGET.M10, 0) + ISNULL(REVISE_BUDGET.M11, 0) + ISNULL(REVISE_BUDGET.M12, 0)) AS REVISE_2ND_HALF,
      SUM(ISNULL(ACTUAL_DATA.M7, 0) + ISNULL(ACTUAL_DATA.M8, 0) + ISNULL(ACTUAL_DATA.M9, 0) + ISNULL(MASTER_DATA.M10, 0) + ISNULL(MASTER_DATA.M11,0) + ISNULL(MASTER_DATA.M12, 0)) AS ESTIMATE_2ND_HALF,
      SUM((ISNULL(ACTUAL_DATA.M7, 0) + ISNULL(ACTUAL_DATA.M8, 0) + ISNULL(ACTUAL_DATA.M9, 0) + ISNULL(MASTER_DATA.M10, 0) + ISNULL(MASTER_DATA.M11,0) + ISNULL(MASTER_DATA.M12, 0)) - (ISNULL(REVISE_BUDGET.M7, 0) + ISNULL(REVISE_BUDGET.M8, 0) + ISNULL(REVISE_BUDGET.M9, 0) + ISNULL(REVISE_BUDGET.M10, 0) + ISNULL(REVISE_BUDGET.M11, 0) + ISNULL(REVISE_BUDGET.M12, 0))) AS DIFFERENCE_2ND_HALF,
      SUM(ISNULL(ACTUAL_DATA.H1,0) + ISNULL(ACTUAL_DATA.M7, 0) + ISNULL(ACTUAL_DATA.M8, 0) + ISNULL(ACTUAL_DATA.M9, 0) + ISNULL(MASTER_DATA.M10, 0) + ISNULL(MASTER_DATA.M11,0) + ISNULL(MASTER_DATA.M12, 0)) AS ESTIMATE_TOTAL_YEAR,
      0 AS INVESTMENT_ACTUAL_1ST_HALF,
      0 AS INVESTMENT_REVISE_2ND_HALF,
      0 AS INVESTMENT_ACTUAL_JUL,
      0 AS INVESTMENT_ACTUAL_AUG,
      0 AS INVESTMENT_ACTUAL_SEP,
      0 AS INVESTMENT_ESTIMATE_OCT,
      0 AS INVESTMENT_ESTIMATE_NOV,
      0 AS INVESTMENT_ESTIMATE_DEC,
      SUM(CASE WHEN MAX_REV.COST = 2  THEN ISNULL(ACTUAL_DATA.M7, 0) ELSE 0 END) AS ADMIN_M7,
      SUM(CASE WHEN MAX_REV.COST = 1  THEN ISNULL(ACTUAL_DATA.M7, 0) ELSE 0 END) AS FC_M7,
      SUM(CASE WHEN MAX_REV.COST = 2  THEN ISNULL(ACTUAL_DATA.M8, 0) ELSE 0 END) AS ADMIN_M8,
      SUM(CASE WHEN MAX_REV.COST = 1  THEN ISNULL(ACTUAL_DATA.M8, 0) ELSE 0 END) AS FC_M8,
      SUM(CASE WHEN MAX_REV.COST = 2  THEN ISNULL(ACTUAL_DATA.M9, 0) ELSE 0 END) AS ADMIN_M9,
      SUM(CASE WHEN MAX_REV.COST = 1  THEN ISNULL(ACTUAL_DATA.M9, 0) ELSE 0 END) AS FC_M9,
      SUM(CASE WHEN MAX_REV.COST = 2  THEN ISNULL(MASTER_DATA.M10, 0) ELSE 0 END) AS ADMIN_M10,
      SUM(CASE WHEN MAX_REV.COST = 1  THEN ISNULL(MASTER_DATA.M10, 0) ELSE 0 END) AS FC_M10,
      SUM(CASE WHEN MAX_REV.COST = 2  THEN ISNULL(MASTER_DATA.M11, 0) ELSE 0 END) AS ADMIN_M11,
      SUM(CASE WHEN MAX_REV.COST = 1  THEN ISNULL(MASTER_DATA.M11, 0) ELSE 0 END) AS FC_M11,
      SUM(CASE WHEN MAX_REV.COST = 2  THEN ISNULL(MASTER_DATA.M12, 0) ELSE 0 END) AS ADMIN_M12,
      SUM(CASE WHEN MAX_REV.COST = 1  THEN ISNULL(MASTER_DATA.M12, 0) ELSE 0 END) AS FC_M12,
      SUM(CASE WHEN MAX_REV.COST = 2  THEN ISNULL(ACTUAL_DATA.H1,0) ELSE 0 END) AS ACTUAL_ADMIN_1ST_HALF,
      SUM(CASE WHEN MAX_REV.COST = 1  THEN ISNULL(ACTUAL_DATA.H1,0) ELSE 0 END) AS ACTUAL_FC_1ST_HALF,
      SUM(CASE WHEN MAX_REV.COST = 2  THEN (ISNULL(REVISE_BUDGET.M7, 0) + ISNULL(REVISE_BUDGET.M8, 0) + ISNULL(REVISE_BUDGET.M9, 0) + ISNULL(REVISE_BUDGET.M10, 0) + ISNULL(REVISE_BUDGET.M11, 0) + ISNULL(REVISE_BUDGET.M12, 0)) ELSE 0 END) AS REVISE_ADMIN_2ND_HALF,
      SUM(CASE WHEN MAX_REV.COST = 1  THEN (ISNULL(REVISE_BUDGET.M7, 0) + ISNULL(REVISE_BUDGET.M8, 0) + ISNULL(REVISE_BUDGET.M9, 0) + ISNULL(REVISE_BUDGET.M10, 0) + ISNULL(REVISE_BUDGET.M11, 0) + ISNULL(REVISE_BUDGET.M12, 0)) ELSE 0 END) AS REVISE_FC_2ND_HALF,
      SUM(CASE WHEN MAX_REV.COST = 2  THEN (ISNULL(ACTUAL_DATA.M7, 0) + ISNULL(ACTUAL_DATA.M8, 0) + ISNULL(ACTUAL_DATA.M9, 0) + ISNULL(MASTER_DATA.M10, 0) + ISNULL(MASTER_DATA.M11,0) + ISNULL(MASTER_DATA.M12, 0)) ELSE 0 END) AS ESTIMATE_ADMIN_2ND_HALF,
      SUM(CASE WHEN MAX_REV.COST = 1  THEN (ISNULL(ACTUAL_DATA.M7, 0) + ISNULL(ACTUAL_DATA.M8, 0) + ISNULL(ACTUAL_DATA.M9, 0) + ISNULL(MASTER_DATA.M10, 0) + ISNULL(MASTER_DATA.M11,0) + ISNULL(MASTER_DATA.M12, 0)) ELSE 0 END) AS ESTIMATE_FC_2ND_HALF,
      SUM(CASE WHEN MAX_REV.COST = 2  THEN (ISNULL(ACTUAL_DATA.M7, 0) + ISNULL(ACTUAL_DATA.M8, 0) + ISNULL(ACTUAL_DATA.M9, 0) + ISNULL(MASTER_DATA.M10, 0) + ISNULL(MASTER_DATA.M11,0) + ISNULL(MASTER_DATA.M12, 0) - (ISNULL(REVISE_BUDGET.M7, 0) + ISNULL(REVISE_BUDGET.M8, 0) + ISNULL(REVISE_BUDGET.M9, 0) + ISNULL(REVISE_BUDGET.M10, 0) + ISNULL(REVISE_BUDGET.M11, 0) + ISNULL(REVISE_BUDGET.M12, 0))) ELSE 0 END) AS DIFFERENCE_ADMIN_2ND_HALF,
      SUM(CASE WHEN MAX_REV.COST = 1  THEN (ISNULL(ACTUAL_DATA.M7, 0) + ISNULL(ACTUAL_DATA.M8, 0) + ISNULL(ACTUAL_DATA.M9, 0) + ISNULL(MASTER_DATA.M10, 0) + ISNULL(MASTER_DATA.M11,0) + ISNULL(MASTER_DATA.M12, 0) - (ISNULL(REVISE_BUDGET.M7, 0) + ISNULL(REVISE_BUDGET.M8, 0) + ISNULL(REVISE_BUDGET.M9, 0) + ISNULL(REVISE_BUDGET.M10, 0) + ISNULL(REVISE_BUDGET.M11, 0) + ISNULL(REVISE_BUDGET.M12, 0))) ELSE 0 END) AS DIFFERENCE_FC_2ND_HALF,
      SUM(CASE WHEN MAX_REV.COST = 2  THEN ISNULL(ACTUAL_DATA.H1,0) + (ISNULL(ACTUAL_DATA.M7, 0) + ISNULL(ACTUAL_DATA.M8, 0) + ISNULL(ACTUAL_DATA.M9, 0) + ISNULL(MASTER_DATA.M10, 0) + ISNULL(MASTER_DATA.M11,0) + ISNULL(MASTER_DATA.M12, 0)) ELSE 0 END) AS ESTIMATE_ADMIN_TOTAL_YEAR,
      SUM(CASE WHEN MAX_REV.COST = 1  THEN ISNULL(ACTUAL_DATA.H1,0) + (ISNULL(ACTUAL_DATA.M7, 0) + ISNULL(ACTUAL_DATA.M8, 0) + ISNULL(ACTUAL_DATA.M9, 0) + ISNULL(MASTER_DATA.M10, 0) + ISNULL(MASTER_DATA.M11,0) + ISNULL(MASTER_DATA.M12, 0)) ELSE 0 END) AS ESTIMATE_FC_TOTAL_YEAR,
      --(SELECT ISNULL(WKH1,0) FROM BG_T_BUDGET_ADJUST WHERE BUDGET_YEAR=@BudgetYear AND PERIOD_TYPE=@PeriodType AND PROJECT_NO=@ProjectNo AND REV_NO= (SELECT MAX(REV_NO) AS REV_NO FROM BG_T_BUDGET_DATA WHERE BUDGET_YEAR = @BudgetYear AND PERIOD_TYPE = @PeriodType AND PROJECT_NO=@ProjectNo)) AS WB_ACTUAL_1ST_HALF,
      --(SELECT ISNULL(WKH2,0) FROM BG_T_BUDGET_ADJUST WHERE BUDGET_YEAR=@BudgetYear AND PERIOD_TYPE=@PeriodType AND PROJECT_NO=@ProjectNo AND REV_NO= (SELECT MAX(REV_NO) AS REV_NO FROM BG_T_BUDGET_DATA WHERE BUDGET_YEAR = @BudgetYear AND PERIOD_TYPE = @PeriodType AND PROJECT_NO=@ProjectNo)) AS WB_REVISE_2ND_HALF,
      (SELECT ISNULL(WKH1,0) FROM BG_T_BUDGET_ADJUST WHERE BUDGET_YEAR=@BudgetYear AND PERIOD_TYPE=@PeriodType AND PROJECT_NO=@ProjectNo AND REV_NO= @RevNo) AS WB_ACTUAL_1ST_HALF,
      (SELECT ISNULL(WKH2,0) FROM BG_T_BUDGET_ADJUST WHERE BUDGET_YEAR=@BudgetYear AND PERIOD_TYPE=@PeriodType AND PROJECT_NO=@ProjectNo AND REV_NO= @RevNo) AS WB_REVISE_2ND_HALF,
      0 AS WB_ACTUAL_M7,
      0 AS WB_ACTUAL_M8,
      0 AS WB_ACTUAL_M9,
      SUM(ISNULL(ROUND(MIN_REV.M10,2),0) - ISNULL(ROUND(MASTER_DATA.M10,2),0)) AS WB_ESTIMATE_M10,
      SUM(ISNULL(ROUND(MIN_REV.M11,2),0) - ISNULL(ROUND(MASTER_DATA.M11,2),0)) AS WB_ESTIMATE_M11,
      SUM(ISNULL(ROUND(MIN_REV.M12,2),0) - ISNULL(ROUND(MASTER_DATA.M12,2),0)) AS WB_ESTIMATE_M12,
      0 AS WB_ESTIMATE_2ND_HALF,
      0 AS WB_DIFFERENCE_2ND_HALF,
      0 AS WB_ESTIMATE_TOTAL_YEAR
      FROM (
      SELECT BUDGET_DATA.BUDGET_ORDER_NO, BUDGET_DATA.BUDGET_YEAR, BUDGET_DATA.PERIOD_TYPE,BUDGET_DATA.PROJECT_NO,
      BUDGET_ORDER.ACCOUNT_NO, ACCOUNT.ACCOUNT_NAME,
      BUDGET_ORDER.BUDGET_TYPE, BUDGET_ORDER.EXPENSE_TYPE, BUDGET_ORDER.COST,
      MAX(BUDGET_DATA.REV_NO) AS REV_NO
      FROM BG_T_BUDGET_DATA AS BUDGET_DATA
      INNER JOIN BG_M_BUDGET_ORDER AS BUDGET_ORDER
      ON BUDGET_ORDER.BUDGET_ORDER_NO = BUDGET_DATA.BUDGET_ORDER_NO
      INNER JOIN BG_M_ACCOUNT AS ACCOUNT
      ON ACCOUNT.ACCOUNT_NO = BUDGET_ORDER.ACCOUNT_NO
      AND BUDGET_ORDER.ACTIVE_FLAG = 1
      WHERE BUDGET_DATA.BUDGET_YEAR = @BudgetYear
      AND BUDGET_DATA.PERIOD_TYPE = @PeriodType
      AND BUDGET_DATA.PROJECT_NO = @ProjectNo
      AND BUDGET_DATA.REV_NO = @RevNo
      AND BUDGET_ORDER.BUDGET_TYPE= 'E'
      GROUP BY BUDGET_DATA.BUDGET_ORDER_NO, BUDGET_DATA.BUDGET_YEAR, BUDGET_DATA.PERIOD_TYPE,BUDGET_DATA.PROJECT_NO,
      BUDGET_ORDER.ACCOUNT_NO, ACCOUNT.ACCOUNT_NAME,
      BUDGET_ORDER.BUDGET_TYPE, BUDGET_ORDER.EXPENSE_TYPE, BUDGET_ORDER.COST) AS MAX_REV
      INNER JOIN BG_T_BUDGET_DATA AS MASTER_DATA
      ON MAX_REV.BUDGET_YEAR = MASTER_DATA.BUDGET_YEAR
      AND MASTER_DATA.PERIOD_TYPE = 2
      AND MASTER_DATA.PROJECT_NO = @ProjectNo
      AND MAX_REV.BUDGET_ORDER_NO = MASTER_DATA.BUDGET_ORDER_NO
      AND MAX_REV.REV_NO = MASTER_DATA.REV_NO

      ---- change Revise to OB 02/05/2018
      --LEFT OUTER JOIN BG_T_UPLOAD_DATA AS REVISE_BUDGET
      --ON MAX_REV.BUDGET_YEAR = REVISE_BUDGET.BUDGET_YEAR
      ----AND REVISE_BUDGET.PERIOD_TYPE = 2
      --AND REVISE_BUDGET.PERIOD_TYPE = 1
      --AND REVISE_BUDGET.PROJECT_NO = 1
      --AND MAX_REV.BUDGET_ORDER_NO = REVISE_BUDGET.BUDGET_ORDER_NO
      --AND REVISE_BUDGET.DATA_TYPE = 1

      LEFT JOIN BG_T_BUDGET_DATA AS REVISE_BUDGET
      ON  REVISE_BUDGET.BUDGET_YEAR =  MAX_REV.BUDGET_YEAR
      AND REVISE_BUDGET.PERIOD_TYPE = 1
      AND REVISE_BUDGET.PROJECT_NO = MAX_REV.PROJECT_NO
      AND REVISE_BUDGET.BUDGET_ORDER_NO = MAX_REV.BUDGET_ORDER_NO
      AND REVISE_BUDGET.REV_NO = MAX_REV.REV_NO


      LEFT OUTER JOIN BG_T_UPLOAD_DATA AS ACTUAL_DATA
      ON ACTUAL_DATA.BUDGET_YEAR = MAX_REV.BUDGET_YEAR
      AND ACTUAL_DATA.PERIOD_TYPE = @PeriodType
      AND ACTUAL_DATA.PROJECT_NO = @ProjectNo
      AND ACTUAL_DATA.BUDGET_ORDER_NO = MAX_REV.BUDGET_ORDER_NO
      AND ACTUAL_DATA.DATA_TYPE = 2
      INNER JOIN BG_T_BUDGET_DATA AS MIN_REV
      ON MIN_REV.BUDGET_YEAR = MASTER_DATA.BUDGET_YEAR
      AND MIN_REV.PERIOD_TYPE = MASTER_DATA.PERIOD_TYPE
      AND MIN_REV.PROJECT_NO = MASTER_DATA.PROJECT_NO
      AND MIN_REV.BUDGET_ORDER_NO = MASTER_DATA.BUDGET_ORDER_NO
      AND MIN_REV.REV_NO = 1
      LEFT OUTER JOIN BG_T_BUDGET_ADJUST AS BUDGET_ADJUST
      ON MAX_REV.BUDGET_YEAR = BUDGET_ADJUST.BUDGET_YEAR
      AND MAX_REV.PERIOD_TYPE = BUDGET_ADJUST.PERIOD_TYPE
      AND MAX_REV.PROJECT_NO = BUDGET_ADJUST.PROJECT_NO
      AND MAX_REV.REV_NO = BUDGET_ADJUST.REV_NO
      WHERE
      (
      ISNULL(ACTUAL_DATA.H1,0) &lt;&gt; 0
      OR ISNULL(REVISE_BUDGET.M7,0) &lt;&gt; 0
      OR ISNULL(REVISE_BUDGET.M8,0) &lt;&gt; 0
      OR ISNULL(REVISE_BUDGET.M9,0) &lt;&gt; 0
      OR ISNULL(REVISE_BUDGET.M10,0) &lt;&gt; 0
      OR ISNULL(REVISE_BUDGET.M11,0) &lt;&gt; 0
      OR ISNULL(REVISE_BUDGET.M12,0) &lt;&gt; 0
      OR ISNULL(ACTUAL_DATA.M7, 0) &lt;&gt; 0
      OR ISNULL(ACTUAL_DATA.M8, 0) &lt;&gt; 0
      OR ISNULL(ACTUAL_DATA.M9, 0) &lt;&gt; 0
      OR ISNULL(MASTER_DATA.M10, 0) &lt;&gt; 0
      OR ISNULL(MASTER_DATA.M11, 0) &lt;&gt; 0
      OR ISNULL(MASTER_DATA.M12, 0) &lt;&gt; 0
      OR ISNULL(MIN_REV.M10, 0) &lt;&gt; 0
      OR ISNULL(MIN_REV.M11, 0) &lt;&gt; 0
      OR ISNULL(MIN_REV.M12, 0) &lt;&gt; 0
      )
      GROUP BY  MAX_REV.BUDGET_YEAR, MAX_REV.PERIOD_TYPE, MAX_REV.PROJECT_NO ,MAX_REV.ACCOUNT_NO, MAX_REV.ACCOUNT_NAME,MAX_REV.BUDGET_TYPE, MAX_REV.EXPENSE_TYPE
      UNION
      SELECT MAX_REV.BUDGET_YEAR, MAX_REV.PERIOD_TYPE, MAX_REV.PROJECT_NO , MAX_REV.ACCOUNT_NO, MAX_REV.ACCOUNT_NAME, MAX_REV.BUDGET_TYPE, MAX_REV.EXPENSE_TYPE,
      0 AS M7, 0 AS M8, 0 AS M9,
      0 AS M10, 0 AS M11, 0 AS M12,
      0 AS ACTUAL_1ST_HALF,
      0 AS REVISE_2ND_HALF,
      0 AS ESTIMATE_2ND_HALF,
      0 AS DIFFERENCE_2ND_HALF,
      0 AS ESTIMATE_TOTAL_YEAR,
      SUM(ISNULL(ACTUAL_DATA.H1,0)) AS INVESTMENT_ACTUAL_1ST_HALF,
      SUM(ISNULL(REVISE_BUDGET.M7, 0) + ISNULL(REVISE_BUDGET.M8, 0) + ISNULL(REVISE_BUDGET.M9, 0) + ISNULL(REVISE_BUDGET.M10, 0) + ISNULL(REVISE_BUDGET.M11, 0) + ISNULL(REVISE_BUDGET.M12, 0)) AS INVESTMENT_REVISE_2ND_HALF,
      SUM(ISNULL(ACTUAL_DATA.M7, 0)) AS INVESTMENT_ACTUAL_JUL,
      SUM(ISNULL(ACTUAL_DATA.M8, 0)) AS INVESTMENT_ACTUAL_AUG,
      SUM(ISNULL(ACTUAL_DATA.M9, 0) ) AS INVESTMENT_ACTUAL_SEP,
      SUM(ISNULL(MASTER_DATA.M10, 0)) AS INVESTMENT_ESTIMATE_OCT,
      SUM(ISNULL(MASTER_DATA.M11, 0)) AS INVESTMENT_ESTIMATE_NOV,
      SUM(ISNULL(MASTER_DATA.M12, 0)) AS INVESTMENT_ESTIMATE_DEC,
      0 AS ADMIN_M7,
      0 AS FC_M7,
      0 AS ADMIN_M8,
      0 AS FC_M8,
      0 AS ADMIN_M9,
      0 AS FC_M9,
      0 AS ADMIN_M10,
      0 AS FC_M10,
      0 AS ADMIN_M11,
      0 AS FC_M11,
      0 AS ADMIN_M12,
      0 AS FC_M12,
      0 AS ACTUAL_ADMIN_1ST_HALF,
      0 AS ACTUAL_FC_1ST_HALF,
      0 AS REVISE_ADMIN_2ND_HALF,
      0 AS REVISE_FC_2ND_HALF,
      0 AS ESTIMATE_ADMIN_2ND_HALF,
      0 AS ESTIMATE_FC_2ND_HALF,
      0 AS DIFFERENCE_ADMIN_2ND_HALF,
      0 AS DIFFERENCE_FC_2ND_HALF,
      0 AS ESTIMATE_ADMIN_TOTAL_YEAR,
      0 AS ESTIMATE_FC_TOTAL_YEAR,
      0 AS WB_ACTUAL_1ST_HALF,
      0 AS WB_REVISE_2ND_HALF,
      0 AS WB_ACTUAL_M7,
      0 AS WB_ACTUAL_M8,
      0 AS WB_ACTUAL_M9,
      0 AS WB_ESTIMATE_M10,
      0 AS WB_ESTIMATE_M11,
      0 AS WB_ESTIMATE_M12,
      0 AS WB_ESTIMATE_2ND_HALF,
      0 AS WB_DIFFERENCE_2ND_HALF,
      0 AS WB_ESTIMATE_TOTAL_YEAR
      FROM (
      SELECT BUDGET_DATA.BUDGET_ORDER_NO, BUDGET_DATA.BUDGET_YEAR, BUDGET_DATA.PERIOD_TYPE, BUDGET_DATA.PROJECT_NO,
      BUDGET_ORDER.ACCOUNT_NO, ACCOUNT.ACCOUNT_NAME,
      BUDGET_ORDER.BUDGET_TYPE, BUDGET_ORDER.EXPENSE_TYPE, BUDGET_ORDER.COST,
      MAX(BUDGET_DATA.REV_NO) AS REV_NO
      FROM BG_T_BUDGET_DATA AS BUDGET_DATA
      INNER JOIN BG_M_BUDGET_ORDER AS BUDGET_ORDER
      ON BUDGET_ORDER.BUDGET_ORDER_NO = BUDGET_DATA.BUDGET_ORDER_NO
      INNER JOIN BG_M_ACCOUNT AS ACCOUNT
      ON ACCOUNT.ACCOUNT_NO = BUDGET_ORDER.ACCOUNT_NO
      AND BUDGET_ORDER.ACTIVE_FLAG = 1
      WHERE BUDGET_DATA.BUDGET_YEAR = @BudgetYear
      AND BUDGET_DATA.PERIOD_TYPE = @PeriodType
      AND BUDGET_DATA.PROJECT_NO = @ProjectNo
      /*AND BUDGET_DATA.REV_NO = (SELECT MAX(BUDGET_DATA.REV_NO) AS REV_NO
      FROM BG_T_BUDGET_DATA AS BUDGET_DATA
      INNER JOIN BG_M_BUDGET_ORDER AS BUDGET_ORDER
      ON BUDGET_ORDER.BUDGET_ORDER_NO = BUDGET_DATA.BUDGET_ORDER_NO
      AND BUDGET_ORDER.ACTIVE_FLAG = 1
      WHERE BUDGET_DATA.BUDGET_YEAR = @BudgetYear
      AND BUDGET_DATA.PERIOD_TYPE = @PeriodType
      AND BUDGET_DATA.PROJECT_NO = @ProjectNo
      AND BUDGET_ORDER.BUDGET_TYPE= 'A')*/
      AND BUDGET_DATA.REV_NO = (SELECT MAX(REV_NO) AS REV_NO
      FROM BG_T_BUDGET_HEADER
      WHERE BUDGET_YEAR = @BudgetYear
      AND PERIOD_TYPE = @PeriodType
      AND PROJECT_NO = @ProjectNo
      AND BUDGET_TYPE= 'A')
      AND BUDGET_ORDER.BUDGET_TYPE= 'A'
      GROUP BY BUDGET_DATA.BUDGET_ORDER_NO, BUDGET_DATA.BUDGET_YEAR, BUDGET_DATA.PERIOD_TYPE, BUDGET_DATA.PROJECT_NO,
      BUDGET_ORDER.ACCOUNT_NO, ACCOUNT.ACCOUNT_NAME,
      BUDGET_ORDER.BUDGET_TYPE, BUDGET_ORDER.EXPENSE_TYPE, BUDGET_ORDER.COST) AS MAX_REV

      INNER JOIN BG_T_BUDGET_DATA AS MASTER_DATA
      ON MAX_REV.BUDGET_YEAR = MASTER_DATA.BUDGET_YEAR
      AND MASTER_DATA.PERIOD_TYPE = 2
      AND MASTER_DATA.PROJECT_NO = @ProjectNo
      AND MAX_REV.BUDGET_ORDER_NO = MASTER_DATA.BUDGET_ORDER_NO
      AND MAX_REV.REV_NO = MASTER_DATA.REV_NO

      ---- change Revise to OB 02/05/2018
      --LEFT OUTER JOIN BG_T_UPLOAD_DATA AS REVISE_BUDGET
      --ON MAX_REV.BUDGET_YEAR = REVISE_BUDGET.BUDGET_YEAR
      ----AND REVISE_BUDGET.PERIOD_TYPE = 2
      --AND REVISE_BUDGET.PERIOD_TYPE = 1
      --AND REVISE_BUDGET.PROJECT_NO = 1
      --AND MAX_REV.BUDGET_ORDER_NO = REVISE_BUDGET.BUDGET_ORDER_NO
      --AND REVISE_BUDGET.DATA_TYPE = 1

      LEFT JOIN BG_T_BUDGET_DATA AS REVISE_BUDGET
      ON  REVISE_BUDGET.BUDGET_YEAR =  MAX_REV.BUDGET_YEAR
      AND REVISE_BUDGET.PERIOD_TYPE = 1
      AND REVISE_BUDGET.PROJECT_NO = MAX_REV.PROJECT_NO
      AND REVISE_BUDGET.BUDGET_ORDER_NO = MAX_REV.BUDGET_ORDER_NO
      AND REVISE_BUDGET.REV_NO = MAX_REV.REV_NO

      LEFT OUTER JOIN BG_T_UPLOAD_DATA AS ACTUAL_DATA
      ON ACTUAL_DATA.BUDGET_YEAR = MAX_REV.BUDGET_YEAR
      AND ACTUAL_DATA.PERIOD_TYPE = @PeriodType
      AND ACTUAL_DATA.PROJECT_NO = @ProjectNo
      AND ACTUAL_DATA.BUDGET_ORDER_NO = MAX_REV.BUDGET_ORDER_NO
      AND ACTUAL_DATA.DATA_TYPE = 2

      INNER JOIN BG_T_BUDGET_DATA AS MIN_REV
      ON MIN_REV.BUDGET_YEAR = MASTER_DATA.BUDGET_YEAR
      AND MIN_REV.PERIOD_TYPE = MASTER_DATA.PERIOD_TYPE
      AND MIN_REV.PROJECT_NO = MASTER_DATA.PROJECT_NO
      AND MIN_REV.BUDGET_ORDER_NO = MASTER_DATA.BUDGET_ORDER_NO
      AND MIN_REV.REV_NO = 1

      LEFT OUTER JOIN BG_T_BUDGET_ADJUST AS BUDGET_ADJUST
      ON MAX_REV.BUDGET_YEAR = BUDGET_ADJUST.BUDGET_YEAR
      AND MAX_REV.PERIOD_TYPE = BUDGET_ADJUST.PERIOD_TYPE
      AND MAX_REV.PROJECT_NO = BUDGET_ADJUST.PROJECT_NO
      AND MAX_REV.REV_NO = BUDGET_ADJUST.REV_NO
      WHERE
      (
      ISNULL(ACTUAL_DATA.H1,0) &lt;&gt; 0
      OR ISNULL(REVISE_BUDGET.M7,0) &lt;&gt; 0
      OR ISNULL(REVISE_BUDGET.M8,0) &lt;&gt; 0
      OR ISNULL(REVISE_BUDGET.M9,0) &lt;&gt; 0
      OR ISNULL(REVISE_BUDGET.M10,0) &lt;&gt; 0
      OR ISNULL(REVISE_BUDGET.M11,0) &lt;&gt; 0
      OR ISNULL(REVISE_BUDGET.M12,0) &lt;&gt; 0
      OR ISNULL(ACTUAL_DATA.M7, 0) &lt;&gt; 0
      OR ISNULL(ACTUAL_DATA.M8, 0) &lt;&gt; 0
      OR ISNULL(ACTUAL_DATA.M9, 0) &lt;&gt; 0
      OR ISNULL(MASTER_DATA.M10, 0) &lt;&gt; 0
      OR ISNULL(MASTER_DATA.M11, 0) &lt;&gt; 0
      OR ISNULL(MASTER_DATA.M12, 0) &lt;&gt; 0
      )
      GROUP BY  MAX_REV.BUDGET_YEAR, MAX_REV.PERIOD_TYPE, MAX_REV.PROJECT_NO, MAX_REV.ACCOUNT_NO, MAX_REV.ACCOUNT_NAME,MAX_REV.BUDGET_TYPE, MAX_REV.EXPENSE_TYPE
    </SELECT015_5>
    <SELECT015_6>
      SELECT MAX_REV.BUDGET_YEAR, MAX_REV.PERIOD_TYPE, MAX_REV.PROJECT_NO, MAX_REV.ACCOUNT_NO , MAX_REV.ACCOUNT_NAME , MAX_REV.BUDGET_TYPE , MAX_REV.EXPENSE_TYPE,
      SUM(ISNULL(ORIGINAL_BUDGET.H1,0)) AS ORIGINAL_1ST_HALF,
      SUM(ISNULL(ACTUAL_DATA.M1, 0)) AS ACTUAL_M1,
      SUM(ISNULL(ACTUAL_DATA.M2, 0)) AS ACTUAL_M2,
      SUM(ISNULL(ACTUAL_DATA.M3, 0)) AS ACTUAL_M3,
      SUM(ISNULL(ESTIMATE_BUDGET.M4, 0)) AS ESTIMATE_M4,
      SUM(ISNULL(ESTIMATE_BUDGET.M5, 0)) AS ESTIMATE_M5,
      SUM(ISNULL(ESTIMATE_BUDGET.M6, 0)) AS ESTIMATE_M6,
      SUM(ISNULL(ACTUAL_DATA.M1, 0) + ISNULL(ACTUAL_DATA.M2, 0) + ISNULL(ACTUAL_DATA.M3, 0) + ISNULL(ESTIMATE_BUDGET.M4, 0) + ISNULL(ESTIMATE_BUDGET.M5, 0) + ISNULL(ESTIMATE_BUDGET.M6, 0)) AS ESTIMATE_1ST_HALF,
      SUM((ISNULL(ACTUAL_DATA.M1, 0) + ISNULL(ACTUAL_DATA.M2, 0) + ISNULL(ACTUAL_DATA.M3, 0) + ISNULL(ESTIMATE_BUDGET.M4, 0) + ISNULL(ESTIMATE_BUDGET.M5, 0) + ISNULL(ESTIMATE_BUDGET.M6, 0)) - ISNULL(ORIGINAL_BUDGET.H1,0)) AS DIFF_1ST_HALF,
      SUM(ISNULL(ORIGINAL_BUDGET.H2,0)) AS ORIGINAL_2ND_HALF,
      SUM(ISNULL(MASTER_DATA.M7, 0)) AS REVISE_M7, SUM(ISNULL(MASTER_DATA.M8, 0)) AS REVISE_M8, SUM(ISNULL(MASTER_DATA.M9, 0)) AS REVISE_M9,
      SUM(ISNULL(MASTER_DATA.M10, 0)) AS REVISE_M10, SUM(ISNULL(MASTER_DATA.M11, 0)) AS REVISE_M11, SUM(ISNULL(MASTER_DATA.M12, 0)) AS REVISE_M12,
      SUM(ISNULL(MASTER_DATA.M7, 0) + ISNULL(MASTER_DATA.M8, 0) + ISNULL(MASTER_DATA.M9, 0) + ISNULL(MASTER_DATA.M10, 0) + ISNULL(MASTER_DATA.M11, 0) + ISNULL(MASTER_DATA.M12, 0)) AS REVISE_2ND_HALF,
      SUM(ISNULL(MASTER_DATA.M7, 0) + ISNULL(MASTER_DATA.M8, 0) + ISNULL(MASTER_DATA.M9, 0) + ISNULL(MASTER_DATA.M10, 0) + ISNULL(MASTER_DATA.M11, 0) + ISNULL(MASTER_DATA.M12, 0) - ISNULL(ORIGINAL_BUDGET.H2,0)) AS DIFF_2ND_HALF,
      SUM(ISNULL(ACTUAL_DATA.M1, 0) + ISNULL(ACTUAL_DATA.M2, 0) + ISNULL(ACTUAL_DATA.M3, 0) + ISNULL(ESTIMATE_BUDGET.M4, 0) + ISNULL(ESTIMATE_BUDGET.M5, 0) + ISNULL(ESTIMATE_BUDGET.M6, 0) + ISNULL(MASTER_DATA.M7, 0) + ISNULL(MASTER_DATA.M8, 0) + ISNULL(MASTER_DATA.M9, 0) + ISNULL(MASTER_DATA.M10, 0) + ISNULL(MASTER_DATA.M11, 0) + ISNULL(MASTER_DATA.M12, 0)) AS REVISE_TOTAL_YEAR,
      SUM((ISNULL(ACTUAL_DATA.M1, 0) + ISNULL(ACTUAL_DATA.M2, 0) + ISNULL(ACTUAL_DATA.M3, 0) + ISNULL(ESTIMATE_BUDGET.M4, 0) + ISNULL(ESTIMATE_BUDGET.M5, 0) + ISNULL(ESTIMATE_BUDGET.M6, 0)) - ISNULL(ORIGINAL_BUDGET.H1,0) + ISNULL(MASTER_DATA.M7, 0) + ISNULL(MASTER_DATA.M8, 0) + ISNULL(MASTER_DATA.M9, 0) + ISNULL(MASTER_DATA.M10, 0) + ISNULL(MASTER_DATA.M11, 0) + ISNULL(MASTER_DATA.M12, 0) - ISNULL(ORIGINAL_BUDGET.H2,0) ) AS DIFF_TOTAL_YEAR,
      SUM(ISNULL(MASTER_DATA.RRT1 ,0)) AS RRT1,
      SUM(ISNULL(MASTER_DATA.RRT2 ,0)) AS RRT2,
      SUM(ISNULL(MASTER_DATA.RRT3 ,0)) AS RRT3,
      SUM(ISNULL(MASTER_DATA.RRT4 ,0)) AS RRT4,
      SUM(ISNULL(MASTER_DATA.RRT5 ,0)) AS RRT5,
      0 AS INVESTMENT_ORIGINAL_1ST_HALF,
      0 AS INVESTMENT_ACTUAL_JAN,
      0 AS INVESTMENT_ACTUAL_FEB,
      0 AS INVESTMENT_ACTUAL_MAR,
      0 AS INVESTMENT_ESTIMATE_APR,
      0 AS INVESTMENT_ESTIMATE_MAY,
      0 AS INVESTMENT_ESTIMATE_JUN,
      0 AS INVESTMENT_ORIGINAL_2ND_HALF,
      0 AS INVESTMENT_REVISE_JUL,
      0 AS INVESTMENT_REVISE_AUG,
      0 AS INVESTMENT_REVISE_SEP,
      0 AS INVESTMENT_REVISE_OCT,
      0 AS INVESTMENT_REVISE_NOV,
      0 AS INVESTMENT_REVISE_DEC,
      0 AS INVESTMENT_RRT1,
      0 AS INVESTMENT_RRT2,
      0 AS INVESTMENT_RRT3,
      0 AS INVESTMENT_RRT4,
      0 AS INVESTMENT_RRT5,
      SUM(CASE WHEN MAX_REV.COST = @Admin  THEN ISNULL(ORIGINAL_BUDGET.H1,0) ELSE 0 END) AS ADMIN_ORIGINAL_1ST_HALF,
      SUM(CASE WHEN MAX_REV.COST = @FC  THEN ISNULL(ORIGINAL_BUDGET.H1,0) ELSE 0 END) AS FC_ORIGINAL_1ST_HALF,
      SUM(CASE WHEN MAX_REV.COST = @Admin  THEN ISNULL(ACTUAL_DATA.M1, 0) ELSE 0 END) AS ADMIN_ACTUAL_M1,
      SUM(CASE WHEN MAX_REV.COST = @FC  THEN ISNULL(ACTUAL_DATA.M1, 0) ELSE 0 END) AS FC_ACTUAL_M1,
      SUM(CASE WHEN MAX_REV.COST = @Admin  THEN ISNULL(ACTUAL_DATA.M2, 0) ELSE 0 END) AS ADMIN_ACTUAL_M2,
      SUM(CASE WHEN MAX_REV.COST = @FC  THEN ISNULL(ACTUAL_DATA.M2, 0) ELSE 0 END) AS FC_ACTUAL_M2,
      SUM(CASE WHEN MAX_REV.COST = @Admin  THEN ISNULL(ACTUAL_DATA.M3, 0) ELSE 0 END) AS ADMIN_ACTUAL_M3,
      SUM(CASE WHEN MAX_REV.COST = @FC  THEN ISNULL(ACTUAL_DATA.M3, 0) ELSE 0 END) AS FC_ACTUAL_M3,
      SUM(CASE WHEN MAX_REV.COST = @Admin  THEN ISNULL(ESTIMATE_BUDGET.M4, 0) ELSE 0 END) AS ADMIN_ESTIMATE_M4,
      SUM(CASE WHEN MAX_REV.COST = @FC  THEN ISNULL(ESTIMATE_BUDGET.M4, 0) ELSE 0 END) AS FC_ESTIMATE_M4,
      SUM(CASE WHEN MAX_REV.COST = @Admin  THEN ISNULL(ESTIMATE_BUDGET.M5, 0) ELSE 0 END) AS ADMIN_ESTIMATE_M5,
      SUM(CASE WHEN MAX_REV.COST = @FC  THEN ISNULL(ESTIMATE_BUDGET.M5, 0) ELSE 0 END) AS FC_ESTIMATE_M5,
      SUM(CASE WHEN MAX_REV.COST = @Admin  THEN ISNULL(ESTIMATE_BUDGET.M6, 0) ELSE 0 END) AS ADMIN_ESTIMATE_M6,
      SUM(CASE WHEN MAX_REV.COST = @FC  THEN ISNULL(ESTIMATE_BUDGET.M6, 0) ELSE 0 END) AS FC_ESTIMATE_M6,
      SUM(CASE WHEN MAX_REV.COST = @Admin  THEN ISNULL(ACTUAL_DATA.M1, 0) + ISNULL(ACTUAL_DATA.M2, 0) + ISNULL(ACTUAL_DATA.M3, 0) + ISNULL(ESTIMATE_BUDGET.M4, 0) + ISNULL(ESTIMATE_BUDGET.M5, 0) + ISNULL(ESTIMATE_BUDGET.M6, 0) ELSE 0 END) AS ADMIN_ESTIMATE_1ST_HALF,
      SUM(CASE WHEN MAX_REV.COST = @FC  THEN ISNULL(ACTUAL_DATA.M1, 0) + ISNULL(ACTUAL_DATA.M2, 0) + ISNULL(ACTUAL_DATA.M3, 0) + ISNULL(ESTIMATE_BUDGET.M4, 0) + ISNULL(ESTIMATE_BUDGET.M5, 0) + ISNULL(ESTIMATE_BUDGET.M6, 0) ELSE 0 END) AS FC_ESTIMATE_1ST_HALF,
      SUM(CASE WHEN MAX_REV.COST = @Admin  THEN (ISNULL(ACTUAL_DATA.M1, 0) + ISNULL(ACTUAL_DATA.M2, 0) + ISNULL(ACTUAL_DATA.M3, 0) + ISNULL(ESTIMATE_BUDGET.M4, 0) + ISNULL(ESTIMATE_BUDGET.M5, 0) + ISNULL(ESTIMATE_BUDGET.M6, 0) - ISNULL(ORIGINAL_BUDGET.H1,0)) ELSE 0 END)AS ADMIN_DIFF_1ST_HALF,
      SUM(CASE WHEN MAX_REV.COST = @FC  THEN (ISNULL(ACTUAL_DATA.M1, 0) + ISNULL(ACTUAL_DATA.M2, 0) + ISNULL(ACTUAL_DATA.M3, 0) + ISNULL(ESTIMATE_BUDGET.M4, 0) + ISNULL(ESTIMATE_BUDGET.M5, 0) + ISNULL(ESTIMATE_BUDGET.M6, 0) - ISNULL(ORIGINAL_BUDGET.H1,0)) ELSE 0 END) AS FC_DIFF_1ST_HALF,
      SUM(CASE WHEN MAX_REV.COST = @Admin  THEN ISNULL(ORIGINAL_BUDGET.H2,0) ELSE 0 END) AS ADMIN_ORIGINAL_2ND_HALF,
      SUM(CASE WHEN MAX_REV.COST = @FC  THEN ISNULL(ORIGINAL_BUDGET.H2,0) ELSE 0 END) AS FC_ORIGINAL_2ND_HALF,
      SUM(CASE WHEN MAX_REV.COST = @Admin  THEN ISNULL(MASTER_DATA.M7, 0) ELSE 0 END) AS ADMIN_REVISE_M7,
      SUM(CASE WHEN MAX_REV.COST = @FC  THEN ISNULL(MASTER_DATA.M7, 0) ELSE 0 END) AS FC_REVISE_M7,
      SUM(CASE WHEN MAX_REV.COST = @Admin  THEN ISNULL(MASTER_DATA.M8, 0) ELSE 0 END) AS ADMIN_REVISE_M8,
      SUM(CASE WHEN MAX_REV.COST = @FC  THEN ISNULL(MASTER_DATA.M8, 0) ELSE 0 END) AS FC_REVISE_M8,
      SUM(CASE WHEN MAX_REV.COST = @Admin  THEN ISNULL(MASTER_DATA.M9, 0) ELSE 0 END) AS ADMIN_REVISE_M9,
      SUM(CASE WHEN MAX_REV.COST = @FC  THEN ISNULL(MASTER_DATA.M9, 0) ELSE 0 END) AS FC_REVISE_M9,
      SUM(CASE WHEN MAX_REV.COST = @Admin  THEN ISNULL(MASTER_DATA.M10, 0) ELSE 0 END) AS ADMIN_REVISE_M10,
      SUM(CASE WHEN MAX_REV.COST = @FC  THEN ISNULL(MASTER_DATA.M10, 0) ELSE 0 END) AS FC_REVISE_M10,
      SUM(CASE WHEN MAX_REV.COST = @Admin  THEN ISNULL(MASTER_DATA.M11, 0) ELSE 0 END) AS ADMIN_REVISE_M11,
      SUM(CASE WHEN MAX_REV.COST = @FC  THEN ISNULL(MASTER_DATA.M11, 0) ELSE 0 END) AS FC_REVISE_M11,
      SUM(CASE WHEN MAX_REV.COST = @Admin  THEN ISNULL(MASTER_DATA.M12, 0) ELSE 0 END) AS ADMIN_REVISE_M12,
      SUM(CASE WHEN MAX_REV.COST = @FC  THEN ISNULL(MASTER_DATA.M12, 0) ELSE 0 END) AS FC_REVISE_M12,
      SUM(CASE WHEN MAX_REV.COST = @Admin  THEN ISNULL(MASTER_DATA.M7, 0) + ISNULL(MASTER_DATA.M8, 0) + ISNULL(MASTER_DATA.M9, 0) + ISNULL(MASTER_DATA.M10, 0) + ISNULL(MASTER_DATA.M11, 0) + ISNULL(MASTER_DATA.M12, 0) ELSE 0 END) AS ADMIN_REVISE_2ND_HALF,
      SUM(CASE WHEN MAX_REV.COST = @FC  THEN ISNULL(MASTER_DATA.M7, 0) + ISNULL(MASTER_DATA.M8, 0) + ISNULL(MASTER_DATA.M9, 0) + ISNULL(MASTER_DATA.M10, 0) + ISNULL(MASTER_DATA.M11, 0) + ISNULL(MASTER_DATA.M12, 0) ELSE 0 END) AS FC_REVISE_2ND_HALF,
      SUM(CASE WHEN MAX_REV.COST = @Admin  THEN (ISNULL(MASTER_DATA.M7, 0) + ISNULL(MASTER_DATA.M8, 0) + ISNULL(MASTER_DATA.M9, 0) + ISNULL(MASTER_DATA.M10, 0) + ISNULL(MASTER_DATA.M11, 0) + ISNULL(MASTER_DATA.M12, 0) - ISNULL(ORIGINAL_BUDGET.H2,0)) ELSE 0 END) AS ADMIN_DIFF_2ND_HALF,
      SUM(CASE WHEN MAX_REV.COST = @FC  THEN (ISNULL(MASTER_DATA.M7, 0) + ISNULL(MASTER_DATA.M8, 0) + ISNULL(MASTER_DATA.M9, 0) + ISNULL(MASTER_DATA.M10, 0) + ISNULL(MASTER_DATA.M11, 0) + ISNULL(MASTER_DATA.M12, 0) - ISNULL(ORIGINAL_BUDGET.H2,0)) ELSE 0 END) AS FC_DIFF_2ND_HALF,
      SUM(CASE WHEN MAX_REV.COST = @Admin  THEN ( ISNULL(ACTUAL_DATA.M1, 0) + ISNULL(ACTUAL_DATA.M2, 0) + ISNULL(ACTUAL_DATA.M3, 0) + ISNULL(ESTIMATE_BUDGET.M4, 0) + ISNULL(ESTIMATE_BUDGET.M5, 0) + ISNULL(ESTIMATE_BUDGET.M6, 0) +  ISNULL(MASTER_DATA.M7, 0) + ISNULL(MASTER_DATA.M8, 0) + ISNULL(MASTER_DATA.M9, 0) + ISNULL(MASTER_DATA.M10, 0) + ISNULL(MASTER_DATA.M11, 0) + ISNULL(MASTER_DATA.M12, 0) ) ELSE 0 END) AS ADMIN_REVISE_TOTAL_YEAR,
      SUM(CASE WHEN MAX_REV.COST = @FC  THEN ( ISNULL(ACTUAL_DATA.M1, 0) + ISNULL(ACTUAL_DATA.M2, 0) + ISNULL(ACTUAL_DATA.M3, 0) + ISNULL(ESTIMATE_BUDGET.M4, 0) + ISNULL(ESTIMATE_BUDGET.M5, 0) + ISNULL(ESTIMATE_BUDGET.M6, 0) +  ISNULL(MASTER_DATA.M7, 0) + ISNULL(MASTER_DATA.M8, 0) + ISNULL(MASTER_DATA.M9, 0) + ISNULL(MASTER_DATA.M10, 0) + ISNULL(MASTER_DATA.M11, 0) + ISNULL(MASTER_DATA.M12, 0) ) ELSE 0 END) AS FC_REVISE_TOTAL_YEAR,
      SUM(CASE WHEN MAX_REV.COST = @Admin  THEN (ISNULL(ACTUAL_DATA.M1, 0) + ISNULL(ACTUAL_DATA.M2, 0) + ISNULL(ACTUAL_DATA.M3, 0) + ISNULL(ESTIMATE_BUDGET.M4, 0) + ISNULL(ESTIMATE_BUDGET.M5, 0) + ISNULL(ESTIMATE_BUDGET.M6, 0) - ISNULL(ORIGINAL_BUDGET.H1,0)) + (ISNULL(MASTER_DATA.M7, 0) + ISNULL(MASTER_DATA.M8, 0) + ISNULL(MASTER_DATA.M9, 0) + ISNULL(MASTER_DATA.M10, 0) + ISNULL(MASTER_DATA.M11, 0) + ISNULL(MASTER_DATA.M12, 0) - ISNULL(ORIGINAL_BUDGET.H2,0)) ELSE 0 END) AS ADMIN_DIFF_TOTAL_YEAR,
      SUM(CASE WHEN MAX_REV.COST = @FC  THEN (ISNULL(ACTUAL_DATA.M1, 0) + ISNULL(ACTUAL_DATA.M2, 0) + ISNULL(ACTUAL_DATA.M3, 0) + ISNULL(ESTIMATE_BUDGET.M4, 0) + ISNULL(ESTIMATE_BUDGET.M5, 0) + ISNULL(ESTIMATE_BUDGET.M6, 0) - ISNULL(ORIGINAL_BUDGET.H1,0)) + (ISNULL(MASTER_DATA.M7, 0) + ISNULL(MASTER_DATA.M8, 0) + ISNULL(MASTER_DATA.M9, 0) + ISNULL(MASTER_DATA.M10, 0) + ISNULL(MASTER_DATA.M11, 0) + ISNULL(MASTER_DATA.M12, 0) - ISNULL(ORIGINAL_BUDGET.H2,0)) ELSE 0 END) AS FC_DIFF_TOTAL_YEAR,
      SUM(CASE WHEN MAX_REV.COST = @Admin  THEN ISNULL(MASTER_DATA.RRT1, 0) ELSE 0 END) AS ADMIN_RRT1,
      SUM(CASE WHEN MAX_REV.COST = @FC  THEN ISNULL(MASTER_DATA.RRT1, 0) ELSE 0 END) AS FC_RRT1,
      SUM(CASE WHEN MAX_REV.COST = @Admin  THEN ISNULL(MASTER_DATA.RRT2, 0) ELSE 0 END) AS ADMIN_RRT2,
      SUM(CASE WHEN MAX_REV.COST = @FC  THEN ISNULL(MASTER_DATA.RRT2, 0) ELSE 0 END) AS FC_RRT2,
      SUM(CASE WHEN MAX_REV.COST = @Admin  THEN ISNULL(MASTER_DATA.RRT3, 0) ELSE 0 END) AS ADMIN_RRT3,
      SUM(CASE WHEN MAX_REV.COST = @FC  THEN ISNULL(MASTER_DATA.RRT3, 0) ELSE 0 END) AS FC_RRT3,
      SUM(CASE WHEN MAX_REV.COST = @Admin  THEN ISNULL(MASTER_DATA.RRT4, 0) ELSE 0 END) AS ADMIN_RRT4,
      SUM(CASE WHEN MAX_REV.COST = @FC  THEN ISNULL(MASTER_DATA.RRT4, 0) ELSE 0 END) AS FC_RRT4,
      SUM(CASE WHEN MAX_REV.COST = @Admin  THEN ISNULL(MASTER_DATA.RRT5, 0) ELSE 0 END) AS ADMIN_RRT5,
      SUM(CASE WHEN MAX_REV.COST = @FC  THEN ISNULL(MASTER_DATA.RRT5, 0) ELSE 0 END) AS FC_RRT5,
      (SELECT ISNULL(WKH1,0) FROM BG_T_BUDGET_ADJUST WHERE BUDGET_YEAR=@BudgetYear AND PERIOD_TYPE=@PeriodType AND PROJECT_NO=@ProjectNo AND REV_NO= @RevNo) AS WB_ORIGINAL_1ST_HALF,
      0 AS WB_ACTUAL_M1,
      0 AS WB_ACTUAL_M2,
      0 AS WB_ACTUAL_M3,
      SUM(ROUND(ISNULL(MIN_REV.M4,0),2) - ROUND(ISNULL(ESTIMATE_BUDGET.M4, 0),2)) AS WB_ESTIMATE_M4,
      SUM(ROUND(ISNULL(MIN_REV.M5,0),2) - ROUND(ISNULL(ESTIMATE_BUDGET.M5, 0),2)) AS WB_ESTIMATE_M5,
      SUM(ROUND(ISNULL(MIN_REV.M6,0),2) - ROUND(ISNULL(ESTIMATE_BUDGET.M6, 0),2)) AS WB_ESTIMATE_M6,
      0 AS WB_ESTIMATE_1ST_HALF,
      0 AS WB_DIFF_1ST_HALF,
      (SELECT ISNULL(WKH2,0) FROM BG_T_BUDGET_ADJUST WHERE BUDGET_YEAR=@BudgetYear AND PERIOD_TYPE=@PeriodType AND PROJECT_NO=@ProjectNo AND REV_NO= @RevNo) AS WB_ORIGINAL_2ND_HALF,
      SUM(ROUND(ISNULL(MIN_REV.M7,0),2) - ROUND(ISNULL(MASTER_DATA.M7, 0),2)) AS WB_REVISE_M7,
      SUM(ROUND(ISNULL(MIN_REV.M8,0),2) - ROUND(ISNULL(MASTER_DATA.M8, 0),2)) AS WB_REVISE_M8,
      SUM(ROUND(ISNULL(MIN_REV.M9,0),2) - ROUND(ISNULL(MASTER_DATA.M9, 0),2)) AS WB_REVISE_M9,
      SUM(ROUND(ISNULL(MIN_REV.M10,0),2) - ROUND(ISNULL(MASTER_DATA.M10, 0),2)) AS WB_REVISE_M10,
      SUM(ROUND(ISNULL(MIN_REV.M11,0),2) - ROUND(ISNULL(MASTER_DATA.M11, 0),2)) AS WB_REVISE_M11,
      SUM(ROUND(ISNULL(MIN_REV.M12,0),2) - ROUND(ISNULL(MASTER_DATA.M12, 0),2)) AS WB_REVISE_M12,
      0 AS WB_REVISE_2ND_HALF,
      0 AS WB_DIFF_2ND_HALF,
      0 AS WB_REVISE_TOTAL_YEAR,
      0 AS WB_DIFF_TOTAL_YEAR,
      --0 AS WB_RRT1,
      SUM(ROUND(ISNULL(MIN_REV.RRT1 ,0),2)) - SUM(ROUND(ISNULL(MASTER_DATA.RRT1 ,0),2)) AS WB_RRT1,
      --0 AS WB_RRT2,
      SUM(ROUND(ISNULL(MIN_REV.RRT2 ,0),2)) - SUM(ROUND(ISNULL(MASTER_DATA.RRT2 ,0),2)) AS WB_RRT2,
      --0 AS WB_RRT3,
      SUM(ROUND(ISNULL(MIN_REV.RRT3 ,0),2)) - SUM(ROUND(ISNULL(MASTER_DATA.RRT3 ,0),2)) AS WB_RRT3,
      --0 AS WB_RRT4,
      SUM(ROUND(ISNULL(MIN_REV.RRT4 ,0),2)) - SUM(ROUND(ISNULL(MASTER_DATA.RRT4 ,0),2)) AS WB_RRT4,
      --0 AS WB_RRT5
      SUM(ROUND(ISNULL(MIN_REV.RRT5 ,0),2)) - SUM(ROUND(ISNULL(MASTER_DATA.RRT5 ,0),2)) AS WB_RRT5
      FROM (
      SELECT BUDGET_DATA.BUDGET_ORDER_NO, BUDGET_DATA.BUDGET_YEAR, BUDGET_DATA.PERIOD_TYPE, BUDGET_DATA.PROJECT_NO,
      BUDGET_ORDER.ACCOUNT_NO, ACC.ACCOUNT_NAME,
      BUDGET_ORDER.BUDGET_TYPE, BUDGET_ORDER.EXPENSE_TYPE, BUDGET_ORDER.COST,
      MAX(BUDGET_DATA.REV_NO) AS REV_NO
      FROM BG_T_BUDGET_DATA AS BUDGET_DATA
      INNER JOIN BG_M_BUDGET_ORDER AS BUDGET_ORDER
      ON BUDGET_ORDER.BUDGET_ORDER_NO = BUDGET_DATA.BUDGET_ORDER_NO AND BUDGET_ORDER.ACTIVE_FLAG = 1
      INNER JOIN BG_M_ACCOUNT AS ACC ON ACC.ACCOUNT_NO = BUDGET_ORDER.ACCOUNT_NO
      WHERE BUDGET_DATA.BUDGET_YEAR = @BudgetYear
      AND BUDGET_DATA.PERIOD_TYPE = @PeriodType
      AND BUDGET_DATA.PROJECT_NO = @ProjectNo
      AND BUDGET_DATA.REV_NO = @RevNo
      AND BUDGET_ORDER.BUDGET_TYPE= 'E'
      GROUP BY BUDGET_DATA.BUDGET_ORDER_NO, BUDGET_DATA.BUDGET_YEAR, BUDGET_DATA.PERIOD_TYPE, BUDGET_DATA.PROJECT_NO,
      BUDGET_ORDER.ACCOUNT_NO, ACC.ACCOUNT_NAME,
      BUDGET_ORDER.BUDGET_TYPE, BUDGET_ORDER.EXPENSE_TYPE, BUDGET_ORDER.COST) AS MAX_REV
      INNER JOIN BG_T_BUDGET_DATA AS MASTER_DATA
      ON MAX_REV.BUDGET_YEAR = MASTER_DATA.BUDGET_YEAR
      AND MAX_REV.PERIOD_TYPE = MASTER_DATA.PERIOD_TYPE
      AND MAX_REV.PROJECT_NO = MASTER_DATA.PROJECT_NO
      AND MAX_REV.BUDGET_ORDER_NO = MASTER_DATA.BUDGET_ORDER_NO
      AND MAX_REV.REV_NO = MASTER_DATA.REV_NO
      LEFT OUTER JOIN BG_T_UPLOAD_DATA AS ORIGINAL_BUDGET
      ON MAX_REV.BUDGET_YEAR = ORIGINAL_BUDGET.BUDGET_YEAR
      AND ORIGINAL_BUDGET.PERIOD_TYPE = @PeriodType
      AND ORIGINAL_BUDGET.PROJECT_NO = @ProjectNo
      AND MAX_REV.BUDGET_ORDER_NO = ORIGINAL_BUDGET.BUDGET_ORDER_NO
      AND ORIGINAL_BUDGET.DATA_TYPE = 1
      LEFT OUTER JOIN BG_T_BUDGET_DATA AS ESTIMATE_BUDGET
      ON MAX_REV.BUDGET_YEAR = ESTIMATE_BUDGET.BUDGET_YEAR
      AND ESTIMATE_BUDGET.PERIOD_TYPE = @PeriodType
      AND ESTIMATE_BUDGET.PROJECT_NO = @ProjectNo
      AND MAX_REV.BUDGET_ORDER_NO = ESTIMATE_BUDGET.BUDGET_ORDER_NO
      AND MAX_REV.REV_NO = ESTIMATE_BUDGET.REV_NO
      LEFT OUTER JOIN BG_T_UPLOAD_DATA AS ACTUAL_DATA
      ON MAX_REV.BUDGET_YEAR = ACTUAL_DATA.BUDGET_YEAR
      AND ACTUAL_DATA.PERIOD_TYPE = @PeriodType
      AND ACTUAL_DATA.PROJECT_NO = @ProjectNo
      AND MAX_REV.BUDGET_ORDER_NO = ACTUAL_DATA.BUDGET_ORDER_NO
      AND ACTUAL_DATA.DATA_TYPE = 2
      INNER JOIN BG_T_BUDGET_DATA AS MIN_REV
      ON MIN_REV.BUDGET_YEAR = MASTER_DATA.BUDGET_YEAR
      AND MIN_REV.PERIOD_TYPE = MASTER_DATA.PERIOD_TYPE
      AND MIN_REV.PROJECT_NO = MASTER_DATA.PROJECT_NO
      AND MIN_REV.BUDGET_ORDER_NO = MASTER_DATA.BUDGET_ORDER_NO
      AND MIN_REV.REV_NO = 1
      LEFT OUTER JOIN BG_T_BUDGET_ADJUST AS BUDGET_ADJUST
      ON MAX_REV.BUDGET_YEAR = BUDGET_ADJUST.BUDGET_YEAR
      AND MAX_REV.PERIOD_TYPE = BUDGET_ADJUST.PERIOD_TYPE
      AND MAX_REV.PROJECT_NO = BUDGET_ADJUST.PROJECT_NO
      AND MAX_REV.REV_NO = BUDGET_ADJUST.REV_NO
      WHERE
      (ISNULL(ORIGINAL_BUDGET.H1,0) &lt;&gt; 0
      OR ISNULL(ORIGINAL_BUDGET.H2,0) &lt;&gt; 0
      OR ISNULL(ACTUAL_DATA.M1, 0) &lt;&gt; 0
      OR ISNULL(ACTUAL_DATA.M2, 0) &lt;&gt; 0
      OR ISNULL(ACTUAL_DATA.M3, 0) &lt;&gt; 0
      OR ISNULL(MASTER_DATA.M4, 0) &lt;&gt; 0
      OR ISNULL(MASTER_DATA.M5, 0) &lt;&gt; 0
      OR ISNULL(MASTER_DATA.M6, 0) &lt;&gt; 0
      OR ISNULL(MASTER_DATA.M7, 0) &lt;&gt; 0
      OR ISNULL(MASTER_DATA.M8, 0) &lt;&gt; 0
      OR ISNULL(MASTER_DATA.M9, 0) &lt;&gt; 0
      OR ISNULL(MASTER_DATA.M10, 0) &lt;&gt; 0
      OR ISNULL(MASTER_DATA.M11, 0) &lt;&gt; 0
      OR ISNULL(MASTER_DATA.M12, 0) &lt;&gt; 0
      OR ISNULL(MASTER_DATA.RRT1 ,0) &lt;&gt; 0
      OR ISNULL(MASTER_DATA.RRT2 ,0) &lt;&gt; 0
      OR ISNULL(MASTER_DATA.RRT3 ,0) &lt;&gt; 0
      OR ISNULL(MASTER_DATA.RRT4 ,0) &lt;&gt; 0
      OR ISNULL(MASTER_DATA.RRT5 ,0) &lt;&gt; 0
      OR ISNULL(MIN_REV.M4, 0) &lt;&gt; 0
      OR ISNULL(MIN_REV.M5, 0) &lt;&gt; 0
      OR ISNULL(MIN_REV.M6, 0) &lt;&gt; 0
      OR ISNULL(MIN_REV.M7, 0) &lt;&gt; 0
      OR ISNULL(MIN_REV.M8, 0) &lt;&gt; 0
      OR ISNULL(MIN_REV.M9, 0) &lt;&gt; 0
      OR ISNULL(MIN_REV.M10, 0) &lt;&gt; 0
      OR ISNULL(MIN_REV.M11, 0) &lt;&gt; 0
      OR ISNULL(MIN_REV.M12, 0) &lt;&gt; 0
      OR ISNULL(MIN_REV.RRT1 ,0) &lt;&gt; 0
      OR ISNULL(MIN_REV.RRT2 ,0) &lt;&gt; 0
      OR ISNULL(MIN_REV.RRT3 ,0) &lt;&gt; 0
      OR ISNULL(MIN_REV.RRT4 ,0) &lt;&gt; 0
      OR ISNULL(MIN_REV.RRT5 ,0) &lt;&gt; 0
      )
      GROUP BY MAX_REV.BUDGET_YEAR, MAX_REV.PERIOD_TYPE, MAX_REV.PROJECT_NO, MAX_REV.ACCOUNT_NO, MAX_REV.ACCOUNT_NAME , MAX_REV.BUDGET_TYPE , MAX_REV.EXPENSE_TYPE
      UNION
      SELECT MAX_REV.BUDGET_YEAR, MAX_REV.PERIOD_TYPE, MAX_REV.PROJECT_NO, MAX_REV.ACCOUNT_NO , MAX_REV.ACCOUNT_NAME , MAX_REV.BUDGET_TYPE , MAX_REV.EXPENSE_TYPE,
      0 AS ORIGINAL_1ST_HALF,
      0 AS ACTUAL_M1,
      0 AS ACTUAL_M2,
      0 AS ACTUAL_M3,
      0 AS ESTIMATE_M4,
      0 AS ESTIMATE_M5,
      0 AS ESTIMATE_M6,
      0 AS ESTIMATE_1ST_HALF,
      0 AS DIFF_1ST_HALF,
      0 AS ORIGINAL_2ND_HALF,
      0 AS REVISE_M7, 0 AS REVISE_M8, 0 AS REVISE_M9,
      0 AS REVISE_M10, 0 AS REVISE_M11, 0 AS REVISE_M12,
      0 AS REVISE_2ND_HALF,
      0 AS DIFF_2ND_HALF,
      0 AS REVISE_TOTAL_YEAR,
      0 AS DIFF_TOTAL_YEAR,
      0 AS RRT1,
      0 AS RRT2,
      0 AS RRT3,
      0 AS RRT4,
      0 AS RRT5,
      SUM(ISNULL(ORIGINAL_BUDGET.H1,0) ) AS INVESTMENT_ORIGINAL_1ST_HALF,
      SUM(ISNULL(ACTUAL_DATA.M1, 0) ) AS INVESTMENT_ACTUAL_JAN,
      SUM(ISNULL(ACTUAL_DATA.M2, 0) ) AS INVESTMENT_ACTUAL_FEB,
      SUM(ISNULL(ACTUAL_DATA.M3, 0) ) AS INVESTMENT_ACTUAL_MAR,
      SUM(ISNULL(ESTIMATE_BUDGET.M4, 0) ) AS INVESTMENT_ESTIMATE_APR,
      SUM(ISNULL(ESTIMATE_BUDGET.M5, 0) ) AS INVESTMENT_ESTIMATE_MAY,
      SUM(ISNULL(ESTIMATE_BUDGET.M6, 0) ) AS INVESTMENT_ESTIMATE_JUN,
      SUM(ISNULL(ORIGINAL_BUDGET.H2,0) ) AS INVESTMENT_ORIGINAL_2ND_HALF,
      SUM(ISNULL(MASTER_DATA.M7, 0) ) AS INVESTMENT_REVISE_JUL,
      SUM(ISNULL(MASTER_DATA.M8, 0) ) AS INVESTMENT_REVISE_AUG,
      SUM(ISNULL(MASTER_DATA.M9, 0) ) AS INVESTMENT_REVISE_SEP,
      SUM(ISNULL(MASTER_DATA.M10, 0) ) AS INVESTMENT_REVISE_OCT,
      SUM(ISNULL(MASTER_DATA.M11, 0) ) AS INVESTMENT_REVISE_NOV,
      SUM(ISNULL(MASTER_DATA.M12, 0) ) AS INVESTMENT_REVISE_DEC,

      --SUM(ISNULL(MASTER_DATA.RRT1 ,0) ) AS INVESTMENT_RRT1,
      (SELECT ISNULL(MTP_SUM1 ,0) FROM BG_T_BUDGET_ADJUST2
      WHERE BUDGET_YEAR=@BudgetYear
      AND PERIOD_TYPE = @PeriodType
      AND PROJECT_NO = @ProjectNo
      AND REV_NO= (SELECT MAX(BUDGET_DATA.REV_NO) AS REV_NO
      FROM BG_T_BUDGET_DATA AS BUDGET_DATA
      INNER JOIN BG_M_BUDGET_ORDER AS BUDGET_ORDER
      ON BUDGET_ORDER.BUDGET_ORDER_NO = BUDGET_DATA.BUDGET_ORDER_NO
      AND BUDGET_ORDER.ACTIVE_FLAG = 1
      WHERE BUDGET_DATA.BUDGET_YEAR = @BudgetYear
      AND BUDGET_DATA.PERIOD_TYPE = @PeriodType
      AND BUDGET_DATA.PROJECT_NO = @ProjectNo
      AND BUDGET_DATA.REV_NO = @RevNo
      AND BUDGET_ORDER.BUDGET_TYPE= 'A')
      ) AS INVESTMENT_RRT1,

      ----SUM(ISNULL(MASTER_DATA.RRT2 ,0) ) AS INVESTMENT_RRT2,
      (SELECT ISNULL(MTP_SUM2 ,0) FROM BG_T_BUDGET_ADJUST2
      WHERE BUDGET_YEAR=@BudgetYear
      AND PERIOD_TYPE = @PeriodType
      AND PROJECT_NO = @ProjectNo
      AND REV_NO= (SELECT MAX(BUDGET_DATA.REV_NO) AS REV_NO
      FROM BG_T_BUDGET_DATA AS BUDGET_DATA
      INNER JOIN BG_M_BUDGET_ORDER AS BUDGET_ORDER
      ON BUDGET_ORDER.BUDGET_ORDER_NO = BUDGET_DATA.BUDGET_ORDER_NO
      AND BUDGET_ORDER.ACTIVE_FLAG = 1
      WHERE BUDGET_DATA.BUDGET_YEAR = @BudgetYear
      AND BUDGET_DATA.PERIOD_TYPE = @PeriodType
      AND BUDGET_DATA.PROJECT_NO = @ProjectNo
      AND BUDGET_DATA.REV_NO = @RevNo
      AND BUDGET_ORDER.BUDGET_TYPE= 'A')
      ) AS INVESTMENT_RRT2,

      ----SUM(ISNULL(MASTER_DATA.RRT3 ,0) ) AS INVESTMENT_RRT3,
      (SELECT ISNULL(MTP_SUM3 ,0) FROM BG_T_BUDGET_ADJUST2
      WHERE BUDGET_YEAR=@BudgetYear
      AND PERIOD_TYPE = @PeriodType
      AND PROJECT_NO = @ProjectNo
      AND REV_NO= (SELECT MAX(BUDGET_DATA.REV_NO) AS REV_NO
      FROM BG_T_BUDGET_DATA AS BUDGET_DATA
      INNER JOIN BG_M_BUDGET_ORDER AS BUDGET_ORDER
      ON BUDGET_ORDER.BUDGET_ORDER_NO = BUDGET_DATA.BUDGET_ORDER_NO
      AND BUDGET_ORDER.ACTIVE_FLAG = 1
      WHERE BUDGET_DATA.BUDGET_YEAR = @BudgetYear
      AND BUDGET_DATA.PERIOD_TYPE = @PeriodType
      AND BUDGET_DATA.PROJECT_NO = @ProjectNo
      AND BUDGET_DATA.REV_NO = @RevNo
      AND BUDGET_ORDER.BUDGET_TYPE= 'A')
      ) AS INVESTMENT_RRT3,

      ----SUM(ISNULL(MASTER_DATA.RRT4 ,0) ) AS INVESTMENT_RRT4,
      (SELECT ISNULL(MTP_SUM4 ,0) FROM BG_T_BUDGET_ADJUST2
      WHERE BUDGET_YEAR=@BudgetYear
      AND PERIOD_TYPE = @PeriodType
      AND PROJECT_NO = @ProjectNo
      AND REV_NO= (SELECT MAX(BUDGET_DATA.REV_NO) AS REV_NO
      FROM BG_T_BUDGET_DATA AS BUDGET_DATA
      INNER JOIN BG_M_BUDGET_ORDER AS BUDGET_ORDER
      ON BUDGET_ORDER.BUDGET_ORDER_NO = BUDGET_DATA.BUDGET_ORDER_NO
      AND BUDGET_ORDER.ACTIVE_FLAG = 1
      WHERE BUDGET_DATA.BUDGET_YEAR = @BudgetYear
      AND BUDGET_DATA.PERIOD_TYPE = @PeriodType
      AND BUDGET_DATA.PROJECT_NO = @ProjectNo
      AND BUDGET_DATA.REV_NO = @RevNo
      AND BUDGET_ORDER.BUDGET_TYPE= 'A')
      ) AS INVESTMENT_RRT4,

      ----SUM(ISNULL(MASTER_DATA.RRT5 ,0) ) AS INVESTMENT_RRT5,
      (SELECT ISNULL(MTP_SUM5 ,0) FROM BG_T_BUDGET_ADJUST2
      WHERE BUDGET_YEAR=@BudgetYear
      AND PERIOD_TYPE = @PeriodType
      AND PROJECT_NO = @ProjectNo
      AND REV_NO= (SELECT MAX(BUDGET_DATA.REV_NO) AS REV_NO
      FROM BG_T_BUDGET_DATA AS BUDGET_DATA
      INNER JOIN BG_M_BUDGET_ORDER AS BUDGET_ORDER
      ON BUDGET_ORDER.BUDGET_ORDER_NO = BUDGET_DATA.BUDGET_ORDER_NO
      AND BUDGET_ORDER.ACTIVE_FLAG = 1
      WHERE BUDGET_DATA.BUDGET_YEAR = @BudgetYear
      AND BUDGET_DATA.PERIOD_TYPE = @PeriodType
      AND BUDGET_DATA.PROJECT_NO = @ProjectNo
      AND BUDGET_DATA.REV_NO = @RevNo
      AND BUDGET_ORDER.BUDGET_TYPE= 'A')
      ) AS INVESTMENT_RRT5,

      0 AS ADMIN_ORIGINAL_1ST_HALF,
      0 AS FC_ORIGINAL_1ST_HALF,
      0 AS ADMIN_ACTUAL_M1,
      0 AS FC_ACTUAL_M1,
      0 AS ADMIN_ACTUAL_M2,
      0 AS FC_ACTUAL_M2,
      0 AS ADMIN_ACTUAL_M3,
      0 AS FC_ACTUAL_M3,
      0 AS ADMIN_ESTIMATE_M4,
      0 AS FC_ESTIMATE_M4,
      0 AS ADMIN_ESTIMATE_M5,
      0 AS FC_ESTIMATE_M5,
      0 AS ADMIN_ESTIMATE_M6,
      0 AS FC_ESTIMATE_M6,
      0 AS ADMIN_ESTIMATE_1ST_HALF,
      0 AS FC_ESTIMATE_1ST_HALF,
      0 AS ADMIN_DIFF_1ST_HALF,
      0 AS FC_DIFF_1ST_HALF,
      0 AS ADMIN_ORIGINAL_2ND_HALF,
      0 AS FC_ORIGINAL_2ND_HALF,
      0 AS ADMIN_REVISE_M7,
      0 AS FC_REVISE_M7,
      0 AS ADMIN_REVISE_M8,
      0 AS FC_REVISE_M8,
      0 AS ADMIN_REVISE_M9,
      0 AS FC_REVISE_M9,
      0 AS ADMIN_REVISE_M10,
      0 AS FC_REVISE_M10,
      0 AS ADMIN_REVISE_M11,
      0 AS FC_REVISE_M11,
      0 AS ADMIN_REVISE_M12,
      0 AS FC_REVISE_M12,
      0 AS ADMIN_REVISE_2ND_HALF,
      0 AS FC_REVISE_2ND_HALF,
      0 AS ADMIN_DIFF_2ND_HALF,
      0 AS FC_DIFF_2ND_HALF,
      0 AS ADMIN_REVISE_TOTAL_YEAR,
      0 AS FC_REVISE_TOTAL_YEAR,
      0 AS ADMIN_DIFF_TOTAL_YEAR,
      0 AS FC_DIFF_TOTAL_YEAR,
      0 AS ADMIN_RRT1,
      0 AS FC_RRT1,
      0 AS ADMIN_RRT2,
      0 AS FC_RRT2,
      0 AS ADMIN_RRT3,
      0 AS FC_RRT3,
      0 AS ADMIN_RRT4,
      0 AS FC_RRT4,
      0 AS ADMIN_RRT5,
      0 AS FC_RRT5,
      0 AS WB_ORIGINAL_1ST_HALF,
      0 AS WB_ACTUAL_M1,
      0 AS WB_ACTUAL_M2,
      0 AS WB_ACTUAL_M3,
      0 AS WB_ESTIMATE_M4,
      0 AS WB_ESTIMATE_M5,
      0 AS WB_ESTIMATE_M6,
      0 AS WB_ESTIMATE_1ST_HALF,
      0 AS WB_DIFF_1ST_HALF,
      0 AS WB_ORIGINAL_2ND_HALF,
      0 AS WB_REVISE_M7,
      0 AS WB_REVISE_M8,
      0 AS WB_REVISE_M9,
      0 AS WB_REVISE_M10,
      0 AS WB_REVISE_M11,
      0 AS WB_REVISE_M12,
      0 AS WB_REVISE_2ND_HALF,
      0 AS WB_DIFF_2ND_HALF,
      0 AS WB_REVISE_TOTAL_YEAR,
      0 AS WB_DIFF_TOTAL_YEAR,
      0 AS WB_RRT1,
      0 AS WB_RRT2,
      0 AS WB_RRT3,
      0 AS WB_RRT4,
      0 AS WB_RRT5
      FROM (
      SELECT BUDGET_DATA.BUDGET_ORDER_NO, BUDGET_DATA.BUDGET_YEAR, BUDGET_DATA.PERIOD_TYPE, BUDGET_DATA.PROJECT_NO,
      BUDGET_ORDER.ACCOUNT_NO, ACC.ACCOUNT_NAME,
      BUDGET_ORDER.BUDGET_TYPE, BUDGET_ORDER.EXPENSE_TYPE, BUDGET_ORDER.COST,
      MAX(BUDGET_DATA.REV_NO) AS REV_NO
      FROM BG_T_BUDGET_DATA AS BUDGET_DATA
      INNER JOIN BG_M_BUDGET_ORDER AS BUDGET_ORDER
      ON BUDGET_ORDER.BUDGET_ORDER_NO = BUDGET_DATA.BUDGET_ORDER_NO AND BUDGET_ORDER.ACTIVE_FLAG = 1
      INNER JOIN BG_M_ACCOUNT AS ACC ON ACC.ACCOUNT_NO = BUDGET_ORDER.ACCOUNT_NO
      WHERE BUDGET_DATA.BUDGET_YEAR = @BudgetYear
      AND BUDGET_DATA.PERIOD_TYPE = @PeriodType
      AND BUDGET_DATA.PROJECT_NO = @ProjectNo
      AND BUDGET_DATA.REV_NO = (SELECT MAX(BUDGET_DATA.REV_NO) AS REV_NO
      FROM BG_T_BUDGET_DATA AS BUDGET_DATA
      INNER JOIN BG_M_BUDGET_ORDER AS BUDGET_ORDER
      ON BUDGET_ORDER.BUDGET_ORDER_NO = BUDGET_DATA.BUDGET_ORDER_NO
      AND BUDGET_ORDER.ACTIVE_FLAG = 1
      WHERE BUDGET_DATA.BUDGET_YEAR = @BudgetYear
      AND BUDGET_DATA.PERIOD_TYPE = @PeriodType
      AND BUDGET_DATA.PROJECT_NO = @ProjectNo
      AND BUDGET_ORDER.BUDGET_TYPE= 'A')
      AND BUDGET_ORDER.BUDGET_TYPE= 'A'
      GROUP BY BUDGET_DATA.BUDGET_ORDER_NO, BUDGET_DATA.BUDGET_YEAR, BUDGET_DATA.PERIOD_TYPE, BUDGET_DATA.PROJECT_NO,
      BUDGET_ORDER.ACCOUNT_NO, ACC.ACCOUNT_NAME,
      BUDGET_ORDER.BUDGET_TYPE, BUDGET_ORDER.EXPENSE_TYPE, BUDGET_ORDER.COST) AS MAX_REV
      INNER JOIN BG_T_BUDGET_DATA AS MASTER_DATA
      ON MAX_REV.BUDGET_YEAR = MASTER_DATA.BUDGET_YEAR
      AND MAX_REV.PERIOD_TYPE = MASTER_DATA.PERIOD_TYPE
      AND MAX_REV.PROJECT_NO = MASTER_DATA.PROJECT_NO
      AND MAX_REV.BUDGET_ORDER_NO = MASTER_DATA.BUDGET_ORDER_NO
      AND MAX_REV.REV_NO = MASTER_DATA.REV_NO
      LEFT OUTER JOIN BG_T_UPLOAD_DATA AS ORIGINAL_BUDGET
      ON MAX_REV.BUDGET_YEAR = ORIGINAL_BUDGET.BUDGET_YEAR
      AND ORIGINAL_BUDGET.PERIOD_TYPE = @PeriodType
      AND ORIGINAL_BUDGET.PROJECT_NO = @ProjectNo
      AND MAX_REV.BUDGET_ORDER_NO = ORIGINAL_BUDGET.BUDGET_ORDER_NO
      AND ORIGINAL_BUDGET.DATA_TYPE = 1
      LEFT OUTER JOIN BG_T_BUDGET_DATA AS ESTIMATE_BUDGET
      ON MAX_REV.BUDGET_YEAR = ESTIMATE_BUDGET.BUDGET_YEAR
      AND ESTIMATE_BUDGET.PERIOD_TYPE = @PeriodType
      AND ESTIMATE_BUDGET.PROJECT_NO = @ProjectNo
      AND MAX_REV.BUDGET_ORDER_NO = ESTIMATE_BUDGET.BUDGET_ORDER_NO
      AND MAX_REV.REV_NO = ESTIMATE_BUDGET.REV_NO
      LEFT OUTER JOIN BG_T_UPLOAD_DATA AS ACTUAL_DATA
      ON MAX_REV.BUDGET_YEAR = ACTUAL_DATA.BUDGET_YEAR
      AND ACTUAL_DATA.PERIOD_TYPE = @PeriodType
      AND ACTUAL_DATA.PROJECT_NO = @ProjectNo
      AND MAX_REV.BUDGET_ORDER_NO = ACTUAL_DATA.BUDGET_ORDER_NO
      AND ACTUAL_DATA.DATA_TYPE = 2
      INNER JOIN BG_T_BUDGET_DATA AS MIN_REV
      ON MIN_REV.BUDGET_YEAR = MASTER_DATA.BUDGET_YEAR
      AND MIN_REV.PERIOD_TYPE = MASTER_DATA.PERIOD_TYPE
      AND MIN_REV.PROJECT_NO = MASTER_DATA.PROJECT_NO
      AND MIN_REV.BUDGET_ORDER_NO = MASTER_DATA.BUDGET_ORDER_NO
      AND MIN_REV.REV_NO = 1
      LEFT OUTER JOIN BG_T_BUDGET_ADJUST AS BUDGET_ADJUST
      ON MAX_REV.BUDGET_YEAR = BUDGET_ADJUST.BUDGET_YEAR
      AND MAX_REV.PERIOD_TYPE = BUDGET_ADJUST.PERIOD_TYPE
      AND MAX_REV.PROJECT_NO = BUDGET_ADJUST.PROJECT_NO
      AND MAX_REV.REV_NO = BUDGET_ADJUST.REV_NO
      WHERE
      (ISNULL(ORIGINAL_BUDGET.H1,0) &lt;&gt; 0
      OR ISNULL(ORIGINAL_BUDGET.H2,0) &lt;&gt; 0
      OR ISNULL(ACTUAL_DATA.M1, 0) &lt;&gt; 0
      OR ISNULL(ACTUAL_DATA.M2, 0) &lt;&gt; 0
      OR ISNULL(ACTUAL_DATA.M3, 0) &lt;&gt; 0
      OR ISNULL(MASTER_DATA.M4, 0) &lt;&gt; 0
      OR ISNULL(MASTER_DATA.M5, 0) &lt;&gt; 0
      OR ISNULL(MASTER_DATA.M6, 0) &lt;&gt; 0
      OR ISNULL(MASTER_DATA.M7, 0) &lt;&gt; 0
      OR ISNULL(MASTER_DATA.M8, 0) &lt;&gt; 0
      OR ISNULL(MASTER_DATA.M9, 0) &lt;&gt; 0
      OR ISNULL(MASTER_DATA.M10, 0) &lt;&gt; 0
      OR ISNULL(MASTER_DATA.M11, 0) &lt;&gt; 0
      OR ISNULL(MASTER_DATA.M12, 0) &lt;&gt; 0
      )
      GROUP BY MAX_REV.BUDGET_YEAR, MAX_REV.PERIOD_TYPE, MAX_REV.PROJECT_NO, MAX_REV.ACCOUNT_NO, MAX_REV.ACCOUNT_NAME , MAX_REV.BUDGET_TYPE , MAX_REV.EXPENSE_TYPE
    </SELECT015_6>
    <SELECT018>
      SELECT ISNULL(WORKING_BG1,0) AS WORKING_BG1,ISNULL(WORKING_BG2,0) AS WORKING_BG2
      FROM BG_T_BUDGET_ADJUST
      WHERE BG_T_BUDGET_ADJUST.BUDGET_YEAR = @BudgetYear
      AND BG_T_BUDGET_ADJUST.PERIOD_TYPE = @PeriodType
      AND BG_T_BUDGET_ADJUST.PROJECT_NO = @ProjectNo
      AND BG_T_BUDGET_ADJUST.REV_NO =
      (
      SELECT
      MAX(REV_NO) AS REV_NO
      FROM BG_T_BUDGET_ADJUST
      WHERE BUDGET_YEAR = @BudgetYear
      AND PERIOD_TYPE =  @PeriodType
      AND PROJECT_NO = @ProjectNo
      )
    </SELECT018>
    <SELECT019>
      SELECT * FROM BG_T_BUDGET_DATA
      WHERE BUDGET_YEAR = @BudgetYear AND PERIOD_TYPE = @PeriodType AND
      BUDGET_ORDER_NO = '@BudgetOrderNo' AND REV_NO = @RevNo AND PROJECT_NO = @ProjectNo
    </SELECT019>
    <SELECT020>
      SELECT
      BD.*,
      (BD.M1+BD.M2+BD.M3+BD.M4+BD.M5+BD.M6) AS H1,
      (BD.M7+BD.M8+BD.M9+BD.M10+BD.M11+BD.M12) AS H2,
      (BD.M1+BD.M2+BD.M3+BD.M4+BD.M5+BD.M6+BD.M7+BD.M8+BD.M9+BD.M10+BD.M11+BD.M12) AS Y1,
      BO.BUDGET_ORDER_NAME,
      AC.ACCOUNT_NO, AC.ACCOUNT_NAME,
      BO.COST, BO.COST_TYPE, DP.DEPT_NO, DP.DEPT_NAME,
      PIC.PERSON_IN_CHARGE_NO, PIC.PERSON_IN_CHARGE_NAME,
      ISNULL(MTP.RRT2,0) AS MTP_RRT1,

      --(ISNULL((SELECT ISNULL(ISNULL(M10,0)+ISNULL(M11,0)+ISNULL(M12,0),0)
      --FROM BG_T_BUDGET_DATA
      --WHERE BUDGET_YEAR = (@BudgetYear-1)
      --AND PERIOD_TYPE = 2
      --AND REV_NO = (SELECT MAX(REV_NO) AS REV_NO FROM BG_T_BUDGET_DATA WHERE BUDGET_YEAR = (@BudgetYear-1) AND PERIOD_TYPE = 2 AND PROJECT_NO = @ProjectNo)
      --AND PROJECT_NO = @ProjectNo
      --AND BUDGET_ORDER_NO = BD.BUDGET_ORDER_NO),0)+
      --ISNULL((SELECT ISNULL(M7,0)+ISNULL(M8,0)+ISNULL(M9,0)
      --FROM BG_T_UPLOAD_DATA
      --WHERE BUDGET_YEAR = (@BudgetYear-1)
      --AND PERIOD_TYPE = 2
      --AND PROJECT_NO = @ProjectNo
      --AND DATA_TYPE = 2
      --AND BUDGET_ORDER_NO = BD.BUDGET_ORDER_NO),0)) AS IMP2

      (ISNULL((SELECT ISNULL(ISNULL(M10,0)+ISNULL(M11,0)+ISNULL(M12,0),0)
      FROM BG_T_BUDGET_DATA
      WHERE BUDGET_YEAR = (@BudgetYear-1)
      AND PERIOD_TYPE = 2
      AND REV_NO = @RefEstRevNo
      AND PROJECT_NO = @RefEstProjectNo
      AND BUDGET_ORDER_NO = BD.BUDGET_ORDER_NO),0) +
      ISNULL((SELECT ISNULL(M7,0)+ISNULL(M8,0)+ISNULL(M9,0)
      FROM BG_T_UPLOAD_DATA
      WHERE BUDGET_YEAR = (@BudgetYear-1)
      AND PERIOD_TYPE = 2
      AND PROJECT_NO = @RefEstProjectNo
      AND DATA_TYPE = 2
      AND BUDGET_ORDER_NO = BD.BUDGET_ORDER_NO),0)) AS IMP2

      FROM
      BG_T_BUDGET_DATA AS BD
      LEFT JOIN BG_M_BUDGET_ORDER AS BO ON BD.BUDGET_ORDER_NO = BO.BUDGET_ORDER_NO
      LEFT JOIN BG_M_ACCOUNT AS AC ON BO.ACCOUNT_NO = AC.ACCOUNT_NO
      LEFT JOIN BG_M_DEPT AS DP ON BO.DEPT_NO = DP.DEPT_NO
      LEFT JOIN BG_M_PERSON_IN_CHARGE AS PIC ON BO.PERSON_IN_CHARGE_NO = PIC.PERSON_IN_CHARGE_NO
      LEFT JOIN BG_T_BUDGET_PERIOD AS BP ON BD.BUDGET_YEAR = BP.BUDGET_YEAR AND BD.PERIOD_TYPE = BP.PERIOD_TYPE AND BD.PROJECT_NO = BP.PROJECT_NO
      --LEFT JOIN BG_T_BUDGET_DATA AS MTP ON BD.BUDGET_ORDER_NO = MTP.BUDGET_ORDER_NO AND MTP.BUDGET_YEAR=(@BudgetYear-1) AND MTP.PERIOD_TYPE = 10 AND MTP.PROJECT_NO = @MtpProjectNo AND MTP.REV_NO = '@MtpRevNo'
      LEFT JOIN BG_T_BUDGET_DATA AS MTP ON BD.BUDGET_ORDER_NO = MTP.BUDGET_ORDER_NO AND MTP.BUDGET_YEAR=@RefBudgetYear AND MTP.PERIOD_TYPE = @RefPeriodType AND MTP.PROJECT_NO = @RefProjectNo AND MTP.REV_NO = @RefRevNo

      WHERE
      BD.BUDGET_YEAR = @BudgetYear AND BD.PERIOD_TYPE = @PeriodType AND BO.BUDGET_TYPE = '@BudgetType' AND BD.REV_NO = @RevNo AND BD.PROJECT_NO = @ProjectNo AND
      BO.ACTIVE_FLAG = 1 AND BO.PERSON_IN_CHARGE_NO = '@UserPIC' AND
      (BP.CLOSE_FLAG = 0 OR (BP.CLOSE_FLAG = 1 AND AC.ACCOUNT_NO IN
      (SELECT ACCOUNT_NO FROM BG_T_ACCOUNT_REOPEN WHERE BUDGET_YEAR = @BudgetYear AND PERIOD_TYPE = @PeriodType AND PROJECT_NO = @ProjectNo AND PERSON_IN_CHARGE_NO = '@UserPIC')))
      ORDER BY BD.BUDGET_ORDER_NO
    </SELECT020>
    <SELECT021>
      SELECT
      BD.*,
      (BD.M1+BD.M2+BD.M3+BD.M4+BD.M5+BD.M6) AS H1,
      (BD.M7+BD.M8+BD.M9+BD.M10+BD.M11+BD.M12) AS H2,
      (BD.M1+BD.M2+BD.M3+BD.M4+BD.M5+BD.M6+BD.M7+BD.M8+BD.M9+BD.M10+BD.M11+BD.M12) AS Y1,
      BO.BUDGET_ORDER_NAME,
      AC.ACCOUNT_NO, AC.ACCOUNT_NAME,
      BO.COST, BO.COST_TYPE, DP.DEPT_NO, DP.DEPT_NAME,
      PIC.PERSON_IN_CHARGE_NO, PIC.PERSON_IN_CHARGE_NAME,
      ISNULL(MTP.RRT2,0) AS MTP_RRT1,

      --(ISNULL((SELECT ISNULL(ISNULL(M10,0)+ISNULL(M11,0)+ISNULL(M12,0),0)
      --FROM BG_T_BUDGET_DATA
      --WHERE BUDGET_YEAR = (@BudgetYear-1)
      --AND PERIOD_TYPE = 2
      --AND REV_NO = (SELECT MAX(REV_NO) AS REV_NO FROM BG_T_BUDGET_DATA WHERE BUDGET_YEAR = (@BudgetYear-1) AND PERIOD_TYPE = 2 AND PROJECT_NO = @ProjectNo)
      --AND PROJECT_NO = @ProjectNo
      --AND BUDGET_ORDER_NO = BD.BUDGET_ORDER_NO),0)+
      --ISNULL((SELECT ISNULL(M7,0)+ISNULL(M8,0)+ISNULL(M9,0)
      --FROM BG_T_UPLOAD_DATA
      --WHERE BUDGET_YEAR = (@BudgetYear-1)
      --AND PERIOD_TYPE = 2
      --AND PROJECT_NO = @ProjectNo
      --AND DATA_TYPE = 2
      --AND BUDGET_ORDER_NO = BD.BUDGET_ORDER_NO),0)) AS IMP2

      (ISNULL((SELECT ISNULL(ISNULL(M10,0)+ISNULL(M11,0)+ISNULL(M12,0),0)
      FROM BG_T_BUDGET_DATA
      WHERE BUDGET_YEAR = (@BudgetYear-1)
      AND PERIOD_TYPE = 2
      AND REV_NO = @RefEstRevNo
      AND PROJECT_NO = @RefEstProjectNo
      AND BUDGET_ORDER_NO = BD.BUDGET_ORDER_NO),0) +
      ISNULL((SELECT ISNULL(M7,0)+ISNULL(M8,0)+ISNULL(M9,0)
      FROM BG_T_UPLOAD_DATA
      WHERE BUDGET_YEAR = (@BudgetYear-1)
      AND PERIOD_TYPE = 2
      AND PROJECT_NO = @RefEstProjectNo
      AND DATA_TYPE = 2
      AND BUDGET_ORDER_NO = BD.BUDGET_ORDER_NO),0)) AS IMP2

      FROM
      BG_T_BUDGET_DATA AS BD
      LEFT JOIN BG_M_BUDGET_ORDER AS BO ON BD.BUDGET_ORDER_NO = BO.BUDGET_ORDER_NO
      LEFT JOIN BG_M_ACCOUNT AS AC ON BO.ACCOUNT_NO = AC.ACCOUNT_NO
      LEFT JOIN BG_M_DEPT AS DP ON BO.DEPT_NO = DP.DEPT_NO
      LEFT JOIN BG_M_PERSON_IN_CHARGE AS PIC ON BO.PERSON_IN_CHARGE_NO = PIC.PERSON_IN_CHARGE_NO
      LEFT JOIN BG_T_BUDGET_PERIOD AS BP ON BD.BUDGET_YEAR = BP.BUDGET_YEAR AND BD.PERIOD_TYPE = BP.PERIOD_TYPE AND BD.PROJECT_NO = BP.PROJECT_NO
      --LEFT JOIN BG_T_BUDGET_DATA AS MTP ON BD.BUDGET_ORDER_NO = MTP.BUDGET_ORDER_NO AND MTP.BUDGET_YEAR=(@BudgetYear-1) AND MTP.PERIOD_TYPE = 10 AND MTP.PROJECT_NO = @MtpProjectNo AND MTP.REV_NO = '@MtpRevNo'
      LEFT JOIN BG_T_BUDGET_DATA AS MTP ON BD.BUDGET_ORDER_NO = MTP.BUDGET_ORDER_NO AND MTP.BUDGET_YEAR=@RefBudgetYear AND MTP.PERIOD_TYPE = @RefPeriodType AND MTP.PROJECT_NO = @RefProjectNo AND MTP.REV_NO = @RefRevNo

      WHERE
      BD.BUDGET_YEAR = @BudgetYear AND BD.PERIOD_TYPE = @PeriodType AND BO.BUDGET_TYPE = '@BudgetType' AND BD.REV_NO = @RevNo AND BD.PROJECT_NO = @ProjectNo AND
      BO.ACTIVE_FLAG = 1 AND
      (BP.CLOSE_FLAG = 0 OR (BP.CLOSE_FLAG = 1 AND AC.ACCOUNT_NO IN
      (SELECT ACCOUNT_NO FROM BG_T_ACCOUNT_REOPEN WHERE BUDGET_YEAR = @BudgetYear AND PERIOD_TYPE = @PeriodType AND PROJECT_NO = @ProjectNo)))
      ORDER BY BD.BUDGET_ORDER_NO
    </SELECT021>
    <SELECT022>
      SELECT  SUM(M1) + SUM(M2) + SUM(M3) + SUM(M4) + SUM(M5)  + SUM(M6) +
      SUM(M7) + SUM(M8) + SUM(M9) + SUM(M10) + SUM(M11) + SUM(M12) AS TOTAL
      FROM BG_T_BUDGET_DATA WHERE BUDGET_ORDER_NO = '@BudgetOrderNo'
    </SELECT022>
    <SELECT023>
      SELECT
      BD.*,
      (BD.M1+BD.M2+BD.M3+BD.M4+BD.M5+BD.M6) AS H1,
      (BD.M7+BD.M8+BD.M9+BD.M10+BD.M11+BD.M12) AS H2,
      (BD.M1+BD.M2+BD.M3+BD.M4+BD.M5+BD.M6+BD.M7+BD.M8+BD.M9+BD.M10+BD.M11+BD.M12) AS Y1,
      BO.BUDGET_ORDER_NAME,
      AC.ACCOUNT_NO, AC.ACCOUNT_NAME,
      BO.COST, BO.COST_TYPE, DP.DEPT_NO, DP.DEPT_NAME,
      PIC.PERSON_IN_CHARGE_NO, PIC.PERSON_IN_CHARGE_NAME,
      (ISNULL(OB_BUDGET_DATA.M1,0)+ISNULL(OB_BUDGET_DATA.M2,0)+ISNULL(OB_BUDGET_DATA.M3,0)+ISNULL(OB_BUDGET_DATA.M4,0)+ISNULL(OB_BUDGET_DATA.M5,0)+ISNULL(OB_BUDGET_DATA.M6,0)+ISNULL(OB_BUDGET_DATA.M7,0)+ISNULL(OB_BUDGET_DATA.M8,0)+ISNULL(OB_BUDGET_DATA.M9,0)+ISNULL(OB_BUDGET_DATA.M10,0)+ISNULL(OB_BUDGET_DATA.M11,0)+ISNULL(OB_BUDGET_DATA.M12,0)) AS RevYear,
      ISNULL(PREVBD.RRT1,0) AS PrevRRT1,
      ISNULL(PREVBD.RRT2,0) AS PrevRRT2,
      ISNULL(PREVBD.RRT3,0) AS PrevRRT3,
      ISNULL(PREVBD.RRT4,0) AS PrevRRT4,
      ISNULL(PREVBD.RRT5,0) AS PrevRRT5,
      ISNULL(PREVBD1.RRT5,0) AS Prev1RRT5
      FROM
      BG_T_BUDGET_DATA AS BD
      LEFT JOIN BG_M_BUDGET_ORDER AS BO ON BD.BUDGET_ORDER_NO = BO.BUDGET_ORDER_NO
      LEFT JOIN BG_M_ACCOUNT AS AC ON BO.ACCOUNT_NO = AC.ACCOUNT_NO
      LEFT JOIN BG_M_DEPT AS DP ON BO.DEPT_NO = DP.DEPT_NO
      LEFT JOIN BG_M_PERSON_IN_CHARGE AS PIC ON BO.PERSON_IN_CHARGE_NO = PIC.PERSON_IN_CHARGE_NO
      LEFT JOIN BG_T_BUDGET_PERIOD AS BP ON BD.BUDGET_YEAR = BP.BUDGET_YEAR AND BD.PERIOD_TYPE = BP.PERIOD_TYPE AND BD.PROJECT_NO = BP.PROJECT_NO
      --LEFT JOIN BG_T_BUDGET_DATA RVBD ON BD.BUDGET_YEAR = RVBD.BUDGET_YEAR AND RVBD.PROJECT_NO = 1 AND BD.BUDGET_ORDER_NO = RVBD.BUDGET_ORDER_NO
      --AND  RVBD.PERIOD_TYPE = 3 AND RVBD.REV_NO = @ReviseRevNo
      LEFT JOIN BG_T_BUDGET_DATA RVBD ON BD.BUDGET_YEAR = RVBD.BUDGET_YEAR AND RVBD.PROJECT_NO = @RefRBProjectNo AND BD.BUDGET_ORDER_NO = RVBD.BUDGET_ORDER_NO
      AND  RVBD.PERIOD_TYPE = 3 AND RVBD.REV_NO = @RefRBRevNo
      --LEFT JOIN BG_T_BUDGET_DATA PREVBD ON  BD.BUDGET_ORDER_NO = PREVBD.BUDGET_ORDER_NO  AND BD.PERIOD_TYPE = PREVBD.PERIOD_TYPE
      --AND PREVBD.REV_NO = @PrevMTPRevNo AND PREVBD.BUDGET_YEAR = (@BudgetYear - 1) AND PREVBD.PROJECT_NO = 1
      LEFT JOIN BG_T_BUDGET_DATA PREVBD ON  BD.BUDGET_ORDER_NO = PREVBD.BUDGET_ORDER_NO
      AND BD.PERIOD_TYPE = PREVBD.PERIOD_TYPE AND PREVBD.REV_NO = @RefRevNo AND PREVBD.BUDGET_YEAR = @RefBudgetYear AND PREVBD.PROJECT_NO = @RefProjectNo

      LEFT JOIN BG_T_BUDGET_DATA PREVBD1 ON  BD.BUDGET_ORDER_NO = PREVBD1.BUDGET_ORDER_NO
      AND BD.PERIOD_TYPE = PREVBD1.PERIOD_TYPE AND PREVBD1.REV_NO = @RefRevNo AND PREVBD1.BUDGET_YEAR = @RefBudgetYear-1 AND PREVBD1.PROJECT_NO = @RefProjectNo

      LEFT OUTER JOIN BG_T_UPLOAD_DATA AS ACTUAL_DATA
      ON ACTUAL_DATA.BUDGET_YEAR = BD.BUDGET_YEAR
      AND ACTUAL_DATA.BUDGET_ORDER_NO = BD.BUDGET_ORDER_NO
      AND ACTUAL_DATA.DATA_TYPE = 2
      AND ACTUAL_DATA.PERIOD_TYPE = 3
      --AND ACTUAL_DATA.PROJECT_NO = 1
      AND ACTUAL_DATA.PROJECT_NO = @RefRBProjectNo

      LEFT OUTER JOIN BG_T_BUDGET_DATA AS OB_BUDGET_DATA
      ON OB_BUDGET_DATA.BUDGET_YEAR = BD.BUDGET_YEAR +1
      AND OB_BUDGET_DATA.BUDGET_ORDER_NO = BD.BUDGET_ORDER_NO
      AND OB_BUDGET_DATA.PERIOD_TYPE = 1
      AND OB_BUDGET_DATA.PROJECT_NO = @RefRBProjectNo
      AND OB_BUDGET_DATA.REV_NO = @RefRBRevNo

      WHERE
      BD.BUDGET_YEAR = @BudgetYear AND BD.PERIOD_TYPE = @PeriodType AND BO.BUDGET_TYPE = 'E' AND BD.REV_NO = @RevNo AND BD.PROJECT_NO = @ProjectNo AND
      BO.ACTIVE_FLAG = 1 AND BO.PERSON_IN_CHARGE_NO = '@UserPIC' AND
      (BP.CLOSE_FLAG = 0 OR (BP.CLOSE_FLAG = 1 AND AC.ACCOUNT_NO IN
      (SELECT ACCOUNT_NO FROM BG_T_ACCOUNT_REOPEN WHERE BUDGET_YEAR = @BudgetYear AND PERIOD_TYPE = @PeriodType AND PROJECT_NO = @ProjectNo AND PERSON_IN_CHARGE_NO = '@UserPIC')))
      ORDER BY BD.BUDGET_ORDER_NO
    </SELECT023>
    <SELECT024>
      SELECT
      BD.*,
      (BD.M1+BD.M2+BD.M3+BD.M4+BD.M5+BD.M6) AS H1,
      (BD.M7+BD.M8+BD.M9+BD.M10+BD.M11+BD.M12) AS H2,
      (BD.M1+BD.M2+BD.M3+BD.M4+BD.M5+BD.M6+BD.M7+BD.M8+BD.M9+BD.M10+BD.M11+BD.M12) AS Y1,
      BO.BUDGET_ORDER_NAME,
      AC.ACCOUNT_NO, AC.ACCOUNT_NAME,
      BO.COST, BO.COST_TYPE, DP.DEPT_NO, DP.DEPT_NAME,
      PIC.PERSON_IN_CHARGE_NO, PIC.PERSON_IN_CHARGE_NAME,
      (ISNULL(OB_BUDGET_DATA.M1,0)+ISNULL(OB_BUDGET_DATA.M2,0)+ISNULL(OB_BUDGET_DATA.M3,0)+ISNULL(OB_BUDGET_DATA.M4,0)+ISNULL(OB_BUDGET_DATA.M5,0)+ISNULL(OB_BUDGET_DATA.M6,0)+ISNULL(OB_BUDGET_DATA.M7,0)+ISNULL(OB_BUDGET_DATA.M8,0)+ISNULL(OB_BUDGET_DATA.M9,0)+ISNULL(OB_BUDGET_DATA.M10,0)+ISNULL(OB_BUDGET_DATA.M11,0)+ISNULL(OB_BUDGET_DATA.M12,0)) AS RevYear,
      ISNULL(PREVBD.RRT1,0) AS PrevRRT1,
      ISNULL(PREVBD.RRT2,0) AS PrevRRT2,
      ISNULL(PREVBD.RRT3,0) AS PrevRRT3,
      ISNULL(PREVBD.RRT4,0) AS PrevRRT4,
      ISNULL(PREVBD.RRT5,0) AS PrevRRT5,
      ISNULL(PREVBD1.RRT5,0) AS Prev1RRT5
      FROM
      BG_T_BUDGET_DATA AS BD
      LEFT JOIN BG_M_BUDGET_ORDER AS BO ON BD.BUDGET_ORDER_NO = BO.BUDGET_ORDER_NO
      LEFT JOIN BG_M_ACCOUNT AS AC ON BO.ACCOUNT_NO = AC.ACCOUNT_NO
      LEFT JOIN BG_M_DEPT AS DP ON BO.DEPT_NO = DP.DEPT_NO
      LEFT JOIN BG_M_PERSON_IN_CHARGE AS PIC ON BO.PERSON_IN_CHARGE_NO = PIC.PERSON_IN_CHARGE_NO
      LEFT JOIN BG_T_BUDGET_PERIOD AS BP ON BD.BUDGET_YEAR = BP.BUDGET_YEAR AND BD.PERIOD_TYPE = BP.PERIOD_TYPE AND BD.PROJECT_NO = BP.PROJECT_NO
      --LEFT JOIN BG_T_BUDGET_DATA RVBD ON BD.BUDGET_YEAR = RVBD.BUDGET_YEAR AND BD.BUDGET_ORDER_NO = RVBD.BUDGET_ORDER_NO
      --AND  RVBD.PERIOD_TYPE = 3 AND RVBD.REV_NO = @ReviseRevNo AND RVBD.PROJECT_NO = 1
      LEFT JOIN BG_T_BUDGET_DATA RVBD ON BD.BUDGET_YEAR = RVBD.BUDGET_YEAR AND RVBD.PROJECT_NO = @RefRBProjectNo AND BD.BUDGET_ORDER_NO = RVBD.BUDGET_ORDER_NO
      AND  RVBD.PERIOD_TYPE = 3 AND RVBD.REV_NO = @RefRBRevNo
      --LEFT JOIN BG_T_BUDGET_DATA PREVBD ON  BD.BUDGET_ORDER_NO = PREVBD.BUDGET_ORDER_NO  AND BD.PERIOD_TYPE = PREVBD.PERIOD_TYPE
      --AND PREVBD.REV_NO = @PrevMTPRevNo AND PREVBD.BUDGET_YEAR = (@BudgetYear - 1) AND PREVBD.PROJECT_NO = 1
      LEFT JOIN BG_T_BUDGET_DATA PREVBD ON  BD.BUDGET_ORDER_NO = PREVBD.BUDGET_ORDER_NO
      AND BD.PERIOD_TYPE = PREVBD.PERIOD_TYPE AND PREVBD.REV_NO = @RefRevNo AND PREVBD.BUDGET_YEAR = @RefBudgetYear AND PREVBD.PROJECT_NO = @RefProjectNo

      LEFT JOIN BG_T_BUDGET_DATA PREVBD1 ON  BD.BUDGET_ORDER_NO = PREVBD1.BUDGET_ORDER_NO
      AND BD.PERIOD_TYPE = PREVBD1.PERIOD_TYPE AND PREVBD1.REV_NO = @RefRevNo AND PREVBD1.BUDGET_YEAR = @RefBudgetYear-1 AND PREVBD1.PROJECT_NO = @RefProjectNo

      LEFT OUTER JOIN BG_T_UPLOAD_DATA AS ACTUAL_DATA
      ON ACTUAL_DATA.BUDGET_YEAR = BD.BUDGET_YEAR
      AND ACTUAL_DATA.BUDGET_ORDER_NO = BD.BUDGET_ORDER_NO
      AND ACTUAL_DATA.DATA_TYPE = 2
      AND ACTUAL_DATA.PERIOD_TYPE = 3
      --AND ACTUAL_DATA.PROJECT_NO = 1
      AND ACTUAL_DATA.PROJECT_NO = @RefRBProjectNo

      LEFT OUTER JOIN BG_T_BUDGET_DATA AS OB_BUDGET_DATA
      ON OB_BUDGET_DATA.BUDGET_YEAR = BD.BUDGET_YEAR +1
      AND OB_BUDGET_DATA.BUDGET_ORDER_NO = BD.BUDGET_ORDER_NO
      AND OB_BUDGET_DATA.PERIOD_TYPE = 1
      AND OB_BUDGET_DATA.PROJECT_NO = @RefRBProjectNo
      AND OB_BUDGET_DATA.REV_NO = @RefRBRevNo

      WHERE
      BD.BUDGET_YEAR = @BudgetYear AND BD.PERIOD_TYPE = @PeriodType AND BO.BUDGET_TYPE = 'E' AND BD.REV_NO = @RevNo AND BD.PROJECT_NO = @ProjectNo AND
      BO.ACTIVE_FLAG = 1 AND
      (BP.CLOSE_FLAG = 0 OR (BP.CLOSE_FLAG = 1 AND AC.ACCOUNT_NO IN
      (SELECT ACCOUNT_NO FROM BG_T_ACCOUNT_REOPEN WHERE BUDGET_YEAR = @BudgetYear AND PERIOD_TYPE = @PeriodType AND PROJECT_NO = @ProjectNo)))
      ORDER BY BD.BUDGET_ORDER_NO
    </SELECT024>
    <SELECT025>
      SELECT
      BD.*,
      (BD.M1+BD.M2+BD.M3+BD.M4+BD.M5+BD.M6) AS H1,
      (BD.M7+BD.M8+BD.M9+BD.M10+BD.M11+BD.M12) AS H2,
      (BD.M1+BD.M2+BD.M3+BD.M4+BD.M5+BD.M6+BD.M7+BD.M8+BD.M9+BD.M10+BD.M11+BD.M12) AS Y1,
      BO.BUDGET_ORDER_NAME,
      AC.ACCOUNT_NO, AC.ACCOUNT_NAME,
      BO.COST, BO.COST_TYPE, DP.DEPT_NO, DP.DEPT_NAME,
      PIC.PERSON_IN_CHARGE_NO, PIC.PERSON_IN_CHARGE_NAME,
      (ISNULL(OB_BUDGET_DATA.M1,0)+ISNULL(OB_BUDGET_DATA.M2,0)+ISNULL(OB_BUDGET_DATA.M3,0)+ISNULL(OB_BUDGET_DATA.M4,0)+ISNULL(OB_BUDGET_DATA.M5,0)+ISNULL(OB_BUDGET_DATA.M6,0)+ISNULL(OB_BUDGET_DATA.M7,0)+ISNULL(OB_BUDGET_DATA.M8,0)+ISNULL(OB_BUDGET_DATA.M9,0)+ISNULL(OB_BUDGET_DATA.M10,0)+ISNULL(OB_BUDGET_DATA.M11,0)+ISNULL(OB_BUDGET_DATA.M12,0)) AS RevYear,
      ISNULL(PREVBD.RRT1,0) AS PrevRRT1,
      ISNULL(PREVBD.RRT2,0) AS PrevRRT2,
      ISNULL(PREVBD.RRT3,0) AS PrevRRT3,
      ISNULL(PREVBD.RRT4,0) AS PrevRRT4,
      ISNULL(PREVBD.RRT5,0) AS PrevRRT5,
      ISNULL(PREVBD1.RRT5,0) AS Prev1RRT5
      FROM
      BG_T_BUDGET_DATA AS BD
      LEFT JOIN BG_M_BUDGET_ORDER AS BO ON BD.BUDGET_ORDER_NO = BO.BUDGET_ORDER_NO
      LEFT JOIN BG_M_ACCOUNT AS AC ON BO.ACCOUNT_NO = AC.ACCOUNT_NO
      LEFT JOIN BG_M_DEPT AS DP ON BO.DEPT_NO = DP.DEPT_NO
      LEFT JOIN BG_M_PERSON_IN_CHARGE AS PIC ON BO.PERSON_IN_CHARGE_NO = PIC.PERSON_IN_CHARGE_NO
      --LEFT JOIN BG_T_BUDGET_DATA RVBD ON BD.BUDGET_YEAR = RVBD.BUDGET_YEAR AND BD.BUDGET_ORDER_NO = RVBD.BUDGET_ORDER_NO
      --AND  RVBD.PERIOD_TYPE = 3 AND RVBD.REV_NO = @ReviseRevNo AND RVBD.PROJECT_NO = 1
      LEFT JOIN BG_T_BUDGET_DATA RVBD ON BD.BUDGET_YEAR = RVBD.BUDGET_YEAR AND RVBD.PROJECT_NO = @RefRBProjectNo AND BD.BUDGET_ORDER_NO = RVBD.BUDGET_ORDER_NO
      AND  RVBD.PERIOD_TYPE = 3 AND RVBD.REV_NO = @RefRBRevNo
      --LEFT JOIN BG_T_BUDGET_DATA PREVBD ON  BD.BUDGET_ORDER_NO = PREVBD.BUDGET_ORDER_NO  AND BD.PERIOD_TYPE = PREVBD.PERIOD_TYPE
      --AND PREVBD.REV_NO = @PrevMTPRevNo AND PREVBD.BUDGET_YEAR = (@BudgetYear - 1) AND PREVBD.PROJECT_NO = 1
      LEFT JOIN BG_T_BUDGET_DATA PREVBD ON  BD.BUDGET_ORDER_NO = PREVBD.BUDGET_ORDER_NO
      AND BD.PERIOD_TYPE = PREVBD.PERIOD_TYPE AND PREVBD.REV_NO = @RefRevNo AND PREVBD.BUDGET_YEAR = @RefBudgetYear AND PREVBD.PROJECT_NO = @RefProjectNo

      LEFT JOIN BG_T_BUDGET_DATA PREVBD1 ON  BD.BUDGET_ORDER_NO = PREVBD1.BUDGET_ORDER_NO
      AND BD.PERIOD_TYPE = PREVBD1.PERIOD_TYPE AND PREVBD1.REV_NO = @RefRevNo AND PREVBD1.BUDGET_YEAR = @RefBudgetYear - 1 AND PREVBD1.PROJECT_NO = @RefProjectNo

      LEFT OUTER JOIN BG_T_UPLOAD_DATA AS ACTUAL_DATA
      ON ACTUAL_DATA.BUDGET_YEAR = BD.BUDGET_YEAR
      AND ACTUAL_DATA.BUDGET_ORDER_NO = BD.BUDGET_ORDER_NO
      AND ACTUAL_DATA.DATA_TYPE = 2
      AND ACTUAL_DATA.PERIOD_TYPE = 3
      --AND ACTUAL_DATA.PROJECT_NO = 1
      AND ACTUAL_DATA.PROJECT_NO = @RefRBProjectNo

      LEFT OUTER JOIN BG_T_BUDGET_DATA AS OB_BUDGET_DATA
      ON OB_BUDGET_DATA.BUDGET_YEAR = BD.BUDGET_YEAR +1
      AND OB_BUDGET_DATA.BUDGET_ORDER_NO = BD.BUDGET_ORDER_NO
      AND OB_BUDGET_DATA.PERIOD_TYPE = 1
      AND OB_BUDGET_DATA.PROJECT_NO = @RefRBProjectNo
      AND OB_BUDGET_DATA.REV_NO = @RefRBRevNo

      WHERE
      BD.BUDGET_YEAR = @BudgetYear AND BD.PERIOD_TYPE = @PeriodType AND BO.BUDGET_TYPE = '@BudgetType' AND BD.REV_NO = @RevNo AND BD.PROJECT_NO = @ProjectNo AND
      BO.PERSON_IN_CHARGE_NO = '@UserPIC' AND BO.ACTIVE_FLAG = 1
      ORDER BY BD.BUDGET_ORDER_NO
    </SELECT025>
    <!--Merge PIC-->
    <!--<SELECT025_1>

      SELECT
      ISNULL(BD.BUDGET_YEAR,@BudgetYear)AS BUDGET_YEAR
      ,ISNULL(BD.PERIOD_TYPE,@PeriodType) AS PERIOD_TYPE
      ,PICMAIN.BUDGET_ORDER_NO
      ,ISNULL(BD.REV_NO,@RevNo) AS REV_NO
      ,ISNULL(BD.M1,0) AS M1
      ,ISNULL(BD.M2,0) AS M2
      ,ISNULL(BD.M3,0) AS M3
      ,ISNULL(BD.M4,0) AS M4
      ,ISNULL(BD.M5,0) AS M5
      ,ISNULL(BD.M6,0) AS M6
      ,ISNULL(BD.M7,0) AS M7
      ,ISNULL(BD.M8,0) AS M8
      ,ISNULL(BD.M9,0) AS M9
      ,ISNULL(BD.M10,0) AS M10
      ,ISNULL(BD.M11,0) AS M11
      ,ISNULL(BD.M12,0) AS M12
      ,ISNULL(BD.RRT1,0) AS RRT1
      ,ISNULL(BD.RRT2,0) AS RRT2
      ,ISNULL(BD.RRT3,0) AS RRT3
      ,ISNULL(BD.RRT4,0) AS RRT4
      ,ISNULL(BD.RRT5,0) AS RRT5
      ,ISNULL(BD.REMARKS,'') AS REMARKS
      ,ISNULL(BD.WB_FLAG,OB_BUDGET_DATA.WB_FLAG) AS WB_FLAG
      ,ISNULL(BD.CREATE_USER_ID,'')AS CREATE_USER_ID
      ,ISNULL(BD.CREATE_DATE,'') AS CREATE_DATE
      ,ISNULL(BD.UPDATE_USER_ID, '') AS UPDATE_USER_ID
      ,ISNULL(BD.UPDATE_DATE, '') AS UPDATE_DATE
      , ISNULL(BD.PROJECT_NO,1)AS PROJECT_NO
      , ISNULL((BD.M1+BD.M2+BD.M3+BD.M4+BD.M5+BD.M6),0) AS H1
      , ISNULL((BD.M7+BD.M8+BD.M9+BD.M10+BD.M11+BD.M12),0) AS H2
      , ISNULL((BD.M1+BD.M2+BD.M3+BD.M4+BD.M5+BD.M6+BD.M7+BD.M8+BD.M9+BD.M10+BD.M11+BD.M12),0) AS Y1
      , BO.BUDGET_ORDER_NAME
      , AC.ACCOUNT_NO
      , AC.ACCOUNT_NAME
      , BO.COST
      , BO.COST_TYPE
      , DP.DEPT_NO
      , DP.DEPT_NAME
      , PIC.PERSON_IN_CHARGE_NO
      , PIC.PERSON_IN_CHARGE_NAME
      , (ISNULL(OB_BUDGET_DATA.M1,0)+ISNULL(OB_BUDGET_DATA.M2,0)
      +ISNULL(OB_BUDGET_DATA.M3,0)+ISNULL(OB_BUDGET_DATA.M4,0)+ISNULL(OB_BUDGET_DATA.M5,0)
      +ISNULL(OB_BUDGET_DATA.M6,0)+ISNULL(OB_BUDGET_DATA.M7,0)+ISNULL(OB_BUDGET_DATA.M8,0)
      +ISNULL(OB_BUDGET_DATA.M9,0)+ISNULL(OB_BUDGET_DATA.M10,0)+ISNULL(OB_BUDGET_DATA.M11,0)
      +ISNULL(OB_BUDGET_DATA.M12,0)) AS RevYear
      ,ISNULL(PREVBD.RRT1,0) AS PrevRRT1
      ,ISNULL(PREVBD.RRT2,0) AS PrevRRT2
      ,ISNULL(PREVBD.RRT3,0) AS PrevRRT3
      ,ISNULL(PREVBD.RRT4,0) AS PrevRRT4
      ,ISNULL(PREVBD.RRT5,0) AS PrevRRT5

      FROM

      (
      SELECT DISTINCT(OB_BUDGET_DATA.BUDGET_ORDER_NO) FROM  BG_T_BUDGET_DATA AS OB_BUDGET_DATA

      LEFT JOIN BG_M_BUDGET_ORDER AS BOO ON OB_BUDGET_DATA.BUDGET_ORDER_NO = BOO.BUDGET_ORDER_NO

      WHERE OB_BUDGET_DATA.BUDGET_YEAR = @BudgetYear
      AND OB_BUDGET_DATA.PERIOD_TYPE = @PeriodType
      AND OB_BUDGET_DATA.PROJECT_NO = @ProjectNo
      AND OB_BUDGET_DATA.REV_NO = @RevNo
      AND BOO.PERSON_IN_CHARGE_NO = '@UserPIC'
      AND BOO.ACTIVE_FLAG = 1

      UNION
      SELECT DISTINCT(OB_BUDGET_DATA.BUDGET_ORDER_NO) FROM  BG_T_BUDGET_DATA AS OB_BUDGET_DATA

      LEFT JOIN BG_M_BUDGET_ORDER AS BOO ON OB_BUDGET_DATA.BUDGET_ORDER_NO = BOO.BUDGET_ORDER_NO

      WHERE OB_BUDGET_DATA.BUDGET_YEAR = @BudgetYear +1
     
      AND OB_BUDGET_DATA.PERIOD_TYPE = 1
      AND OB_BUDGET_DATA.PROJECT_NO = @RefRBProjectNo
      AND OB_BUDGET_DATA.REV_NO = @RefRBRevNo
      AND BOO.PERSON_IN_CHARGE_NO = '@UserPIC'
      AND BOO.ACTIVE_FLAG = 1
      ) AS PICMAIN

      LEFT JOIN BG_M_BUDGET_ORDER AS BO ON PICMAIN.BUDGET_ORDER_NO = BO.BUDGET_ORDER_NO
      LEFT JOIN BG_M_ACCOUNT AS AC ON BO.ACCOUNT_NO = AC.ACCOUNT_NO
      LEFT JOIN BG_M_DEPT AS DP ON BO.DEPT_NO = DP.DEPT_NO
      LEFT JOIN BG_M_PERSON_IN_CHARGE AS PIC ON BO.PERSON_IN_CHARGE_NO = PIC.PERSON_IN_CHARGE_NO


      LEFT JOIN
      (
      SELECT BDD.* FROM BG_T_BUDGET_DATA AS BDD
      LEFT JOIN BG_M_BUDGET_ORDER AS BO ON BDD.BUDGET_ORDER_NO = BO.BUDGET_ORDER_NO
      LEFT JOIN BG_M_ACCOUNT AS AC ON BO.ACCOUNT_NO = AC.ACCOUNT_NO
      LEFT JOIN BG_M_DEPT AS DP ON BO.DEPT_NO = DP.DEPT_NO
      LEFT JOIN BG_M_PERSON_IN_CHARGE AS PIC ON BO.PERSON_IN_CHARGE_NO = PIC.PERSON_IN_CHARGE_NO
      WHERE
      BDD.BUDGET_YEAR = @BudgetYear AND BDD.PERIOD_TYPE = @PeriodType AND BO.BUDGET_TYPE = 'E' AND BDD.REV_NO = @RevNo AND BDD.PROJECT_NO = @ProjectNo AND
      BO.PERSON_IN_CHARGE_NO = '@UserPIC' AND BO.ACTIVE_FLAG = 1
      )BD
      ON BD.BUDGET_ORDER_NO = PICMAIN.BUDGET_ORDER_NO


      LEFT JOIN BG_T_BUDGET_DATA AS OB_BUDGET_DATA
      ON OB_BUDGET_DATA.BUDGET_YEAR = @BudgetYear +1
      AND OB_BUDGET_DATA.BUDGET_ORDER_NO = PICMAIN.BUDGET_ORDER_NO
      AND OB_BUDGET_DATA.PERIOD_TYPE = 1
      AND OB_BUDGET_DATA.PROJECT_NO = @RefRBProjectNo
      AND OB_BUDGET_DATA.REV_NO = @RefRBRevNo

      LEFT JOIN BG_T_BUDGET_DATA PREVBD ON  BD.BUDGET_ORDER_NO = PREVBD.BUDGET_ORDER_NO
      AND BD.PERIOD_TYPE = PREVBD.PERIOD_TYPE AND PREVBD.REV_NO = @RefRevNo AND PREVBD.BUDGET_YEAR = @RefBudgetYear AND PREVBD.PROJECT_NO = @RefProjectNo

    </SELECT025_1>-->
    <SELECT025_1>
      SELECT
      BD.*,
      (BD.M1+BD.M2+BD.M3+BD.M4+BD.M5+BD.M6) AS H1,
      (BD.M7+BD.M8+BD.M9+BD.M10+BD.M11+BD.M12) AS H2,
      (BD.M1+BD.M2+BD.M3+BD.M4+BD.M5+BD.M6+BD.M7+BD.M8+BD.M9+BD.M10+BD.M11+BD.M12) AS Y1,
      BO.BUDGET_ORDER_NAME,
      AC.ACCOUNT_NO, AC.ACCOUNT_NAME,
      BO.COST, BO.COST_TYPE, DP.DEPT_NO, DP.DEPT_NAME,
      PIC.PERSON_IN_CHARGE_NO, PIC.PERSON_IN_CHARGE_NAME,
      (ISNULL(OB_BUDGET_DATA.M1,0)+ISNULL(OB_BUDGET_DATA.M2,0)+ISNULL(OB_BUDGET_DATA.M3,0)+ISNULL(OB_BUDGET_DATA.M4,0)+ISNULL(OB_BUDGET_DATA.M5,0)+ISNULL(OB_BUDGET_DATA.M6,0)+ISNULL(OB_BUDGET_DATA.M7,0)+ISNULL(OB_BUDGET_DATA.M8,0)+ISNULL(OB_BUDGET_DATA.M9,0)+ISNULL(OB_BUDGET_DATA.M10,0)+ISNULL(OB_BUDGET_DATA.M11,0)+ISNULL(OB_BUDGET_DATA.M12,0)) AS RevYear,
      ISNULL(PREVBD.RRT1,0) AS PrevRRT1,
      ISNULL(PREVBD.RRT2,0) AS PrevRRT2,
      ISNULL(PREVBD.RRT3,0) AS PrevRRT3,
      ISNULL(PREVBD.RRT4,0) AS PrevRRT4,
      ISNULL(PREVBD.RRT5,0) AS PrevRRT5,
      ISNULL(PREVBD1.RRT5,0) AS Prev1RRT5
      FROM
      BG_T_BUDGET_DATA AS BD
      LEFT JOIN BG_M_BUDGET_ORDER AS BO ON BD.BUDGET_ORDER_NO = BO.BUDGET_ORDER_NO
      LEFT JOIN BG_M_ACCOUNT AS AC ON BO.ACCOUNT_NO = AC.ACCOUNT_NO
      LEFT JOIN BG_M_DEPT AS DP ON BO.DEPT_NO = DP.DEPT_NO
      LEFT JOIN BG_M_PERSON_IN_CHARGE AS PIC ON BO.PERSON_IN_CHARGE_NO = PIC.PERSON_IN_CHARGE_NO

      LEFT JOIN BG_T_BUDGET_DATA RVBD ON BD.BUDGET_YEAR = RVBD.BUDGET_YEAR AND RVBD.PROJECT_NO = @RefRBProjectNo AND BD.BUDGET_ORDER_NO = RVBD.BUDGET_ORDER_NO
      AND  RVBD.PERIOD_TYPE = 3 AND RVBD.REV_NO = @RefRBRevNo


      LEFT JOIN BG_T_BUDGET_DATA PREVBD ON  BD.BUDGET_ORDER_NO = PREVBD.BUDGET_ORDER_NO
      AND BD.PERIOD_TYPE = PREVBD.PERIOD_TYPE AND PREVBD.REV_NO = @RefRevNo AND PREVBD.BUDGET_YEAR = @RefBudgetYear AND PREVBD.PROJECT_NO = @RefProjectNo

      LEFT JOIN BG_T_BUDGET_DATA PREVBD1 ON  BD.BUDGET_ORDER_NO = PREVBD1.BUDGET_ORDER_NO
      AND BD.PERIOD_TYPE = PREVBD1.PERIOD_TYPE AND PREVBD1.REV_NO = @RefRevNo AND PREVBD1.BUDGET_YEAR = @RefBudgetYear-1 AND PREVBD1.PROJECT_NO = @RefProjectNo

      LEFT OUTER JOIN BG_T_UPLOAD_DATA AS ACTUAL_DATA
      ON ACTUAL_DATA.BUDGET_YEAR = BD.BUDGET_YEAR
      AND ACTUAL_DATA.BUDGET_ORDER_NO = BD.BUDGET_ORDER_NO
      AND ACTUAL_DATA.DATA_TYPE = 2
      AND ACTUAL_DATA.PERIOD_TYPE = 3

      AND ACTUAL_DATA.PROJECT_NO = @RefRBProjectNo

      LEFT OUTER JOIN BG_T_BUDGET_DATA AS OB_BUDGET_DATA
      ON OB_BUDGET_DATA.BUDGET_YEAR = BD.BUDGET_YEAR +1
      AND OB_BUDGET_DATA.BUDGET_ORDER_NO = BD.BUDGET_ORDER_NO
      AND OB_BUDGET_DATA.PERIOD_TYPE = 1
      AND OB_BUDGET_DATA.PROJECT_NO = @RefRBProjectNo
      AND OB_BUDGET_DATA.REV_NO = @RefRBRevNo


      WHERE
      BD.BUDGET_YEAR = @BudgetYear AND BD.PERIOD_TYPE = @PeriodType AND BO.BUDGET_TYPE = '@BudgetType' AND BD.REV_NO = @RevNo AND BD.PROJECT_NO = @ProjectNo AND
      BO.PERSON_IN_CHARGE_NO = '@UserPIC' AND BO.ACTIVE_FLAG = 1
      ORDER BY BD.BUDGET_ORDER_NO
    </SELECT025_1>
    <SELECT026>
      SELECT
      BD.*,
      (BD.M1+BD.M2+BD.M3+BD.M4+BD.M5+BD.M6) AS H1,
      (BD.M7+BD.M8+BD.M9+BD.M10+BD.M11+BD.M12) AS H2,
      (BD.M1+BD.M2+BD.M3+BD.M4+BD.M5+BD.M6+BD.M7+BD.M8+BD.M9+BD.M10+BD.M11+BD.M12) AS Y1,
      BO.BUDGET_ORDER_NAME,
      AC.ACCOUNT_NO, AC.ACCOUNT_NAME,
      BO.COST, BO.COST_TYPE, DP.DEPT_NO, DP.DEPT_NAME,
      PIC.PERSON_IN_CHARGE_NO, PIC.PERSON_IN_CHARGE_NAME,
      (ISNULL(OB_BUDGET_DATA.M1,0)+ISNULL(OB_BUDGET_DATA.M2,0)+ISNULL(OB_BUDGET_DATA.M3,0)+ISNULL(OB_BUDGET_DATA.M4,0)+ISNULL(OB_BUDGET_DATA.M5,0)+ISNULL(OB_BUDGET_DATA.M6,0)+ISNULL(OB_BUDGET_DATA.M7,0)+ISNULL(OB_BUDGET_DATA.M8,0)+ISNULL(OB_BUDGET_DATA.M9,0)+ISNULL(OB_BUDGET_DATA.M10,0)+ISNULL(OB_BUDGET_DATA.M11,0)+ISNULL(OB_BUDGET_DATA.M12,0)) AS RevYear,
      ISNULL(PREVBD.RRT1,0) AS PrevRRT1,
      ISNULL(PREVBD.RRT2,0) AS PrevRRT2,
      ISNULL(PREVBD.RRT3,0) AS PrevRRT3,
      ISNULL(PREVBD.RRT4,0) AS PrevRRT4,
      ISNULL(PREVBD.RRT5,0) AS PrevRRT5,
      ISNULL(PREVBD1.RRT5,0) AS Prev1RRT5
      FROM
      BG_T_BUDGET_DATA AS BD
      LEFT JOIN BG_M_BUDGET_ORDER AS BO ON BD.BUDGET_ORDER_NO = BO.BUDGET_ORDER_NO
      LEFT JOIN BG_M_ACCOUNT AS AC ON BO.ACCOUNT_NO = AC.ACCOUNT_NO
      LEFT JOIN BG_M_DEPT AS DP ON BO.DEPT_NO = DP.DEPT_NO
      LEFT JOIN BG_M_PERSON_IN_CHARGE AS PIC ON BO.PERSON_IN_CHARGE_NO = PIC.PERSON_IN_CHARGE_NO
      --LEFT JOIN BG_T_BUDGET_DATA RVBD ON BD.BUDGET_YEAR = RVBD.BUDGET_YEAR AND BD.BUDGET_ORDER_NO = RVBD.BUDGET_ORDER_NO
      --AND  RVBD.PERIOD_TYPE = 3 AND RVBD.REV_NO = @ReviseRevNo AND RVBD.PROJECT_NO = 1
      LEFT JOIN BG_T_BUDGET_DATA RVBD ON BD.BUDGET_YEAR = RVBD.BUDGET_YEAR AND RVBD.PROJECT_NO = @RefRBProjectNo AND BD.BUDGET_ORDER_NO = RVBD.BUDGET_ORDER_NO
      AND  RVBD.PERIOD_TYPE = 3 AND RVBD.REV_NO = @RefRBRevNo
      --LEFT JOIN BG_T_BUDGET_DATA PREVBD ON  BD.BUDGET_ORDER_NO = PREVBD.BUDGET_ORDER_NO  AND BD.PERIOD_TYPE = PREVBD.PERIOD_TYPE
      --AND PREVBD.REV_NO = @PrevMTPRevNo AND PREVBD.BUDGET_YEAR = (@BudgetYear - 1) AND PREVBD.PROJECT_NO = 1
      LEFT JOIN BG_T_BUDGET_DATA PREVBD ON  BD.BUDGET_ORDER_NO = PREVBD.BUDGET_ORDER_NO
      AND BD.PERIOD_TYPE = PREVBD.PERIOD_TYPE AND PREVBD.REV_NO = @RefRevNo AND PREVBD.BUDGET_YEAR = @RefBudgetYear AND PREVBD.PROJECT_NO = @RefProjectNo

      LEFT JOIN BG_T_BUDGET_DATA PREVBD1 ON  BD.BUDGET_ORDER_NO = PREVBD1.BUDGET_ORDER_NO
      AND BD.PERIOD_TYPE = PREVBD1.PERIOD_TYPE AND PREVBD1.REV_NO = @RefRevNo AND PREVBD1.BUDGET_YEAR = @RefBudgetYear-1 AND PREVBD1.PROJECT_NO = @RefProjectNo

      LEFT OUTER JOIN BG_T_UPLOAD_DATA AS ACTUAL_DATA
      ON ACTUAL_DATA.BUDGET_YEAR = BD.BUDGET_YEAR
      AND ACTUAL_DATA.BUDGET_ORDER_NO = BD.BUDGET_ORDER_NO
      AND ACTUAL_DATA.DATA_TYPE = 2
      AND ACTUAL_DATA.PERIOD_TYPE = 3
      --AND ACTUAL_DATA.PROJECT_NO = 1
      AND ACTUAL_DATA.PROJECT_NO = @RefRBProjectNo

      LEFT OUTER JOIN BG_T_BUDGET_DATA AS OB_BUDGET_DATA
      ON OB_BUDGET_DATA.BUDGET_YEAR = BD.BUDGET_YEAR +1
      AND OB_BUDGET_DATA.BUDGET_ORDER_NO = BD.BUDGET_ORDER_NO
      AND OB_BUDGET_DATA.PERIOD_TYPE = 1
      AND OB_BUDGET_DATA.PROJECT_NO = @RefRBProjectNo
      AND OB_BUDGET_DATA.REV_NO = @RefRBRevNo

      WHERE
      BD.BUDGET_YEAR = @BudgetYear AND BD.PERIOD_TYPE = @PeriodType AND BO.BUDGET_TYPE = '@BudgetType' AND BD.REV_NO = @RevNo AND BD.PROJECT_NO = @ProjectNo AND
      BO.ACTIVE_FLAG = 1
      AND BD.BUDGET_ORDER_NO NOT IN
      (
      SELECT BUDGET_ORDER_NO
      FROM BG_T_BUDGET_DATA_REINPUT
      WHERE BUDGET_YEAR = @BudgetYear
      AND PERIOD_TYPE = @PeriodType
      AND REV_NO = @RevNo
      AND PROJECT_NO = @ProjectNo
      )
      ORDER BY BD.BUDGET_ORDER_NO
    </SELECT026>
    <SELECT027>
      SELECT
      BD.*,
      (BD.M1+BD.M2+BD.M3+BD.M4+BD.M5+BD.M6) AS H1,
      (BD.M7+BD.M8+BD.M9+BD.M10+BD.M11+BD.M12) AS H2,
      (BD.M1+BD.M2+BD.M3+BD.M4+BD.M5+BD.M6+BD.M7+BD.M8+BD.M9+BD.M10+BD.M11+BD.M12) AS Y1,
      BO.BUDGET_ORDER_NAME,
      AC.ACCOUNT_NO, AC.ACCOUNT_NAME,
      BO.COST, BO.COST_TYPE, DP.DEPT_NO, DP.DEPT_NAME,
      PIC.PERSON_IN_CHARGE_NO, PIC.PERSON_IN_CHARGE_NAME,
      (ISNULL(OB_BUDGET_DATA.M1,0)+ISNULL(OB_BUDGET_DATA.M2,0)+ISNULL(OB_BUDGET_DATA.M3,0)+ISNULL(OB_BUDGET_DATA.M4,0)+ISNULL(OB_BUDGET_DATA.M5,0)+ISNULL(OB_BUDGET_DATA.M6,0)+ISNULL(OB_BUDGET_DATA.M7,0)+ISNULL(OB_BUDGET_DATA.M8,0)+ISNULL(OB_BUDGET_DATA.M9,0)+ISNULL(OB_BUDGET_DATA.M10,0)+ISNULL(OB_BUDGET_DATA.M11,0)+ISNULL(OB_BUDGET_DATA.M12,0)) AS RevYear,
      ISNULL(PREVBD.RRT1,0) AS PrevRRT1,
      ISNULL(PREVBD.RRT2,0) AS PrevRRT2,
      ISNULL(PREVBD.RRT3,0) AS PrevRRT3,
      ISNULL(PREVBD.RRT4,0) AS PrevRRT4,
      ISNULL(PREVBD.RRT5,0) AS PrevRRT5,
      ISNULL(PREVBD1.RRT5,0) AS Prev1RRT5
      FROM
      BG_T_BUDGET_DATA AS BD
      LEFT JOIN BG_M_BUDGET_ORDER AS BO ON BD.BUDGET_ORDER_NO = BO.BUDGET_ORDER_NO
      LEFT JOIN BG_M_ACCOUNT AS AC ON BO.ACCOUNT_NO = AC.ACCOUNT_NO
      LEFT JOIN BG_M_DEPT AS DP ON BO.DEPT_NO = DP.DEPT_NO
      LEFT JOIN BG_M_PERSON_IN_CHARGE AS PIC ON BO.PERSON_IN_CHARGE_NO = PIC.PERSON_IN_CHARGE_NO
      LEFT JOIN BG_T_BUDGET_HEADER AS BH
      ON BD.BUDGET_YEAR = BH.BUDGET_YEAR AND
      BD.PERIOD_TYPE = BH.PERIOD_TYPE AND
      BO.PERSON_IN_CHARGE_NO = BH.PERSON_IN_CHARGE_NO AND
      BO.BUDGET_TYPE = BH.BUDGET_TYPE AND
      BD.REV_NO = BH.REV_NO AND
      BD.PROJECT_NO = BH.PROJECT_NO
      --LEFT JOIN BG_T_BUDGET_DATA RVBD ON BD.BUDGET_YEAR = RVBD.BUDGET_YEAR AND BD.BUDGET_ORDER_NO = RVBD.BUDGET_ORDER_NO
      --AND  RVBD.PERIOD_TYPE = 3 AND RVBD.REV_NO = @ReviseRevNo AND RVBD.PROJECT_NO = 1
      LEFT JOIN BG_T_BUDGET_DATA RVBD ON BD.BUDGET_YEAR = RVBD.BUDGET_YEAR AND RVBD.PROJECT_NO = @RefRBProjectNo AND BD.BUDGET_ORDER_NO = RVBD.BUDGET_ORDER_NO
      AND  RVBD.PERIOD_TYPE = 3 AND RVBD.REV_NO = @RefRBRevNo
      --LEFT JOIN BG_T_BUDGET_DATA PREVBD ON  BD.BUDGET_ORDER_NO = PREVBD.BUDGET_ORDER_NO  AND BD.PERIOD_TYPE = PREVBD.PERIOD_TYPE
      --AND PREVBD.REV_NO = @PrevMTPRevNo AND PREVBD.BUDGET_YEAR = (@BudgetYear - 1) AND PREVBD.PROJECT_NO = 1

      LEFT JOIN BG_T_BUDGET_DATA PREVBD ON  BD.BUDGET_ORDER_NO = PREVBD.BUDGET_ORDER_NO
      AND BD.PERIOD_TYPE = PREVBD.PERIOD_TYPE AND PREVBD.REV_NO = @RefRevNo AND PREVBD.BUDGET_YEAR = @RefBudgetYear AND PREVBD.PROJECT_NO = @RefProjectNo

      LEFT JOIN BG_T_BUDGET_DATA PREVBD1 ON  BD.BUDGET_ORDER_NO = PREVBD1.BUDGET_ORDER_NO
      AND BD.PERIOD_TYPE = PREVBD1.PERIOD_TYPE AND PREVBD1.REV_NO = @RefRevNo AND PREVBD1.BUDGET_YEAR = @RefBudgetYear-1 AND PREVBD1.PROJECT_NO = @RefProjectNo

      LEFT OUTER JOIN BG_T_UPLOAD_DATA AS ACTUAL_DATA
      ON ACTUAL_DATA.BUDGET_YEAR = BD.BUDGET_YEAR
      AND ACTUAL_DATA.BUDGET_ORDER_NO = BD.BUDGET_ORDER_NO
      AND ACTUAL_DATA.DATA_TYPE = 2
      AND ACTUAL_DATA.PERIOD_TYPE = 3
      --AND ACTUAL_DATA.PROJECT_NO = 1
      AND ACTUAL_DATA.PROJECT_NO = @RefRBProjectNo

      LEFT OUTER JOIN BG_T_BUDGET_DATA AS OB_BUDGET_DATA
      ON OB_BUDGET_DATA.BUDGET_YEAR = BD.BUDGET_YEAR +1
      AND OB_BUDGET_DATA.BUDGET_ORDER_NO = BD.BUDGET_ORDER_NO
      AND OB_BUDGET_DATA.PERIOD_TYPE = 1
      AND OB_BUDGET_DATA.PROJECT_NO = @RefRBProjectNo
      AND OB_BUDGET_DATA.REV_NO = @RefRBRevNo


      WHERE
      BD.BUDGET_YEAR = @BudgetYear AND BD.PERIOD_TYPE = @PeriodType AND BD.REV_NO = @RevNo AND BD.PROJECT_NO = @ProjectNo AND
      BO.BUDGET_TYPE = '@BudgetType' AND BO.ACTIVE_FLAG = 1 AND BH.Status >= @Status
      AND BD.BUDGET_ORDER_NO NOT IN
      (
      SELECT BUDGET_ORDER_NO
      FROM BG_T_BUDGET_DATA_REINPUT
      WHERE BUDGET_YEAR = @BudgetYear
      AND PERIOD_TYPE = @PeriodType
      AND REV_NO = @RevNo
      AND PROJECT_NO = @ProjectNo
      )
      ORDER BY BD.BUDGET_ORDER_NO
    </SELECT027>


    <SELECT028>
      SELECT
      BO.BUDGET_TYPE
      , BO.EXPENSE_TYPE
      , ISNULL(BD.BUDGET_YEAR ,@BudgetYear)AS BUDGET_YEAR
      , ISNULL(BD.PERIOD_TYPE, @PeriodType) AS PERIOD_TYPE
      , ISNULL(BD.PROJECT_NO, @ProjectNo) AS PROJECT_NO
      , BUDGET_ORDER_MAIN.BUDGET_ORDER_NO
      , ISNULL(BD.REV_NO,(SELECT ISNULL(MAX(REV_NO),1) AS MAX_REV_NO FROM BG_T_BUDGET_HEADER WHERE BUDGET_YEAR = @BudgetYear AND PERIOD_TYPE = @PeriodType)) AS REV_NO
      , ISNULL(BD.M1,0) AS M1
      , ISNULL(BD.M2,0) AS M2
      , ISNULL(BD.M3,0) AS M3
      , ISNULL(BD.M4,0) AS M4
      , ISNULL(BD.M5,0) AS M5
      , ISNULL(BD.M6,0) AS M6
      , ISNULL(BD.M7,0) AS M7
      , ISNULL(BD.M8,0) AS M8
      , ISNULL(BD.M9,0) AS M9
      , ISNULL(BD.M10,0) AS M10
      , ISNULL(BD.M11,0) AS M11
      , ISNULL(BD.M12,0) AS M12
      , ISNULL(BD.REMARKS,'') AS REMARKS
      , ISNULL(BD.WB_FLAG,OB_BUDGET_DATA.WB_FLAG) AS WB_FLAG
      , ISNULL(BD.CREATE_USER_ID,'')AS CREATE_USER_ID
      , ISNULL(BD.CREATE_DATE,'')AS CREATE_DATE
      , ISNULL(BD.UPDATE_USER_ID,'')AS UPDATE_USER_ID
      , ISNULL(BD.UPDATE_DATE,'')AS UPDATE_DATE
      , (BD.M1+BD.M2+BD.M3+BD.M4+BD.M5+BD.M6) AS H1
      , (BD.M7+BD.M8+BD.M9+BD.M10+BD.M11+BD.M12) AS H2
      , (BD.M1+BD.M2+BD.M3+BD.M4+BD.M5+BD.M6+BD.M7+BD.M8+BD.M9+BD.M10+BD.M11+BD.M12) AS Y1
      ,  BO.BUDGET_ORDER_NAME
      ,  AC.ACCOUNT_NO
      ,  AC.ACCOUNT_NAME
      ,  BO.COST, BO.COST_TYPE
      ,  DP.DEPT_NO
      ,  DP.DEPT_NAME
      ,  PIC.PERSON_IN_CHARGE_NO
      ,  PIC.PERSON_IN_CHARGE_NAME
      ,  ISNULL(BD.RRT1,0) AS RRT1
      ,  ISNULL(BD.RRT2,0) AS RRT2
      ,  ISNULL(BD.RRT3,0) AS RRT3
      ,  ISNULL(BD.RRT4,0) AS RRT4
      ,  ISNULL(BD.RRT5,0) AS RRT5
      ,  (ISNULL(OB_BUDGET_DATA.M1,0)+ISNULL(OB_BUDGET_DATA.M2,0)
      +ISNULL(OB_BUDGET_DATA.M3,0)+ISNULL(OB_BUDGET_DATA.M4,0)
      +ISNULL(OB_BUDGET_DATA.M5,0)+ISNULL(OB_BUDGET_DATA.M6,0)
      +ISNULL(OB_BUDGET_DATA.M7,0)+ISNULL(OB_BUDGET_DATA.M8,0)
      +ISNULL(OB_BUDGET_DATA.M9,0)+ISNULL(OB_BUDGET_DATA.M10,0)
      +ISNULL(OB_BUDGET_DATA.M11,0)+ISNULL(OB_BUDGET_DATA.M12,0)) AS RevYear
      ,ISNULL(PREVBD.RRT1,0) AS PrevRRT1
      ,ISNULL(PREVBD.RRT2,0) AS PrevRRT2
      ,ISNULL(PREVBD.RRT3,0) AS PrevRRT3
      ,ISNULL(PREVBD.RRT4,0) AS PrevRRT4
      ,ISNULL(PREVBD.RRT5,0) AS PrevRRT5

      ,(ISNULL(OB_BUDGET_DATA.M1,0)+ISNULL(OB_BUDGET_DATA.M2,0)+ISNULL(OB_BUDGET_DATA.M3,0)
      +ISNULL(OB_BUDGET_DATA.M4,0)+ISNULL(OB_BUDGET_DATA.M5,0)+ISNULL(OB_BUDGET_DATA.M6,0)
      +ISNULL(OB_BUDGET_DATA.M7,0)+ISNULL(OB_BUDGET_DATA.M8,0)+ISNULL(OB_BUDGET_DATA.M9,0)
      +ISNULL(OB_BUDGET_DATA.M10,0)+ISNULL(OB_BUDGET_DATA.M11,0)+ISNULL(OB_BUDGET_DATA.M12,0))
      - ISNULL(PREVBD.RRT2,0) AS DiffYear

      ,ISNULL(BD.RRT2, 0)  - ISNULL(PREVBD.RRT3, 0) AS DIFF_PREV_YEAR

      FROM
      (

      SELECT DISTINCT(OB_BUDGET_DATA.BUDGET_ORDER_NO) FROM  BG_T_BUDGET_DATA AS OB_BUDGET_DATA

      LEFT JOIN BG_M_BUDGET_ORDER AS BO
      ON OB_BUDGET_DATA.BUDGET_ORDER_NO = BO.BUDGET_ORDER_NO

      WHERE OB_BUDGET_DATA.BUDGET_YEAR = @BudgetYear
      AND OB_BUDGET_DATA.PERIOD_TYPE = @PeriodType
      AND OB_BUDGET_DATA.PROJECT_NO = @ProjectNo
      AND OB_BUDGET_DATA.REV_NO = (SELECT ISNULL(MAX(REV_NO),1) AS MAX_REV_NO FROM BG_T_BUDGET_HEADER WHERE BUDGET_YEAR = @BudgetYear AND PERIOD_TYPE = @PeriodType AND PROJECT_NO = @ProjectNo AND BUDGET_TYPE = '@BudgetType')
      AND BO.BUDGET_TYPE = '@BudgetType'
      AND BO.ACTIVE_FLAG = 1
      @AccountNo
      AND ((ISNULL(OB_BUDGET_DATA.RRT1,0)) &lt;&gt; 0
      OR (ISNULL(OB_BUDGET_DATA.RRT2,0)) &lt;&gt; 0
      OR (ISNULL(OB_BUDGET_DATA.RRT3,0)) &lt;&gt; 0
      OR (ISNULL(OB_BUDGET_DATA.RRT4,0)) &lt;&gt; 0
      OR (ISNULL(OB_BUDGET_DATA.RRT5,0)) &lt;&gt; 0)

      UNION

      SELECT DISTINCT(OB_BUDGET_DATA.BUDGET_ORDER_NO) FROM  BG_T_BUDGET_DATA AS OB_BUDGET_DATA

      LEFT JOIN BG_M_BUDGET_ORDER AS BO
      ON OB_BUDGET_DATA.BUDGET_ORDER_NO = BO.BUDGET_ORDER_NO

      WHERE OB_BUDGET_DATA.BUDGET_YEAR = @BudgetYear +1
      AND OB_BUDGET_DATA.PERIOD_TYPE = 1
      AND OB_BUDGET_DATA.PROJECT_NO = @RefRBProjectNo
      AND OB_BUDGET_DATA.REV_NO = @RefRBRevNo
      AND BO.BUDGET_TYPE =  '@BudgetType'
      AND BO.ACTIVE_FLAG = 1
      @AccountNo
      AND ((ISNULL(OB_BUDGET_DATA.M1,0)+ISNULL(OB_BUDGET_DATA.M2,0)+ISNULL(OB_BUDGET_DATA.M3,0)+ISNULL(OB_BUDGET_DATA.M4,0)
      +ISNULL(OB_BUDGET_DATA.M5,0)+ISNULL(OB_BUDGET_DATA.M6,0)+ISNULL(OB_BUDGET_DATA.M7,0)+ISNULL(OB_BUDGET_DATA.M8,0)
      +ISNULL(OB_BUDGET_DATA.M9,0)+ISNULL(OB_BUDGET_DATA.M10,0)+ISNULL(OB_BUDGET_DATA.M11,0)+ISNULL(OB_BUDGET_DATA.M12,0)) &lt;&gt; 0)

      UNION

      SELECT DISTINCT(OB_BUDGET_DATA.BUDGET_ORDER_NO) FROM  BG_T_BUDGET_DATA AS OB_BUDGET_DATA

      LEFT JOIN BG_M_BUDGET_ORDER AS BO
      ON OB_BUDGET_DATA.BUDGET_ORDER_NO = BO.BUDGET_ORDER_NO

      WHERE OB_BUDGET_DATA.BUDGET_YEAR = @BudgetYear -1
      AND OB_BUDGET_DATA.PERIOD_TYPE = @PeriodType
      AND OB_BUDGET_DATA.PROJECT_NO = @ProjectNo
      AND OB_BUDGET_DATA.REV_NO = (SELECT ISNULL(MAX(REV_NO),1) AS MAX_REV_NO FROM BG_T_BUDGET_HEADER WHERE BUDGET_YEAR = @BudgetYear -1 AND PERIOD_TYPE = @PeriodType AND PROJECT_NO = @ProjectNo AND BUDGET_TYPE = '@BudgetType')
      AND BO.BUDGET_TYPE = '@BudgetType'
      AND BO.ACTIVE_FLAG = 1
      @AccountNo
      AND ((ISNULL(OB_BUDGET_DATA.RRT1,0)) &lt;&gt; 0
      OR (ISNULL(OB_BUDGET_DATA.RRT2,0)) &lt;&gt; 0
      OR (ISNULL(OB_BUDGET_DATA.RRT3,0)) &lt;&gt; 0
      OR (ISNULL(OB_BUDGET_DATA.RRT4,0)) &lt;&gt; 0
      OR (ISNULL(OB_BUDGET_DATA.RRT5,0)) &lt;&gt; 0)

      ) AS BUDGET_ORDER_MAIN



      LEFT JOIN BG_M_BUDGET_ORDER AS BO
      ON BUDGET_ORDER_MAIN.BUDGET_ORDER_NO = BO.BUDGET_ORDER_NO

      LEFT JOIN BG_M_ACCOUNT AS AC
      ON BO.ACCOUNT_NO = AC.ACCOUNT_NO

      LEFT JOIN BG_M_DEPT AS DP
      ON BO.DEPT_NO = DP.DEPT_NO

      LEFT JOIN BG_M_PERSON_IN_CHARGE AS PIC
      ON BO.PERSON_IN_CHARGE_NO = PIC.PERSON_IN_CHARGE_NO


      LEFT JOIN  BG_T_BUDGET_DATA AS BD
      ON BD.BUDGET_ORDER_NO = BUDGET_ORDER_MAIN.BUDGET_ORDER_NO
      AND BD.BUDGET_YEAR = @BudgetYear
      AND BD.PERIOD_TYPE = @PeriodType
      AND BD.REV_NO = (SELECT ISNULL(MAX(REV_NO),1) AS MAX_REV_NO FROM BG_T_BUDGET_HEADER WHERE BUDGET_YEAR = @BudgetYear AND PERIOD_TYPE = @PeriodType AND PROJECT_NO = @ProjectNo AND BUDGET_TYPE =  '@BudgetType')
      AND BD.PROJECT_NO = @ProjectNo
      AND BO.BUDGET_TYPE =  '@BudgetType'
      AND BO.ACTIVE_FLAG = 1
      @AccountNo
      AND (
      BD.RRT1 &lt;&gt; 0
      OR BD.RRT2 &lt;&gt; 0
      OR BD.RRT3 &lt;&gt; 0
      OR BD.RRT4 &lt;&gt; 0
      OR BD.RRT5 &lt;&gt; 0)


      LEFT OUTER JOIN BG_T_BUDGET_DATA AS OB_BUDGET_DATA
      ON OB_BUDGET_DATA.BUDGET_YEAR = @BudgetYear +1
      AND OB_BUDGET_DATA.BUDGET_ORDER_NO = BUDGET_ORDER_MAIN.BUDGET_ORDER_NO
      AND OB_BUDGET_DATA.PERIOD_TYPE = 1
      AND OB_BUDGET_DATA.PROJECT_NO = @RefRBProjectNo
      AND OB_BUDGET_DATA.REV_NO = @RefRBRevNo


      LEFT JOIN BG_T_BUDGET_DATA PREVBD
      ON  BUDGET_ORDER_MAIN.BUDGET_ORDER_NO = PREVBD.BUDGET_ORDER_NO
      AND PREVBD.BUDGET_YEAR = (@BudgetYear - 1)
      AND PREVBD.PERIOD_TYPE  = @PeriodType
      AND PREVBD.PROJECT_NO = @RefRBProjectNo
      AND PREVBD.REV_NO = @RefRBRevNo
      AND (
      ISNULL(PREVBD.RRT1,0) &lt;&gt; 0
      OR ISNULL(PREVBD.RRT2,0) &lt;&gt; 0
      OR ISNULL(PREVBD.RRT3,0) &lt;&gt; 0
      OR ISNULL(PREVBD.RRT4,0) &lt;&gt; 0
      OR ISNULL(PREVBD.RRT5,0) &lt;&gt; 0
      )

    </SELECT028>

    
    <!--<SELECT028>
      SELECT
      BO.BUDGET_TYPE,
      BO.EXPENSE_TYPE,
      BD.BUDGET_YEAR, BD.PERIOD_TYPE, BD.PROJECT_NO, BD.BUDGET_ORDER_NO, BD.REV_NO,
      BD.M1, BD.M2, BD.M3, BD.M4, BD.M5, BD.M6, BD.M7, BD.M8, BD.M9, BD.M10, BD.M11, BD.M12, BD.REMARKS, BD.WB_FLAG, BD.CREATE_USER_ID, BD.CREATE_DATE, BD.UPDATE_USER_ID, BD.UPDATE_DATE,
      (BD.M1+BD.M2+BD.M3+BD.M4+BD.M5+BD.M6) AS H1,
      (BD.M7+BD.M8+BD.M9+BD.M10+BD.M11+BD.M12) AS H2,
      (BD.M1+BD.M2+BD.M3+BD.M4+BD.M5+BD.M6+BD.M7+BD.M8+BD.M9+BD.M10+BD.M11+BD.M12) AS Y1,
      BO.BUDGET_ORDER_NAME,
      AC.ACCOUNT_NO, AC.ACCOUNT_NAME,
      BO.COST, BO.COST_TYPE, DP.DEPT_NO, DP.DEPT_NAME,
      PIC.PERSON_IN_CHARGE_NO, PIC.PERSON_IN_CHARGE_NAME,
      BD.RRT1, BD.RRT2, BD.RRT3,
      BD.RRT4, BD.RRT5,
      (ISNULL(OB_BUDGET_DATA.M1,0)+ISNULL(OB_BUDGET_DATA.M2,0)+ISNULL(OB_BUDGET_DATA.M3,0)+ISNULL(OB_BUDGET_DATA.M4,0)+ISNULL(OB_BUDGET_DATA.M5,0)+ISNULL(OB_BUDGET_DATA.M6,0)+ISNULL(OB_BUDGET_DATA.M7,0)+ISNULL(OB_BUDGET_DATA.M8,0)+ISNULL(OB_BUDGET_DATA.M9,0)+ISNULL(OB_BUDGET_DATA.M10,0)+ISNULL(OB_BUDGET_DATA.M11,0)+ISNULL(OB_BUDGET_DATA.M12,0)) AS RevYear,
      ISNULL(PREVBD.RRT1,0) AS PrevRRT1,
      ISNULL(PREVBD.RRT2,0) AS PrevRRT2,
      ISNULL(PREVBD.RRT3,0) AS PrevRRT3,
      ISNULL(PREVBD.RRT4,0) AS PrevRRT4,
      ISNULL(PREVBD.RRT5,0) AS PrevRRT5,
      (ISNULL(OB_BUDGET_DATA.M1,0)+ISNULL(OB_BUDGET_DATA.M2,0)+ISNULL(OB_BUDGET_DATA.M3,0)+ISNULL(OB_BUDGET_DATA.M4,0)+ISNULL(OB_BUDGET_DATA.M5,0)+ISNULL(OB_BUDGET_DATA.M6,0)+ISNULL(OB_BUDGET_DATA.M7,0)+ISNULL(OB_BUDGET_DATA.M8,0)+ISNULL(OB_BUDGET_DATA.M9,0)+ISNULL(OB_BUDGET_DATA.M10,0)+ISNULL(OB_BUDGET_DATA.M11,0)+ISNULL(OB_BUDGET_DATA.M12,0))  - ISNULL(PREVBD.RRT2,0) AS DiffYear

      ,ISNULL(BD.RRT2, 0)  - ISNULL(PREVBD.RRT3, 0) AS DIFF_PREV_YEAR
      FROM BG_T_BUDGET_DATA AS BD

      LEFT JOIN BG_M_BUDGET_ORDER AS BO
      ON BD.BUDGET_ORDER_NO = BO.BUDGET_ORDER_NO

      LEFT JOIN BG_M_ACCOUNT AS AC
      ON BO.ACCOUNT_NO = AC.ACCOUNT_NO

      LEFT JOIN BG_M_DEPT AS DP
      ON BO.DEPT_NO = DP.DEPT_NO

      LEFT JOIN BG_M_PERSON_IN_CHARGE AS PIC
      ON BO.PERSON_IN_CHARGE_NO = PIC.PERSON_IN_CHARGE_NO

      LEFT JOIN BG_T_BUDGET_HEADER AS BH
      ON BD.BUDGET_YEAR = BH.BUDGET_YEAR AND
      BD.PERIOD_TYPE = BH.PERIOD_TYPE AND
      BO.PERSON_IN_CHARGE_NO = BH.PERSON_IN_CHARGE_NO AND
      BO.BUDGET_TYPE = BH.BUDGET_TYPE AND
      BD.REV_NO = BH.REV_NO AND
      BD.PROJECT_NO = BH.PROJECT_NO

      LEFT JOIN BG_T_BUDGET_DATA RVBD
      ON BD.BUDGET_YEAR = RVBD.BUDGET_YEAR
      AND BD.BUDGET_ORDER_NO = RVBD.BUDGET_ORDER_NO
      AND  RVBD.PERIOD_TYPE = 3
      AND RVBD.PROJECT_NO = @RefRBProjectNo
      AND RVBD.REV_NO = @RefRBRevNo
     

      LEFT JOIN BG_T_BUDGET_DATA PREVBD
      ON BD.BUDGET_ORDER_NO = PREVBD.BUDGET_ORDER_NO
      AND PREVBD.BUDGET_YEAR = (@BudgetYear - 1)
      AND BD.PERIOD_TYPE = PREVBD.PERIOD_TYPE
      AND PREVBD.PROJECT_NO = @MtpProjectNo
      AND PREVBD.REV_NO = @MtpRevNo
     

      LEFT OUTER JOIN BG_T_UPLOAD_DATA AS ACTUAL_DATA
      ON ACTUAL_DATA.BUDGET_YEAR = BD.BUDGET_YEAR
      AND ACTUAL_DATA.BUDGET_ORDER_NO = BD.BUDGET_ORDER_NO
      AND ACTUAL_DATA.DATA_TYPE = 2
      AND ACTUAL_DATA.PERIOD_TYPE = 3
      AND ACTUAL_DATA.PROJECT_NO = 1



      LEFT JOIN BG_T_BUDGET_DATA OB_RVBD
      ON BD.BUDGET_YEAR = OB_RVBD.BUDGET_YEAR
      AND BD.BUDGET_ORDER_NO = OB_RVBD.BUDGET_ORDER_NO
      AND  RVBD.PERIOD_TYPE = @REFPERIOD
      AND RVBD.PROJECT_NO = @RefRBProjectNo
      AND RVBD.REV_NO = @RefRBRevNo

      LEFT OUTER JOIN BG_T_UPLOAD_DATA AS OB_ACTUAL_DATA
      ON OB_ACTUAL_DATA.BUDGET_YEAR = BD.BUDGET_YEAR
      AND OB_ACTUAL_DATA.BUDGET_ORDER_NO = BD.BUDGET_ORDER_NO
      AND OB_ACTUAL_DATA.DATA_TYPE = 2
      AND OB_ACTUAL_DATA.PERIOD_TYPE = @REFPERIOD
      AND OB_ACTUAL_DATA.PROJECT_NO = 1


      LEFT OUTER JOIN BG_T_BUDGET_DATA AS OB_BUDGET_DATA
      ON OB_BUDGET_DATA.BUDGET_YEAR = BD.BUDGET_YEAR +1
      AND OB_BUDGET_DATA.BUDGET_ORDER_NO = BD.BUDGET_ORDER_NO
      AND OB_BUDGET_DATA.PERIOD_TYPE = 1
      AND OB_BUDGET_DATA.PROJECT_NO = @RefRBProjectNo
      AND OB_BUDGET_DATA.REV_NO = @RefRBRevNo



      WHERE
      BD.BUDGET_YEAR = @BudgetYear
      AND BD.PERIOD_TYPE = @PeriodType
      AND BD.REV_NO = (SELECT ISNULL(MAX(REV_NO),1) AS MAX_REV_NO FROM BG_T_BUDGET_HEADER
      WHERE BUDGET_YEAR = @BudgetYear
      AND PERIOD_TYPE = @PeriodType AND BUDGET_TYPE = '@BudgetType' AND PROJECT_NO = @ProjectNo)
      AND BD.PROJECT_NO = @ProjectNo
      AND BO.BUDGET_TYPE = '@BudgetType'
      AND BO.ACTIVE_FLAG = 1
      AND ((ISNULL(ACTUAL_DATA.M1,0)+ISNULL(ACTUAL_DATA.M2,0)+ISNULL(ACTUAL_DATA.M3,0)+ISNULL(RVBD.M4,0)+ISNULL(RVBD.M5,0)+ISNULL(RVBD.M6,0)+ISNULL(RVBD.M7,0)+ISNULL(RVBD.M8,0)+ISNULL(RVBD.M9,0)+ISNULL(RVBD.M10,0)+ISNULL(RVBD.M11,0)+ISNULL(RVBD.M12,0)) &lt;&gt; 0
      OR ISNULL(PREVBD.RRT1,0) &lt;&gt; 0
      OR ISNULL(PREVBD.RRT2,0) &lt;&gt; 0
      OR ISNULL(PREVBD.RRT3,0) &lt;&gt; 0
      OR ISNULL(PREVBD.RRT4,0) &lt;&gt; 0
      OR ISNULL(PREVBD.RRT5,0) &lt;&gt; 0
      OR BD.RRT1 &lt;&gt; 0
      OR BD.RRT2 &lt;&gt; 0
      OR BD.RRT3 &lt;&gt; 0
      OR BD.RRT4 &lt;&gt; 0
      OR BD.RRT5 &lt;&gt; 0)
      /*AND BH.Status >= @Status
      AND (ISNULL(BD.RRT1 ,0) &lt;&gt; 0
      OR ISNULL(BD.RRT2 ,0) &lt;&gt; 0
      OR ISNULL(BD.RRT3 ,0) &lt;&gt; 0
      OR ISNULL(BD.RRT4 ,0) &lt;&gt; 0
      OR ISNULL(BD.RRT5 ,0) &lt;&gt; 0)*/
      @AccountNo
      ORDER BY BD.BUDGET_ORDER_NO
    </SELECT028>-->

    <SELECT028_2>
      SELECT
      BO.BUDGET_TYPE
      , BO.EXPENSE_TYPE
      , ISNULL(BD.BUDGET_YEAR ,@BudgetYear)AS BUDGET_YEAR
      , ISNULL(BD.PERIOD_TYPE, @PeriodType) AS PERIOD_TYPE
      , ISNULL(BD.PROJECT_NO, @ProjectNo) AS PROJECT_NO
      , BUDGET_ORDER_MAIN.BUDGET_ORDER_NO
      , ISNULL(BD.REV_NO,@RevNo) AS REV_NO
      , ISNULL(BD.M1,0) AS M1
      , ISNULL(BD.M2,0) AS M2
      , ISNULL(BD.M3,0) AS M3
      , ISNULL(BD.M4,0) AS M4
      , ISNULL(BD.M5,0) AS M5
      , ISNULL(BD.M6,0) AS M6
      , ISNULL(BD.M7,0) AS M7
      , ISNULL(BD.M8,0) AS M8
      , ISNULL(BD.M9,0) AS M9
      , ISNULL(BD.M10,0) AS M10
      , ISNULL(BD.M11,0) AS M11
      , ISNULL(BD.M12,0) AS M12
      , ISNULL(BD.REMARKS,'') AS REMARKS
      , ISNULL(BD.WB_FLAG,OB_BUDGET_DATA.WB_FLAG) AS WB_FLAG
      , ISNULL(BD.CREATE_USER_ID,'')AS CREATE_USER_ID
      , ISNULL(BD.CREATE_DATE,'')AS CREATE_DATE
      , ISNULL(BD.UPDATE_USER_ID,'')AS UPDATE_USER_ID
      , ISNULL(BD.UPDATE_DATE,'')AS UPDATE_DATE
      , (BD.M1+BD.M2+BD.M3+BD.M4+BD.M5+BD.M6) AS H1
      , (BD.M7+BD.M8+BD.M9+BD.M10+BD.M11+BD.M12) AS H2
      , (BD.M1+BD.M2+BD.M3+BD.M4+BD.M5+BD.M6+BD.M7+BD.M8+BD.M9+BD.M10+BD.M11+BD.M12) AS Y1
      ,  BO.BUDGET_ORDER_NAME
      ,  AC.ACCOUNT_NO
      ,  AC.ACCOUNT_NAME
      ,  BO.COST, BO.COST_TYPE
      ,  DP.DEPT_NO
      ,  DP.DEPT_NAME
      ,  PIC.PERSON_IN_CHARGE_NO
      ,  PIC.PERSON_IN_CHARGE_NAME
      ,  ISNULL(BD.RRT1,0) AS RRT1
      ,  ISNULL(BD.RRT2,0) AS RRT2
      ,  ISNULL(BD.RRT3,0) AS RRT3
      ,  ISNULL(BD.RRT4,0) AS RRT4
      ,  ISNULL(BD.RRT5,0) AS RRT5
      ,  (ISNULL(OB_BUDGET_DATA.M1,0)+ISNULL(OB_BUDGET_DATA.M2,0)
      +ISNULL(OB_BUDGET_DATA.M3,0)+ISNULL(OB_BUDGET_DATA.M4,0)
      +ISNULL(OB_BUDGET_DATA.M5,0)+ISNULL(OB_BUDGET_DATA.M6,0)
      +ISNULL(OB_BUDGET_DATA.M7,0)+ISNULL(OB_BUDGET_DATA.M8,0)
      +ISNULL(OB_BUDGET_DATA.M9,0)+ISNULL(OB_BUDGET_DATA.M10,0)
      +ISNULL(OB_BUDGET_DATA.M11,0)+ISNULL(OB_BUDGET_DATA.M12,0)) AS RevYear
      ,ISNULL(PREVBD.RRT1,0) AS PrevRRT1
      ,ISNULL(PREVBD.RRT2,0) AS PrevRRT2
      ,ISNULL(PREVBD.RRT3,0) AS PrevRRT3
      ,ISNULL(PREVBD.RRT4,0) AS PrevRRT4
      ,ISNULL(PREVBD.RRT5,0) AS PrevRRT5

      ,(ISNULL(OB_BUDGET_DATA.M1,0)+ISNULL(OB_BUDGET_DATA.M2,0)+ISNULL(OB_BUDGET_DATA.M3,0)
      +ISNULL(OB_BUDGET_DATA.M4,0)+ISNULL(OB_BUDGET_DATA.M5,0)+ISNULL(OB_BUDGET_DATA.M6,0)
      +ISNULL(OB_BUDGET_DATA.M7,0)+ISNULL(OB_BUDGET_DATA.M8,0)+ISNULL(OB_BUDGET_DATA.M9,0)
      +ISNULL(OB_BUDGET_DATA.M10,0)+ISNULL(OB_BUDGET_DATA.M11,0)+ISNULL(OB_BUDGET_DATA.M12,0))
      - ISNULL(PREVBD.RRT2,0) AS DiffYear

      ,ISNULL(BD.RRT2, 0)  - ISNULL(PREVBD.RRT3, 0) AS DIFF_PREV_YEAR

      FROM
      (

      SELECT DISTINCT(OB_BUDGET_DATA.BUDGET_ORDER_NO) FROM  BG_T_BUDGET_DATA AS OB_BUDGET_DATA

      LEFT JOIN BG_M_BUDGET_ORDER AS BO
      ON OB_BUDGET_DATA.BUDGET_ORDER_NO = BO.BUDGET_ORDER_NO

      WHERE OB_BUDGET_DATA.BUDGET_YEAR = @BudgetYear
      AND OB_BUDGET_DATA.PERIOD_TYPE = @PeriodType
      AND OB_BUDGET_DATA.PROJECT_NO = @ProjectNo
      AND OB_BUDGET_DATA.REV_NO = @RevNo
      AND BO.BUDGET_TYPE = '@BudgetType'
      AND BO.ACTIVE_FLAG = 1
      @AccountNo
      AND ((ISNULL(OB_BUDGET_DATA.RRT1,0)) &lt;&gt; 0
      OR (ISNULL(OB_BUDGET_DATA.RRT2,0)) &lt;&gt; 0
      OR (ISNULL(OB_BUDGET_DATA.RRT3,0)) &lt;&gt; 0
      OR (ISNULL(OB_BUDGET_DATA.RRT4,0)) &lt;&gt; 0
      OR (ISNULL(OB_BUDGET_DATA.RRT5,0)) &lt;&gt; 0)

      UNION

      SELECT DISTINCT(OB_BUDGET_DATA.BUDGET_ORDER_NO) FROM  BG_T_BUDGET_DATA AS OB_BUDGET_DATA

      LEFT JOIN BG_M_BUDGET_ORDER AS BO
      ON OB_BUDGET_DATA.BUDGET_ORDER_NO = BO.BUDGET_ORDER_NO

      WHERE OB_BUDGET_DATA.BUDGET_YEAR = @BudgetYear +1
      AND OB_BUDGET_DATA.PERIOD_TYPE = 1
      AND OB_BUDGET_DATA.PROJECT_NO = @RefRBProjectNo
      AND OB_BUDGET_DATA.REV_NO = @RefRBRevNo
      AND BO.BUDGET_TYPE =  '@BudgetType'
      AND BO.ACTIVE_FLAG = 1
      @AccountNo
      AND ((ISNULL(OB_BUDGET_DATA.M1,0)+ISNULL(OB_BUDGET_DATA.M2,0)+ISNULL(OB_BUDGET_DATA.M3,0)+ISNULL(OB_BUDGET_DATA.M4,0)
      +ISNULL(OB_BUDGET_DATA.M5,0)+ISNULL(OB_BUDGET_DATA.M6,0)+ISNULL(OB_BUDGET_DATA.M7,0)+ISNULL(OB_BUDGET_DATA.M8,0)
      +ISNULL(OB_BUDGET_DATA.M9,0)+ISNULL(OB_BUDGET_DATA.M10,0)+ISNULL(OB_BUDGET_DATA.M11,0)+ISNULL(OB_BUDGET_DATA.M12,0)) &lt;&gt; 0)

      UNION


      SELECT DISTINCT(OB_BUDGET_DATA.BUDGET_ORDER_NO) FROM  BG_T_BUDGET_DATA AS OB_BUDGET_DATA

      LEFT JOIN BG_M_BUDGET_ORDER AS BO
      ON OB_BUDGET_DATA.BUDGET_ORDER_NO = BO.BUDGET_ORDER_NO

      WHERE OB_BUDGET_DATA.BUDGET_YEAR = @BudgetYear -1
      AND OB_BUDGET_DATA.PERIOD_TYPE = @PeriodType
      AND OB_BUDGET_DATA.PROJECT_NO = @ProjectNo
      AND OB_BUDGET_DATA.REV_NO = @RevNo
      AND BO.BUDGET_TYPE = '@BudgetType'
      AND BO.ACTIVE_FLAG = 1
      @AccountNo
      AND ((ISNULL(OB_BUDGET_DATA.RRT1,0)) &lt;&gt; 0
      OR (ISNULL(OB_BUDGET_DATA.RRT2,0)) &lt;&gt; 0
      OR (ISNULL(OB_BUDGET_DATA.RRT3,0)) &lt;&gt; 0
      OR (ISNULL(OB_BUDGET_DATA.RRT4,0)) &lt;&gt; 0
      OR (ISNULL(OB_BUDGET_DATA.RRT5,0)) &lt;&gt; 0)

      ) AS BUDGET_ORDER_MAIN



      LEFT JOIN BG_M_BUDGET_ORDER AS BO
      ON BUDGET_ORDER_MAIN.BUDGET_ORDER_NO = BO.BUDGET_ORDER_NO

      LEFT JOIN BG_M_ACCOUNT AS AC
      ON BO.ACCOUNT_NO = AC.ACCOUNT_NO

      LEFT JOIN BG_M_DEPT AS DP
      ON BO.DEPT_NO = DP.DEPT_NO

      LEFT JOIN BG_M_PERSON_IN_CHARGE AS PIC
      ON BO.PERSON_IN_CHARGE_NO = PIC.PERSON_IN_CHARGE_NO


      LEFT JOIN  BG_T_BUDGET_DATA AS BD
      ON BD.BUDGET_ORDER_NO = BUDGET_ORDER_MAIN.BUDGET_ORDER_NO
      AND BD.BUDGET_YEAR = @BudgetYear
      AND BD.PERIOD_TYPE = @PeriodType
      AND BD.REV_NO = @RevNo
      AND BD.PROJECT_NO = @ProjectNo
      AND BO.BUDGET_TYPE =  '@BudgetType'
      AND BO.ACTIVE_FLAG = 1
      @AccountNo
      AND (
      BD.RRT1 &lt;&gt; 0
      OR BD.RRT2 &lt;&gt; 0
      OR BD.RRT3 &lt;&gt; 0
      OR BD.RRT4 &lt;&gt; 0
      OR BD.RRT5 &lt;&gt; 0)


      LEFT OUTER JOIN BG_T_BUDGET_DATA AS OB_BUDGET_DATA
      ON OB_BUDGET_DATA.BUDGET_YEAR = @BudgetYear +1
      AND OB_BUDGET_DATA.BUDGET_ORDER_NO = BUDGET_ORDER_MAIN.BUDGET_ORDER_NO
      AND OB_BUDGET_DATA.PERIOD_TYPE = 1
      AND OB_BUDGET_DATA.PROJECT_NO = @RefRBProjectNo
      AND OB_BUDGET_DATA.REV_NO = @RefRBRevNo


      LEFT JOIN BG_T_BUDGET_DATA PREVBD
      ON  BUDGET_ORDER_MAIN.BUDGET_ORDER_NO = PREVBD.BUDGET_ORDER_NO
      AND PREVBD.BUDGET_YEAR = (@BudgetYear - 1)
      AND PREVBD.PERIOD_TYPE  = @PeriodType
      AND PREVBD.PROJECT_NO = @RefRBProjectNo
      AND PREVBD.REV_NO = @RefRBRevNo
      AND (
      ISNULL(PREVBD.RRT1,0) &lt;&gt; 0
      OR ISNULL(PREVBD.RRT2,0) &lt;&gt; 0
      OR ISNULL(PREVBD.RRT3,0) &lt;&gt; 0
      OR ISNULL(PREVBD.RRT4,0) &lt;&gt; 0
      OR ISNULL(PREVBD.RRT5,0) &lt;&gt; 0
      )

    </SELECT028_2>
    
    <!--<SELECT028_2>
      SELECT
      BO.BUDGET_TYPE,
      BO.EXPENSE_TYPE,
      BD.BUDGET_YEAR, BD.PERIOD_TYPE, BD.PROJECT_NO, BD.BUDGET_ORDER_NO, BD.REV_NO,
      BD.M1, BD.M2, BD.M3, BD.M4, BD.M5, BD.M6, BD.M7, BD.M8, BD.M9, BD.M10, BD.M11, BD.M12, BD.REMARKS, BD.WB_FLAG, BD.CREATE_USER_ID, BD.CREATE_DATE, BD.UPDATE_USER_ID, BD.UPDATE_DATE,
      (BD.M1+BD.M2+BD.M3+BD.M4+BD.M5+BD.M6) AS H1,
      (BD.M7+BD.M8+BD.M9+BD.M10+BD.M11+BD.M12) AS H2,
      (BD.M1+BD.M2+BD.M3+BD.M4+BD.M5+BD.M6+BD.M7+BD.M8+BD.M9+BD.M10+BD.M11+BD.M12) AS Y1,
      BO.BUDGET_ORDER_NAME,
      AC.ACCOUNT_NO, AC.ACCOUNT_NAME,
      BO.COST, BO.COST_TYPE, DP.DEPT_NO, DP.DEPT_NAME,
      PIC.PERSON_IN_CHARGE_NO, PIC.PERSON_IN_CHARGE_NAME,
      BD.RRT1, BD.RRT2, BD.RRT3,
      BD.RRT4, BD.RRT5,
      (ISNULL(OB_BUDGET_DATA.M1,0)+ISNULL(OB_BUDGET_DATA.M2,0)+ISNULL(OB_BUDGET_DATA.M3,0)+ISNULL(OB_BUDGET_DATA.M4,0)+ISNULL(OB_BUDGET_DATA.M5,0)+ISNULL(OB_BUDGET_DATA.M6,0)+ISNULL(OB_BUDGET_DATA.M7,0)+ISNULL(OB_BUDGET_DATA.M8,0)+ISNULL(OB_BUDGET_DATA.M9,0)+ISNULL(OB_BUDGET_DATA.M10,0)+ISNULL(OB_BUDGET_DATA.M11,0)+ISNULL(OB_BUDGET_DATA.M12,0)) AS RevYear,
      ISNULL(PREVBD.RRT1,0) AS PrevRRT1,
      ISNULL(PREVBD.RRT2,0) AS PrevRRT2,
      ISNULL(PREVBD.RRT3,0) AS PrevRRT3,
      ISNULL(PREVBD.RRT4,0) AS PrevRRT4,
      ISNULL(PREVBD.RRT5,0) AS PrevRRT5,
      (ISNULL(OB_BUDGET_DATA.M1,0)+ISNULL(OB_BUDGET_DATA.M2,0)+ISNULL(OB_BUDGET_DATA.M3,0)+ISNULL(OB_BUDGET_DATA.M4,0)+ISNULL(OB_BUDGET_DATA.M5,0)+ISNULL(OB_BUDGET_DATA.M6,0)+ISNULL(OB_BUDGET_DATA.M7,0)+ISNULL(OB_BUDGET_DATA.M8,0)+ISNULL(OB_BUDGET_DATA.M9,0)+ISNULL(OB_BUDGET_DATA.M10,0)+ISNULL(OB_BUDGET_DATA.M11,0)+ISNULL(OB_BUDGET_DATA.M12,0))  - ISNULL(PREVBD.RRT2,0) AS DiffYear

      ,ISNULL(BD.RRT2, 0)  - ISNULL(PREVBD.RRT3, 0) AS DIFF_PREV_YEAR

      FROM BG_T_BUDGET_DATA AS BD

      LEFT JOIN BG_M_BUDGET_ORDER AS BO
      ON BD.BUDGET_ORDER_NO = BO.BUDGET_ORDER_NO

      LEFT JOIN BG_M_ACCOUNT AS AC
      ON BO.ACCOUNT_NO = AC.ACCOUNT_NO

      LEFT JOIN BG_M_DEPT AS DP
      ON BO.DEPT_NO = DP.DEPT_NO

      LEFT JOIN BG_M_PERSON_IN_CHARGE AS PIC
      ON BO.PERSON_IN_CHARGE_NO = PIC.PERSON_IN_CHARGE_NO

      LEFT JOIN BG_T_BUDGET_HEADER AS BH
      ON BD.BUDGET_YEAR = BH.BUDGET_YEAR AND
      BD.PERIOD_TYPE = BH.PERIOD_TYPE AND
      BO.PERSON_IN_CHARGE_NO = BH.PERSON_IN_CHARGE_NO AND
      BO.BUDGET_TYPE = BH.BUDGET_TYPE AND
      BD.REV_NO = BH.REV_NO AND
      BD.PROJECT_NO = BH.PROJECT_NO

      LEFT JOIN BG_T_BUDGET_DATA RVBD
      ON BD.BUDGET_YEAR = RVBD.BUDGET_YEAR
      AND BD.BUDGET_ORDER_NO = RVBD.BUDGET_ORDER_NO
      AND  RVBD.PERIOD_TYPE = 3
      AND RVBD.PROJECT_NO = @RefRBProjectNo
      AND RVBD.REV_NO = @RefRBRevNo
    
      LEFT JOIN BG_T_BUDGET_DATA PREVBD
      ON BD.BUDGET_ORDER_NO = PREVBD.BUDGET_ORDER_NO
      AND PREVBD.BUDGET_YEAR = (@BudgetYear - 1)
      AND BD.PERIOD_TYPE = PREVBD.PERIOD_TYPE     
      AND PREVBD.PROJECT_NO = @MtpProjectNo
      AND PREVBD.REV_NO = @MtpRevNo

      LEFT OUTER JOIN BG_T_UPLOAD_DATA AS ACTUAL_DATA
      ON ACTUAL_DATA.BUDGET_YEAR = BD.BUDGET_YEAR
      AND ACTUAL_DATA.BUDGET_ORDER_NO = BD.BUDGET_ORDER_NO
      AND ACTUAL_DATA.DATA_TYPE = 2
      AND ACTUAL_DATA.PERIOD_TYPE = 3
      AND ACTUAL_DATA.PROJECT_NO = 1

      LEFT JOIN BG_T_BUDGET_DATA OB_RVBD
      ON BD.BUDGET_YEAR = OB_RVBD.BUDGET_YEAR
      AND BD.BUDGET_ORDER_NO = OB_RVBD.BUDGET_ORDER_NO
      AND  RVBD.PERIOD_TYPE = @REFPERIOD
      AND RVBD.PROJECT_NO = @RefRBProjectNo
      AND RVBD.REV_NO = @RefRBRevNo

      LEFT OUTER JOIN BG_T_UPLOAD_DATA AS OB_ACTUAL_DATA
      ON OB_ACTUAL_DATA.BUDGET_YEAR = BD.BUDGET_YEAR
      AND OB_ACTUAL_DATA.BUDGET_ORDER_NO = BD.BUDGET_ORDER_NO
      AND OB_ACTUAL_DATA.DATA_TYPE = 2
      AND OB_ACTUAL_DATA.PERIOD_TYPE = @REFPERIOD
      AND OB_ACTUAL_DATA.PROJECT_NO = 1

      LEFT OUTER JOIN BG_T_BUDGET_DATA AS OB_BUDGET_DATA
      ON OB_BUDGET_DATA.BUDGET_YEAR = BD.BUDGET_YEAR +1
      AND OB_BUDGET_DATA.BUDGET_ORDER_NO = BD.BUDGET_ORDER_NO
      AND OB_BUDGET_DATA.PERIOD_TYPE = 1
      AND OB_BUDGET_DATA.PROJECT_NO = @RefRBProjectNo
      AND OB_BUDGET_DATA.REV_NO = @RefRBRevNo


      WHERE
      BD.BUDGET_YEAR = @BudgetYear
      AND BD.PERIOD_TYPE = @PeriodType
      AND BD.REV_NO = @RevNo
      AND BD.PROJECT_NO = @ProjectNo
      AND BO.BUDGET_TYPE = '@BudgetType'
      AND BO.ACTIVE_FLAG = 1
      AND ((ISNULL(OB_BUDGET_DATA.M1,0)+ISNULL(OB_BUDGET_DATA.M2,0)+ISNULL(OB_BUDGET_DATA.M3,0)+ISNULL(OB_BUDGET_DATA.M4,0)+ISNULL(OB_BUDGET_DATA.M5,0)+ISNULL(OB_BUDGET_DATA.M6,0)+ISNULL(OB_BUDGET_DATA.M7,0)+ISNULL(OB_BUDGET_DATA.M8,0)+ISNULL(OB_BUDGET_DATA.M9,0)+ISNULL(OB_BUDGET_DATA.M10,0)+ISNULL(OB_BUDGET_DATA.M11,0)+ISNULL(OB_BUDGET_DATA.M12,0)) &lt;&gt; 0
      OR ISNULL(PREVBD.RRT1,0) &lt;&gt; 0
      OR ISNULL(PREVBD.RRT2,0) &lt;&gt; 0
      OR ISNULL(PREVBD.RRT3,0) &lt;&gt; 0
      OR ISNULL(PREVBD.RRT4,0) &lt;&gt; 0
      OR ISNULL(PREVBD.RRT5,0) &lt;&gt; 0
      OR BD.RRT1 &lt;&gt; 0
      OR BD.RRT2 &lt;&gt; 0
      OR BD.RRT3 &lt;&gt; 0
      OR BD.RRT4 &lt;&gt; 0
      OR BD.RRT5 &lt;&gt; 0)
      /*AND BH.Status >= @Status
      AND (ISNULL(BD.RRT1 ,0) &lt;&gt; 0
      OR ISNULL(BD.RRT2 ,0) &lt;&gt; 0
      OR ISNULL(BD.RRT3 ,0) &lt;&gt; 0
      OR ISNULL(BD.RRT4 ,0) &lt;&gt; 0
      OR ISNULL(BD.RRT5 ,0) &lt;&gt; 0)*/
      @AccountNo
      ORDER BY BD.BUDGET_ORDER_NO
    </SELECT028_2>-->
    <SELECT029>
      SELECT
      BO.BUDGET_TYPE,
      BO.EXPENSE_TYPE,
      BD.BUDGET_YEAR,
      BD.PERIOD_TYPE,
      BD.PROJECT_NO,
      AC.ACCOUNT_NO ,
      AC.ACCOUNT_NAME ,

      --SUM((ISNULL(OB_BUDGET_DATA.M1,0)
      --+ISNULL(OB_BUDGET_DATA.M2,0)
      --+ISNULL(OB_BUDGET_DATA.M3,0)
      --+ISNULL(OB_BUDGET_DATA.M4,0)
      --+ISNULL(OB_BUDGET_DATA.M5,0)
      --+ISNULL(OB_BUDGET_DATA.M6,0)
      --+ISNULL(OB_BUDGET_DATA.M7,0)
      --+ISNULL(OB_BUDGET_DATA.M8,0)
      --+ISNULL(OB_BUDGET_DATA.M9,0)
      --+ISNULL(OB_BUDGET_DATA.M10,0)
      --+ISNULL(OB_BUDGET_DATA.M11,0)
      --+ISNULL(OB_BUDGET_DATA.M12,0))) AS REVYEAR,

      (
      SELECT SUM(ISNULL(M1,0)+ISNULL(M2,0)+ISNULL(M3,0)+ISNULL(M4,0)+ISNULL(M5,0)+ISNULL(M6,0)+ISNULL(M7,0)+ISNULL(M8,0)
      +ISNULL(M9,0)+ISNULL(M10,0)+ISNULL(M11,0)+ISNULL(M12,0)) from  BG_T_BUDGET_DATA AS OB_BUDGET_DATA
      LEFT JOIN BG_M_BUDGET_ORDER AS BOO
      ON OB_BUDGET_DATA.BUDGET_ORDER_NO = BOO.BUDGET_ORDER_NO
      LEFT JOIN BG_M_ACCOUNT AS ACC
      ON BOO.ACCOUNT_NO = ACC.ACCOUNT_NO
      Where OB_BUDGET_DATA.BUDGET_YEAR = (@BudgetYear + 1)
      AND OB_BUDGET_DATA.PERIOD_TYPE = 1
      AND OB_BUDGET_DATA.PROJECT_NO = @RefRBProjectNo
      AND OB_BUDGET_DATA.REV_NO = @RefRBRevNo
      AND BOO.BUDGET_TYPE = 'E'
      AND BOO.ACTIVE_FLAG = 1
      AND ACC.ACCOUNT_NO = AC.ACCOUNT_NO
      AND BOO.EXPENSE_TYPE = BO.EXPENSE_TYPE
      )  AS REVYEAR,




      --SUM(CASE WHEN BO.COST = 2  THEN (ISNULL(OB_BUDGET_DATA.M1,0)
      --+ISNULL(OB_BUDGET_DATA.M2,0)
      --+ISNULL(OB_BUDGET_DATA.M3,0)
      --+ISNULL(OB_BUDGET_DATA.M4,0)
      --+ISNULL(OB_BUDGET_DATA.M5,0)
      --+ISNULL(OB_BUDGET_DATA.M6,0)
      --+ISNULL(OB_BUDGET_DATA.M7,0)
      --+ISNULL(OB_BUDGET_DATA.M8,0)
      --+ISNULL(OB_BUDGET_DATA.M9,0)
      --+ISNULL(OB_BUDGET_DATA.M10,0)
      --+ISNULL(OB_BUDGET_DATA.M11,0)
      --+ISNULL(OB_BUDGET_DATA.M12,0)) ELSE 0 END) AS ADMIN_REVYEAR,

      ISNULL((
      SELECT SUM(ISNULL(M1,0)+ISNULL(M2,0)+ISNULL(M3,0)+ISNULL(M4,0)+ISNULL(M5,0)+ISNULL(M6,0)+ISNULL(M7,0)+ISNULL(M8,0)
      +ISNULL(M9,0)+ISNULL(M10,0)+ISNULL(M11,0)+ISNULL(M12,0)) from  BG_T_BUDGET_DATA AS OB_BUDGET_DATA
      LEFT JOIN BG_M_BUDGET_ORDER AS BOO
      ON OB_BUDGET_DATA.BUDGET_ORDER_NO = BOO.BUDGET_ORDER_NO
      LEFT JOIN BG_M_ACCOUNT AS ACC
      ON BOO.ACCOUNT_NO = ACC.ACCOUNT_NO
      Where OB_BUDGET_DATA.BUDGET_YEAR = (@BudgetYear + 1)
      AND OB_BUDGET_DATA.PERIOD_TYPE = 1
      AND OB_BUDGET_DATA.PROJECT_NO = @RefRBProjectNo
      AND OB_BUDGET_DATA.REV_NO = @RefRBRevNo
      AND BOO.BUDGET_TYPE = 'E'
      AND BOO.ACTIVE_FLAG = 1
      AND ACC.ACCOUNT_NO = AC.ACCOUNT_NO
      AND BOO.EXPENSE_TYPE = BO.EXPENSE_TYPE
      AND BOO.COST = 2
      ),0)  AS ADMIN_REVYEAR,


      --SUM(CASE WHEN BO.COST = 1  THEN (ISNULL(OB_BUDGET_DATA.M1,0)
      --+ISNULL(OB_BUDGET_DATA.M2,0)
      --+ISNULL(OB_BUDGET_DATA.M3,0)
      --+ISNULL(OB_BUDGET_DATA.M4,0)
      --+ISNULL(OB_BUDGET_DATA.M5,0)
      --+ISNULL(OB_BUDGET_DATA.M6,0)
      --+ISNULL(OB_BUDGET_DATA.M7,0)
      --+ISNULL(OB_BUDGET_DATA.M8,0)
      --+ISNULL(OB_BUDGET_DATA.M9,0)
      --+ISNULL(OB_BUDGET_DATA.M10,0)
      --+ISNULL(OB_BUDGET_DATA.M11,0)
      --+ISNULL(OB_BUDGET_DATA.M12,0)) ELSE 0 END) AS FC_REVYEAR,

      ISNULL((
      SELECT SUM(ISNULL(M1,0)+ISNULL(M2,0)+ISNULL(M3,0)+ISNULL(M4,0)+ISNULL(M5,0)+ISNULL(M6,0)+ISNULL(M7,0)+ISNULL(M8,0)
      +ISNULL(M9,0)+ISNULL(M10,0)+ISNULL(M11,0)+ISNULL(M12,0)) from  BG_T_BUDGET_DATA AS OB_BUDGET_DATA
      LEFT JOIN BG_M_BUDGET_ORDER AS BOO
      ON OB_BUDGET_DATA.BUDGET_ORDER_NO = BOO.BUDGET_ORDER_NO
      LEFT JOIN BG_M_ACCOUNT AS ACC
      ON BOO.ACCOUNT_NO = ACC.ACCOUNT_NO
      Where OB_BUDGET_DATA.BUDGET_YEAR = (@BudgetYear + 1)
      AND OB_BUDGET_DATA.PERIOD_TYPE = 1
      AND OB_BUDGET_DATA.PROJECT_NO = @RefRBProjectNo
      AND OB_BUDGET_DATA.REV_NO = @RefRBRevNo
      AND BOO.BUDGET_TYPE = 'E'
      AND BOO.ACTIVE_FLAG = 1
      AND ACC.ACCOUNT_NO = AC.ACCOUNT_NO
      AND BOO.EXPENSE_TYPE = BO.EXPENSE_TYPE
      AND BOO.COST = 1
      ) ,0)
      AS FC_REVYEAR,



      SUM(ISNULL(BD.RRT1,0)) AS RRT1,
      SUM(ISNULL(BD.RRT2,0)) AS RRT2,
      SUM(ISNULL(BD.RRT3,0)) AS RRT3,
      SUM(ISNULL(BD.RRT4,0)) AS RRT4,
      SUM(ISNULL(BD.RRT5,0)) AS RRT5,
      SUM(ISNULL(PREVBD.RRT1,0)) AS PrevRRT1,
      SUM(ISNULL(PREVBD.RRT2,0)) AS PrevRRT2,
      SUM(ISNULL(PREVBD.RRT3,0)) AS PrevRRT3,
      SUM(ISNULL(PREVBD.RRT4,0)) AS PrevRRT4,
      SUM(ISNULL(PREVBD.RRT5,0)) AS PrevRRT5,

      --(SUM((ISNULL(OB_BUDGET_DATA.M1,0)+ISNULL(OB_BUDGET_DATA.M2,0)+ISNULL(OB_BUDGET_DATA.M3,0)+ISNULL(OB_BUDGET_DATA.M4,0)
      --+ISNULL(OB_BUDGET_DATA.M5,0)+ISNULL(OB_BUDGET_DATA.M6,0)+ISNULL(OB_BUDGET_DATA.M7,0)+ISNULL(OB_BUDGET_DATA.M8,0)+ISNULL(OB_BUDGET_DATA.M9,0)
      --+ISNULL(OB_BUDGET_DATA.M10,0)+ISNULL(OB_BUDGET_DATA.M11,0)+ISNULL(OB_BUDGET_DATA.M12,0)) - ISNULL(PREVBD.RRT2,0))) AS DiffYear,


      (
      SELECT SUM(ISNULL(M1,0)+ISNULL(M2,0)+ISNULL(M3,0)+ISNULL(M4,0)+ISNULL(M5,0)+ISNULL(M6,0)+ISNULL(M7,0)+ISNULL(M8,0)
      +ISNULL(M9,0)+ISNULL(M10,0)+ISNULL(M11,0)+ISNULL(M12,0)) from  BG_T_BUDGET_DATA AS OB_BUDGET_DATA
      LEFT JOIN BG_M_BUDGET_ORDER AS BOO
      ON OB_BUDGET_DATA.BUDGET_ORDER_NO = BOO.BUDGET_ORDER_NO
      LEFT JOIN BG_M_ACCOUNT AS ACC
      ON BOO.ACCOUNT_NO = ACC.ACCOUNT_NO
      Where OB_BUDGET_DATA.BUDGET_YEAR = (@BudgetYear + 1)
      AND OB_BUDGET_DATA.PERIOD_TYPE = 1
      AND OB_BUDGET_DATA.PROJECT_NO = @RefRBProjectNo
      AND OB_BUDGET_DATA.REV_NO = @RefRBRevNo
      AND BOO.BUDGET_TYPE = 'E'
      AND BOO.ACTIVE_FLAG = 1
      AND ACC.ACCOUNT_NO = AC.ACCOUNT_NO
      AND BOO.EXPENSE_TYPE = BO.EXPENSE_TYPE
      ) - SUM(ISNULL(PREVBD.RRT2,0))AS DiffYear,


      SUM((ISNULL(BD.RRT2,0)) - (ISNULL(PREVBD.RRT3,0))) AS DIFFRRT1,




      SUM(CASE WHEN BO.COST = 2  THEN (ISNULL(BD.RRT2,0) - ISNULL(PREVBD.RRT3,0)) ELSE 0 END) AS ADMIN_DIFFRRT1,

      SUM(CASE WHEN BO.COST = 1  THEN (ISNULL(BD.RRT2,0) - ISNULL(PREVBD.RRT3,0)) ELSE 0 END) AS FC_DIFFRRT1,




      SUM(CASE WHEN BO.COST = 2  THEN ISNULL(BD.RRT1,0) ELSE 0 END) AS ADMIN_RRT1,
      SUM(CASE WHEN BO.COST = 1  THEN ISNULL(BD.RRT1,0) ELSE 0 END) AS FC_RRT1,
      SUM(CASE WHEN BO.COST = 2  THEN ISNULL(BD.RRT2,0) ELSE 0 END) AS ADMIN_RRT2,
      SUM(CASE WHEN BO.COST = 1  THEN ISNULL(BD.RRT2,0) ELSE 0 END) AS FC_RRT2,
      SUM(CASE WHEN BO.COST = 2  THEN ISNULL(BD.RRT3,0) ELSE 0 END) AS ADMIN_RRT3,
      SUM(CASE WHEN BO.COST = 1  THEN ISNULL(BD.RRT3,0) ELSE 0 END) AS FC_RRT3,
      SUM(CASE WHEN BO.COST = 2  THEN ISNULL(BD.RRT4,0) ELSE 0 END) AS ADMIN_RRT4,
      SUM(CASE WHEN BO.COST = 1  THEN ISNULL(BD.RRT4,0) ELSE 0 END) AS FC_RRT4,
      SUM(CASE WHEN BO.COST = 2  THEN ISNULL(BD.RRT5,0) ELSE 0 END) AS ADMIN_RRT5,
      SUM(CASE WHEN BO.COST = 1  THEN ISNULL(BD.RRT5,0) ELSE 0 END) AS FC_RRT5,
      SUM(CASE WHEN BO.COST = 2  THEN ISNULL(PREVBD.RRT1,0) ELSE 0 END) AS ADMIN_PrevRRT1,
      SUM(CASE WHEN BO.COST = 1  THEN ISNULL(PREVBD.RRT1,0) ELSE 0 END) AS FC_PrevRRT1,
      SUM(CASE WHEN BO.COST = 2  THEN ISNULL(PREVBD.RRT2,0) ELSE 0 END) AS ADMIN_PrevRRT2,
      SUM(CASE WHEN BO.COST = 1  THEN ISNULL(PREVBD.RRT2,0) ELSE 0 END) AS FC_PrevRRT2,
      SUM(CASE WHEN BO.COST = 2  THEN ISNULL(PREVBD.RRT3,0) ELSE 0 END) AS ADMIN_PrevRRT3,
      SUM(CASE WHEN BO.COST = 1  THEN ISNULL(PREVBD.RRT3,0) ELSE 0 END) AS FC_PrevRRT3,
      SUM(CASE WHEN BO.COST = 2  THEN ISNULL(PREVBD.RRT4,0) ELSE 0 END) AS ADMIN_PrevRRT4,
      SUM(CASE WHEN BO.COST = 1  THEN ISNULL(PREVBD.RRT4,0) ELSE 0 END) AS FC_PrevRRT4,
      SUM(CASE WHEN BO.COST = 2  THEN ISNULL(PREVBD.RRT5,0) ELSE 0 END) AS ADMIN_PrevRRT5,
      SUM(CASE WHEN BO.COST = 1  THEN ISNULL(PREVBD.RRT5,0) ELSE 0 END) AS FC_PrevRRT5,

      --SUM(CASE WHEN BO.COST = 2  THEN (ISNULL(OB_BUDGET_DATA.M1,0)+ISNULL(OB_BUDGET_DATA.M2,0)+ISNULL(OB_BUDGET_DATA.M3,0)+ISNULL(OB_BUDGET_DATA.M4,0)+ISNULL(OB_BUDGET_DATA.M5,0)+ISNULL(OB_BUDGET_DATA.M6,0)+ISNULL(OB_BUDGET_DATA.M7,0)+ISNULL(OB_BUDGET_DATA.M8,0)+ISNULL(OB_BUDGET_DATA.M9,0)+ISNULL(OB_BUDGET_DATA.M10,0)+ISNULL(OB_BUDGET_DATA.M11,0)+ISNULL(OB_BUDGET_DATA.M12,0)) - ISNULL(PREVBD.RRT2,0) ELSE 0 END) AS ADMIN_DIFFYEAR,
      --SUM(CASE WHEN BO.COST = 1  THEN (ISNULL(OB_BUDGET_DATA.M1,0)+ISNULL(OB_BUDGET_DATA.M2,0)+ISNULL(OB_BUDGET_DATA.M3,0)+ISNULL(OB_BUDGET_DATA.M4,0)+ISNULL(OB_BUDGET_DATA.M5,0)+ISNULL(OB_BUDGET_DATA.M6,0)+ISNULL(OB_BUDGET_DATA.M7,0)+ISNULL(OB_BUDGET_DATA.M8,0)+ISNULL(OB_BUDGET_DATA.M9,0)+ISNULL(OB_BUDGET_DATA.M10,0)+ISNULL(OB_BUDGET_DATA.M11,0)+ISNULL(OB_BUDGET_DATA.M12,0)) - ISNULL(PREVBD.RRT2,0) ELSE 0 END) AS FC_DIFFYEAR,

      ISNULL(
      ( SELECT SUM(ISNULL(M1,0)+ISNULL(M2,0)+ISNULL(M3,0)+ISNULL(M4,0)+ISNULL(M5,0)+ISNULL(M6,0)+ISNULL(M7,0)+ISNULL(M8,0)
      +ISNULL(M9,0)+ISNULL(M10,0)+ISNULL(M11,0)+ISNULL(M12,0)) from  BG_T_BUDGET_DATA AS OB_BUDGET_DATA
      LEFT JOIN BG_M_BUDGET_ORDER AS BOO
      ON OB_BUDGET_DATA.BUDGET_ORDER_NO = BOO.BUDGET_ORDER_NO
      LEFT JOIN BG_M_ACCOUNT AS ACC
      ON BOO.ACCOUNT_NO = ACC.ACCOUNT_NO
      Where OB_BUDGET_DATA.BUDGET_YEAR = (@BudgetYear + 1)
      AND OB_BUDGET_DATA.PERIOD_TYPE = 1
      AND OB_BUDGET_DATA.PROJECT_NO = @RefRBProjectNo
      AND OB_BUDGET_DATA.REV_NO = @RefRBRevNo
      AND BOO.BUDGET_TYPE = 'E'
      AND BOO.ACTIVE_FLAG = 1
      AND ACC.ACCOUNT_NO = AC.ACCOUNT_NO
      AND BOO.EXPENSE_TYPE = BO.EXPENSE_TYPE
      AND BOO.COST = 2)
      - (SUM(CASE WHEN BO.COST = 2  THEN (ISNULL(PREVBD.RRT2,0)) ELSE 0 END))
      ,0)
      AS ADMIN_DIFFYEAR,


      ISNULL(  ( SELECT SUM(ISNULL(M1,0)+ISNULL(M2,0)+ISNULL(M3,0)+ISNULL(M4,0)+ISNULL(M5,0)+ISNULL(M6,0)+ISNULL(M7,0)+ISNULL(M8,0)
      +ISNULL(M9,0)+ISNULL(M10,0)+ISNULL(M11,0)+ISNULL(M12,0)) from  BG_T_BUDGET_DATA AS OB_BUDGET_DATA
      LEFT JOIN BG_M_BUDGET_ORDER AS BOO
      ON OB_BUDGET_DATA.BUDGET_ORDER_NO = BOO.BUDGET_ORDER_NO
      LEFT JOIN BG_M_ACCOUNT AS ACC
      ON BOO.ACCOUNT_NO = ACC.ACCOUNT_NO
      Where OB_BUDGET_DATA.BUDGET_YEAR = (@BudgetYear + 1)
      AND OB_BUDGET_DATA.PERIOD_TYPE = 1
      AND OB_BUDGET_DATA.PROJECT_NO = @RefRBProjectNo
      AND OB_BUDGET_DATA.REV_NO = @RefRBRevNo
      AND BOO.BUDGET_TYPE = 'E'
      AND BOO.ACTIVE_FLAG = 1
      AND ACC.ACCOUNT_NO = AC.ACCOUNT_NO
      AND BOO.EXPENSE_TYPE = BO.EXPENSE_TYPE
      AND BOO.COST = 1)
      - (SUM(CASE WHEN BO.COST = 1  THEN (ISNULL(PREVBD.RRT2,0)) ELSE 0 END))
      ,0)
      AS FC_DIFFYEAR,


      --SUM((ROUND(ISNULL(MIN_RVBD.M1,0),2)+ROUND(ISNULL(MIN_RVBD.M2,0),2)
      --+ROUND(ISNULL(MIN_RVBD.M3,0),2)+ROUND(ISNULL(MIN_RVBD.M4,0),2)
      --+ROUND(ISNULL(MIN_RVBD.M5,0),2)+ROUND(ISNULL(MIN_RVBD.M6,0),2)
      --+ROUND(ISNULL(MIN_RVBD.M7,0),2)+ROUND(ISNULL(MIN_RVBD.M8,0),2)
      --+ROUND(ISNULL(MIN_RVBD.M9,0),2)+ROUND(ISNULL(MIN_RVBD.M10,0),2)
      --+ROUND(ISNULL(MIN_RVBD.M11,0),2)+ROUND(ISNULL(MIN_RVBD.M12,0),2))


      --- (ROUND(ISNULL(OB_BUDGET_DATA.M1,0),2)+ROUND(ISNULL(OB_BUDGET_DATA.M2,0),2)+ROUND(ISNULL(OB_BUDGET_DATA.M3,0),2)
      --+ROUND(ISNULL(OB_BUDGET_DATA.M4,0),2)+ROUND(ISNULL(OB_BUDGET_DATA.M5,0),2)+ROUND(ISNULL(OB_BUDGET_DATA.M6,0),2)
      --+ROUND(ISNULL(OB_BUDGET_DATA.M7,0),2)+ROUND(ISNULL(OB_BUDGET_DATA.M8,0),2)+ROUND(ISNULL(OB_BUDGET_DATA.M9,0),2)
      --+ROUND(ISNULL(OB_BUDGET_DATA.M10,0),2)+ROUND(ISNULL(OB_BUDGET_DATA.M11,0),2)+ROUND(ISNULL(OB_BUDGET_DATA.M12,0),2)))
      --AS WBRevYear,

      (
      SELECT SUM(ISNULL(M1,0)+ISNULL(M2,0)+ISNULL(M3,0)+ISNULL(M4,0)+ISNULL(M5,0)+ISNULL(M6,0)+ISNULL(M7,0)+ISNULL(M8,0)
      +ISNULL(M9,0)+ISNULL(M10,0)+ISNULL(M11,0)+ISNULL(M12,0)) from  BG_T_BUDGET_DATA AS OB_BUDGET_DATA
      LEFT JOIN BG_M_BUDGET_ORDER AS BOO
      ON OB_BUDGET_DATA.BUDGET_ORDER_NO = BOO.BUDGET_ORDER_NO
      LEFT JOIN BG_M_ACCOUNT AS ACC
      ON BOO.ACCOUNT_NO = ACC.ACCOUNT_NO
      Where OB_BUDGET_DATA.BUDGET_YEAR = (@BudgetYear + 1)
      AND OB_BUDGET_DATA.PERIOD_TYPE = 1
      AND OB_BUDGET_DATA.PROJECT_NO = 1
      AND OB_BUDGET_DATA.REV_NO = 1
      AND BOO.BUDGET_TYPE = 'E'
      AND BOO.ACTIVE_FLAG = 1
      AND ACC.ACCOUNT_NO = AC.ACCOUNT_NO
      AND BOO.EXPENSE_TYPE = BO.EXPENSE_TYPE
      )

      -
      (
      SELECT SUM(ISNULL(M1,0)+ISNULL(M2,0)+ISNULL(M3,0)+ISNULL(M4,0)+ISNULL(M5,0)+ISNULL(M6,0)+ISNULL(M7,0)+ISNULL(M8,0)
      +ISNULL(M9,0)+ISNULL(M10,0)+ISNULL(M11,0)+ISNULL(M12,0)) from  BG_T_BUDGET_DATA AS OB_BUDGET_DATA
      LEFT JOIN BG_M_BUDGET_ORDER AS BOO
      ON OB_BUDGET_DATA.BUDGET_ORDER_NO = BOO.BUDGET_ORDER_NO
      LEFT JOIN BG_M_ACCOUNT AS ACC
      ON BOO.ACCOUNT_NO = ACC.ACCOUNT_NO
      Where OB_BUDGET_DATA.BUDGET_YEAR = (@BudgetYear + 1)
      AND OB_BUDGET_DATA.PERIOD_TYPE = 1
      AND OB_BUDGET_DATA.PROJECT_NO = @RefRBProjectNo
      AND OB_BUDGET_DATA.REV_NO = @RefRBRevNo
      AND BOO.BUDGET_TYPE = 'E'
      AND BOO.ACTIVE_FLAG = 1
      AND ACC.ACCOUNT_NO = AC.ACCOUNT_NO
      AND BOO.EXPENSE_TYPE = BO.EXPENSE_TYPE
      )AS WBRevYear,



      0 AS WBDiffYear,
      SUM(ROUND(ISNULL(MIN_REV.RRT1 ,0),2) - ROUND(ISNULL(BD.RRT1 ,0),2)) AS WB_RRT1,
      SUM(ROUND(ISNULL(MIN_REV.RRT2 ,0),2) - ROUND(ISNULL(BD.RRT2 ,0),2)) AS WB_RRT2,
      SUM(ROUND(ISNULL(MIN_REV.RRT3 ,0),2) - ROUND(ISNULL(BD.RRT3 ,0),2)) AS WB_RRT3,
      SUM(ROUND(ISNULL(MIN_REV.RRT4 ,0),2) - ROUND(ISNULL(BD.RRT4 ,0),2)) AS WB_RRT4,
      SUM(ROUND(ISNULL(MIN_REV.RRT5 ,0),2) - ROUND(ISNULL(BD.RRT5 ,0),2)) AS WB_RRT5,

      /*SUM(ISNULL(PREVBD.RRT1 ,0) - ISNULL(PREV_MIN_REV.RRT1 ,0)) AS PREV_WB_RRT1,
      SUM(ISNULL(PREVBD.RRT2 ,0) - ISNULL(PREV_MIN_REV.RRT2 ,0)) AS PREV_WB_RRT2,
      SUM(ISNULL(PREVBD.RRT3 ,0) - ISNULL(PREV_MIN_REV.RRT3 ,0)) AS PREV_WB_RRT3,
      SUM(ISNULL(PREVBD.RRT4 ,0) - ISNULL(PREV_MIN_REV.RRT4 ,0)) AS PREV_WB_RRT4,
      SUM(ISNULL(PREVBD.RRT5 ,0) - ISNULL(PREV_MIN_REV.RRT5 ,0)) AS PREV_WB_RRT5

      (SELECT ISNULL(WKRRT1,0) FROM BG_T_BUDGET_ADJUST WHERE BUDGET_YEAR=2018 AND PERIOD_TYPE=10 AND PROJECT_NO=1 AND REV_NO= @MtpRevNo) AS WB_RRT1,
      (SELECT ISNULL(WKRRT2,0) FROM BG_T_BUDGET_ADJUST WHERE BUDGET_YEAR=2018 AND PERIOD_TYPE=10 AND PROJECT_NO=1 AND REV_NO= @MtpRevNo) AS WB_RRT2,
      (SELECT ISNULL(WKRRT3,0) FROM BG_T_BUDGET_ADJUST WHERE BUDGET_YEAR=2018 AND PERIOD_TYPE=10 AND PROJECT_NO=1 AND REV_NO= @MtpRevNo) AS WB_RRT3,
      (SELECT ISNULL(WKRRT4,0) FROM BG_T_BUDGET_ADJUST WHERE BUDGET_YEAR=2018 AND PERIOD_TYPE=10 AND PROJECT_NO=1 AND REV_NO= @MtpRevNo) AS WB_RRT4,
      (SELECT ISNULL(WKRRT5,0) FROM BG_T_BUDGET_ADJUST WHERE BUDGET_YEAR=2018 AND PERIOD_TYPE=10 AND PROJECT_NO=1 AND REV_NO= @MtpRevNo) AS WB_RRT5,*/

      ISNULL((SELECT ISNULL(WKRRT1,0) FROM BG_T_BUDGET_ADJUST WHERE BUDGET_YEAR=2018 AND PERIOD_TYPE=10 AND PROJECT_NO=1 AND REV_NO= @MtpRevNo),0) AS PREV_WB_RRT1,
      ISNULL((SELECT ISNULL(WKRRT2,0) FROM BG_T_BUDGET_ADJUST WHERE BUDGET_YEAR=2018 AND PERIOD_TYPE=10 AND PROJECT_NO=1 AND REV_NO= @MtpRevNo),0) AS PREV_WB_RRT2,
      ISNULL((SELECT ISNULL(WKRRT3,0) FROM BG_T_BUDGET_ADJUST WHERE BUDGET_YEAR=2018 AND PERIOD_TYPE=10 AND PROJECT_NO=1 AND REV_NO= @MtpRevNo),0) AS PREV_WB_RRT3,
      ISNULL((SELECT ISNULL(WKRRT4,0) FROM BG_T_BUDGET_ADJUST WHERE BUDGET_YEAR=2018 AND PERIOD_TYPE=10 AND PROJECT_NO=1 AND REV_NO= @MtpRevNo),0) AS PREV_WB_RRT4,
      ISNULL((SELECT ISNULL(WKRRT5,0) FROM BG_T_BUDGET_ADJUST WHERE BUDGET_YEAR=2018 AND PERIOD_TYPE=10 AND PROJECT_NO=1 AND REV_NO= @MtpRevNo),0) AS PREV_WB_RRT5,

      0 AS WBDIFFRRT1

      FROM BG_T_BUDGET_DATA AS BD

      LEFT JOIN BG_M_BUDGET_ORDER AS BO
      ON BD.BUDGET_ORDER_NO = BO.BUDGET_ORDER_NO

      LEFT JOIN BG_M_ACCOUNT AS AC
      ON BO.ACCOUNT_NO = AC.ACCOUNT_NO

      LEFT JOIN BG_M_DEPT AS DP
      ON BO.DEPT_NO = DP.DEPT_NO

      LEFT JOIN BG_M_PERSON_IN_CHARGE AS PIC
      ON BO.PERSON_IN_CHARGE_NO = PIC.PERSON_IN_CHARGE_NO

      LEFT JOIN BG_T_BUDGET_HEADER AS BH
      ON BD.BUDGET_YEAR = BH.BUDGET_YEAR AND
      BD.PERIOD_TYPE = BH.PERIOD_TYPE AND
      BO.PERSON_IN_CHARGE_NO = BH.PERSON_IN_CHARGE_NO AND
      BO.BUDGET_TYPE = BH.BUDGET_TYPE AND
      BD.REV_NO = BH.REV_NO AND
      BD.PROJECT_NO = BH.PROJECT_NO

      LEFT JOIN BG_T_BUDGET_DATA RVBD
      ON BD.BUDGET_YEAR = RVBD.BUDGET_YEAR
      AND BD.BUDGET_ORDER_NO = RVBD.BUDGET_ORDER_NO
      AND  RVBD.PERIOD_TYPE = 3
      AND RVBD.PROJECT_NO = @RefRBProjectNo
      AND RVBD.REV_NO = @RefRBRevNo
      --AND RVBD.PROJECT_NO = 1
      --AND RVBD.REV_NO = (SELECT ISNULL(MAX(REV_NO),1) AS MAX_REV_NO FROM BG_T_BUDGET_HEADER
      --WHERE BUDGET_YEAR = @BudgetYear AND PERIOD_TYPE = 3 AND BUDGET_TYPE = 'E' AND PROJECT_NO = 1)

      LEFT JOIN BG_T_BUDGET_DATA MIN_RVBD
      ON BD.BUDGET_YEAR +1 = MIN_RVBD.BUDGET_YEAR
      AND BD.BUDGET_ORDER_NO = MIN_RVBD.BUDGET_ORDER_NO
      AND  MIN_RVBD.PERIOD_TYPE = 3
      AND MIN_RVBD.REV_NO = 1
      AND MIN_RVBD.PROJECT_NO = 1

      LEFT JOIN BG_T_BUDGET_DATA PREVBD
      ON BD.BUDGET_ORDER_NO = PREVBD.BUDGET_ORDER_NO
      AND PREVBD.BUDGET_YEAR = (@BudgetYear - 1)
      AND BD.PERIOD_TYPE = PREVBD.PERIOD_TYPE
      AND PREVBD.PROJECT_NO = @MtpProjectNo
      AND PREVBD.REV_NO = @MtpRevNo
      --AND PREVBD.PROJECT_NO = @PrevProjectNo
      --AND PREVBD.REV_NO = (SELECT ISNULL(MAX(REV_NO),1) AS MAX_REV_NO
      --FROM BG_T_BUDGET_HEADER
      --WHERE BUDGET_YEAR = (@BudgetYear - 1)
      --AND PERIOD_TYPE = 10
      --AND BUDGET_TYPE = 'E'
      --AND PROJECT_NO = @PrevProjectNo)

      LEFT JOIN BG_T_BUDGET_DATA AS PREV_MIN_REV
      ON PREV_MIN_REV.BUDGET_YEAR =  (@BudgetYear - 1)
      AND PREV_MIN_REV.PERIOD_TYPE = BD.PERIOD_TYPE
      AND PREV_MIN_REV.PROJECT_NO = @MtpProjectNo
      AND PREV_MIN_REV.BUDGET_ORDER_NO = BD.BUDGET_ORDER_NO
      AND PREV_MIN_REV.REV_NO = 1

      LEFT OUTER JOIN BG_T_UPLOAD_DATA AS ACTUAL_DATA
      ON ACTUAL_DATA.BUDGET_YEAR = BD.BUDGET_YEAR
      AND ACTUAL_DATA.BUDGET_ORDER_NO = BD.BUDGET_ORDER_NO
      AND ACTUAL_DATA.DATA_TYPE = 2
      AND ACTUAL_DATA.PERIOD_TYPE = 3
      AND ACTUAL_DATA.PROJECT_NO = 1

      LEFT OUTER JOIN BG_T_BUDGET_DATA AS MIN_REV
      ON MIN_REV.BUDGET_YEAR = BD.BUDGET_YEAR
      AND MIN_REV.PERIOD_TYPE = BD.PERIOD_TYPE
      AND MIN_REV.PROJECT_NO = BD.PROJECT_NO
      AND MIN_REV.BUDGET_ORDER_NO = BD.BUDGET_ORDER_NO
      AND MIN_REV.REV_NO = 1

      LEFT OUTER JOIN BG_T_BUDGET_DATA AS OB_BUDGET_DATA
      ON OB_BUDGET_DATA.BUDGET_YEAR = BD.BUDGET_YEAR +1
      AND OB_BUDGET_DATA.BUDGET_ORDER_NO = BD.BUDGET_ORDER_NO
      AND OB_BUDGET_DATA.PERIOD_TYPE = 1
      AND OB_BUDGET_DATA.PROJECT_NO = @RefRBProjectNo
      AND OB_BUDGET_DATA.REV_NO = @RefRBRevNo

      WHERE
      BD.BUDGET_YEAR = @BudgetYear
      AND BD.PERIOD_TYPE = @PeriodType
      AND BD.REV_NO = (SELECT ISNULL(MAX(REV_NO),1) AS MAX_REV_NO FROM BG_T_BUDGET_HEADER
      WHERE BUDGET_YEAR = @BudgetYear
      AND PERIOD_TYPE = @PeriodType AND BUDGET_TYPE = '@BudgetType' AND PROJECT_NO = @ProjectNo)
      AND BD.PROJECT_NO = @ProjectNo
      AND BO.BUDGET_TYPE = '@BudgetType'
      AND BO.ACTIVE_FLAG = 1
      /*AND BH.Status >= @Status
      AND ( OB_BUDGET_DATA.M1 &lt;&gt; 0
      OR OB_BUDGET_DATA.M2 &lt;&gt; 0
      OR OB_BUDGET_DATA.M3 &lt;&gt; 0
      OR OB_BUDGET_DATA.M4 &lt;&gt; 0
      OR OB_BUDGET_DATA.M5 &lt;&gt; 0
      OR OB_BUDGET_DATA.M6 &lt;&gt; 0
      OR OB_BUDGET_DATA.M7 &lt;&gt; 0
      OR OB_BUDGET_DATA.M8 &lt;&gt; 0
      OR OB_BUDGET_DATA.M9 &lt;&gt; 0
      OR OB_BUDGET_DATA.M10 &lt;&gt; 0
      OR OB_BUDGET_DATA.M11 &lt;&gt; 0
      OR OB_BUDGET_DATA.M12 &lt;&gt; 0
      OR BD.RRT1 &lt;&gt; 0
      OR BD.RRT2 &lt;&gt; 0
      OR BD.RRT3 &lt;&gt; 0
      OR BD.RRT4 &lt;&gt; 0
      OR BD.RRT5 &lt;&gt; 0
      OR PREVBD.RRT1 &lt;&gt; 0
      OR PREVBD.RRT2 &lt;&gt; 0
      OR PREVBD.RRT3 &lt;&gt; 0
      OR PREVBD.RRT4 &lt;&gt; 0
      OR PREVBD.RRT5 &lt;&gt; 0
      OR MIN_REV.RRT1 &lt;&gt; 0
      OR MIN_REV.RRT2 &lt;&gt; 0
      OR MIN_REV.RRT3 &lt;&gt; 0
      OR MIN_REV.RRT4 &lt;&gt; 0
      OR MIN_REV.RRT5 &lt;&gt; 0
      OR MIN_RVBD.M1 &lt;&gt; 0
      OR MIN_RVBD.M2 &lt;&gt; 0
      OR MIN_RVBD.M3 &lt;&gt; 0
      OR MIN_RVBD.M4 &lt;&gt; 0
      OR MIN_RVBD.M5 &lt;&gt; 0
      OR MIN_RVBD.M6 &lt;&gt; 0
      OR MIN_RVBD.M7 &lt;&gt; 0
      OR MIN_RVBD.M8 &lt;&gt; 0
      OR MIN_RVBD.M9 &lt;&gt; 0
      OR MIN_RVBD.M10 &lt;&gt; 0
      OR MIN_RVBD.M11 &lt;&gt; 0
      OR MIN_RVBD.M12 &lt;&gt; 0)*/
      GROUP BY BD.BUDGET_YEAR, BD.PERIOD_TYPE, BD.PROJECT_NO, AC.ACCOUNT_NO, AC.ACCOUNT_NAME , BO.BUDGET_TYPE , BO.EXPENSE_TYPE

      UNION

      SELECT 'A' AS BUDGET_TYPE,
      1 AS EXPENSE_TYPE,
      RVDB.BUDGET_YEAR,
      RVDB.PERIOD_TYPE,
      RVDB.PROJECT_NO,
      '' AS ACCOUNT_NO ,
      '' AS ACCOUNT_NAME ,


      ISNULL(RVDB.REVYEAR,0) AS REVYEAR,

      0 AS ADMIN_REVYEAR,
      0 AS FC_REVYEAR,

      ISNULL(BD.MTP_SUM1,0) AS RRT1,
      ISNULL(BD.MTP_SUM2,0) AS RRT2,
      ISNULL(BD.MTP_SUM3,0) AS RRT3,
      ISNULL(BD.MTP_SUM4,0) AS RRT4,
      ISNULL(BD.MTP_SUM5,0) AS RRT5,

      ISNULL(BD.MTP_PY_SUM1,0) AS PREVRRT1,
      ISNULL(BD.MTP_PY_SUM2,0) AS PREVRRT2,
      ISNULL(BD.MTP_PY_SUM3,0) AS PREVRRT3,
      ISNULL(BD.MTP_PY_SUM4,0) AS PREVRRT4,
      ISNULL(BD.MTP_PY_SUM5,0) AS PREVRRT5,

      (ISNULL(RVDB.REVYEAR,0) - ISNULL(BD.MTP_PY_SUM1,0)) AS DIFFYEAR,
      ISNULL(BD.MTP_SUM1,0) - ISNULL(BD.MTP_PY_SUM2,0) AS DIFFRRT1,

      0 AS ADMIN_DIFFRRT1,
      0 AS FC_DIFFRRT1,

      0 AS ADMIN_RRT1,
      0 AS FC_RRT1,
      0 AS ADMIN_RRT2,
      0 AS FC_RRT2,
      0 AS ADMIN_RRT3,
      0 AS FC_RRT3,
      0 AS ADMIN_RRT4,
      0 AS FC_RRT4,
      0 AS ADMIN_RRT5,
      0 AS FC_RRT5,
      0 AS ADMIN_PREVRRT1,
      0 AS FC_PREVRRT1,
      0 AS ADMIN_PREVRRT2,
      0 AS FC_PREVRRT2,
      0 AS ADMIN_PREVRRT3,
      0 AS FC_PREVRRT3,
      0 AS ADMIN_PREVRRT4,
      0 AS FC_PREVRRT4,
      0 AS ADMIN_PREVRRT5,
      0 AS FC_PREVRRT5,
      0 AS ADMIN_DIFFYEAR,
      0 AS FC_DIFFYEAR,
      0 AS WBREVYEAR,
      0 AS WBDIFFYEAR,
      0 AS WB_RRT1,
      0 AS WB_RRT2,
      0 AS WB_RRT3,
      0 AS WB_RRT4,
      0 AS WB_RRT5,

      0 AS PREV_WB_RRT1,
      0 AS PREV_WB_RRT2,
      0 AS PREV_WB_RRT3,
      0 AS PREV_WB_RRT4,
      0 AS PREV_WB_RRT5,

      0 AS WBDIFFRRT1


      FROM
      (SELECT RVBD.BUDGET_YEAR,RVBD.PERIOD_TYPE,RVBD.PROJECT_NO,


      --SUM((ISNULL(OB_BUDGET_DATA.M1,0)+ISNULL(OB_BUDGET_DATA.M2,0)+ISNULL(OB_BUDGET_DATA.M3,0)
      --+ISNULL(OB_BUDGET_DATA.M4,0)+ISNULL(OB_BUDGET_DATA.M5,0)+ISNULL(OB_BUDGET_DATA.M6,0)+ISNULL(OB_BUDGET_DATA.M7,0)+ISNULL(OB_BUDGET_DATA.M8,0)
      --+ISNULL(OB_BUDGET_DATA.M9,0)+ISNULL(OB_BUDGET_DATA.M10,0)+ISNULL(OB_BUDGET_DATA.M11,0)+ISNULL(OB_BUDGET_DATA.M12,0))) AS REVYEAR

      (
      SELECT SUM(ISNULL(M1,0)+ISNULL(M2,0)+ISNULL(M3,0)+ISNULL(M4,0)+ISNULL(M5,0)+ISNULL(M6,0)+ISNULL(M7,0)+ISNULL(M8,0)
      +ISNULL(M9,0)+ISNULL(M10,0)+ISNULL(M11,0)+ISNULL(M12,0)) from  BG_T_BUDGET_DATA AS OB_BUDGET_DATA
      LEFT JOIN BG_M_BUDGET_ORDER AS BOO
      ON OB_BUDGET_DATA.BUDGET_ORDER_NO = BOO.BUDGET_ORDER_NO
      LEFT JOIN BG_M_ACCOUNT AS ACC
      ON BOO.ACCOUNT_NO = ACC.ACCOUNT_NO
      Where OB_BUDGET_DATA.BUDGET_YEAR = (@BudgetYear + 1)
      AND OB_BUDGET_DATA.PERIOD_TYPE = 1
      AND OB_BUDGET_DATA.PROJECT_NO = 1
      --AND OB_BUDGET_DATA.REV_NO = 3
      AND BOO.BUDGET_TYPE = 'A'
      AND BOO.ACTIVE_FLAG = 1
      --AND ACC.ACCOUNT_NO = AC.ACCOUNT_NO
      --AND BOO.EXPENSE_TYPE = BO.EXPENSE_TYPE
      )AS REVYEAR


      FROM
      (SELECT * FROM
      BG_T_BUDGET_DATA BD

      WHERE BD.BUDGET_YEAR = @BudgetYear
      AND  BD.PERIOD_TYPE = 3
      --AND BD.PROJECT_NO = @RefRBProjectNo
      --AND BD.REV_NO = @RefRBRevNo
      AND BD.PROJECT_NO = 1
      AND BD.REV_NO = (SELECT ISNULL(MAX(REV_NO),1) AS MAX_REV_NO FROM BG_T_BUDGET_HEADER
      WHERE BUDGET_YEAR = @BudgetYear AND PERIOD_TYPE = 3 AND BUDGET_TYPE = 'A' AND PROJECT_NO = 1)
      )RVBD

      INNER JOIN BG_M_BUDGET_ORDER AS BUDGET_ORDER
      ON BUDGET_ORDER.BUDGET_ORDER_NO = RVBD.BUDGET_ORDER_NO
      AND BUDGET_ORDER.ACTIVE_FLAG = 1
      AND BUDGET_ORDER.BUDGET_TYPE = 'A'

      LEFT OUTER JOIN BG_T_UPLOAD_DATA AS ACTUAL_DATA
      ON ACTUAL_DATA.BUDGET_YEAR = RVBD.BUDGET_YEAR
      AND ACTUAL_DATA.BUDGET_ORDER_NO = RVBD.BUDGET_ORDER_NO
      AND ACTUAL_DATA.DATA_TYPE = 2
      AND ACTUAL_DATA.PERIOD_TYPE = 3
      AND ACTUAL_DATA.PROJECT_NO = 1

      --LEFT OUTER JOIN BG_T_BUDGET_DATA AS OB_BUDGET_DATA
      --ON OB_BUDGET_DATA.BUDGET_YEAR = RVBD.BUDGET_YEAR +1
      --AND OB_BUDGET_DATA.BUDGET_ORDER_NO = RVBD.BUDGET_ORDER_NO
      --AND OB_BUDGET_DATA.PERIOD_TYPE = 1
      --AND OB_BUDGET_DATA.PROJECT_NO = @RefRBProjectNo
      ----AND OB_BUDGET_DATA.REV_NO = @RefRBRevNo

      GROUP BY RVBD.BUDGET_YEAR,RVBD.PERIOD_TYPE,RVBD.PROJECT_NO

      ) RVDB
      LEFT OUTER JOIN BG_T_BUDGET_ADJUST2 BD
      ON
      BD.BUDGET_YEAR = @BudgetYear
      AND BD.PERIOD_TYPE = @PeriodType
      AND BD.REV_NO = (SELECT ISNULL(MAX(REV_NO),1) AS MAX_REV_NO FROM BG_T_BUDGET_HEADER
      WHERE BUDGET_YEAR = @BudgetYear
      AND PERIOD_TYPE = @PeriodType AND BUDGET_TYPE = '@BudgetType' AND PROJECT_NO = @ProjectNo)
      AND BD.PROJECT_NO = @ProjectNo

      ORDER BY BO.EXPENSE_TYPE,AC.ACCOUNT_NO
    </SELECT029>
    <SELECT029_2>
      SELECT
      BO.BUDGET_TYPE,
      BO.EXPENSE_TYPE,
      BD.BUDGET_YEAR,
      BD.PERIOD_TYPE,
      BD.PROJECT_NO,
      AC.ACCOUNT_NO ,
      AC.ACCOUNT_NAME ,

      --SUM((ISNULL(OB_BUDGET_DATA.M1,0)
      --+ISNULL(OB_BUDGET_DATA.M2,0)
      --+ISNULL(OB_BUDGET_DATA.M3,0)
      --+ISNULL(OB_BUDGET_DATA.M4,0)
      --+ISNULL(OB_BUDGET_DATA.M5,0)
      --+ISNULL(OB_BUDGET_DATA.M6,0)
      --+ISNULL(OB_BUDGET_DATA.M7,0)
      --+ISNULL(OB_BUDGET_DATA.M8,0)
      --+ISNULL(OB_BUDGET_DATA.M9,0)
      --+ISNULL(OB_BUDGET_DATA.M10,0)
      --+ISNULL(OB_BUDGET_DATA.M11,0)
      --+ISNULL(OB_BUDGET_DATA.M12,0))) AS REVYEAR,

      (
      SELECT SUM(ISNULL(M1,0)+ISNULL(M2,0)+ISNULL(M3,0)+ISNULL(M4,0)+ISNULL(M5,0)+ISNULL(M6,0)+ISNULL(M7,0)+ISNULL(M8,0)
      +ISNULL(M9,0)+ISNULL(M10,0)+ISNULL(M11,0)+ISNULL(M12,0)) from  BG_T_BUDGET_DATA AS OB_BUDGET_DATA
      LEFT JOIN BG_M_BUDGET_ORDER AS BOO
      ON OB_BUDGET_DATA.BUDGET_ORDER_NO = BOO.BUDGET_ORDER_NO
      LEFT JOIN BG_M_ACCOUNT AS ACC
      ON BOO.ACCOUNT_NO = ACC.ACCOUNT_NO
      Where OB_BUDGET_DATA.BUDGET_YEAR = (@BudgetYear + 1)
      AND OB_BUDGET_DATA.PERIOD_TYPE = 1
      AND OB_BUDGET_DATA.PROJECT_NO = @RefRBProjectNo
      AND OB_BUDGET_DATA.REV_NO = @RefRBRevNo
      AND BOO.BUDGET_TYPE = 'E'
      AND BOO.ACTIVE_FLAG = 1
      AND ACC.ACCOUNT_NO = AC.ACCOUNT_NO
      AND BOO.EXPENSE_TYPE = BO.EXPENSE_TYPE
      )  AS REVYEAR,




      --SUM(CASE WHEN BO.COST = 2  THEN (ISNULL(OB_BUDGET_DATA.M1,0)
      --+ISNULL(OB_BUDGET_DATA.M2,0)
      --+ISNULL(OB_BUDGET_DATA.M3,0)
      --+ISNULL(OB_BUDGET_DATA.M4,0)
      --+ISNULL(OB_BUDGET_DATA.M5,0)
      --+ISNULL(OB_BUDGET_DATA.M6,0)
      --+ISNULL(OB_BUDGET_DATA.M7,0)
      --+ISNULL(OB_BUDGET_DATA.M8,0)
      --+ISNULL(OB_BUDGET_DATA.M9,0)
      --+ISNULL(OB_BUDGET_DATA.M10,0)
      --+ISNULL(OB_BUDGET_DATA.M11,0)
      --+ISNULL(OB_BUDGET_DATA.M12,0)) ELSE 0 END) AS ADMIN_REVYEAR,

      ISNULL((
      SELECT SUM(ISNULL(M1,0)+ISNULL(M2,0)+ISNULL(M3,0)+ISNULL(M4,0)+ISNULL(M5,0)+ISNULL(M6,0)+ISNULL(M7,0)+ISNULL(M8,0)
      +ISNULL(M9,0)+ISNULL(M10,0)+ISNULL(M11,0)+ISNULL(M12,0)) from  BG_T_BUDGET_DATA AS OB_BUDGET_DATA
      LEFT JOIN BG_M_BUDGET_ORDER AS BOO
      ON OB_BUDGET_DATA.BUDGET_ORDER_NO = BOO.BUDGET_ORDER_NO
      LEFT JOIN BG_M_ACCOUNT AS ACC
      ON BOO.ACCOUNT_NO = ACC.ACCOUNT_NO
      Where OB_BUDGET_DATA.BUDGET_YEAR = (@BudgetYear + 1)
      AND OB_BUDGET_DATA.PERIOD_TYPE = 1
      AND OB_BUDGET_DATA.PROJECT_NO = @RefRBProjectNo
      AND OB_BUDGET_DATA.REV_NO = @RefRBRevNo
      AND BOO.BUDGET_TYPE = 'E'
      AND BOO.ACTIVE_FLAG = 1
      AND ACC.ACCOUNT_NO = AC.ACCOUNT_NO
      AND BOO.EXPENSE_TYPE = BO.EXPENSE_TYPE
      AND BOO.COST = 2
      ),0)  AS ADMIN_REVYEAR,


      --SUM(CASE WHEN BO.COST = 1  THEN (ISNULL(OB_BUDGET_DATA.M1,0)
      --+ISNULL(OB_BUDGET_DATA.M2,0)
      --+ISNULL(OB_BUDGET_DATA.M3,0)
      --+ISNULL(OB_BUDGET_DATA.M4,0)
      --+ISNULL(OB_BUDGET_DATA.M5,0)
      --+ISNULL(OB_BUDGET_DATA.M6,0)
      --+ISNULL(OB_BUDGET_DATA.M7,0)
      --+ISNULL(OB_BUDGET_DATA.M8,0)
      --+ISNULL(OB_BUDGET_DATA.M9,0)
      --+ISNULL(OB_BUDGET_DATA.M10,0)
      --+ISNULL(OB_BUDGET_DATA.M11,0)
      --+ISNULL(OB_BUDGET_DATA.M12,0)) ELSE 0 END) AS FC_REVYEAR,

      ISNULL((
      SELECT SUM(ISNULL(M1,0)+ISNULL(M2,0)+ISNULL(M3,0)+ISNULL(M4,0)+ISNULL(M5,0)+ISNULL(M6,0)+ISNULL(M7,0)+ISNULL(M8,0)
      +ISNULL(M9,0)+ISNULL(M10,0)+ISNULL(M11,0)+ISNULL(M12,0)) from  BG_T_BUDGET_DATA AS OB_BUDGET_DATA
      LEFT JOIN BG_M_BUDGET_ORDER AS BOO
      ON OB_BUDGET_DATA.BUDGET_ORDER_NO = BOO.BUDGET_ORDER_NO
      LEFT JOIN BG_M_ACCOUNT AS ACC
      ON BOO.ACCOUNT_NO = ACC.ACCOUNT_NO
      Where OB_BUDGET_DATA.BUDGET_YEAR = (@BudgetYear + 1)
      AND OB_BUDGET_DATA.PERIOD_TYPE = 1
      AND OB_BUDGET_DATA.PROJECT_NO = @RefRBProjectNo
      AND OB_BUDGET_DATA.REV_NO = @RefRBRevNo
      AND BOO.BUDGET_TYPE = 'E'
      AND BOO.ACTIVE_FLAG = 1
      AND ACC.ACCOUNT_NO = AC.ACCOUNT_NO
      AND BOO.EXPENSE_TYPE = BO.EXPENSE_TYPE
      AND BOO.COST = 1
      ) ,0)
      AS FC_REVYEAR,



      SUM(ISNULL(BD.RRT1,0)) AS RRT1,
      SUM(ISNULL(BD.RRT2,0)) AS RRT2,
      SUM(ISNULL(BD.RRT3,0)) AS RRT3,
      SUM(ISNULL(BD.RRT4,0)) AS RRT4,
      SUM(ISNULL(BD.RRT5,0)) AS RRT5,
      SUM(ISNULL(PREVBD.RRT1,0)) AS PrevRRT1,
      SUM(ISNULL(PREVBD.RRT2,0)) AS PrevRRT2,
      SUM(ISNULL(PREVBD.RRT3,0)) AS PrevRRT3,
      SUM(ISNULL(PREVBD.RRT4,0)) AS PrevRRT4,
      SUM(ISNULL(PREVBD.RRT5,0)) AS PrevRRT5,

      --(SUM((ISNULL(OB_BUDGET_DATA.M1,0)+ISNULL(OB_BUDGET_DATA.M2,0)+ISNULL(OB_BUDGET_DATA.M3,0)+ISNULL(OB_BUDGET_DATA.M4,0)
      --+ISNULL(OB_BUDGET_DATA.M5,0)+ISNULL(OB_BUDGET_DATA.M6,0)+ISNULL(OB_BUDGET_DATA.M7,0)+ISNULL(OB_BUDGET_DATA.M8,0)+ISNULL(OB_BUDGET_DATA.M9,0)
      --+ISNULL(OB_BUDGET_DATA.M10,0)+ISNULL(OB_BUDGET_DATA.M11,0)+ISNULL(OB_BUDGET_DATA.M12,0)) - ISNULL(PREVBD.RRT2,0))) AS DiffYear,


      (
      SELECT SUM(ISNULL(M1,0)+ISNULL(M2,0)+ISNULL(M3,0)+ISNULL(M4,0)+ISNULL(M5,0)+ISNULL(M6,0)+ISNULL(M7,0)+ISNULL(M8,0)
      +ISNULL(M9,0)+ISNULL(M10,0)+ISNULL(M11,0)+ISNULL(M12,0)) from  BG_T_BUDGET_DATA AS OB_BUDGET_DATA
      LEFT JOIN BG_M_BUDGET_ORDER AS BOO
      ON OB_BUDGET_DATA.BUDGET_ORDER_NO = BOO.BUDGET_ORDER_NO
      LEFT JOIN BG_M_ACCOUNT AS ACC
      ON BOO.ACCOUNT_NO = ACC.ACCOUNT_NO
      Where OB_BUDGET_DATA.BUDGET_YEAR = (@BudgetYear + 1)
      AND OB_BUDGET_DATA.PERIOD_TYPE = 1
      AND OB_BUDGET_DATA.PROJECT_NO = @RefRBProjectNo
      AND OB_BUDGET_DATA.REV_NO = @RefRBRevNo
      AND BOO.BUDGET_TYPE = 'E'
      AND BOO.ACTIVE_FLAG = 1
      AND ACC.ACCOUNT_NO = AC.ACCOUNT_NO
      AND BOO.EXPENSE_TYPE = BO.EXPENSE_TYPE
      ) - SUM(ISNULL(PREVBD.RRT2,0))AS DiffYear,


      SUM((ISNULL(BD.RRT2,0)) - (ISNULL(PREVBD.RRT3,0))) AS DIFFRRT1,




      SUM(CASE WHEN BO.COST = 2  THEN (ISNULL(BD.RRT2,0) - ISNULL(PREVBD.RRT3,0)) ELSE 0 END) AS ADMIN_DIFFRRT1,

      SUM(CASE WHEN BO.COST = 1  THEN (ISNULL(BD.RRT2,0) - ISNULL(PREVBD.RRT3,0)) ELSE 0 END) AS FC_DIFFRRT1,




      SUM(CASE WHEN BO.COST = 2  THEN ISNULL(BD.RRT1,0) ELSE 0 END) AS ADMIN_RRT1,
      SUM(CASE WHEN BO.COST = 1  THEN ISNULL(BD.RRT1,0) ELSE 0 END) AS FC_RRT1,
      SUM(CASE WHEN BO.COST = 2  THEN ISNULL(BD.RRT2,0) ELSE 0 END) AS ADMIN_RRT2,
      SUM(CASE WHEN BO.COST = 1  THEN ISNULL(BD.RRT2,0) ELSE 0 END) AS FC_RRT2,
      SUM(CASE WHEN BO.COST = 2  THEN ISNULL(BD.RRT3,0) ELSE 0 END) AS ADMIN_RRT3,
      SUM(CASE WHEN BO.COST = 1  THEN ISNULL(BD.RRT3,0) ELSE 0 END) AS FC_RRT3,
      SUM(CASE WHEN BO.COST = 2  THEN ISNULL(BD.RRT4,0) ELSE 0 END) AS ADMIN_RRT4,
      SUM(CASE WHEN BO.COST = 1  THEN ISNULL(BD.RRT4,0) ELSE 0 END) AS FC_RRT4,
      SUM(CASE WHEN BO.COST = 2  THEN ISNULL(BD.RRT5,0) ELSE 0 END) AS ADMIN_RRT5,
      SUM(CASE WHEN BO.COST = 1  THEN ISNULL(BD.RRT5,0) ELSE 0 END) AS FC_RRT5,
      SUM(CASE WHEN BO.COST = 2  THEN ISNULL(PREVBD.RRT1,0) ELSE 0 END) AS ADMIN_PrevRRT1,
      SUM(CASE WHEN BO.COST = 1  THEN ISNULL(PREVBD.RRT1,0) ELSE 0 END) AS FC_PrevRRT1,
      SUM(CASE WHEN BO.COST = 2  THEN ISNULL(PREVBD.RRT2,0) ELSE 0 END) AS ADMIN_PrevRRT2,
      SUM(CASE WHEN BO.COST = 1  THEN ISNULL(PREVBD.RRT2,0) ELSE 0 END) AS FC_PrevRRT2,
      SUM(CASE WHEN BO.COST = 2  THEN ISNULL(PREVBD.RRT3,0) ELSE 0 END) AS ADMIN_PrevRRT3,
      SUM(CASE WHEN BO.COST = 1  THEN ISNULL(PREVBD.RRT3,0) ELSE 0 END) AS FC_PrevRRT3,
      SUM(CASE WHEN BO.COST = 2  THEN ISNULL(PREVBD.RRT4,0) ELSE 0 END) AS ADMIN_PrevRRT4,
      SUM(CASE WHEN BO.COST = 1  THEN ISNULL(PREVBD.RRT4,0) ELSE 0 END) AS FC_PrevRRT4,
      SUM(CASE WHEN BO.COST = 2  THEN ISNULL(PREVBD.RRT5,0) ELSE 0 END) AS ADMIN_PrevRRT5,
      SUM(CASE WHEN BO.COST = 1  THEN ISNULL(PREVBD.RRT5,0) ELSE 0 END) AS FC_PrevRRT5,

      --SUM(CASE WHEN BO.COST = 2  THEN (ISNULL(OB_BUDGET_DATA.M1,0)+ISNULL(OB_BUDGET_DATA.M2,0)+ISNULL(OB_BUDGET_DATA.M3,0)+ISNULL(OB_BUDGET_DATA.M4,0)+ISNULL(OB_BUDGET_DATA.M5,0)+ISNULL(OB_BUDGET_DATA.M6,0)+ISNULL(OB_BUDGET_DATA.M7,0)+ISNULL(OB_BUDGET_DATA.M8,0)+ISNULL(OB_BUDGET_DATA.M9,0)+ISNULL(OB_BUDGET_DATA.M10,0)+ISNULL(OB_BUDGET_DATA.M11,0)+ISNULL(OB_BUDGET_DATA.M12,0)) - ISNULL(PREVBD.RRT2,0) ELSE 0 END) AS ADMIN_DIFFYEAR,
      --SUM(CASE WHEN BO.COST = 1  THEN (ISNULL(OB_BUDGET_DATA.M1,0)+ISNULL(OB_BUDGET_DATA.M2,0)+ISNULL(OB_BUDGET_DATA.M3,0)+ISNULL(OB_BUDGET_DATA.M4,0)+ISNULL(OB_BUDGET_DATA.M5,0)+ISNULL(OB_BUDGET_DATA.M6,0)+ISNULL(OB_BUDGET_DATA.M7,0)+ISNULL(OB_BUDGET_DATA.M8,0)+ISNULL(OB_BUDGET_DATA.M9,0)+ISNULL(OB_BUDGET_DATA.M10,0)+ISNULL(OB_BUDGET_DATA.M11,0)+ISNULL(OB_BUDGET_DATA.M12,0)) - ISNULL(PREVBD.RRT2,0) ELSE 0 END) AS FC_DIFFYEAR,

      ISNULL(
      ( SELECT SUM(ISNULL(M1,0)+ISNULL(M2,0)+ISNULL(M3,0)+ISNULL(M4,0)+ISNULL(M5,0)+ISNULL(M6,0)+ISNULL(M7,0)+ISNULL(M8,0)
      +ISNULL(M9,0)+ISNULL(M10,0)+ISNULL(M11,0)+ISNULL(M12,0)) from  BG_T_BUDGET_DATA AS OB_BUDGET_DATA
      LEFT JOIN BG_M_BUDGET_ORDER AS BOO
      ON OB_BUDGET_DATA.BUDGET_ORDER_NO = BOO.BUDGET_ORDER_NO
      LEFT JOIN BG_M_ACCOUNT AS ACC
      ON BOO.ACCOUNT_NO = ACC.ACCOUNT_NO
      Where OB_BUDGET_DATA.BUDGET_YEAR = (@BudgetYear + 1)
      AND OB_BUDGET_DATA.PERIOD_TYPE = 1
      AND OB_BUDGET_DATA.PROJECT_NO = @RefRBProjectNo
      AND OB_BUDGET_DATA.REV_NO = @RefRBRevNo
      AND BOO.BUDGET_TYPE = 'E'
      AND BOO.ACTIVE_FLAG = 1
      AND ACC.ACCOUNT_NO = AC.ACCOUNT_NO
      AND BOO.EXPENSE_TYPE = BO.EXPENSE_TYPE
      AND BOO.COST = 2)
      - (SUM(CASE WHEN BO.COST = 2  THEN (ISNULL(PREVBD.RRT2,0)) ELSE 0 END))
      ,0)
      AS ADMIN_DIFFYEAR,


      ISNULL(  ( SELECT SUM(ISNULL(M1,0)+ISNULL(M2,0)+ISNULL(M3,0)+ISNULL(M4,0)+ISNULL(M5,0)+ISNULL(M6,0)+ISNULL(M7,0)+ISNULL(M8,0)
      +ISNULL(M9,0)+ISNULL(M10,0)+ISNULL(M11,0)+ISNULL(M12,0)) from  BG_T_BUDGET_DATA AS OB_BUDGET_DATA
      LEFT JOIN BG_M_BUDGET_ORDER AS BOO
      ON OB_BUDGET_DATA.BUDGET_ORDER_NO = BOO.BUDGET_ORDER_NO
      LEFT JOIN BG_M_ACCOUNT AS ACC
      ON BOO.ACCOUNT_NO = ACC.ACCOUNT_NO
      Where OB_BUDGET_DATA.BUDGET_YEAR = (@BudgetYear + 1)
      AND OB_BUDGET_DATA.PERIOD_TYPE = 1
      AND OB_BUDGET_DATA.PROJECT_NO = @RefRBProjectNo
      AND OB_BUDGET_DATA.REV_NO = @RefRBRevNo
      AND BOO.BUDGET_TYPE = 'E'
      AND BOO.ACTIVE_FLAG = 1
      AND ACC.ACCOUNT_NO = AC.ACCOUNT_NO
      AND BOO.EXPENSE_TYPE = BO.EXPENSE_TYPE
      AND BOO.COST = 1)
      - (SUM(CASE WHEN BO.COST = 1  THEN (ISNULL(PREVBD.RRT2,0)) ELSE 0 END))
      ,0)
      AS FC_DIFFYEAR,


      --SUM((ROUND(ISNULL(MIN_RVBD.M1,0),2)+ROUND(ISNULL(MIN_RVBD.M2,0),2)
      --+ROUND(ISNULL(MIN_RVBD.M3,0),2)+ROUND(ISNULL(MIN_RVBD.M4,0),2)
      --+ROUND(ISNULL(MIN_RVBD.M5,0),2)+ROUND(ISNULL(MIN_RVBD.M6,0),2)
      --+ROUND(ISNULL(MIN_RVBD.M7,0),2)+ROUND(ISNULL(MIN_RVBD.M8,0),2)
      --+ROUND(ISNULL(MIN_RVBD.M9,0),2)+ROUND(ISNULL(MIN_RVBD.M10,0),2)
      --+ROUND(ISNULL(MIN_RVBD.M11,0),2)+ROUND(ISNULL(MIN_RVBD.M12,0),2))


      --- (ROUND(ISNULL(OB_BUDGET_DATA.M1,0),2)+ROUND(ISNULL(OB_BUDGET_DATA.M2,0),2)+ROUND(ISNULL(OB_BUDGET_DATA.M3,0),2)
      --+ROUND(ISNULL(OB_BUDGET_DATA.M4,0),2)+ROUND(ISNULL(OB_BUDGET_DATA.M5,0),2)+ROUND(ISNULL(OB_BUDGET_DATA.M6,0),2)
      --+ROUND(ISNULL(OB_BUDGET_DATA.M7,0),2)+ROUND(ISNULL(OB_BUDGET_DATA.M8,0),2)+ROUND(ISNULL(OB_BUDGET_DATA.M9,0),2)
      --+ROUND(ISNULL(OB_BUDGET_DATA.M10,0),2)+ROUND(ISNULL(OB_BUDGET_DATA.M11,0),2)+ROUND(ISNULL(OB_BUDGET_DATA.M12,0),2)))
      --AS WBRevYear,

      (
      SELECT SUM(ISNULL(M1,0)+ISNULL(M2,0)+ISNULL(M3,0)+ISNULL(M4,0)+ISNULL(M5,0)+ISNULL(M6,0)+ISNULL(M7,0)+ISNULL(M8,0)
      +ISNULL(M9,0)+ISNULL(M10,0)+ISNULL(M11,0)+ISNULL(M12,0)) from  BG_T_BUDGET_DATA AS OB_BUDGET_DATA
      LEFT JOIN BG_M_BUDGET_ORDER AS BOO
      ON OB_BUDGET_DATA.BUDGET_ORDER_NO = BOO.BUDGET_ORDER_NO
      LEFT JOIN BG_M_ACCOUNT AS ACC
      ON BOO.ACCOUNT_NO = ACC.ACCOUNT_NO
      Where OB_BUDGET_DATA.BUDGET_YEAR = (@BudgetYear + 1)
      AND OB_BUDGET_DATA.PERIOD_TYPE = 1
      AND OB_BUDGET_DATA.PROJECT_NO = 1
      AND OB_BUDGET_DATA.REV_NO = 1
      AND BOO.BUDGET_TYPE = 'E'
      AND BOO.ACTIVE_FLAG = 1
      AND ACC.ACCOUNT_NO = AC.ACCOUNT_NO
      AND BOO.EXPENSE_TYPE = BO.EXPENSE_TYPE
      )

      -
      (
      SELECT SUM(ISNULL(M1,0)+ISNULL(M2,0)+ISNULL(M3,0)+ISNULL(M4,0)+ISNULL(M5,0)+ISNULL(M6,0)+ISNULL(M7,0)+ISNULL(M8,0)
      +ISNULL(M9,0)+ISNULL(M10,0)+ISNULL(M11,0)+ISNULL(M12,0)) from  BG_T_BUDGET_DATA AS OB_BUDGET_DATA
      LEFT JOIN BG_M_BUDGET_ORDER AS BOO
      ON OB_BUDGET_DATA.BUDGET_ORDER_NO = BOO.BUDGET_ORDER_NO
      LEFT JOIN BG_M_ACCOUNT AS ACC
      ON BOO.ACCOUNT_NO = ACC.ACCOUNT_NO
      Where OB_BUDGET_DATA.BUDGET_YEAR = (@BudgetYear + 1)
      AND OB_BUDGET_DATA.PERIOD_TYPE = 1
      AND OB_BUDGET_DATA.PROJECT_NO = @RefRBProjectNo
      AND OB_BUDGET_DATA.REV_NO = @RefRBRevNo
      AND BOO.BUDGET_TYPE = 'E'
      AND BOO.ACTIVE_FLAG = 1
      AND ACC.ACCOUNT_NO = AC.ACCOUNT_NO
      AND BOO.EXPENSE_TYPE = BO.EXPENSE_TYPE
      )AS WBRevYear,



      0 AS WBDiffYear,
      SUM(ROUND(ISNULL(MIN_REV.RRT1 ,0),2) - ROUND(ISNULL(BD.RRT1 ,0),2)) AS WB_RRT1,
      SUM(ROUND(ISNULL(MIN_REV.RRT2 ,0),2) - ROUND(ISNULL(BD.RRT2 ,0),2)) AS WB_RRT2,
      SUM(ROUND(ISNULL(MIN_REV.RRT3 ,0),2) - ROUND(ISNULL(BD.RRT3 ,0),2)) AS WB_RRT3,
      SUM(ROUND(ISNULL(MIN_REV.RRT4 ,0),2) - ROUND(ISNULL(BD.RRT4 ,0),2)) AS WB_RRT4,
      SUM(ROUND(ISNULL(MIN_REV.RRT5 ,0),2) - ROUND(ISNULL(BD.RRT5 ,0),2)) AS WB_RRT5,

      /*SUM(ISNULL(PREVBD.RRT1 ,0) - ISNULL(PREV_MIN_REV.RRT1 ,0)) AS PREV_WB_RRT1,
      SUM(ISNULL(PREVBD.RRT2 ,0) - ISNULL(PREV_MIN_REV.RRT2 ,0)) AS PREV_WB_RRT2,
      SUM(ISNULL(PREVBD.RRT3 ,0) - ISNULL(PREV_MIN_REV.RRT3 ,0)) AS PREV_WB_RRT3,
      SUM(ISNULL(PREVBD.RRT4 ,0) - ISNULL(PREV_MIN_REV.RRT4 ,0)) AS PREV_WB_RRT4,
      SUM(ISNULL(PREVBD.RRT5 ,0) - ISNULL(PREV_MIN_REV.RRT5 ,0)) AS PREV_WB_RRT5

      (SELECT ISNULL(WKRRT1,0) FROM BG_T_BUDGET_ADJUST WHERE BUDGET_YEAR=2018 AND PERIOD_TYPE=10 AND PROJECT_NO=1 AND REV_NO= @MtpRevNo) AS WB_RRT1,
      (SELECT ISNULL(WKRRT2,0) FROM BG_T_BUDGET_ADJUST WHERE BUDGET_YEAR=2018 AND PERIOD_TYPE=10 AND PROJECT_NO=1 AND REV_NO= @MtpRevNo) AS WB_RRT2,
      (SELECT ISNULL(WKRRT3,0) FROM BG_T_BUDGET_ADJUST WHERE BUDGET_YEAR=2018 AND PERIOD_TYPE=10 AND PROJECT_NO=1 AND REV_NO= @MtpRevNo) AS WB_RRT3,
      (SELECT ISNULL(WKRRT4,0) FROM BG_T_BUDGET_ADJUST WHERE BUDGET_YEAR=2018 AND PERIOD_TYPE=10 AND PROJECT_NO=1 AND REV_NO= @MtpRevNo) AS WB_RRT4,
      (SELECT ISNULL(WKRRT5,0) FROM BG_T_BUDGET_ADJUST WHERE BUDGET_YEAR=2018 AND PERIOD_TYPE=10 AND PROJECT_NO=1 AND REV_NO= @MtpRevNo) AS WB_RRT5,*/

      ISNULL((SELECT ISNULL(WKRRT1,0) FROM BG_T_BUDGET_ADJUST WHERE BUDGET_YEAR=2018 AND PERIOD_TYPE=10 AND PROJECT_NO=1 AND REV_NO= @MtpRevNo),0) AS PREV_WB_RRT1,
      ISNULL((SELECT ISNULL(WKRRT2,0) FROM BG_T_BUDGET_ADJUST WHERE BUDGET_YEAR=2018 AND PERIOD_TYPE=10 AND PROJECT_NO=1 AND REV_NO= @MtpRevNo),0) AS PREV_WB_RRT2,
      ISNULL((SELECT ISNULL(WKRRT3,0) FROM BG_T_BUDGET_ADJUST WHERE BUDGET_YEAR=2018 AND PERIOD_TYPE=10 AND PROJECT_NO=1 AND REV_NO= @MtpRevNo),0) AS PREV_WB_RRT3,
      ISNULL((SELECT ISNULL(WKRRT4,0) FROM BG_T_BUDGET_ADJUST WHERE BUDGET_YEAR=2018 AND PERIOD_TYPE=10 AND PROJECT_NO=1 AND REV_NO= @MtpRevNo),0) AS PREV_WB_RRT4,
      ISNULL((SELECT ISNULL(WKRRT5,0) FROM BG_T_BUDGET_ADJUST WHERE BUDGET_YEAR=2018 AND PERIOD_TYPE=10 AND PROJECT_NO=1 AND REV_NO= @MtpRevNo),0) AS PREV_WB_RRT5,

      0 AS WBDIFFRRT1

      FROM BG_T_BUDGET_DATA AS BD

      LEFT JOIN BG_M_BUDGET_ORDER AS BO
      ON BD.BUDGET_ORDER_NO = BO.BUDGET_ORDER_NO

      LEFT JOIN BG_M_ACCOUNT AS AC
      ON BO.ACCOUNT_NO = AC.ACCOUNT_NO

      LEFT JOIN BG_M_DEPT AS DP
      ON BO.DEPT_NO = DP.DEPT_NO

      LEFT JOIN BG_M_PERSON_IN_CHARGE AS PIC
      ON BO.PERSON_IN_CHARGE_NO = PIC.PERSON_IN_CHARGE_NO

      LEFT JOIN BG_T_BUDGET_HEADER AS BH
      ON BD.BUDGET_YEAR = BH.BUDGET_YEAR AND
      BD.PERIOD_TYPE = BH.PERIOD_TYPE AND
      BO.PERSON_IN_CHARGE_NO = BH.PERSON_IN_CHARGE_NO AND
      BO.BUDGET_TYPE = BH.BUDGET_TYPE AND
      BD.REV_NO = BH.REV_NO AND
      BD.PROJECT_NO = BH.PROJECT_NO

      LEFT JOIN BG_T_BUDGET_DATA RVBD
      ON BD.BUDGET_YEAR = RVBD.BUDGET_YEAR
      AND BD.BUDGET_ORDER_NO = RVBD.BUDGET_ORDER_NO
      AND  RVBD.PERIOD_TYPE = 1
      AND RVBD.PROJECT_NO = @RefRBProjectNo
      AND RVBD.REV_NO = @RefRBRevNo
      --AND RVBD.PROJECT_NO = 1
      --AND RVBD.REV_NO = (SELECT ISNULL(MAX(REV_NO),1) AS MAX_REV_NO FROM BG_T_BUDGET_HEADER
      --WHERE BUDGET_YEAR = @BudgetYear AND PERIOD_TYPE = 1 AND BUDGET_TYPE = 'E' AND PROJECT_NO = 1)

      LEFT JOIN BG_T_BUDGET_DATA MIN_RVBD
      ON BD.BUDGET_YEAR+1 = MIN_RVBD.BUDGET_YEAR
      AND BD.BUDGET_ORDER_NO = MIN_RVBD.BUDGET_ORDER_NO
      AND  MIN_RVBD.PERIOD_TYPE = 1
      AND MIN_RVBD.REV_NO = 1
      AND MIN_RVBD.PROJECT_NO = 1

      LEFT JOIN BG_T_BUDGET_DATA PREVBD
      ON BD.BUDGET_ORDER_NO = PREVBD.BUDGET_ORDER_NO
      AND PREVBD.BUDGET_YEAR = (@BudgetYear - 1)
      AND BD.PERIOD_TYPE = PREVBD.PERIOD_TYPE
      AND PREVBD.PROJECT_NO = @MtpProjectNo
      AND PREVBD.REV_NO = @MtpRevNo
      --AND PREVBD.PROJECT_NO = @PrevProjectNo
      --AND PREVBD.REV_NO = @PrevRevNo

      LEFT JOIN BG_T_BUDGET_DATA AS PREV_MIN_REV
      ON PREV_MIN_REV.BUDGET_YEAR = (@BudgetYear - 1)
      AND PREV_MIN_REV.PERIOD_TYPE = BD.PERIOD_TYPE
      --AND PREV_MIN_REV.PROJECT_NO = @PrevProjectNo
      AND PREV_MIN_REV.PROJECT_NO = @MtpProjectNo
      AND PREV_MIN_REV.BUDGET_ORDER_NO = BD.BUDGET_ORDER_NO
      AND PREV_MIN_REV.REV_NO = 1

      LEFT OUTER JOIN BG_T_UPLOAD_DATA AS ACTUAL_DATA
      ON ACTUAL_DATA.BUDGET_YEAR = BD.BUDGET_YEAR
      AND ACTUAL_DATA.BUDGET_ORDER_NO = BD.BUDGET_ORDER_NO
      AND ACTUAL_DATA.DATA_TYPE = 2
      AND ACTUAL_DATA.PERIOD_TYPE = 1
      AND ACTUAL_DATA.PROJECT_NO = 1

      LEFT OUTER JOIN BG_T_BUDGET_DATA AS MIN_REV
      ON MIN_REV.BUDGET_YEAR = BD.BUDGET_YEAR
      AND MIN_REV.PERIOD_TYPE = BD.PERIOD_TYPE
      AND MIN_REV.PROJECT_NO = 1
      AND MIN_REV.BUDGET_ORDER_NO = BD.BUDGET_ORDER_NO
      AND MIN_REV.REV_NO = 1

      LEFT OUTER JOIN BG_T_BUDGET_DATA AS OB_BUDGET_DATA
      ON OB_BUDGET_DATA.BUDGET_YEAR = BD.BUDGET_YEAR +1
      AND OB_BUDGET_DATA.BUDGET_ORDER_NO = BD.BUDGET_ORDER_NO
      AND OB_BUDGET_DATA.PERIOD_TYPE = 1
      AND OB_BUDGET_DATA.PROJECT_NO = @RefRBProjectNo
      AND OB_BUDGET_DATA.REV_NO = @RefRBRevNo


      WHERE
      BD.BUDGET_YEAR = @BudgetYear
      AND BD.PERIOD_TYPE = @PeriodType
      AND BD.REV_NO = @RevNo
      AND BD.PROJECT_NO = @ProjectNo
      AND BO.BUDGET_TYPE = '@BudgetType'
      AND BO.ACTIVE_FLAG = 1
      AND
      (
      OB_BUDGET_DATA.M1 &lt;&gt; 0
      OR OB_BUDGET_DATA.M2 &lt;&gt; 0
      OR OB_BUDGET_DATA.M3 &lt;&gt; 0
      OR OB_BUDGET_DATA.M4 &lt;&gt; 0
      OR OB_BUDGET_DATA.M5 &lt;&gt; 0
      OR OB_BUDGET_DATA.M6 &lt;&gt; 0
      OR OB_BUDGET_DATA.M7 &lt;&gt; 0
      OR OB_BUDGET_DATA.M8 &lt;&gt; 0
      OR OB_BUDGET_DATA.M9 &lt;&gt; 0
      OR OB_BUDGET_DATA.M10 &lt;&gt; 0
      OR OB_BUDGET_DATA.M11 &lt;&gt; 0
      OR OB_BUDGET_DATA.M12 &lt;&gt; 0
      OR BD.RRT1 &lt;&gt; 0
      OR BD.RRT2 &lt;&gt; 0
      OR BD.RRT3 &lt;&gt; 0
      OR BD.RRT4 &lt;&gt; 0
      OR BD.RRT5 &lt;&gt; 0
      OR PREVBD.RRT1 &lt;&gt; 0
      OR PREVBD.RRT2 &lt;&gt; 0
      OR PREVBD.RRT3 &lt;&gt; 0
      OR PREVBD.RRT4 &lt;&gt; 0
      OR PREVBD.RRT5 &lt;&gt; 0
      OR MIN_REV.RRT1 &lt;&gt; 0
      OR MIN_REV.RRT2 &lt;&gt; 0
      OR MIN_REV.RRT3 &lt;&gt; 0
      OR MIN_REV.RRT4 &lt;&gt; 0
      OR MIN_REV.RRT5 &lt;&gt; 0
      OR MIN_RVBD.M1 &lt;&gt; 0
      OR MIN_RVBD.M2 &lt;&gt; 0
      OR MIN_RVBD.M3 &lt;&gt; 0
      OR MIN_RVBD.M4 &lt;&gt; 0
      OR MIN_RVBD.M5 &lt;&gt; 0
      OR MIN_RVBD.M6 &lt;&gt; 0
      OR MIN_RVBD.M7 &lt;&gt; 0
      OR MIN_RVBD.M8 &lt;&gt; 0
      OR MIN_RVBD.M9 &lt;&gt; 0
      OR MIN_RVBD.M10 &lt;&gt; 0
      OR MIN_RVBD.M11 &lt;&gt; 0
      OR MIN_RVBD.M12 &lt;&gt; 0
      )
      /*AND BH.Status >= @Status
      AND (ISNULL(BD.RRT1 ,0) &lt;&gt; 0
      OR ISNULL(BD.RRT2 ,0) &lt;&gt; 0
      OR ISNULL(BD.RRT3 ,0) &lt;&gt; 0
      OR ISNULL(BD.RRT4 ,0) &lt;&gt; 0
      OR ISNULL(BD.RRT5 ,0) &lt;&gt; 0
      OR ISNULL(MIN_REV.RRT1 ,0) &lt;&gt; 0
      OR ISNULL(MIN_REV.RRT2 ,0) &lt;&gt; 0
      OR ISNULL(MIN_REV.RRT3 ,0) &lt;&gt; 0
      OR ISNULL(MIN_REV.RRT4 ,0) &lt;&gt; 0
      OR ISNULL(MIN_REV.RRT5 ,0) &lt;&gt; 0)*/
      GROUP BY BD.BUDGET_YEAR, BD.PERIOD_TYPE, BD.PROJECT_NO, AC.ACCOUNT_NO, AC.ACCOUNT_NAME , BO.BUDGET_TYPE , BO.EXPENSE_TYPE

      UNION
      SELECT 'A' AS BUDGET_TYPE,
      1 AS EXPENSE_TYPE,
      RVDB.BUDGET_YEAR,
      RVDB.PERIOD_TYPE,
      RVDB.PROJECT_NO,
      '' AS ACCOUNT_NO ,
      '' AS ACCOUNT_NAME ,


      ISNULL(RVDB.REVYEAR,0) AS REVYEAR,

      0 AS ADMIN_REVYEAR,
      0 AS FC_REVYEAR,

      ISNULL(BD.MTP_SUM1,0) AS RRT1,
      ISNULL(BD.MTP_SUM2,0) AS RRT2,
      ISNULL(BD.MTP_SUM3,0) AS RRT3,
      ISNULL(BD.MTP_SUM4,0) AS RRT4,
      ISNULL(BD.MTP_SUM5,0) AS RRT5,

      ISNULL(BD.MTP_PY_SUM1,0) AS PREVRRT1,
      ISNULL(BD.MTP_PY_SUM2,0) AS PREVRRT2,
      ISNULL(BD.MTP_PY_SUM3,0) AS PREVRRT3,
      ISNULL(BD.MTP_PY_SUM4,0) AS PREVRRT4,
      ISNULL(BD.MTP_PY_SUM5,0) AS PREVRRT5,

      (ISNULL(RVDB.REVYEAR,0) - ISNULL(BD.MTP_PY_SUM1,0)) AS DIFFYEAR,
      ISNULL(BD.MTP_SUM1,0) - ISNULL(BD.MTP_PY_SUM2,0) AS DIFFRRT1,

      0 AS ADMIN_DIFFRRT1,
      0 AS FC_DIFFRRT1,

      0 AS ADMIN_RRT1,
      0 AS FC_RRT1,
      0 AS ADMIN_RRT2,
      0 AS FC_RRT2,
      0 AS ADMIN_RRT3,
      0 AS FC_RRT3,
      0 AS ADMIN_RRT4,
      0 AS FC_RRT4,
      0 AS ADMIN_RRT5,
      0 AS FC_RRT5,
      0 AS ADMIN_PREVRRT1,
      0 AS FC_PREVRRT1,
      0 AS ADMIN_PREVRRT2,
      0 AS FC_PREVRRT2,
      0 AS ADMIN_PREVRRT3,
      0 AS FC_PREVRRT3,
      0 AS ADMIN_PREVRRT4,
      0 AS FC_PREVRRT4,
      0 AS ADMIN_PREVRRT5,
      0 AS FC_PREVRRT5,
      0 AS ADMIN_DIFFYEAR,
      0 AS FC_DIFFYEAR,
      0 AS WBREVYEAR,
      0 AS WBDIFFYEAR,
      0 AS WB_RRT1,
      0 AS WB_RRT2,
      0 AS WB_RRT3,
      0 AS WB_RRT4,
      0 AS WB_RRT5,

      0 AS PREV_WB_RRT1,
      0 AS PREV_WB_RRT2,
      0 AS PREV_WB_RRT3,
      0 AS PREV_WB_RRT4,
      0 AS PREV_WB_RRT5,

      0 AS WBDIFFRRT1

      FROM
      (SELECT RVBD.BUDGET_YEAR,RVBD.PERIOD_TYPE,RVBD.PROJECT_NO,


      --SUM((ISNULL(OB_BUDGET_DATA.M1,0)+ISNULL(OB_BUDGET_DATA.M2,0)+ISNULL(OB_BUDGET_DATA.M3,0)
      --+ISNULL(OB_BUDGET_DATA.M4,0)+ISNULL(OB_BUDGET_DATA.M5,0)+ISNULL(OB_BUDGET_DATA.M6,0)+ISNULL(OB_BUDGET_DATA.M7,0)+ISNULL(OB_BUDGET_DATA.M8,0)
      --+ISNULL(OB_BUDGET_DATA.M9,0)+ISNULL(OB_BUDGET_DATA.M10,0)+ISNULL(OB_BUDGET_DATA.M11,0)+ISNULL(OB_BUDGET_DATA.M12,0))) AS REVYEAR

      (
      SELECT SUM(ISNULL(M1,0)+ISNULL(M2,0)+ISNULL(M3,0)+ISNULL(M4,0)+ISNULL(M5,0)+ISNULL(M6,0)+ISNULL(M7,0)+ISNULL(M8,0)
      +ISNULL(M9,0)+ISNULL(M10,0)+ISNULL(M11,0)+ISNULL(M12,0)) from  BG_T_BUDGET_DATA AS OB_BUDGET_DATA
      LEFT JOIN BG_M_BUDGET_ORDER AS BOO
      ON OB_BUDGET_DATA.BUDGET_ORDER_NO = BOO.BUDGET_ORDER_NO
      LEFT JOIN BG_M_ACCOUNT AS ACC
      ON BOO.ACCOUNT_NO = ACC.ACCOUNT_NO
      Where OB_BUDGET_DATA.BUDGET_YEAR = (@BudgetYear + 1)
      AND OB_BUDGET_DATA.PERIOD_TYPE = 1
      AND OB_BUDGET_DATA.PROJECT_NO = 1
      --AND OB_BUDGET_DATA.REV_NO = 3
      AND BOO.BUDGET_TYPE = 'A'
      AND BOO.ACTIVE_FLAG = 1
      --AND ACC.ACCOUNT_NO = AC.ACCOUNT_NO
      --AND BOO.EXPENSE_TYPE = BO.EXPENSE_TYPE
      )AS REVYEAR

      FROM
      (SELECT * FROM
      BG_T_BUDGET_DATA BD

      WHERE BD.BUDGET_YEAR = @BudgetYear
      AND  BD.PERIOD_TYPE = 1
      AND BD.PROJECT_NO = 1
      AND BD.REV_NO = (SELECT ISNULL(MAX(REV_NO),1) AS MAX_REV_NO FROM BG_T_BUDGET_HEADER
      WHERE BUDGET_YEAR = @BudgetYear AND PERIOD_TYPE = 1 AND BUDGET_TYPE = 'A' AND PROJECT_NO = 1)
      --AND BD.PROJECT_NO = @RefRBProjectNo
      --AND BD.REV_NO = @RefRBRevNo
      )RVBD

      INNER JOIN BG_M_BUDGET_ORDER AS BUDGET_ORDER
      ON BUDGET_ORDER.BUDGET_ORDER_NO = RVBD.BUDGET_ORDER_NO
      AND BUDGET_ORDER.ACTIVE_FLAG = 1
      AND BUDGET_ORDER.BUDGET_TYPE = 'A'

      LEFT OUTER JOIN BG_T_UPLOAD_DATA AS ACTUAL_DATA
      ON ACTUAL_DATA.BUDGET_YEAR = RVBD.BUDGET_YEAR
      AND ACTUAL_DATA.BUDGET_ORDER_NO = RVBD.BUDGET_ORDER_NO
      AND ACTUAL_DATA.DATA_TYPE = 2
      AND ACTUAL_DATA.PERIOD_TYPE = 1
      AND ACTUAL_DATA.PROJECT_NO = 1

      --LEFT OUTER JOIN BG_T_BUDGET_DATA AS OB_BUDGET_DATA
      --ON OB_BUDGET_DATA.BUDGET_YEAR = RVBD.BUDGET_YEAR +1
      --AND OB_BUDGET_DATA.BUDGET_ORDER_NO = RVBD.BUDGET_ORDER_NO
      --AND OB_BUDGET_DATA.PERIOD_TYPE = 1
      --AND OB_BUDGET_DATA.PROJECT_NO = @RefRBProjectNo
      ----AND OB_BUDGET_DATA.REV_NO = @RefRBRevNo

      GROUP BY RVBD.BUDGET_YEAR,RVBD.PERIOD_TYPE,RVBD.PROJECT_NO

      ) RVDB
      LEFT OUTER JOIN BG_T_BUDGET_ADJUST2 BD
      ON
      BD.BUDGET_YEAR = @BudgetYear
      AND BD.PERIOD_TYPE = @PeriodType
      AND BD.REV_NO = @RevNo
      AND BD.PROJECT_NO = @ProjectNo

      WHERE
      (
      RVDB.REVYEAR &lt;&gt; 0
      OR ISNULL(BD.MTP_SUM1,0) &lt;&gt; 0
      OR ISNULL(BD.MTP_SUM2,0) &lt;&gt; 0
      OR ISNULL(BD.MTP_SUM3,0) &lt;&gt; 0
      OR ISNULL(BD.MTP_SUM4,0) &lt;&gt; 0
      OR ISNULL(BD.MTP_SUM5,0) &lt;&gt; 0
      OR ISNULL(BD.MTP_PY_SUM1,0) &lt;&gt; 0
      OR ISNULL(BD.MTP_PY_SUM2,0) &lt;&gt; 0
      OR ISNULL(BD.MTP_PY_SUM3,0) &lt;&gt; 0
      OR ISNULL(BD.MTP_PY_SUM4,0) &lt;&gt; 0
      OR ISNULL(BD.MTP_PY_SUM5,0) &lt;&gt; 0
      )

      ORDER BY BO.EXPENSE_TYPE,AC.ACCOUNT_NO


    </SELECT029_2>
    <SELECT030>
      SELECT
      BD.BUDGET_YEAR,
      BD.PERIOD_TYPE,
      BD.PROJECT_NO,
      AC.ACCOUNT_NO,
      AC.ACCOUNT_NAME,
      BO.EXPENSE_TYPE,
      BO.COST,
      MAX(BD.REV_NO) AS REV_NO,
      SUM(BD.RRT1) AS RRT1,
      SUM(BD.RRT2) AS RRT2,
      SUM(BD.RRT3) AS RRT3,
      SUM(BD.RRT4) AS RRT4,
      SUM(BD.RRT5) AS RRT5,
      --SUM((ISNULL(OB_BUDGET_DATA.M1,0)+ISNULL(OB_BUDGET_DATA.M2,0)+ISNULL(OB_BUDGET_DATA.M3,0)+ISNULL(OB_BUDGET_DATA.M4,0)+ISNULL(OB_BUDGET_DATA.M5,0)+ISNULL(OB_BUDGET_DATA.M6,0)+ISNULL(OB_BUDGET_DATA.M7,0)+ISNULL(OB_BUDGET_DATA.M8,0)+ISNULL(OB_BUDGET_DATA.M9,0)+ISNULL(OB_BUDGET_DATA.M10,0)+ISNULL(OB_BUDGET_DATA.M11,0)+ISNULL(OB_BUDGET_DATA.M12,0))) AS RevYear,

      (
      SELECT SUM(ISNULL(M1,0)+ISNULL(M2,0)+ISNULL(M3,0)+ISNULL(M4,0)+ISNULL(M5,0)+ISNULL(M6,0)+ISNULL(M7,0)+ISNULL(M8,0)+ISNULL(M9,0)+ISNULL(M10,0)+ISNULL(M11,0)+ISNULL(M12,0)) from  BG_T_BUDGET_DATA AS OB_BUDGET_DATA
      LEFT JOIN BG_M_BUDGET_ORDER AS BOO
      ON OB_BUDGET_DATA.BUDGET_ORDER_NO = BOO.BUDGET_ORDER_NO
      LEFT JOIN BG_M_ACCOUNT AS ACC
      ON BOO.ACCOUNT_NO = ACC.ACCOUNT_NO
      Where OB_BUDGET_DATA.BUDGET_YEAR = (@BudgetYear + 1)
      AND OB_BUDGET_DATA.PERIOD_TYPE = 1
      AND OB_BUDGET_DATA.PROJECT_NO = 1
      AND OB_BUDGET_DATA.REV_NO = (SELECT ISNULL(MAX(REV_NO),1) AS MAX_REV_NO FROM BG_T_BUDGET_HEADER WHERE BUDGET_YEAR = (@BudgetYear + 1) AND PERIOD_TYPE = 1 AND PROJECT_NO = 1 AND BUDGET_TYPE = 'E')
      AND BOO.BUDGET_TYPE = 'E'
      AND BOO.ACTIVE_FLAG = 1
      AND ACC.ACCOUNT_NO = AC.ACCOUNT_NO
      AND BOO.COST = BO.COST
      )  AS RevYear,

      SUM(ISNULL(PREVBD.RRT1,0)) AS PrevRRT1,
      SUM(ISNULL(PREVBD.RRT2,0)) AS PrevRRT2,
      SUM(ISNULL(PREVBD.RRT3,0)) AS PrevRRT3,
      SUM(ISNULL(PREVBD.RRT4,0)) AS PrevRRT4,
      SUM(ISNULL(PREVBD.RRT5,0)) AS PrevRRT5,

      --SUM((ISNULL(OB_BUDGET_DATA.M1,0)+ISNULL(OB_BUDGET_DATA.M2,0)+ISNULL(OB_BUDGET_DATA.M3,0)+ISNULL(OB_BUDGET_DATA.M4,0)
      --+ISNULL(OB_BUDGET_DATA.M5,0)+ISNULL(OB_BUDGET_DATA.M6,0)+ISNULL(OB_BUDGET_DATA.M7,0)
      --+ISNULL(OB_BUDGET_DATA.M8,0)+ISNULL(OB_BUDGET_DATA.M9,0)+ISNULL(OB_BUDGET_DATA.M10,0)
      --+ISNULL(OB_BUDGET_DATA.M11,0)+ISNULL(OB_BUDGET_DATA.M12,0)) - (ISNULL(PREVBD.RRT2,0))) AS DiffYear,

      (( SELECT SUM(ISNULL(M1,0)+ISNULL(M2,0)+ISNULL(M3,0)+ISNULL(M4,0)+ISNULL(M5,0)+ISNULL(M6,0)+ISNULL(M7,0)+ISNULL(M8,0)+ISNULL(M9,0)+ISNULL(M10,0)+ISNULL(M11,0)+ISNULL(M12,0)) from  BG_T_BUDGET_DATA AS OB_BUDGET_DATA
      LEFT JOIN BG_M_BUDGET_ORDER AS BOO
      ON OB_BUDGET_DATA.BUDGET_ORDER_NO = BOO.BUDGET_ORDER_NO
      LEFT JOIN BG_M_ACCOUNT AS ACC
      ON BOO.ACCOUNT_NO = ACC.ACCOUNT_NO
      Where OB_BUDGET_DATA.BUDGET_YEAR = (@BudgetYear + 1)
      AND OB_BUDGET_DATA.PERIOD_TYPE = 1
      AND OB_BUDGET_DATA.PROJECT_NO = 1
      AND OB_BUDGET_DATA.REV_NO = (SELECT ISNULL(MAX(REV_NO),1) AS MAX_REV_NO FROM BG_T_BUDGET_HEADER WHERE BUDGET_YEAR = (@BudgetYear + 1) AND PERIOD_TYPE = 1 AND PROJECT_NO = 1 AND BUDGET_TYPE = 'E')
      AND BOO.BUDGET_TYPE = 'E'
      AND BOO.ACTIVE_FLAG = 1
      AND ACC.ACCOUNT_NO = AC.ACCOUNT_NO
      AND BOO.COST = BO.COST)-SUM(ISNULL(PREVBD.RRT2,0))) AS DiffYear,


      SUM(BD.RRT2) - SUM(ISNULL(PREVBD.RRT3,0)) AS DIFFRRT1

      FROM BG_T_BUDGET_DATA AS BD

      LEFT JOIN BG_M_BUDGET_ORDER AS BO
      ON BD.BUDGET_ORDER_NO = BO.BUDGET_ORDER_NO

      LEFT JOIN BG_M_ACCOUNT AS AC
      ON BO.ACCOUNT_NO = AC.ACCOUNT_NO

      LEFT JOIN BG_M_DEPT AS DP
      ON BO.DEPT_NO = DP.DEPT_NO

      LEFT JOIN BG_M_PERSON_IN_CHARGE AS PIC
      ON BO.PERSON_IN_CHARGE_NO = PIC.PERSON_IN_CHARGE_NO

      LEFT JOIN BG_T_BUDGET_HEADER AS BH
      ON BD.BUDGET_YEAR = BH.BUDGET_YEAR AND
      BD.PERIOD_TYPE = BH.PERIOD_TYPE AND
      BO.PERSON_IN_CHARGE_NO = BH.PERSON_IN_CHARGE_NO AND
      BO.BUDGET_TYPE = BH.BUDGET_TYPE AND
      BD.REV_NO = BH.REV_NO AND
      BD.PROJECT_NO = BH.PROJECT_NO

      LEFT JOIN BG_T_BUDGET_DATA RVBD
      ON BD.BUDGET_YEAR = RVBD.BUDGET_YEAR
      AND BD.BUDGET_ORDER_NO = RVBD.BUDGET_ORDER_NO
      AND  RVBD.PERIOD_TYPE = 3
      AND RVBD.PROJECT_NO = @RefRBProjectNo
      AND RVBD.REV_NO = @RefRBRevNo
      --AND RVBD.PROJECT_NO = 1
      --AND RVBD.REV_NO = (SELECT ISNULL(MAX(REV_NO),1) AS MAX_REV_NO FROM BG_T_BUDGET_HEADER
      --WHERE BUDGET_YEAR = @BudgetYear AND PERIOD_TYPE = 3 AND BUDGET_TYPE = 'E' AND PROJECT_NO = 1)

      LEFT JOIN BG_T_BUDGET_DATA MIN_RVBD
      ON BD.BUDGET_YEAR = MIN_RVBD.BUDGET_YEAR
      AND BD.BUDGET_ORDER_NO = MIN_RVBD.BUDGET_ORDER_NO
      AND  MIN_RVBD.PERIOD_TYPE = 3
      AND MIN_RVBD.REV_NO = 1
      AND MIN_RVBD.PROJECT_NO = 1

      LEFT JOIN BG_T_BUDGET_DATA PREVBD
      ON BD.BUDGET_ORDER_NO = PREVBD.BUDGET_ORDER_NO
      AND PREVBD.BUDGET_YEAR = (@BudgetYear - 1)
      AND BD.PERIOD_TYPE = PREVBD.PERIOD_TYPE
      AND PREVBD.PROJECT_NO = @MtpProjectNo
      AND PREVBD.REV_NO = @MtpRevNo
      --AND PREVBD.PROJECT_NO = @PrevProjectNo
      --AND PREVBD.REV_NO = (SELECT ISNULL(MAX(REV_NO),1) AS MAX_REV_NO
      --FROM BG_T_BUDGET_HEADER
      --WHERE BUDGET_YEAR = (@BudgetYear - 1)
      --AND PERIOD_TYPE = 10
      --AND BUDGET_TYPE = 'E'
      --AND PROJECT_NO = @PrevProjectNo)

      LEFT JOIN BG_T_BUDGET_DATA AS PREV_MIN_REV
      ON PREV_MIN_REV.BUDGET_YEAR =(@BudgetYear - 1)
      AND PREV_MIN_REV.PERIOD_TYPE = BD.PERIOD_TYPE
      --AND PREV_MIN_REV.PROJECT_NO = @PrevProjectNo
      AND PREV_MIN_REV.PROJECT_NO = @MtpProjectNo
      AND PREV_MIN_REV.BUDGET_ORDER_NO = BD.BUDGET_ORDER_NO
      AND PREV_MIN_REV.REV_NO = 1

      LEFT OUTER JOIN BG_T_UPLOAD_DATA AS ACTUAL_DATA
      ON ACTUAL_DATA.BUDGET_YEAR = BD.BUDGET_YEAR
      AND ACTUAL_DATA.BUDGET_ORDER_NO = BD.BUDGET_ORDER_NO
      AND ACTUAL_DATA.DATA_TYPE = 2
      AND ACTUAL_DATA.PERIOD_TYPE = 3
      AND ACTUAL_DATA.PROJECT_NO = 1

      LEFT OUTER JOIN BG_T_BUDGET_DATA AS MIN_REV
      ON MIN_REV.BUDGET_YEAR = BD.BUDGET_YEAR
      AND MIN_REV.PERIOD_TYPE = BD.PERIOD_TYPE
      AND MIN_REV.PROJECT_NO = BD.PROJECT_NO
      AND MIN_REV.BUDGET_ORDER_NO = BD.BUDGET_ORDER_NO
      AND MIN_REV.REV_NO = 1

      LEFT JOIN BG_T_BUDGET_DATA OB_RVBD
      ON BD.BUDGET_YEAR = OB_RVBD.BUDGET_YEAR
      AND BD.BUDGET_ORDER_NO = OB_RVBD.BUDGET_ORDER_NO
      AND  RVBD.PERIOD_TYPE = @REFPERIOD
      AND RVBD.PROJECT_NO = @RefRBProjectNo
      AND RVBD.REV_NO = @RefRBRevNo

      LEFT OUTER JOIN BG_T_UPLOAD_DATA AS OB_ACTUAL_DATA
      ON OB_ACTUAL_DATA.BUDGET_YEAR = BD.BUDGET_YEAR
      AND OB_ACTUAL_DATA.BUDGET_ORDER_NO = BD.BUDGET_ORDER_NO
      AND OB_ACTUAL_DATA.DATA_TYPE = 2
      AND OB_ACTUAL_DATA.PERIOD_TYPE = @REFPERIOD
      AND OB_ACTUAL_DATA.PROJECT_NO = 1

      LEFT OUTER JOIN BG_T_BUDGET_DATA AS OB_BUDGET_DATA
      ON OB_BUDGET_DATA.BUDGET_YEAR = BD.BUDGET_YEAR +1
      AND OB_BUDGET_DATA.BUDGET_ORDER_NO = BD.BUDGET_ORDER_NO
      AND OB_BUDGET_DATA.PERIOD_TYPE = @REFPERIOD
      AND OB_BUDGET_DATA.PROJECT_NO = @RefRBProjectNo
      AND OB_BUDGET_DATA.REV_NO = @RefRBRevNo

      WHERE
      BD.BUDGET_YEAR = @BudgetYear
      AND BD.PERIOD_TYPE = @PeriodType
      AND BD.REV_NO = (SELECT ISNULL(MAX(REV_NO),1) AS MAX_REV_NO FROM BG_T_BUDGET_HEADER
      WHERE BUDGET_YEAR = @BudgetYear
      AND PERIOD_TYPE = @PeriodType AND BUDGET_TYPE = '@BudgetType' AND PROJECT_NO = @ProjectNo)
      AND BD.PROJECT_NO = @ProjectNo
      AND BO.BUDGET_TYPE = '@BudgetType'
      AND BO.ACTIVE_FLAG = 1
      /*AND BH.Status >= @Status*/
      AND (ISNULL(OB_BUDGET_DATA.M1,0) &lt;&gt; 0
      OR ISNULL(OB_BUDGET_DATA.M2,0) &lt;&gt; 0
      OR ISNULL(OB_BUDGET_DATA.M3,0) &lt;&gt; 0
      OR ISNULL(OB_BUDGET_DATA.M4, 0) &lt;&gt; 0
      OR ISNULL(OB_BUDGET_DATA.M5, 0) &lt;&gt; 0
      OR ISNULL(OB_BUDGET_DATA.M6, 0) &lt;&gt; 0
      OR ISNULL(OB_BUDGET_DATA.M7, 0) &lt;&gt; 0
      OR ISNULL(OB_BUDGET_DATA.M8, 0) &lt;&gt; 0
      OR ISNULL(OB_BUDGET_DATA.M9, 0) &lt;&gt; 0
      OR ISNULL(OB_BUDGET_DATA.M10, 0) &lt;&gt; 0
      OR ISNULL(OB_BUDGET_DATA.M11, 0) &lt;&gt; 0
      OR ISNULL(OB_BUDGET_DATA.M12, 0) &lt;&gt; 0
      OR ISNULL(BD.RRT1 ,0) &lt;&gt; 0
      OR ISNULL(BD.RRT2 ,0) &lt;&gt; 0
      OR ISNULL(BD.RRT3 ,0) &lt;&gt; 0
      OR ISNULL(BD.RRT4 ,0) &lt;&gt; 0
      OR ISNULL(BD.RRT5 ,0) &lt;&gt; 0
      OR ISNULL(PREVBD.RRT1 ,0) &lt;&gt; 0
      OR ISNULL(PREVBD.RRT2 ,0) &lt;&gt; 0
      OR ISNULL(PREVBD.RRT3 ,0) &lt;&gt; 0
      OR ISNULL(PREVBD.RRT4 ,0) &lt;&gt; 0
      OR ISNULL(PREVBD.RRT5 ,0) &lt;&gt; 0)

      GROUP BY BD.BUDGET_YEAR, BD.PERIOD_TYPE, BD.PROJECT_NO, AC.ACCOUNT_NO, AC.ACCOUNT_NAME, BO.EXPENSE_TYPE, BO.COST
      ORDER BY BO.COST, BO.EXPENSE_TYPE, AC.ACCOUNT_NO
    </SELECT030>
    <SELECT030_2>
      SELECT
      BD.BUDGET_YEAR,
      BD.PERIOD_TYPE,
      BD.PROJECT_NO,
      AC.ACCOUNT_NO,
      AC.ACCOUNT_NAME,
      BO.EXPENSE_TYPE,
      BO.COST,
      MAX(BD.REV_NO) AS REV_NO,
      SUM(BD.RRT1) AS RRT1,
      SUM(BD.RRT2) AS RRT2,
      SUM(BD.RRT3) AS RRT3,
      SUM(BD.RRT4) AS RRT4,
      SUM(BD.RRT5) AS RRT5,
      --SUM((ISNULL(OB_BUDGET_DATA.M1,0)+ISNULL(OB_BUDGET_DATA.M2,0)+ISNULL(OB_BUDGET_DATA.M3,0)+ISNULL(OB_BUDGET_DATA.M4,0)+ISNULL(OB_BUDGET_DATA.M5,0)+ISNULL(OB_BUDGET_DATA.M6,0)+ISNULL(OB_BUDGET_DATA.M7,0)+ISNULL(OB_BUDGET_DATA.M8,0)+ISNULL(OB_BUDGET_DATA.M9,0)+ISNULL(OB_BUDGET_DATA.M10,0)+ISNULL(OB_BUDGET_DATA.M11,0)+ISNULL(OB_BUDGET_DATA.M12,0))) AS RevYear,

      (
      SELECT SUM(ISNULL(M1,0)+ISNULL(M2,0)+ISNULL(M3,0)+ISNULL(M4,0)+ISNULL(M5,0)+ISNULL(M6,0)+ISNULL(M7,0)+ISNULL(M8,0)+ISNULL(M9,0)+ISNULL(M10,0)+ISNULL(M11,0)+ISNULL(M12,0)) from  BG_T_BUDGET_DATA AS OB_BUDGET_DATA
      LEFT JOIN BG_M_BUDGET_ORDER AS BOO
      ON OB_BUDGET_DATA.BUDGET_ORDER_NO = BOO.BUDGET_ORDER_NO
      LEFT JOIN BG_M_ACCOUNT AS ACC
      ON BOO.ACCOUNT_NO = ACC.ACCOUNT_NO
      Where OB_BUDGET_DATA.BUDGET_YEAR = (@BudgetYear + 1)
      AND OB_BUDGET_DATA.PERIOD_TYPE = 1
      AND OB_BUDGET_DATA.PROJECT_NO = 1
      AND OB_BUDGET_DATA.REV_NO = @RevNo
      AND BOO.BUDGET_TYPE = 'E'
      AND BOO.ACTIVE_FLAG = 1
      AND ACC.ACCOUNT_NO = AC.ACCOUNT_NO
      AND BOO.COST = BO.COST
      )  AS RevYear,


      SUM(ISNULL(PREVBD.RRT1,0)) AS PrevRRT1,
      SUM(ISNULL(PREVBD.RRT2,0)) AS PrevRRT2,
      SUM(ISNULL(PREVBD.RRT3,0)) AS PrevRRT3,
      SUM(ISNULL(PREVBD.RRT4,0)) AS PrevRRT4,
      SUM(ISNULL(PREVBD.RRT5,0)) AS PrevRRT5,

      --SUM((ISNULL(OB_BUDGET_DATA.M1,0)+ISNULL(OB_BUDGET_DATA.M2,0)+ISNULL(OB_BUDGET_DATA.M3,0)+ISNULL(OB_BUDGET_DATA.M4,0)
      --+ISNULL(OB_BUDGET_DATA.M5,0)+ISNULL(OB_BUDGET_DATA.M6,0)+ISNULL(OB_BUDGET_DATA.M7,0)
      --+ISNULL(OB_BUDGET_DATA.M8,0)+ISNULL(OB_BUDGET_DATA.M9,0)+ISNULL(OB_BUDGET_DATA.M10,0)
      --+ISNULL(OB_BUDGET_DATA.M11,0)+ISNULL(OB_BUDGET_DATA.M12,0)) - (ISNULL(PREVBD.RRT2,0))) AS DiffYear,

      (( SELECT SUM(ISNULL(M1,0)+ISNULL(M2,0)+ISNULL(M3,0)+ISNULL(M4,0)+ISNULL(M5,0)+ISNULL(M6,0)+ISNULL(M7,0)+ISNULL(M8,0)+ISNULL(M9,0)+ISNULL(M10,0)+ISNULL(M11,0)+ISNULL(M12,0)) from  BG_T_BUDGET_DATA AS OB_BUDGET_DATA
      LEFT JOIN BG_M_BUDGET_ORDER AS BOO
      ON OB_BUDGET_DATA.BUDGET_ORDER_NO = BOO.BUDGET_ORDER_NO
      LEFT JOIN BG_M_ACCOUNT AS ACC
      ON BOO.ACCOUNT_NO = ACC.ACCOUNT_NO
      Where OB_BUDGET_DATA.BUDGET_YEAR = (@BudgetYear + 1)
      AND OB_BUDGET_DATA.PERIOD_TYPE = 1
      AND OB_BUDGET_DATA.PROJECT_NO = 1
      AND OB_BUDGET_DATA.REV_NO = @RevNo
      AND BOO.BUDGET_TYPE = 'E'
      AND BOO.ACTIVE_FLAG = 1
      AND ACC.ACCOUNT_NO = AC.ACCOUNT_NO
      AND BOO.COST = BO.COST)-SUM(ISNULL(PREVBD.RRT2,0))) AS DiffYear,

      SUM(BD.RRT2) - SUM(ISNULL(PREVBD.RRT3,0)) AS DIFFRRT1
      FROM BG_T_BUDGET_DATA AS BD

      LEFT JOIN BG_M_BUDGET_ORDER AS BO
      ON BD.BUDGET_ORDER_NO = BO.BUDGET_ORDER_NO

      LEFT JOIN BG_M_ACCOUNT AS AC
      ON BO.ACCOUNT_NO = AC.ACCOUNT_NO

      LEFT JOIN BG_M_DEPT AS DP
      ON BO.DEPT_NO = DP.DEPT_NO

      LEFT JOIN BG_M_PERSON_IN_CHARGE AS PIC
      ON BO.PERSON_IN_CHARGE_NO = PIC.PERSON_IN_CHARGE_NO

      LEFT JOIN BG_T_BUDGET_HEADER AS BH
      ON BD.BUDGET_YEAR = BH.BUDGET_YEAR AND
      BD.PERIOD_TYPE = BH.PERIOD_TYPE AND
      BO.PERSON_IN_CHARGE_NO = BH.PERSON_IN_CHARGE_NO AND
      BO.BUDGET_TYPE = BH.BUDGET_TYPE AND
      BD.REV_NO = BH.REV_NO AND
      BD.PROJECT_NO = BH.PROJECT_NO

      LEFT JOIN BG_T_BUDGET_DATA RVBD
      ON BD.BUDGET_YEAR = RVBD.BUDGET_YEAR
      AND BD.BUDGET_ORDER_NO = RVBD.BUDGET_ORDER_NO
      AND  RVBD.PERIOD_TYPE = 3
      AND RVBD.PROJECT_NO = @RefRBProjectNo
      AND RVBD.REV_NO = @RefRBRevNo
      --AND RVBD.PROJECT_NO = 1
      --AND RVBD.REV_NO = (SELECT ISNULL(MAX(REV_NO),1) AS MAX_REV_NO FROM BG_T_BUDGET_HEADER
      --WHERE BUDGET_YEAR = @BudgetYear AND PERIOD_TYPE = 3 AND BUDGET_TYPE = 'E' AND PROJECT_NO = 1)

      LEFT JOIN BG_T_BUDGET_DATA MIN_RVBD
      ON BD.BUDGET_YEAR = MIN_RVBD.BUDGET_YEAR
      AND BD.BUDGET_ORDER_NO = MIN_RVBD.BUDGET_ORDER_NO
      AND  MIN_RVBD.PERIOD_TYPE = 3
      AND MIN_RVBD.REV_NO = 1
      AND MIN_RVBD.PROJECT_NO = 1

      LEFT JOIN BG_T_BUDGET_DATA PREVBD
      ON BD.BUDGET_ORDER_NO = PREVBD.BUDGET_ORDER_NO
      AND PREVBD.BUDGET_YEAR = (@BudgetYear - 1)
      AND BD.PERIOD_TYPE = PREVBD.PERIOD_TYPE
      --AND PREVBD.PROJECT_NO = @PrevProjectNo
      --AND PREVBD.REV_NO = @PrevRevNo
      AND PREVBD.PROJECT_NO = @MtpProjectNo
      AND PREVBD.REV_NO = @MtpRevNo

      LEFT JOIN BG_T_BUDGET_DATA AS PREV_MIN_REV
      ON PREV_MIN_REV.BUDGET_YEAR = (@BudgetYear - 1)
      AND PREV_MIN_REV.PERIOD_TYPE = BD.PERIOD_TYPE
      AND PREV_MIN_REV.PROJECT_NO = @MtpProjectNo
      AND PREV_MIN_REV.BUDGET_ORDER_NO = BD.BUDGET_ORDER_NO
      AND PREV_MIN_REV.REV_NO = 1

      LEFT OUTER JOIN BG_T_UPLOAD_DATA AS ACTUAL_DATA
      ON ACTUAL_DATA.BUDGET_YEAR = BD.BUDGET_YEAR
      AND ACTUAL_DATA.BUDGET_ORDER_NO = BD.BUDGET_ORDER_NO
      AND ACTUAL_DATA.DATA_TYPE = 2
      AND ACTUAL_DATA.PERIOD_TYPE = 3
      AND ACTUAL_DATA.PROJECT_NO = 1

      LEFT OUTER JOIN BG_T_BUDGET_DATA AS MIN_REV
      ON MIN_REV.BUDGET_YEAR = BD.BUDGET_YEAR
      AND MIN_REV.PERIOD_TYPE = BD.PERIOD_TYPE
      AND MIN_REV.PROJECT_NO = BD.PROJECT_NO
      AND MIN_REV.BUDGET_ORDER_NO = BD.BUDGET_ORDER_NO
      AND MIN_REV.REV_NO = 1



      LEFT JOIN BG_T_BUDGET_DATA OB_RVBD
      ON BD.BUDGET_YEAR = OB_RVBD.BUDGET_YEAR
      AND BD.BUDGET_ORDER_NO = OB_RVBD.BUDGET_ORDER_NO
      AND  RVBD.PERIOD_TYPE = @REFPERIOD
      AND RVBD.PROJECT_NO = @RefRBProjectNo
      AND RVBD.REV_NO = @RefRBRevNo

      LEFT OUTER JOIN BG_T_UPLOAD_DATA AS OB_ACTUAL_DATA
      ON OB_ACTUAL_DATA.BUDGET_YEAR = BD.BUDGET_YEAR
      AND OB_ACTUAL_DATA.BUDGET_ORDER_NO = BD.BUDGET_ORDER_NO
      AND OB_ACTUAL_DATA.DATA_TYPE = 2
      AND OB_ACTUAL_DATA.PERIOD_TYPE = @REFPERIOD
      AND OB_ACTUAL_DATA.PROJECT_NO = 1


      LEFT OUTER JOIN BG_T_BUDGET_DATA AS OB_BUDGET_DATA
      ON OB_BUDGET_DATA.BUDGET_YEAR = BD.BUDGET_YEAR +1
      AND OB_BUDGET_DATA.BUDGET_ORDER_NO = BD.BUDGET_ORDER_NO
      AND OB_BUDGET_DATA.PERIOD_TYPE = @REFPERIOD
      AND OB_BUDGET_DATA.PROJECT_NO = @RefRBProjectNo
      AND OB_BUDGET_DATA.REV_NO = @RefRBRevNo


      WHERE
      BD.BUDGET_YEAR = @BudgetYear
      AND BD.PERIOD_TYPE = @PeriodType
      AND BD.REV_NO = @RevNo
      AND BD.PROJECT_NO = @ProjectNo
      AND BO.BUDGET_TYPE = '@BudgetType'
      AND BO.ACTIVE_FLAG = 1
      /*AND BH.Status >= @Status*/
      AND (ISNULL(OB_BUDGET_DATA.M1,0) &lt;&gt; 0
      OR ISNULL(OB_BUDGET_DATA.M2,0) &lt;&gt; 0
      OR ISNULL(OB_BUDGET_DATA.M3,0) &lt;&gt; 0
      OR ISNULL(OB_BUDGET_DATA.M4, 0) &lt;&gt; 0
      OR ISNULL(OB_BUDGET_DATA.M5, 0) &lt;&gt; 0
      OR ISNULL(OB_BUDGET_DATA.M6, 0) &lt;&gt; 0
      OR ISNULL(OB_BUDGET_DATA.M7, 0) &lt;&gt; 0
      OR ISNULL(OB_BUDGET_DATA.M8, 0) &lt;&gt; 0
      OR ISNULL(OB_BUDGET_DATA.M9, 0) &lt;&gt; 0
      OR ISNULL(OB_BUDGET_DATA.M10, 0) &lt;&gt; 0
      OR ISNULL(OB_BUDGET_DATA.M11, 0) &lt;&gt; 0
      OR ISNULL(OB_BUDGET_DATA.M12, 0) &lt;&gt; 0
      OR ISNULL(BD.RRT1 ,0) &lt;&gt; 0
      OR ISNULL(BD.RRT2 ,0) &lt;&gt; 0
      OR ISNULL(BD.RRT3 ,0) &lt;&gt; 0
      OR ISNULL(BD.RRT4 ,0) &lt;&gt; 0
      OR ISNULL(BD.RRT5 ,0) &lt;&gt; 0
      OR ISNULL(PREVBD.RRT1 ,0) &lt;&gt; 0
      OR ISNULL(PREVBD.RRT2 ,0) &lt;&gt; 0
      OR ISNULL(PREVBD.RRT3 ,0) &lt;&gt; 0
      OR ISNULL(PREVBD.RRT4 ,0) &lt;&gt; 0
      OR ISNULL(PREVBD.RRT5 ,0) &lt;&gt; 0)

      GROUP BY BD.BUDGET_YEAR, BD.PERIOD_TYPE, BD.PROJECT_NO, AC.ACCOUNT_NO, AC.ACCOUNT_NAME, BO.EXPENSE_TYPE, BO.COST
      ORDER BY BO.COST, BO.EXPENSE_TYPE, AC.ACCOUNT_NO
    </SELECT030_2>
    <SELECT031>
      SELECT * FROM BG_T_BUDGET_DATA BD WHERE   BD.BUDGET_YEAR = @BudgetYear
      AND BD.PERIOD_TYPE = @PeriodType
      AND BD.REV_NO = @RevNo
      AND BD.PROJECT_NO = @ProjectNo
    </SELECT031>
    <SELECT032>
      SELECT * FROM BG_T_BUDGET_DATA BD 
      WHERE BD.BUDGET_YEAR = @BudgetYear
      AND BD.PERIOD_TYPE = @PeriodType
      AND BD.REV_NO = @RevNo
      AND BD.PROJECT_NO = @ProjectNo
      AND BD.BUDGET_ORDER_NO = '@BudgetOrderNo'
    </SELECT032>
    <INSERT001>
      INSERT INTO BG_T_BUDGET_DATA (BUDGET_YEAR, PERIOD_TYPE, BUDGET_ORDER_NO, REV_NO, CREATE_USER_ID, UPDATE_USER_ID, PROJECT_NO)
      VALUES (@BudgetYear,@PeriodType,'@BudgetOrderNo',@RevNo,'@UserId','@UserId', @ProjectNo)
    </INSERT001>
    <INSERT002>
      INSERT INTO BG_T_BUDGET_DATA (BUDGET_YEAR, PERIOD_TYPE, BUDGET_ORDER_NO, REV_NO,
      M1, M2, M3, M4, M5, M6, M7, M8, M9, M10, M11, M12, RRT1, RRT2, RRT3, RRT4, RRT5, REMARKS,
      CREATE_USER_ID, UPDATE_USER_ID, PROJECT_NO)
      VALUES (@BudgetYear,@PeriodType,'@BudgetOrderNo',@RevNo,
      @M01, @M02, @M03, @M04, @M05, @M06, @M07, @M08, @M09, @M10, @M11, @M12, @RRT1, @RRT2, @RRT3, @RRT4, @RRT5, @Remarks
      '@UserId','@UserId', @ProjectNo)
    </INSERT002>
    <INSERT003>
      INSERT INTO BG_T_BUDGET_DATA (BUDGET_YEAR, PERIOD_TYPE, BUDGET_ORDER_NO, REV_NO, M10, CREATE_USER_ID, UPDATE_USER_ID, PROJECT_NO)
      VALUES (@BudgetYear,@PeriodType,'@BudgetOrderNo',@RevNo,@M10,'@UserId','@UserId', @ProjectNo)
    </INSERT003>
    <INSERT004>
      INSERT INTO BG_T_BUDGET_DATA (BUDGET_YEAR, PERIOD_TYPE, BUDGET_ORDER_NO, REV_NO, M4, CREATE_USER_ID, UPDATE_USER_ID, PROJECT_NO)
      VALUES (@BudgetYear,@PeriodType,'@BudgetOrderNo',@RevNo,@M04,'@UserId','@UserId', @ProjectNo)
    </INSERT004>
    <INSERT005>
      INSERT INTO BG_T_BUDGET_DATA (BUDGET_YEAR, PERIOD_TYPE, BUDGET_ORDER_NO, REV_NO,
      M1, M2, M3, M4, M5, M6, M7, M8, M9, M10, M11, M12,
      CREATE_USER_ID, CREATE_DATE, UPDATE_USER_ID, UPDATE_DATE, PROJECT_NO)
      VALUES (@BudgetYear,@PeriodType,'@BudgetOrderNo',@RevNo,
      @M01, @M02, @M03, @M04, @M05, @M06, @M07, @M08, @M09, @M10, @M11, @M12,
      '@UserId', GetDate(), '@UserId', GetDate(), @ProjectNo)
    </INSERT005>
    <INSERT006>
      INSERT INTO BG_T_BUDGET_DATA (BUDGET_YEAR, PERIOD_TYPE, BUDGET_ORDER_NO, REV_NO,
      RRT1, RRT2, RRT3, RRT4, RRT5,
      CREATE_USER_ID, UPDATE_USER_ID, PROJECT_NO)
      VALUES (@BudgetYear,@PeriodType,'@BudgetOrderNo',@RevNo,
      @RRT1, @RRT2, @RRT3, @RRT4, @RRT5,
      '@UserId','@UserId', @ProjectNo)
    </INSERT006>
    <UPDATE001>
      UPDATE BG_T_BUDGET_DATA SET
      M1 = @M01, M2 = @M02, M3 = @M03, M4 = @M04, M5 = @M05, M6 = @M06,
      M7 = @M07, M8 = @M08, M9 = @M09, M10 = @M10, M11 = @M11, M12 = @M12,
      REMARKS = '@Remarks', WB_FLAG = @WBFlag,
      RRT1 = @RRT1, RRT2 = @RRT2, RRT3 = @RRT3, RRT4 = @RRT4, RRT5 = @RRT5,
      UPDATE_USER_ID = '@UserId', UPDATE_DATE = GetDate()
      WHERE BUDGET_YEAR = @BudgetYear AND PERIOD_TYPE = @PeriodType AND
      BUDGET_ORDER_NO = '@BudgetOrderNo' AND REV_NO = @RevNo AND PROJECT_NO = @ProjectNo
    </UPDATE001>
    <UPDATE002>
      UPDATE BG_T_BUDGET_DATA SET
      M1 = @M01, M2 = @M02, M3 = @M03, M4 = @M04, M5 = @M05, M6 = @M06,
      M7 = @M07, M8 = @M08, M9 = @M09, M10 = @M10, M11 = @M11, M12 = @M12,
      UPDATE_USER_ID = '@UserId', UPDATE_DATE = GetDate()
      WHERE BUDGET_YEAR = @BudgetYear AND PERIOD_TYPE = @PeriodType AND
      BUDGET_ORDER_NO = '@BudgetOrderNo' AND REV_NO = @RevNo AND PROJECT_NO = @ProjectNo
    </UPDATE002>
    <UPDATE002-1>
      UPDATE BG_T_BUDGET_DATA SET
      M1 = @M01, M2 = @M02, M3 = @M03, M4 = @M04, M5 = @M05, M6 = @M06,
      M7 = @M07, M8 = @M08, M9 = @M09, M10 = @M10, M11 = @M11, M12 = @M12,
      UPDATE_USER_ID = '@UserId', UPDATE_DATE = GetDate()
      WHERE BUDGET_YEAR = @BudgetYear AND PERIOD_TYPE = @PeriodType AND
      BUDGET_ORDER_NO = '@BudgetOrderNo' AND REV_NO = @RevNo AND PROJECT_NO = @ProjectNo
    </UPDATE002-1>
    <UPDATE002-2>
      UPDATE BG_T_BUDGET_DATA SET
      M10 = @M10,M11 = @M11, M12 = @M12,
      UPDATE_USER_ID = '@UserId', UPDATE_DATE = GetDate()
      WHERE BUDGET_YEAR = @BudgetYear AND PERIOD_TYPE = @PeriodType AND
      BUDGET_ORDER_NO = '@BudgetOrderNo' AND REV_NO = @RevNo AND PROJECT_NO = @ProjectNo
    </UPDATE002-2>
    <UPDATE002-3>
      UPDATE BG_T_BUDGET_DATA SET
      M4 = @M04, M5 = @M05, M6 = @M06,
      M7 = @M07, M8 = @M08, M9 = @M09, M10 = @M10, M11 = @M11, M12 = @M12,
      UPDATE_USER_ID = '@UserId', UPDATE_DATE = GetDate()
      WHERE BUDGET_YEAR = @BudgetYear AND PERIOD_TYPE = @PeriodType AND
      BUDGET_ORDER_NO = '@BudgetOrderNo' AND REV_NO = @RevNo AND PROJECT_NO = @ProjectNo
    </UPDATE002-3>
    <UPDATE002-4>
      UPDATE BG_T_BUDGET_DATA SET
      RRT1 = @RRT1, RRT2 = @RRT2,
      RRT3 = @RRT3, RRT4 = @RRT4, RRT5 = @RRT5,
      UPDATE_USER_ID = '@UserId', UPDATE_DATE = GetDate()
      WHERE BUDGET_YEAR = @BudgetYear AND PERIOD_TYPE = @PeriodType AND
      BUDGET_ORDER_NO = '@BudgetOrderNo' AND REV_NO = @RevNo AND PROJECT_NO = @ProjectNo
    </UPDATE002-4>
    <!--UPDATE003>
      UPDATE BG_T_BUDGET_DATA SET
      M10 = @M10,
      UPDATE_USER_ID = '@UserId', UPDATE_DATE = GetDate()
      WHERE BUDGET_YEAR = @BudgetYear AND PERIOD_TYPE = @PeriodType AND
      BUDGET_ORDER_NO = '@BudgetOrderNo' AND REV_NO = @RevNo
    </UPDATE003>
    <UPDATE004>
      UPDATE BG_T_BUDGET_DATA SET
      M4 = @M04,
      UPDATE_USER_ID = '@UserId', UPDATE_DATE = GetDate()
      WHERE BUDGET_YEAR = @BudgetYear AND PERIOD_TYPE = @PeriodType AND
      BUDGET_ORDER_NO = '@BudgetOrderNo' AND REV_NO = @RevNo
    </UPDATE004-->
    <UPDATE003>
      UPDATE BG_T_BUDGET_DATA SET
      M10 = @M10,
      UPDATE_USER_ID = '@UserId', UPDATE_DATE = GetDate()
      WHERE BUDGET_YEAR = @BudgetYear AND PERIOD_TYPE = @PeriodType AND
      BUDGET_ORDER_NO = '@BudgetOrderNo' AND PROJECT_NO = @ProjectNo
    </UPDATE003>
    <UPDATE004>
      UPDATE BG_T_BUDGET_DATA SET
      M4 = @M04,
      UPDATE_USER_ID = '@UserId', UPDATE_DATE = GetDate()
      WHERE BUDGET_YEAR = @BudgetYear AND PERIOD_TYPE = @PeriodType AND
      BUDGET_ORDER_NO = '@BudgetOrderNo' AND PROJECT_NO = @ProjectNo
    </UPDATE004>
    <UPDATE005>
      UPDATE BG_T_BUDGET_DATA SET
      M1 = @M01, M2 = @M02, M3 = @M03, M4 = @M04, M5 = @M05, M6 = @M06,
      M7 = @M07, M8 = @M08, M9 = @M09, M10 = @M10, M11 = @M11, M12 = @M12,
      UPDATE_USER_ID = '@UserId', UPDATE_DATE = GetDate()
      WHERE BUDGET_YEAR = @BudgetYear AND PERIOD_TYPE = @PeriodType AND
      BUDGET_ORDER_NO = '@BudgetOrderNo' AND REV_NO = @RevNo AND PROJECT_NO = @ProjectNo
    </UPDATE005>
    <UPDATE006>
      UPDATE BG_T_BUDGET_DATA SET
      RRT1 = @RRT1, RRT2 = @RRT2, RRT3 = @RRT3, RRT4 = @RRT4, RRT5 = @RRT5,
      UPDATE_USER_ID = '@UserId', UPDATE_DATE = GetDate()
      WHERE BUDGET_YEAR = @BudgetYear AND PERIOD_TYPE = @PeriodType AND
      BUDGET_ORDER_NO = '@BudgetOrderNo' AND REV_NO = @RevNo AND PROJECT_NO = @ProjectNo
    </UPDATE006>
    <DELETE001>
      DELETE FROM BG_T_BUDGET_DATA
      WHERE BUDGET_YEAR = @BudgetYear AND PERIOD_TYPE = @PeriodType AND PROJECT_NO = @ProjectNo AND
      REV_NO = @RevNo AND BUDGET_ORDER_NO IN (SELECT BUDGET_ORDER_NO FROM BG_M_BUDGET_ORDER WHERE BUDGET_TYPE = '@BudgetType')
    </DELETE001>
    <DELETE002>
      DELETE FROM BG_T_BUDGET_DATA
      WHERE BUDGET_YEAR = @BudgetYear AND PERIOD_TYPE = @PeriodType AND PROJECT_NO = @ProjectNo AND
      REV_NO = @RevNo AND BUDGET_ORDER_NO IN (SELECT BUDGET_ORDER_NO FROM BG_M_BUDGET_ORDER WHERE BUDGET_TYPE = '@BudgetType' AND
      PERSON_IN_CHARGE_NO = '@UserPIC')
    </DELETE002>
    <DELETE003>
      DELETE FROM BG_T_BUDGET_DATA
      WHERE  BUDGET_ORDER_NO = '@BudgetOrderNo'
    </DELETE003>





  </BG_T_BUDGET_DATA>

  <!--// Table: BG_T_BUDGET_HEADER -->
  <BG_T_BUDGET_HEADER>
    <SELECT001>
      SELECT BH.STATUS, BA.RRT0, BA.RRT1, BA.RRT2, BA.RRT3, BA.RRT4, BA.RRT5, BA.WORKING_BG1, BA.WORKING_BG2, BH.REF_REV_NO,
      US.USER_NAME AS UPDATE_USER_NAME, BH.UPDATE_DATE
      FROM BG_T_BUDGET_HEADER AS BH LEFT JOIN BG_T_BUDGET_ADJUST AS BA
      ON BH.BUDGET_YEAR = BA.BUDGET_YEAR AND BH.PERIOD_TYPE = BA.PERIOD_TYPE AND BH.REV_NO = BA.REV_NO AND BH.PROJECT_NO = BA.PROJECT_NO
      LEFT JOIN BG_M_USER AS US ON BH.UPDATE_USER_ID = US.USER_ID
      WHERE BH.BUDGET_YEAR = @BudgetYear AND BH.PERIOD_TYPE = @PeriodType AND
      BH.BUDGET_TYPE = '@BudgetType' AND BH.REV_NO = @RevNo
      AND BH.PROJECT_NO = @ProjectNo
    </SELECT001>
    <SELECT001_1>
      SELECT BH.STATUS, BA.RRT0, BA.RRT1, BA.RRT2, BA.RRT3, BA.RRT4, BA.RRT5, BA.WORKING_BG1, BA.WORKING_BG2, BH.REF_REV_NO,
      US.USER_NAME AS UPDATE_USER_NAME, BH.UPDATE_DATE
      FROM BG_T_BUDGET_HEADER AS BH LEFT JOIN BG_T_BUDGET_ADJUST AS BA
      ON BH.BUDGET_YEAR = BA.BUDGET_YEAR AND BH.PERIOD_TYPE = BA.PERIOD_TYPE AND BH.REV_NO = BA.REV_NO AND BH.PROJECT_NO = BA.PROJECT_NO
      LEFT JOIN BG_M_USER AS US ON BH.UPDATE_USER_ID = US.USER_ID
      WHERE BH.BUDGET_YEAR = @BudgetYear AND BH.PERIOD_TYPE = @PeriodType AND
      BH.BUDGET_TYPE = '@BudgetType' AND BH.REV_NO = @RevNo
      AND BH.PROJECT_NO = @ProjectNo
      AND BH.STATUS = @STATUS
    </SELECT001_1>
    <SELECT002>
      SELECT BH.STATUS, BA.RRT0, BA.RRT1, BA.RRT2, BA.RRT3, BA.RRT4, BA.RRT5, BA.WORKING_BG1, BA.WORKING_BG2, BH.REF_REV_NO,
      US.USER_NAME AS UPDATE_USER_NAME, BH.UPDATE_DATE
      FROM BG_T_BUDGET_HEADER AS BH LEFT JOIN BG_T_BUDGET_ADJUST AS BA
      ON BH.BUDGET_YEAR = BA.BUDGET_YEAR AND BH.PERIOD_TYPE = BA.PERIOD_TYPE AND BH.REV_NO = BA.REV_NO AND BH.PROJECT_NO = BA.PROJECT_NO
      LEFT JOIN BG_M_USER AS US ON BH.UPDATE_USER_ID = US.USER_ID
      WHERE BH.BUDGET_YEAR = @BudgetYear AND BH.PERIOD_TYPE = @PeriodType AND BH.PROJECT_NO = @ProjectNo AND
      BH.BUDGET_TYPE = '@BudgetType' AND BH.REV_NO = @RevNo AND BH.PERSON_IN_CHARGE_NO = '@UserPIC'
      AND BH.PROJECT_NO = @ProjectNo
    </SELECT002>
    <SELECT002_1>
      SELECT BH.STATUS, BA.RRT0, BA.RRT1, BA.RRT2, BA.RRT3, BA.RRT4, BA.RRT5, BA.WORKING_BG1, BA.WORKING_BG2, BH.REF_REV_NO,
      US.USER_NAME AS UPDATE_USER_NAME, BH.UPDATE_DATE
      FROM BG_T_BUDGET_HEADER AS BH LEFT JOIN BG_T_BUDGET_ADJUST AS BA
      ON BH.BUDGET_YEAR = BA.BUDGET_YEAR AND BH.PERIOD_TYPE = BA.PERIOD_TYPE AND BH.REV_NO = BA.REV_NO AND BH.PROJECT_NO = BA.PROJECT_NO
      LEFT JOIN BG_M_USER AS US ON BH.UPDATE_USER_ID = US.USER_ID
      WHERE BH.BUDGET_YEAR = @BudgetYear AND BH.PERIOD_TYPE = @PeriodType AND BH.PROJECT_NO = @ProjectNo AND
      BH.BUDGET_TYPE = '@BudgetType' AND BH.REV_NO = @RevNo AND BH.PERSON_IN_CHARGE_NO = '@UserPIC'
      AND BH.PROJECT_NO = @ProjectNo
      AND BH.STATUS = @STATUS
    </SELECT002_1>
    <SELECT003>
      SELECT * FROM BG_T_BUDGET_HEADER
      WHERE BUDGET_YEAR = @BudgetYear AND PERIOD_TYPE = @PeriodType AND BUDGET_TYPE = '@BudgetType' AND PROJECT_NO = @ProjectNo AND REV_NO = @RevNo AND STATUS = @Status
    </SELECT003>
    <SELECT004>
      SELECT * FROM BG_T_BUDGET_HEADER
      WHERE BUDGET_YEAR = @BudgetYear AND PERIOD_TYPE = @PeriodType AND BUDGET_TYPE = '@BudgetType' AND PROJECT_NO = @ProjectNo AND REV_NO = @RevNo AND STATUS = @Status AND
      (PERSON_IN_CHARGE_NO LIKE '@UserPIC%' OR PERSON_IN_CHARGE_NO IN (SELECT PIC_CHILD_NO AS PERSON_IN_CHARGE_NO
      FROM BG_M_CHILD_PIC WHERE PIC_PARENT_NO = '@UserPIC'))
    </SELECT004>
    <SELECT005>
      SELECT MAX(REV_NO) AS MAX_REV_NO FROM BG_T_BUDGET_HEADER
      WHERE BUDGET_YEAR = @BudgetYear AND PERIOD_TYPE = @PeriodType AND PROJECT_NO = @ProjectNo
    </SELECT005>
    <SELECT006>
      SELECT MAX(REV_NO) AS MAX_REV_NO FROM BG_T_BUDGET_HEADER
      WHERE BUDGET_YEAR = @BudgetYear AND PERIOD_TYPE = @PeriodType AND BUDGET_TYPE = '@BudgetType' AND PROJECT_NO = @ProjectNo
    </SELECT006>
    <SELECT007>
      SELECT MAX_REV.BUDGET_YEAR, MAX_REV.PERIOD_TYPE, MAX_REV.REV_NO, MAX(STATUS) AS STATUS
      FROM (SELECT BUDGET_YEAR, PERIOD_TYPE, MAX(REV_NO) AS REV_NO, PROJECT_NO
      FROM BG_T_BUDGET_HEADER
      WHERE BUDGET_YEAR = @YEAR AND PERIOD_TYPE = @PERIOD_TYPE AND BUDGET_TYPE = '@BUDGET_TYPE' AND PROJECT_NO = @PROJECTNO
      GROUP BY BUDGET_YEAR, PERIOD_TYPE, BUDGET_TYPE, PROJECT_NO) AS MAX_REV
      INNER JOIN BG_T_BUDGET_HEADER AS A ON MAX_REV.BUDGET_YEAR = A.BUDGET_YEAR
      AND MAX_REV.PERIOD_TYPE = A.PERIOD_TYPE AND MAX_REV.REV_NO = A.REV_NO AND MAX_REV.PROJECT_NO = A.PROJECT_NO
      GROUP BY MAX_REV.BUDGET_YEAR, MAX_REV.PERIOD_TYPE, MAX_REV.REV_NO, MAX_REV.PROJECT_NO
    </SELECT007>
    <SELECT008>
      SELECT BH.STATUS, BA.RRT0, BA.RRT1, BA.RRT2, BA.RRT3, BA.RRT4, BA.RRT5, BA.WORKING_BG1, BA.WORKING_BG2, BH.REF_REV_NO,
      US.USER_NAME AS UPDATE_USER_NAME, BH.UPDATE_DATE
      FROM BG_T_BUDGET_HEADER AS BH

      LEFT JOIN BG_T_BUDGET_ADJUST AS BA
      ON BH.BUDGET_YEAR = BA.BUDGET_YEAR
      AND BH.PERIOD_TYPE = BA.PERIOD_TYPE
      AND BH.REV_NO = BA.REV_NO
      AND BH.PROJECT_NO = BA.PROJECT_NO

      LEFT JOIN BG_M_USER AS US ON BH.UPDATE_USER_ID = US.USER_ID
      WHERE BH.BUDGET_YEAR = @BudgetYear AND BH.PERIOD_TYPE = @PeriodType AND
      BH.BUDGET_TYPE = '@BudgetType' AND BH.REV_NO = @RevNo AND BH.PROJECT_NO = @ProjectNo
    </SELECT008>
    <SELECT008_1>
      SELECT BH.STATUS, BA.RRT0, BA.RRT1, BA.RRT2, BA.RRT3, BA.RRT4, BA.RRT5, BA.WORKING_BG1, BA.WORKING_BG2, BH.REF_REV_NO,
      US.USER_NAME AS UPDATE_USER_NAME, BH.UPDATE_DATE
      FROM BG_T_BUDGET_HEADER AS BH

      LEFT JOIN BG_T_BUDGET_ADJUST AS BA
      ON BH.BUDGET_YEAR = BA.BUDGET_YEAR
      AND BH.PERIOD_TYPE = BA.PERIOD_TYPE
      AND BH.REV_NO = BA.REV_NO
      AND BH.PROJECT_NO = BA.PROJECT_NO

      LEFT JOIN BG_M_USER AS US ON BH.UPDATE_USER_ID = US.USER_ID
      WHERE BH.BUDGET_YEAR = @BudgetYear AND BH.PERIOD_TYPE = @PeriodType AND
      BH.BUDGET_TYPE = '@BudgetType' AND BH.REV_NO = @RevNo AND BH.PROJECT_NO = @ProjectNo
      AND BH.STATUS = @STATUS
    </SELECT008_1>
    <SELECT009>
      SELECT DISTINCT REV_NO FROM BG_T_BUDGET_HEADER
      WHERE BUDGET_YEAR = @BudgetYear AND PERIOD_TYPE = @PeriodType AND BUDGET_TYPE = '@BudgetType' AND PROJECT_NO = @ProjectNo
      ORDER BY REV_NO DESC
    </SELECT009>
    <SELECT010>
      SELECT BH.STATUS, BA.RRT0, BA.RRT1, BA.RRT2, BA.RRT3, BA.RRT4, BA.RRT5, BA.WORKING_BG1, BA.WORKING_BG2, BH.REF_REV_NO,
      US.USER_NAME AS UPDATE_USER_NAME, BH.UPDATE_DATE
      FROM BG_T_BUDGET_HEADER AS BH

      LEFT JOIN BG_T_BUDGET_ADJUST AS BA
      ON BH.BUDGET_YEAR = BA.BUDGET_YEAR
      AND BH.PERIOD_TYPE = BA.PERIOD_TYPE
      AND BH.REV_NO = BA.REV_NO
      AND BH.PROJECT_NO = BA.PROJECT_NO

      LEFT JOIN BG_M_USER AS US
      ON BH.UPDATE_USER_ID = US.USER_ID

      WHERE BH.BUDGET_YEAR = @BudgetYear AND BH.PERIOD_TYPE = @PeriodType AND BH.PROJECT_NO = @ProjectNo AND
      BH.BUDGET_TYPE = '@BudgetType' AND BH.REV_NO = @RevNo AND (BH.PERSON_IN_CHARGE_NO LIKE '@UserPIC%' OR
      BH.PERSON_IN_CHARGE_NO IN (SELECT PIC_CHILD_NO AS PERSON_IN_CHARGE_NO
      FROM BG_M_CHILD_PIC WHERE PIC_PARENT_NO = '@UserPIC'))
    </SELECT010>
    <SELECT011>
      SELECT DISTINCT REV_NO, MAX(STATUS) AS MAX_REV_STATUS
      FROM BG_T_BUDGET_HEADER
      WHERE BUDGET_YEAR = @BudgetYear
      AND PERIOD_TYPE = @PeriodType
      AND BUDGET_TYPE = '@BudgetType'
      AND PROJECT_NO = @ProjectNo
      AND REV_NO = (SELECT MAX(REV_NO)
      FROM BG_T_BUDGET_HEADER
      WHERE BUDGET_YEAR = @BudgetYear
      AND PERIOD_TYPE = @PeriodType
      AND BUDGET_TYPE = '@BudgetType'
      AND PROJECT_NO = @ProjectNo)
      GROUP BY REV_NO
    </SELECT011>
    <SELECT012>
      SELECT MAX(REV_NO) AS MAX_REV_NO FROM BG_T_BUDGET_HEADER
      WHERE BUDGET_YEAR = @BudgetYear AND PERIOD_TYPE = @PeriodType AND BUDGET_TYPE = '@BudgetType' AND PROJECT_NO = @ProjectNo
      AND PERSON_IN_CHARGE_NO = '@UserPIC'
    </SELECT012>
    <SELECT013>
      SELECT BH.STATUS, BA.RRT0, BA.RRT1, BA.RRT2, BA.RRT3, BA.RRT4, BA.RRT5, BA.WORKING_BG1, BA.WORKING_BG2, BH.REF_REV_NO,
      US.USER_NAME AS UPDATE_USER_NAME, BH.UPDATE_DATE
      FROM BG_T_BUDGET_HEADER AS BH

      LEFT JOIN BG_T_BUDGET_ADJUST AS BA
      ON BH.BUDGET_YEAR = BA.BUDGET_YEAR
      AND BH.PERIOD_TYPE = BA.PERIOD_TYPE
      AND BH.REV_NO = BA.REV_NO
      AND BH.PROJECT_NO = BA.PROJECT_NO

      LEFT JOIN BG_M_USER AS US
      ON BH.UPDATE_USER_ID = US.USER_ID

      WHERE BH.BUDGET_YEAR = @BudgetYear
      AND BH.PERIOD_TYPE = @PeriodType
      AND BH.BUDGET_TYPE = '@BudgetType'
      AND BH.REV_NO = @RevNo
      AND BH.PROJECT_NO = @ProjectNo
    </SELECT013>
    <SELECT014>
      SELECT DISTINCT REV_NO
      FROM BG_T_BUDGET_HEADER
      WHERE BUDGET_YEAR = @BudgetYear
      AND PERIOD_TYPE = @PeriodType
      AND PROJECT_NO = @ProjectNo
      AND BUDGET_TYPE = '@BudgetType'
      ORDER BY REV_NO DESC
    </SELECT014>
    <SELECT015>
      SELECT * FROM BG_T_BUDGET_HEADER
      WHERE BUDGET_YEAR = @BudgetYear
      AND PERIOD_TYPE = @PeriodType
      AND REV_NO = @RevNo
      AND PROJECT_NO = @ProjectNo
      AND BUDGET_TYPE = (SELECT BUDGET_TYPE FROM BG_M_BUDGET_ORDER WHERE BUDGET_ORDER_NO = '@BudgetOrderNo')
      AND PERSON_IN_CHARGE_NO = (SELECT PERSON_IN_CHARGE_NO FROM BG_M_BUDGET_ORDER WHERE BUDGET_ORDER_NO = '@BudgetOrderNo')
    </SELECT015>
    <SELECT016>
      SELECT * FROM BG_T_BUDGET_HEADER
      WHERE PERSON_IN_CHARGE_NO ='@UserPIC'
    </SELECT016>
    <SELECT017>
      SELECT HD.BUDGET_YEAR,HD.PERIOD_TYPE,HD.BUDGET_TYPE,HD.REV_NO,HD.PROJECT_NO,HD.STATUS,HD.RRT0,HD.RRT1,HD.RRT2,HD.RRT3,HD.RRT4,HD.RRT5,HD.WORKING_BG1,HD.WORKING_BG2
      FROM [BG_T_BUDGET_HEADER] HD
      INNER JOIN dbo.BG_T_BUDGET_PERIOD PD
      ON HD.BUDGET_YEAR = PD.BUDGET_YEAR
      AND HD.PERIOD_TYPE = PD.PERIOD_TYPE
      AND HD.PROJECT_NO = PD.PROJECT_NO
      AND HD.PERSON_IN_CHARGE_NO = '@PIC'
      GROUP BY  HD.BUDGET_YEAR,HD.PERIOD_TYPE,HD.BUDGET_TYPE,HD.REV_NO,HD.PROJECT_NO,HD.STATUS,HD.RRT0,HD.RRT1,HD.RRT2,HD.RRT3,HD.RRT4,HD.RRT5,HD.WORKING_BG1,HD.WORKING_BG2
      <!--AND PD.HIDE_FLAG = 0-->
    </SELECT017>
    <INSERT001>
      INSERT INTO BG_T_BUDGET_HEADER (BUDGET_YEAR, PERIOD_TYPE, BUDGET_TYPE, PERSON_IN_CHARGE_NO,
      REV_NO, STATUS, CREATE_USER_ID, UPDATE_USER_ID, PROJECT_NO)
      VALUES (@BudgetYear,@PeriodType,'@BudgetType','@UserPIC',@RevNo,@Status,'@UserId','@UserId', @ProjectNo)
    </INSERT001>
    <INSERT002>
      INSERT INTO BG_T_BUDGET_HEADER (BUDGET_YEAR, PERIOD_TYPE, BUDGET_TYPE, PERSON_IN_CHARGE_NO,
      REV_NO, STATUS, CREATE_USER_ID, UPDATE_USER_ID, PROJECT_NO)
      VALUES (@BudgetYear,@PeriodType,'@BudgetType','@UserPIC',@RevNo,@Status,'@UserId','@UserId', @ProjectNo)
    </INSERT002>
    <INSERT003>
    INSERT INTO BG_T_BUDGET_HEADER (BUDGET_YEAR, PERIOD_TYPE, BUDGET_TYPE, PERSON_IN_CHARGE_NO,
    REV_NO, STATUS, CREATE_USER_ID, UPDATE_USER_ID, PROJECT_NO, RRT1, RRT2, RRT3, RRT4, RRT5, WORKINGBG1, WORKINGBG2 )
    VALUES (@BudgetYear,@PeriodType,'@BudgetType','@UserPIC',@RevNo,@Status,'@UserId','@UserId', @ProjectNo, @RRT1, @RRT2, @RRT3, @RRT4, @RRT5, @WorkingBG1, @WorkingBG2)
    </INSERT003>
    <UPDATE001>
      UPDATE BG_T_BUDGET_HEADER SET
      STATUS = @Status, UPDATE_USER_ID = '@UserId', UPDATE_DATE = GetDate()
      WHERE BUDGET_YEAR = @BudgetYear AND PERIOD_TYPE = @PeriodType AND BUDGET_TYPE = '@BudgetType' AND
      PERSON_IN_CHARGE_NO = '@UserPIC' AND REV_NO = @RevNo AND PROJECT_NO = @ProjectNo
    </UPDATE001>
    <UPDATE002>
      UPDATE BG_T_BUDGET_HEADER SET
      STATUS = @Status, UPDATE_USER_ID = '@UserId', UPDATE_DATE = GetDate()
      WHERE BUDGET_YEAR = @BudgetYear AND PERIOD_TYPE = @PeriodType AND BUDGET_TYPE = '@BudgetType' AND
      PERSON_IN_CHARGE_NO = '@UserPIC' AND REV_NO = @RevNo AND PROJECT_NO = @ProjectNo
    </UPDATE002>
    <UPDATE003>
      UPDATE BG_T_BUDGET_HEADER SET
      STATUS = @Status, UPDATE_USER_ID = '@UserId', UPDATE_DATE = GetDate()
      WHERE BUDGET_YEAR = @BudgetYear AND PERIOD_TYPE = @PeriodType AND BUDGET_TYPE = '@BudgetType' AND
      REV_NO = @RevNo AND PROJECT_NO = @ProjectNo
    </UPDATE003>
    <UPDATE004>
      UPDATE BG_T_BUDGET_HEADER
      SET STATUS = @Status,
      UPDATE_USER_ID = '@UserId',
      UPDATE_DATE = GetDate(),
      REF_REV_NO = @RevNo2
      WHERE BUDGET_YEAR = @BudgetYear
      AND PERIOD_TYPE = @PeriodType
      AND BUDGET_TYPE = '@BudgetType'
      AND REV_NO = @RevNo1
      AND PERSON_IN_CHARGE_NO = '@UserPIC'
      AND PROJECT_NO = @ProjectNo
    </UPDATE004>
    <DELETE001>
      DELETE FROM BG_T_BUDGET_HEADER
      WHERE BUDGET_YEAR = @BudgetYear AND PERIOD_TYPE = @PeriodType AND BUDGET_TYPE = '@BudgetType' AND
      REV_NO = @RevNo AND PROJECT_NO = @ProjectNo
    </DELETE001>
    <DELETE002>
      DELETE FROM BG_T_BUDGET_HEADER
      WHERE BUDGET_YEAR = @BudgetYear AND PERIOD_TYPE = @PeriodType AND BUDGET_TYPE = '@BudgetType' AND
      REV_NO = @RevNo AND PERSON_IN_CHARGE_NO = '@UserPIC' AND PROJECT_NO = @ProjectNo
    </DELETE002>
  </BG_T_BUDGET_HEADER>

  <!--// Table: BG_T_BUDGET_PERIOD -->
  <BG_T_BUDGET_PERIOD>
    <SELECT001>
      SELECT * FROM BG_T_BUDGET_PERIOD WHERE CLOSE_FLAG = 0
      ORDER BY BUDGET_YEAR, PERIOD_TYPE
    </SELECT001>
    <SELECT002>
      SELECT * FROM BG_T_BUDGET_PERIOD WHERE CLOSE_FLAG = 1
      ORDER BY BUDGET_YEAR DESC, PERIOD_TYPE
    </SELECT002>
    <SELECT003>
      SELECT * FROM BG_T_BUDGET_PERIOD WHERE BUDGET_YEAR = @BudgetYear AND PERIOD_TYPE = @PeriodType AND PROJECT_NO = @ProjectNo
    </SELECT003>
    <SELECT004>
      SELECT *
      FROM BG_T_BUDGET_PERIOD
      WHERE BUDGET_YEAR >= (@BudgetYear - 3)
      @ViewAll
      ORDER BY BUDGET_YEAR, PERIOD_TYPE
    </SELECT004>
    <SELECT005>
      SELECT *
      FROM BG_T_BUDGET_PERIOD
      @ViewAll
      ORDER BY BUDGET_YEAR, PERIOD_TYPE
    </SELECT005>
    <SELECT006>
      (SELECT BUDGET_YEAR, PERIOD_TYPE, PROJECT_NO FROM BG_T_BUDGET_PERIOD WHERE CLOSE_FLAG = 0 @ViewAll)
      UNION
      (SELECT DISTINCT BUDGET_YEAR, PERIOD_TYPE, PROJECT_NO FROM BG_T_ACCOUNT_REOPEN)
      ORDER BY BUDGET_YEAR, PERIOD_TYPE, PROJECT_NO
    </SELECT006>
    <SELECT007>
      SELECT * FROM BG_T_BUDGET_PERIOD WHERE BUDGET_YEAR = @BudgetYear AND PERIOD_TYPE = @PeriodType AND PROJECT_NO = @ProjectNo
    </SELECT007>
    <SELECT008>
      SELECT TP.BUDGET_YEAR,
      TP.PERIOD_TYPE,
      TP.PROJECT_NO,
      TP.HIDE_FLAG
      FROM BG_T_BUDGET_PERIOD TP
      ORDER BY TP.BUDGET_YEAR, TP.PERIOD_TYPE
    </SELECT008>
    <SELECT009>
      SELECT TP.BUDGET_YEAR,
      TP.PERIOD_TYPE,
      TP.PROJECT_NO,
      TP.HIDE_FLAG
      FROM BG_T_BUDGET_PERIOD TP
      WHERE TP.BUDGET_YEAR = @BudgetYear
      AND TP.PERIOD_TYPE = @PeriodType
      AND TP.PROJECT_NO = @ProjectNo
    </SELECT009>
    <INSERT001>
      INSERT INTO BG_T_BUDGET_PERIOD (BUDGET_YEAR, PERIOD_TYPE, CREATE_USER_ID, UPDATE_USER_ID, PROJECT_NO)
      VALUES (@BudgetYear,@PeriodType,'@UserId','@UserId', @ProjectNo)
    </INSERT001>
    <UPDATE001>
      UPDATE BG_T_BUDGET_PERIOD SET
      CLOSE_FLAG = @CloseFlg, UPDATE_USER_ID = '@UserId', UPDATE_DATE = GetDate()
      WHERE BUDGET_YEAR = @BudgetYear AND PERIOD_TYPE = @PeriodType AND PROJECT_NO = @ProjectNo
    </UPDATE001>
    <UPDATE002>
      UPDATE BG_T_BUDGET_PERIOD SET
      HIDE_FLAG = @HideFlag, UPDATE_USER_ID = '@UserId', UPDATE_DATE = GetDate()
      WHERE BUDGET_YEAR = @BudgetYear AND PERIOD_TYPE = @PeriodType AND PROJECT_NO = @ProjectNo
    </UPDATE002>
  </BG_T_BUDGET_PERIOD>

  <!--// Table: BG_M_SETTINGS -->
  <BG_M_SETTINGS>
    <SELECT001>
      SELECT * FROM BG_M_SETTINGS
    </SELECT001>
    <SELECT002>
      SELECT AUTH1_IMAGE, AUTH2_IMAGE FROM BG_M_SETTINGS
    </SELECT002>
    <UPDATE001>
      UPDATE BG_M_SETTINGS SET
      HOME_URL = @HomeUrl,
      SHARED_FOLDER = @SharedFolder,
      MTP_HIGHLIGHT_VALUE = @HighLightMTP,
      MAIL_FROM_ADDR = @FromAddr,
      MAIL_SMTP_SVR = @SmtpServer,
      MAIL_SMTP_PORT = @SmtpPort,
      MAIL_USE_AUTH = @UseAuth,
      MAIL_USER = @SmtpUser,
      MAIL_PWD = @SmtpPassword,
      MAIL_ENABLE = @EnableMail,
      AUTH1_IMAGE = @Auth1Pic,
      AUTH2_IMAGE = @Auth2Pic,
      UPDATE_USER_ID = @UserId,
      UPDATE_DATE = GetDate()
    </UPDATE001>
  </BG_M_SETTINGS>

  <!--// Table: BG_M_ACCOUNT -->
  <BG_M_ACCOUNT>
    <SELECT001>
      SELECT ACCOUNT_NO, ACCOUNT_NAME, ACCOUNT_NO + ' : ' + ACCOUNT_NAME [ACCOUNT_NAME_2] FROM BG_M_ACCOUNT ORDER BY ACCOUNT_NO ASC
    </SELECT001>
    <SELECT002>
      SELECT * FROM BG_M_ACCOUNT @Where
    </SELECT002>
    <SELECT003>
      SELECT * FROM BG_M_ACCOUNT WHERE ACCOUNT_NO = '@No'
    </SELECT003>
    <SELECT004>
      SELECT DISTINCT ACCOUNT_NO FROM BG_M_BUDGET_ORDER WHERE PERSON_IN_CHARGE_NO = '@PicNo'
    </SELECT004>
    <UPDATE001>
      UPDATE BG_M_ACCOUNT SET
      ACCOUNT_NAME = '@Name', UPDATE_USER_ID = '@UserId', UPDATE_DATE = GetDate()
      WHERE ACCOUNT_NO = '@No'
    </UPDATE001>
    <INSERT001>
      INSERT INTO BG_M_ACCOUNT (ACCOUNT_NO, ACCOUNT_NAME,
      CREATE_USER_ID, CREATE_DATE, UPDATE_USER_ID, UPDATE_DATE )
      VALUES ('@No','@Name','@UserId', GetDate(), '@UserId', GetDate() )
    </INSERT001>
    <DELETE001>
      DELETE FROM BG_M_ACCOUNT WHERE ACCOUNT_NO = '@No'
    </DELETE001>
  </BG_M_ACCOUNT>

  <!--// Table: BG_M_PERSON_IN_CHARGE -->
  <BG_M_PERSON_IN_CHARGE>
    <SELECT001>
      SELECT *, PERSON_IN_CHARGE_NO + ' : ' + PERSON_IN_CHARGE_NAME [PIC_NAME] FROM BG_M_PERSON_IN_CHARGE
      ORDER BY PERSON_IN_CHARGE_NO
    </SELECT001>
    <SELECT002>
      SELECT * FROM BG_M_PERSON_IN_CHARGE
      @Where
      ORDER BY PERSON_IN_CHARGE_NO
    </SELECT002>
    <SELECT003>
      SELECT * FROM BG_M_PERSON_IN_CHARGE WHERE PERSON_IN_CHARGE_NO = '@No'
      ORDER BY PERSON_IN_CHARGE_NO
    </SELECT003>
    <SELECT004>
      SELECT DISTINCT PIC.PERSON_IN_CHARGE_NO,
      PIC.PERSON_IN_CHARGE_NO + ' : ' + PIC.PERSON_IN_CHARGE_NAME AS PIC_NAME,
      BH.BUDGET_YEAR, BH.PERIOD_TYPE, BH.REV_NO, BH.STATUS
      FROM BG_M_BUDGET_ORDER AS BO
      LEFT JOIN BG_M_PERSON_IN_CHARGE AS PIC ON BO.PERSON_IN_CHARGE_NO = PIC.PERSON_IN_CHARGE_NO
      LEFT JOIN BG_T_BUDGET_HEADER AS BH ON BO.PERSON_IN_CHARGE_NO = BH.PERSON_IN_CHARGE_NO AND BO.BUDGET_TYPE = BH.BUDGET_TYPE
      WHERE BO.ACTIVE_FLAG = 1 AND BO.BUDGET_TYPE = '@BudgetType' AND
      (BH.BUDGET_YEAR IS NULL OR BH.BUDGET_YEAR = @BudgetYear) AND
      (BH.PERIOD_TYPE IS NULL OR BH.PERIOD_TYPE = @PeriodType) AND
      (BH.REV_NO IS NULL OR BH.REV_NO = @RevNo) AND
      (BH.STATUS IS NULL OR BH.STATUS = @Status)
      ORDER BY PIC.PERSON_IN_CHARGE_NO
    </SELECT004>
    <SELECT005>
      SELECT DISTINCT PIC.PERSON_IN_CHARGE_NO,
      PIC.PERSON_IN_CHARGE_NO + ' : ' + PIC.PERSON_IN_CHARGE_NAME AS PIC_NAME
      FROM BG_T_BUDGET_HEADER AS BH LEFT JOIN BG_M_PERSON_IN_CHARGE AS PIC
      ON BH.PERSON_IN_CHARGE_NO = PIC.PERSON_IN_CHARGE_NO
      WHERE BH.BUDGET_YEAR = @BudgetYear AND BH.PERIOD_TYPE = @PeriodType AND BH.PROJECT_NO = @ProjectNo AND
      BH.BUDGET_TYPE = '@BudgetType' AND BH.REV_NO = @RevNo
      ORDER BY PIC.PERSON_IN_CHARGE_NO
    </SELECT005>
    <SELECT006>
      SELECT DISTINCT PIC.PERSON_IN_CHARGE_NO,
      PIC.PERSON_IN_CHARGE_NO + ' : ' + PIC.PERSON_IN_CHARGE_NAME AS PIC_NAME
      FROM BG_T_BUDGET_HEADER AS BH LEFT JOIN BG_M_PERSON_IN_CHARGE AS PIC
      ON BH.PERSON_IN_CHARGE_NO = PIC.PERSON_IN_CHARGE_NO
      WHERE BH.BUDGET_YEAR = @BudgetYear AND
      BH.PERIOD_TYPE = @PeriodType AND
      BH.BUDGET_TYPE = '@BudgetType' AND
      BH.PROJECT_NO = @ProjectNo AND
      BH.REV_NO = @RevNo AND
      BH.STATUS = @Status
      ORDER BY PIC.PERSON_IN_CHARGE_NO
    </SELECT006>
    <SELECT006_1>
      SELECT DISTINCT PIC.PERSON_IN_CHARGE_NO,
      PIC.PERSON_IN_CHARGE_NO + ' : ' + PIC.PERSON_IN_CHARGE_NAME AS PIC_NAME
      FROM BG_T_BUDGET_HEADER AS BH LEFT JOIN BG_M_PERSON_IN_CHARGE AS PIC
      ON BH.PERSON_IN_CHARGE_NO = PIC.PERSON_IN_CHARGE_NO
      WHERE BH.BUDGET_YEAR = @BudgetYear AND
      BH.PERIOD_TYPE = @PeriodType AND
      BH.BUDGET_TYPE = '@BudgetType' AND
      BH.PROJECT_NO = @ProjectNo AND
      BH.REV_NO = @RevNo AND
      BH.STATUS = @Status
      UNION
      SELECT  DISTINCT(ORD.PERSON_IN_CHARGE_NO),  PIC.PERSON_IN_CHARGE_NO + ' : ' + PIC.PERSON_IN_CHARGE_NAME AS PIC_NAME
      FROM BG_T_BUDGET_DATA_REINPUT REI
      INNER JOIN  dbo.BG_M_BUDGET_ORDER  ORD ON ORD.BUDGET_ORDER_NO = REI.BUDGET_ORDER_NO AND ORD.BUDGET_TYPE = '@BudgetType'
      LEFT JOIN BG_M_PERSON_IN_CHARGE AS PIC ON ORD.PERSON_IN_CHARGE_NO = PIC.PERSON_IN_CHARGE_NO
      WHERE REI.BUDGET_YEAR = @BudgetYear
      AND REI.PERIOD_TYPE = @PeriodType
      AND REI.REV_NO = @RevNo
      AND REI.ITEM_STATUS = @Status
      AND REI.PROJECT_NO = @ProjectNo
      ORDER BY PIC.PERSON_IN_CHARGE_NO
    </SELECT006_1>
    <SELECT007>
      SELECT DISTINCT PIC.PERSON_IN_CHARGE_NO,
      PIC.PERSON_IN_CHARGE_NO + ' : ' + PIC.PERSON_IN_CHARGE_NAME AS PIC_NAME
      FROM BG_T_BUDGET_HEADER AS BH LEFT JOIN BG_M_PERSON_IN_CHARGE AS PIC
      ON BH.PERSON_IN_CHARGE_NO = PIC.PERSON_IN_CHARGE_NO
      WHERE BH.BUDGET_YEAR = @BudgetYear AND BH.PERIOD_TYPE = @PeriodType AND
      BH.BUDGET_TYPE = '@BudgetType' AND BH.REV_NO = @RevNo AND BH.STATUS = @Status AND BH.PROJECT_NO = @ProjectNo AND
      (PIC.PERSON_IN_CHARGE_NO = '@UserPIC' OR PIC.PERSON_IN_CHARGE_NO IN
      (SELECT PIC_CHILD_NO AS PERSON_IN_CHARGE_NO FROM BG_M_CHILD_PIC WHERE PIC_PARENT_NO = '@UserPIC'))
      ORDER BY PIC.PERSON_IN_CHARGE_NO
    </SELECT007>
    <SELECT007_1>
      SELECT DISTINCT PIC.PERSON_IN_CHARGE_NO,
      PIC.PERSON_IN_CHARGE_NO + ' : ' + PIC.PERSON_IN_CHARGE_NAME AS PIC_NAME
      FROM BG_T_BUDGET_HEADER AS BH LEFT JOIN BG_M_PERSON_IN_CHARGE AS PIC
      ON BH.PERSON_IN_CHARGE_NO = PIC.PERSON_IN_CHARGE_NO
      WHERE BH.BUDGET_YEAR = @BudgetYear AND BH.PERIOD_TYPE = @PeriodType AND
      BH.BUDGET_TYPE = '@BudgetType' AND BH.REV_NO = @RevNo AND BH.STATUS = @Status AND BH.PROJECT_NO = @ProjectNo AND
      (PIC.PERSON_IN_CHARGE_NO = '@UserPIC' OR PIC.PERSON_IN_CHARGE_NO IN
      (SELECT PIC_CHILD_NO AS PERSON_IN_CHARGE_NO FROM BG_M_CHILD_PIC WHERE PIC_PARENT_NO = '@UserPIC'))
      UNION
      SELECT  DISTINCT(ORD.PERSON_IN_CHARGE_NO),  PIC.PERSON_IN_CHARGE_NO + ' : ' + PIC.PERSON_IN_CHARGE_NAME AS PIC_NAME
      FROM BG_T_BUDGET_DATA_REINPUT REI
      INNER JOIN  dbo.BG_M_BUDGET_ORDER  ORD ON ORD.BUDGET_ORDER_NO = REI.BUDGET_ORDER_NO AND ORD.BUDGET_TYPE = '@BudgetType'
      AND ORD.PERSON_IN_CHARGE_NO ='@UserPIC'
      LEFT JOIN BG_M_PERSON_IN_CHARGE AS PIC ON ORD.PERSON_IN_CHARGE_NO = PIC.PERSON_IN_CHARGE_NO
      WHERE REI.BUDGET_YEAR = @BudgetYear
      AND REI.PERIOD_TYPE = @PeriodType
      AND REI.REV_NO = @RevNo
      AND REI.ITEM_STATUS = @Status
      AND REI.PROJECT_NO = @ProjectNo
      ORDER BY PIC.PERSON_IN_CHARGE_NO
    </SELECT007_1>
    <SELECT008>
      SELECT PERSON_IN_CHARGE_NO,
      PERSON_IN_CHARGE_NO + ' : ' + PERSON_IN_CHARGE_NAME AS PERSON_IN_CHARGE_NAME
      FROM BG_M_PERSON_IN_CHARGE
      ORDER BY PERSON_IN_CHARGE_NO
    </SELECT008>
    <SELECT009>
      SELECT *, PERSON_IN_CHARGE_NO + ' : ' + PERSON_IN_CHARGE_NAME AS PIC_NAME
      FROM BG_M_PERSON_IN_CHARGE
      WHERE PERSON_IN_CHARGE_NO LIKE '@UserPIC%' OR
      PERSON_IN_CHARGE_NO IN (SELECT PIC_CHILD_NO AS PERSON_IN_CHARGE_NO FROM BG_M_CHILD_PIC WHERE PIC_PARENT_NO = '@UserPIC')
      ORDER BY PERSON_IN_CHARGE_NO
    </SELECT009>
    <SELECT010>
      SELECT DISTINCT PERSON_IN_CHARGE_NO FROM BG_M_BUDGET_ORDER
      WHERE ACCOUNT_NO = '@AccountNo' ORDER BY PERSON_IN_CHARGE_NO
    </SELECT010>
    <SELECT011>
      SELECT DISTINCT PIC.PERSON_IN_CHARGE_NO,
      PIC.PERSON_IN_CHARGE_NO + ' : ' + PIC.PERSON_IN_CHARGE_NAME AS PIC_NAME
      FROM BG_T_BUDGET_HEADER AS BH LEFT JOIN BG_M_PERSON_IN_CHARGE AS PIC
      ON BH.PERSON_IN_CHARGE_NO = PIC.PERSON_IN_CHARGE_NO
      WHERE BH.BUDGET_YEAR = @BudgetYear AND BH.PERIOD_TYPE = @PeriodType AND BH.PROJECT_NO = @ProjectNo AND
      BH.BUDGET_TYPE = '@BudgetType' AND BH.REV_NO = @RevNo AND BH.STATUS >= @Status
      ORDER BY PIC.PERSON_IN_CHARGE_NO
    </SELECT011>
    <SELECT012>
      SELECT DISTINCT A.PERSON_IN_CHARGE_NO,A.PERSON_IN_CHARGE_NO + ' : ' + B.PERSON_IN_CHARGE_NAME [PIC_NAME]
      FROM BG_T_BUDGET_HEADER A
      LEFT JOIN BG_M_PERSON_IN_CHARGE B ON A.PERSON_IN_CHARGE_NO = B.PERSON_IN_CHARGE_NO
      WHERE BUDGET_TYPE = 'A' AND BUDGET_YEAR = @BudgetYear AND PERIOD_TYPE =@PeriodType
      ORDER BY A.PERSON_IN_CHARGE_NO
    </SELECT012>
    <SELECT013>
      SELECT DISTINCT C.PERSON_IN_CHARGE_NO,C.PERSON_IN_CHARGE_NO + ' : ' + C.PERSON_IN_CHARGE_NAME [PIC_NAME]
      FROM BG_T_UPLOAD_DATA A
      INNER JOIN BG_M_BUDGET_ORDER B
      ON B.BUDGET_ORDER_NO = A.BUDGET_ORDER_NO
      AND B.BUDGET_TYPE = 'A'
      LEFT JOIN BG_M_PERSON_IN_CHARGE C
      ON C.PERSON_IN_CHARGE_NO = B.PERSON_IN_CHARGE_NO
      WHERE A.BUDGET_YEAR = @BudgetYear
      AND A.PERIOD_TYPE IN (11,12)
      ORDER BY C.PERSON_IN_CHARGE_NO
    </SELECT013>
    <UPDATE001>
      UPDATE BG_M_PERSON_IN_CHARGE SET
      PERSON_IN_CHARGE_NAME = '@Name', UPDATE_USER_ID = '@UserId', UPDATE_DATE = GetDate()
      WHERE PERSON_IN_CHARGE_NO = '@No'
    </UPDATE001>
    <UPDATE002_1>
      UPDATE BG_M_BUDGET_ORDER SET
      PERSON_IN_CHARGE_NO = '@NewNo', UPDATE_USER_ID = '@UserId', UPDATE_DATE = GetDate()
      WHERE PERSON_IN_CHARGE_NO = '@OldNo'
    </UPDATE002_1>
    <UPDATE002_2>
      UPDATE BG_M_CHILD_PIC SET
      PIC_PARENT_NO = '@NewNo', UPDATE_USER_ID = '@UserId', UPDATE_DATE = GetDate()
      WHERE PIC_PARENT_NO = '@OldNo'
    </UPDATE002_2>
    <UPDATE002_3>
      UPDATE BG_M_CHILD_PIC SET
      PIC_CHILD_NO = '@NewNo', UPDATE_USER_ID = '@UserId', UPDATE_DATE = GetDate()
      WHERE PIC_CHILD_NO = '@OldNo'
    </UPDATE002_3>
    <UPDATE002_4>
      UPDATE BG_T_ACCOUNT_REOPEN SET
      PERSON_IN_CHARGE_NO = '@NewNo', UPDATE_USER_ID = '@UserId', UPDATE_DATE = GetDate()
      WHERE PERSON_IN_CHARGE_NO = '@OldNo'
    </UPDATE002_4>
    <UPDATE002_5>
      UPDATE BG_T_BUDGET_HEADER SET
      PERSON_IN_CHARGE_NO = '@NewNo', UPDATE_USER_ID = '@UserId', UPDATE_DATE = GetDate()
      WHERE PERSON_IN_CHARGE_NO = '@OldNo'
    </UPDATE002_5>
    <UPDATE002_6>
      UPDATE BG_T_TRANS_LOG SET
      PERSON_IN_CHARGE_NO = '@NewNo'
      WHERE PERSON_IN_CHARGE_NO = '@OldNo'
    </UPDATE002_6>
    <UPDATE002_7>
      UPDATE BG_M_USER SET
      PERSON_IN_CHARGE_NO = '@NewNo', UPDATE_USER_ID = '@UserId', UPDATE_DATE = GetDate()
      WHERE PERSON_IN_CHARGE_NO = '@OldNo'
    </UPDATE002_7>
    <UPDATE002_8>
      UPDATE BG_T_USER_LOGIN SET
      PERSON_IN_CHARGE_NO = '@NewNo'
      WHERE PERSON_IN_CHARGE_NO = '@OldNo'
    </UPDATE002_8>
    <UPDATE002_9>
      UPDATE BG_M_PERSON_IN_CHARGE SET
      PERSON_IN_CHARGE_NO = '@NewNo', PERSON_IN_CHARGE_NAME = '@Name', UPDATE_USER_ID = '@UserId', UPDATE_DATE = GetDate()
      WHERE PERSON_IN_CHARGE_NO = '@OldNo'
    </UPDATE002_9>
    <INSERT001>
      INSERT INTO BG_M_PERSON_IN_CHARGE (PERSON_IN_CHARGE_NO, PERSON_IN_CHARGE_NAME,
      CREATE_USER_ID, CREATE_DATE, UPDATE_USER_ID, UPDATE_DATE )
      VALUES ('@No','@Name','@UserId', GetDate(), '@UserId', GetDate() )
    </INSERT001>
    <DELETE001>
      DELETE FROM BG_M_PERSON_IN_CHARGE WHERE PERSON_IN_CHARGE_NO = '@No'
    </DELETE001>
  </BG_M_PERSON_IN_CHARGE>

  <!--// Table: BG_M_DEPT -->
  <BG_M_DEPT>
    <SELECT001>
      SELECT DEPT_NO, DEPT_NAME, DEPT_NO + ' : ' + DEPT_NAME [DEPT_NAME_2] FROM BG_M_DEPT ORDER BY DEPT_NO ASC
    </SELECT001>
    <SELECT002>
      SELECT * FROM BG_M_DEPT @Where
    </SELECT002>
    <SELECT003>
      SELECT * FROM BG_M_DEPT WHERE DEPT_NO = '@No'
    </SELECT003>
    <UPDATE001>
      UPDATE BG_M_DEPT SET
      DEPT_NAME = '@Name', UPDATE_USER_ID = '@UserId', UPDATE_DATE = GetDate()
      WHERE DEPT_NO = '@No'
    </UPDATE001>
    <INSERT001>
      INSERT INTO BG_M_DEPT (DEPT_NO, DEPT_NAME,
      CREATE_USER_ID, CREATE_DATE, UPDATE_USER_ID, UPDATE_DATE )
      VALUES ('@No','@Name','@UserId', GetDate(), '@UserId', GetDate() )
    </INSERT001>
    <DELETE001>
      DELETE FROM BG_M_DEPT WHERE DEPT_NO = '@No'
    </DELETE001>
  </BG_M_DEPT>

  <!--// Table: BG_M_ASSET_GROUP -->
  <BG_M_ASSET_GROUP>
    <SELECT001>
      SELECT ASSET_GROUP_NO, ASSET_GROUP_NAME, ASSET_GROUP_NO + ' : ' + ASSET_GROUP_NAME [ASSET_GROUP_NAME_2] FROM BG_M_ASSET_GROUP ORDER BY ASSET_GROUP_NO ASC
    </SELECT001>
    <SELECT002>
      SELECT ASSET_GROUP_NO, ASSET_GROUP_NAME, ASSET_PROJECT, '' AS ASSET_PROJECT_TXT, ASSET_CATEGORY, '' AS ASSET_CATEGORY_TXT, CREATE_USER_ID, CREATE_DATE, UPDATE_USER_ID, UPDATE_DATE FROM BG_M_ASSET_GROUP @Where
    </SELECT002>
    <SELECT003>
      SELECT * FROM BG_M_ASSET_GROUP WHERE ASSET_GROUP_NO = '@No'
    </SELECT003>
    <SELECT004>
      SELECT * FROM BG_M_ASSET_CATEGORY @Where
    </SELECT004>
    <SELECT005>
      SELECT * FROM BG_M_ASSET_PROJECT @Where
    </SELECT005>
    <SELECT006>
      SELECT * FROM BG_M_ASSET_CATEGORY WHERE ASSET_CATEGORY = '@No'
    </SELECT006>
    <SELECT007>
      SELECT * FROM BG_M_ASSET_PROJECT WHERE ASSET_PROJECT = '@No'
    </SELECT007>
    <UPDATE001>
      UPDATE BG_M_ASSET_GROUP SET
      ASSET_GROUP_NAME = '@Name', ASSET_PROJECT = '@proj', ASSET_CATEGORY ='@cate', UPDATE_USER_ID = '@UserId', UPDATE_DATE = GetDate()
      WHERE ASSET_GROUP_NO = '@No'
    </UPDATE001>
    <UPDATE002>
      UPDATE BG_M_ASSET_CATEGORY SET
      ASSET_CATEGORY_TXT = '@Name', UPDATE_USER_ID = '@UserId', UPDATE_DATE = GetDate()
      WHERE ASSET_CATEGORY = '@No'
    </UPDATE002>
    <UPDATE003>
      UPDATE BG_M_ASSET_PROJECT SET
      ASSET_PROJECT_TXT = '@Name', UPDATE_USER_ID = '@UserId', UPDATE_DATE = GetDate()
      WHERE ASSET_PROJECT= '@No'
    </UPDATE003>
    <INSERT001>
      INSERT INTO BG_M_ASSET_GROUP (ASSET_GROUP_NO, ASSET_GROUP_NAME, ASSET_PROJECT, ASSET_CATEGORY,
      CREATE_USER_ID, CREATE_DATE, UPDATE_USER_ID, UPDATE_DATE )
      VALUES ('@No','@Name', '@proj', '@cate', '@UserId', GetDate(), '@UserId', GetDate() )
    </INSERT001>
    <INSERT002>
      INSERT INTO BG_M_ASSET_CATEGORY (ASSET_CATEGORY, ASSET_CATEGORY_TXT,
      CREATE_USER_ID, CREATE_DATE, UPDATE_USER_ID, UPDATE_DATE )
      VALUES ('@No','@Name', '@UserId', GetDate(), '@UserId', GetDate() )
    </INSERT002>
    <INSERT003>
      INSERT INTO BG_M_ASSET_PROJECT (ASSET_PROJECT, ASSET_PROJECT_TXT,
      CREATE_USER_ID, CREATE_DATE, UPDATE_USER_ID, UPDATE_DATE )
      VALUES ('@No','@Name', '@UserId', GetDate(), '@UserId', GetDate() )
    </INSERT003>
    <DELETE001>
      DELETE FROM BG_M_ASSET_GROUP WHERE ASSET_GROUP_NO = '@No'
    </DELETE001>
    <DELETE002>
      DELETE FROM BG_M_ASSET_CATEGORY WHERE ASSET_CATEGORY = '@No'
    </DELETE002>
    <DELETE003>
      DELETE FROM BG_M_ASSET_PROJECT WHERE ASSET_PROJECT = '@No'
    </DELETE003>
  </BG_M_ASSET_GROUP>

  <!--// Table: BG_T_INFORMATION -->
  <BG_T_INFORMATION>
    <SELECT001>
      SELECT [FILE_NO], [FILE_TITLE], [FILE_PATH]
      , [CREATE_USER_ID]
      , CONVERT(VARCHAR(19), [CREATE_DATE], 120) [CREATE_DATE]
      , [UPDATE_USER_ID]
      , [UPDATE_DATE]
      FROM [BG_T_INFORMATION]
    </SELECT001>
    <SELECT002>
      SELECT [FILE_NO], [FILE_TITLE], [FILE_PATH]
      , [CREATE_USER_ID]
      , CONVERT(VARCHAR(19), [CREATE_DATE], 120) [CREATE_DATE]
      , [UPDATE_USER_ID]
      , [UPDATE_DATE]
      FROM [BG_T_INFORMATION]
      WHERE CONVERT(VARCHAR(10), [FILE_NO]) = '@P_FILE_NO'
    </SELECT002>
    <INSERT001>
      INSERT INTO [BG_T_INFORMATION]([FILE_TITLE],[FILE_PATH]
      ,[CREATE_USER_ID],[CREATE_DATE]
      ,[UPDATE_USER_ID],[UPDATE_DATE])
      VALUES('@P_FILE_TITLE','@P_FILE_PATH'
      ,'@P_USER_ID',GETDATE()
      ,'@P_USER_ID',GETDATE())
    </INSERT001>
    <UPDATE001>
      UPDATE [BG_T_INFORMATION]
      SET [FILE_TITLE] = '@P_FILE_TITLE'
      ,[UPDATE_USER_ID] = '@P_USER_ID'
      ,[UPDATE_DATE] = GETDATE()
      WHERE CONVERT(VARCHAR(10), [FILE_NO]) = '@P_FILE_NO'
    </UPDATE001>
    <DELETE001>
      DELETE FROM [BG_T_INFORMATION]
      WHERE CONVERT(VARCHAR(10), [FILE_NO]) = '@P_FILE_NO'
    </DELETE001>
  </BG_T_INFORMATION>

  <!--// Table: BG_T_UPLOAD_DATA -->
  <BG_T_UPLOAD_DATA>
    <SELECT001>
      SELECT * FROM BG_T_UPLOAD_DATA
      WHERE BUDGET_YEAR = @BudgetYear AND PERIOD_TYPE = @PeriodType AND
      BUDGET_ORDER_NO = '@BudgetOrder' AND DATA_TYPE = @DataType AND PROJECT_NO = @ProjectNo
    </SELECT001>
    <SELECT002>
      SELECT * FROM BG_T_UPLOAD_DATA
      WHERE BUDGET_YEAR = @BudgetYear AND PERIOD_TYPE = @PeriodType AND PROJECT_NO = @ProjectNo
    </SELECT002>
    <SELECT003>
      SELECT * FROM (
      SELECT COMPARE_DATA.BUDGET_YEAR,
      COMPARE_DATA.BUDGET_ORDER_NO,
      BUDGET_ORDER.BUDGET_ORDER_NAME,
      BUDGET_ORDER.ACCOUNT_NO,
      ACC.ACCOUNT_NAME,
      BUDGET_ORDER.COST_TYPE,
      BUDGET_ORDER.COST,
      BUDGET_ORDER.DEPT_NO,
      BUDGET_ORDER.PERSON_IN_CHARGE_NO AS PERSON_IN_CHARGE,
      PIC.PERSON_IN_CHARGE_NAME,
      CASE WHEN BUDGET_ORDER.COST_TYPE = 1 THEN 'Fixed Cost' ELSE 'Variable Cost' END AS COST_TYPE_NAME,
      CASE WHEN BUDGET_ORDER.COST = 1 THEN 'FC' ELSE 'Admin' END AS COST_NAME,

      COMPARE_DATA.OB_M1,
      COMPARE_DATA.OB_M2,
      COMPARE_DATA.OB_M3,
      COMPARE_DATA.OB_M4,
      COMPARE_DATA.OB_M5,
      COMPARE_DATA.OB_M6,

      COMPARE_DATA.OB_M7,
      COMPARE_DATA.OB_M8,
      COMPARE_DATA.OB_M9,
      COMPARE_DATA.OB_M10,
      COMPARE_DATA.OB_M11,
      COMPARE_DATA.OB_M12,

      COMPARE_DATA.AC_M1,
      COMPARE_DATA.AC_M2,
      COMPARE_DATA.AC_M3,
      COMPARE_DATA.AC_M4,
      COMPARE_DATA.AC_M5,
      COMPARE_DATA.AC_M6,

      COMPARE_DATA.AC_M7,
      COMPARE_DATA.AC_M8,
      COMPARE_DATA.AC_M9,
      COMPARE_DATA.AC_M10,
      COMPARE_DATA.AC_M11,
      COMPARE_DATA.AC_M12,

      COMPARE_DATA.OB_M1 AS ACC_OB_M1,
      COMPARE_DATA.OB_M1 + COMPARE_DATA.OB_M2 AS ACC_OB_M2,
      COMPARE_DATA.OB_M1 + COMPARE_DATA.OB_M2 + COMPARE_DATA.OB_M3 AS ACC_OB_M3,
      COMPARE_DATA.OB_M1 + COMPARE_DATA.OB_M2 + COMPARE_DATA.OB_M3 + COMPARE_DATA.OB_M4 AS ACC_OB_M4,
      COMPARE_DATA.OB_M1 + COMPARE_DATA.OB_M2 + COMPARE_DATA.OB_M3 + COMPARE_DATA.OB_M4 + COMPARE_DATA.OB_M5 AS ACC_OB_M5,
      COMPARE_DATA.OB_M1 + COMPARE_DATA.OB_M2 + COMPARE_DATA.OB_M3 + COMPARE_DATA.OB_M4 + COMPARE_DATA.OB_M5 + COMPARE_DATA.OB_M6 AS ACC_OB_M6,

      COMPARE_DATA.OB_M7  AS ACC_OB_M7 ,
      COMPARE_DATA.OB_M7 + COMPARE_DATA.OB_M8 AS ACC_OB_M8 ,
      COMPARE_DATA.OB_M7 + COMPARE_DATA.OB_M8 + COMPARE_DATA.OB_M9 AS ACC_OB_M9 ,
      COMPARE_DATA.OB_M7 + COMPARE_DATA.OB_M8 + COMPARE_DATA.OB_M9 + COMPARE_DATA.OB_M10 AS ACC_OB_M10,
      COMPARE_DATA.OB_M7 + COMPARE_DATA.OB_M8 + COMPARE_DATA.OB_M9 + COMPARE_DATA.OB_M10 + COMPARE_DATA.OB_M11 AS ACC_OB_M11,
      COMPARE_DATA.OB_M7 + COMPARE_DATA.OB_M8 + COMPARE_DATA.OB_M9 + COMPARE_DATA.OB_M10 + COMPARE_DATA.OB_M11 + COMPARE_DATA.OB_M12 AS ACC_OB_M12,

      COMPARE_DATA.AC_M1 AS ACC_AC_M1,
      COMPARE_DATA.AC_M1 + COMPARE_DATA.AC_M2 AS ACC_AC_M2,
      COMPARE_DATA.AC_M1 + COMPARE_DATA.AC_M2 + COMPARE_DATA.AC_M3 AS ACC_AC_M3,
      COMPARE_DATA.AC_M1 + COMPARE_DATA.AC_M2 + COMPARE_DATA.AC_M3 + COMPARE_DATA.AC_M4 AS ACC_AC_M4,
      COMPARE_DATA.AC_M1 + COMPARE_DATA.AC_M2 + COMPARE_DATA.AC_M3 + COMPARE_DATA.AC_M4 + COMPARE_DATA.AC_M5 AS ACC_AC_M5,
      COMPARE_DATA.AC_M1 + COMPARE_DATA.AC_M2 + COMPARE_DATA.AC_M3 + COMPARE_DATA.AC_M4 + COMPARE_DATA.AC_M5 + COMPARE_DATA.AC_M6 AS ACC_AC_M6,

      COMPARE_DATA.AC_M7 AS ACC_AC_M7 ,
      COMPARE_DATA.AC_M7 + COMPARE_DATA.AC_M8 AS ACC_AC_M8 ,
      COMPARE_DATA.AC_M7 + COMPARE_DATA.AC_M8 + COMPARE_DATA.AC_M9  AS ACC_AC_M9 ,
      COMPARE_DATA.AC_M7 + COMPARE_DATA.AC_M8 + COMPARE_DATA.AC_M9  + COMPARE_DATA.AC_M10 AS ACC_AC_M10,
      COMPARE_DATA.AC_M7 + COMPARE_DATA.AC_M8 + COMPARE_DATA.AC_M9  + COMPARE_DATA.AC_M10 + COMPARE_DATA.AC_M11 AS ACC_AC_M11,
      COMPARE_DATA.AC_M7 + COMPARE_DATA.AC_M8 + COMPARE_DATA.AC_M9  + COMPARE_DATA.AC_M10 + COMPARE_DATA.AC_M11 + COMPARE_DATA.AC_M12 AS ACC_AC_M12

      FROM
      (
      SELECT
      CP.BUDGET_ORDER_NO,
      CP.BUDGET_YEAR,

      SUM(CP.OB_H1) AS OB_H1,
      SUM(CP.OB_M1) AS OB_M1,
      SUM(CP.OB_M2) AS OB_M2,
      SUM(CP.OB_M3) AS OB_M3,
      SUM(CP.OB_M4) AS OB_M4,
      SUM(CP.OB_M5) AS OB_M5,
      SUM(CP.OB_M6) AS OB_M6,

      SUM(CP.OB_H2) AS OB_H2,
      SUM(CP.OB_M7) AS OB_M7,
      SUM(CP.OB_M8) AS OB_M8,
      SUM(CP.OB_M9) AS OB_M9,
      SUM(CP.OB_M10) AS OB_M10,
      SUM(CP.OB_M11) AS OB_M11,
      SUM(CP.OB_M12) AS OB_M12,

      SUM(CP.AC_H1) AS AC_H1,
      SUM(CP.AC_M1) AS AC_M1,
      SUM(CP.AC_M2) AS AC_M2,
      SUM(CP.AC_M3) AS AC_M3,
      SUM(CP.AC_M4) AS AC_M4,
      SUM(CP.AC_M5) AS AC_M5,
      SUM(CP.AC_M6) AS AC_M6,

      SUM(CP.AC_H2) AS AC_H2,
      SUM(CP.AC_M7) AS AC_M7,
      SUM(CP.AC_M8) AS AC_M8,
      SUM(CP.AC_M9) AS AC_M9,
      SUM(CP.AC_M10) AS AC_M10,
      SUM(CP.AC_M11) AS AC_M11,
      SUM(CP.AC_M12) AS AC_M12

      FROM
      (
      SELECT BUDGET.BUDGET_ORDER_NO,
      BUDGET.BUDGET_YEAR,

      ISNULL(BUDGET.H1,0) AS OB_H1,
      ISNULL(BUDGET.M1,0) AS OB_M1,
      ISNULL(BUDGET.M2,0) AS OB_M2,
      ISNULL(BUDGET.M3,0) AS OB_M3,
      ISNULL(BUDGET.M4,0) AS OB_M4,
      ISNULL(BUDGET.M5,0) AS OB_M5,
      ISNULL(BUDGET.M6,0) AS OB_M6,

      ISNULL(ACTUAL.H1,0) AS AC_H1,
      ISNULL(ACTUAL.M1,0) AS AC_M1,
      ISNULL(ACTUAL.M2,0) AS AC_M2,
      ISNULL(ACTUAL.M3,0) AS AC_M3,
      ISNULL(ACTUAL.M4,0) AS AC_M4,
      ISNULL(ACTUAL.M5,0) AS AC_M5,
      ISNULL(ACTUAL.M6,0) AS AC_M6,

      0 AS OB_H2,
      0 AS OB_M7,
      0 AS OB_M8,
      0 AS OB_M9,
      0 AS OB_M10,
      0 AS OB_M11,
      0 AS OB_M12,

      0 AS AC_H2,
      0 AS AC_M7,
      0 AS AC_M8,
      0 AS AC_M9,
      0 AS AC_M10,
      0 AS AC_M11,
      0 AS AC_M12

      FROM BG_T_UPLOAD_DATA AS BUDGET

      LEFT OUTER JOIN BG_T_UPLOAD_DATA AS ACTUAL
      ON ACTUAL.BUDGET_ORDER_NO = BUDGET.BUDGET_ORDER_NO
      AND ACTUAL.BUDGET_YEAR = BUDGET.BUDGET_YEAR
      AND ACTUAL.PERIOD_TYPE = BUDGET.PERIOD_TYPE
      AND ACTUAL.PROJECT_NO = BUDGET.PROJECT_NO
      AND ACTUAL.DATA_TYPE = 2

      WHERE BUDGET.BUDGET_YEAR = @BudgetYear
      AND BUDGET.PERIOD_TYPE = @PeriodType1
      AND BUDGET.PROJECT_NO = 1
      AND BUDGET.DATA_TYPE = 1

      UNION

      SELECT BUDGET.BUDGET_ORDER_NO,
      BUDGET.BUDGET_YEAR,

      0 AS OB_H1,
      0 AS OB_M1,
      0 AS OB_M2,
      0 AS OB_M3,
      0 AS OB_M4,
      0 AS OB_M5,
      0 AS OB_M6,

      0 AS AC_H1,
      0 AS AC_M1,
      0 AS AC_M2,
      0 AS AC_M3,
      0 AS AC_M4,
      0 AS AC_M5,
      0 AS AC_M6,

      ISNULL(BUDGET.H2,0) AS OB_H2,
      ISNULL(BUDGET.M7,0) AS OB_M7,
      ISNULL(BUDGET.M8,0) AS OB_M8,
      ISNULL(BUDGET.M9,0) AS OB_M9,
      ISNULL(BUDGET.M10,0) AS OB_M10,
      ISNULL(BUDGET.M11,0) AS OB_M11,
      ISNULL(BUDGET.M12,0) AS OB_M12,

      ISNULL(ACTUAL.H2,0) AS AC_H2,
      ISNULL(ACTUAL.M7,0) AS AC_M7,
      ISNULL(ACTUAL.M8,0) AS AC_M8,
      ISNULL(ACTUAL.M9,0) AS AC_M9,
      ISNULL(ACTUAL.M10,0) AS AC_M10,
      ISNULL(ACTUAL.M11,0) AS AC_M11,
      ISNULL(ACTUAL.M12,0) AS AC_M12

      FROM BG_T_UPLOAD_DATA AS BUDGET

      LEFT OUTER JOIN BG_T_UPLOAD_DATA AS ACTUAL
      ON ACTUAL.BUDGET_ORDER_NO = BUDGET.BUDGET_ORDER_NO
      AND ACTUAL.BUDGET_YEAR = BUDGET.BUDGET_YEAR
      AND ACTUAL.PERIOD_TYPE = BUDGET.PERIOD_TYPE
      AND ACTUAL.PROJECT_NO = BUDGET.PROJECT_NO
      AND ACTUAL.DATA_TYPE = 2

      WHERE BUDGET.BUDGET_YEAR = @BudgetYear
      AND BUDGET.PERIOD_TYPE = 12
      AND BUDGET.PROJECT_NO = 1
      AND BUDGET.DATA_TYPE = 1
      ) AS CP
      GROUP BY CP.BUDGET_ORDER_NO,CP.BUDGET_YEAR

      ) AS COMPARE_DATA

      INNER JOIN BG_M_BUDGET_ORDER AS BUDGET_ORDER
      ON BUDGET_ORDER.BUDGET_ORDER_NO = COMPARE_DATA.BUDGET_ORDER_NO
      AND BUDGET_ORDER.BUDGET_TYPE = 'E'
      AND BUDGET_ORDER.ACTIVE_FLAG = 1

      INNER JOIN BG_M_PERSON_IN_CHARGE AS PIC
      ON PIC.PERSON_IN_CHARGE_NO = BUDGET_ORDER.PERSON_IN_CHARGE_NO

      LEFT OUTER JOIN BG_M_ACCOUNT AS ACC
      ON BUDGET_ORDER.ACCOUNT_NO = ACC.ACCOUNT_NO
      @PICCondition
      @ACCCondition
      ) T1

    </SELECT003>
    <SELECT004>
      SELECT BUDGET_ORDER.PIC_SHOW_FLAG,
      PIC.PERSON_IN_CHARGE_NO AS PERSON_IN_CHARGE,
      PIC.PERSON_IN_CHARGE_NAME,

      -- ORIGINAL
      SUM(ISNULL(COMPARE_DATA.OB_M1, 0)) AS OB_M1,
      SUM(ISNULL(COMPARE_DATA.OB_M2, 0)) AS OB_M2,
      SUM(ISNULL(COMPARE_DATA.OB_M3, 0)) AS OB_M3,
      SUM(ISNULL(COMPARE_DATA.OB_M4, 0)) AS OB_M4,
      SUM(ISNULL(COMPARE_DATA.OB_M5, 0)) AS OB_M5,
      SUM(ISNULL(COMPARE_DATA.OB_M6, 0)) AS OB_M6,

      SUM(ISNULL(COMPARE_DATA.OB_M7, 0)) AS OB_M7,
      SUM(ISNULL(COMPARE_DATA.OB_M8, 0)) AS OB_M8,
      SUM(ISNULL(COMPARE_DATA.OB_M9, 0)) AS OB_M9,
      SUM(ISNULL(COMPARE_DATA.OB_M10, 0)) AS OB_M10,
      SUM(ISNULL(COMPARE_DATA.OB_M11, 0)) AS OB_M11,
      SUM(ISNULL(COMPARE_DATA.OB_M12, 0)) AS OB_M12,

      -- ACTUAL
      SUM(ISNULL(COMPARE_DATA.AC_M1, 0)) AS AC_M1,
      SUM(ISNULL(COMPARE_DATA.AC_M2, 0)) AS AC_M2,
      SUM(ISNULL(COMPARE_DATA.AC_M3, 0)) AS AC_M3,
      SUM(ISNULL(COMPARE_DATA.AC_M4, 0)) AS AC_M4,
      SUM(ISNULL(COMPARE_DATA.AC_M5, 0)) AS AC_M5,
      SUM(ISNULL(COMPARE_DATA.AC_M6, 0)) AS AC_M6,

      SUM(ISNULL(COMPARE_DATA.AC_M7, 0)) AS AC_M7,
      SUM(ISNULL(COMPARE_DATA.AC_M8, 0)) AS AC_M8,
      SUM(ISNULL(COMPARE_DATA.AC_M9, 0)) AS AC_M9,
      SUM(ISNULL(COMPARE_DATA.AC_M10, 0)) AS AC_M10,
      SUM(ISNULL(COMPARE_DATA.AC_M11, 0)) AS AC_M11,
      SUM(ISNULL(COMPARE_DATA.AC_M12, 0)) AS AC_M12,

      -- ORIGINAL FIXED + VARIABLE
      SUM(CASE WHEN BUDGET_ORDER.COST_TYPE = 1 THEN ISNULL(COMPARE_DATA.OB_M1, 0) ELSE 0 END) AS OB_FC_M1,
      SUM(CASE WHEN BUDGET_ORDER.COST_TYPE = 2 THEN ISNULL(COMPARE_DATA.OB_M1, 0) ELSE 0 END) AS OB_VC_M1,
      SUM(CASE WHEN BUDGET_ORDER.COST_TYPE = 1 THEN ISNULL(COMPARE_DATA.OB_M2, 0) ELSE 0 END) AS OB_FC_M2,
      SUM(CASE WHEN BUDGET_ORDER.COST_TYPE = 2 THEN ISNULL(COMPARE_DATA.OB_M2, 0) ELSE 0 END) AS OB_VC_M2,
      SUM(CASE WHEN BUDGET_ORDER.COST_TYPE = 1 THEN ISNULL(COMPARE_DATA.OB_M3, 0) ELSE 0 END) AS OB_FC_M3,
      SUM(CASE WHEN BUDGET_ORDER.COST_TYPE = 2 THEN ISNULL(COMPARE_DATA.OB_M3, 0) ELSE 0 END) AS OB_VC_M3,
      SUM(CASE WHEN BUDGET_ORDER.COST_TYPE = 1 THEN ISNULL(COMPARE_DATA.OB_M4, 0) ELSE 0 END) AS OB_FC_M4,
      SUM(CASE WHEN BUDGET_ORDER.COST_TYPE = 2 THEN ISNULL(COMPARE_DATA.OB_M4, 0) ELSE 0 END) AS OB_VC_M4,
      SUM(CASE WHEN BUDGET_ORDER.COST_TYPE = 1 THEN ISNULL(COMPARE_DATA.OB_M5, 0) ELSE 0 END) AS OB_FC_M5,
      SUM(CASE WHEN BUDGET_ORDER.COST_TYPE = 2 THEN ISNULL(COMPARE_DATA.OB_M5, 0) ELSE 0 END) AS OB_VC_M5,
      SUM(CASE WHEN BUDGET_ORDER.COST_TYPE = 1 THEN ISNULL(COMPARE_DATA.OB_M6, 0) ELSE 0 END) AS OB_FC_M6,
      SUM(CASE WHEN BUDGET_ORDER.COST_TYPE = 2 THEN ISNULL(COMPARE_DATA.OB_M6, 0) ELSE 0 END) AS OB_VC_M6,

      SUM(CASE WHEN BUDGET_ORDER.COST_TYPE = 1 THEN (ISNULL(COMPARE_DATA.OB_M1, 0) + ISNULL(COMPARE_DATA.OB_M2, 0) + ISNULL(COMPARE_DATA.OB_M3, 0) + ISNULL(COMPARE_DATA.OB_M4, 0) + ISNULL(COMPARE_DATA.OB_M5,0) + ISNULL(COMPARE_DATA.OB_M6, 0)) ELSE 0 END) AS OB_FC_H1,
      SUM(CASE WHEN BUDGET_ORDER.COST_TYPE = 2 THEN (ISNULL(COMPARE_DATA.OB_M1, 0) + ISNULL(COMPARE_DATA.OB_M2, 0) + ISNULL(COMPARE_DATA.OB_M3, 0) + ISNULL(COMPARE_DATA.OB_M4, 0) + ISNULL(COMPARE_DATA.OB_M5,0) + ISNULL(COMPARE_DATA.OB_M6, 0)) ELSE 0 END) AS OB_VC_H1,

      SUM(CASE WHEN BUDGET_ORDER.COST_TYPE = 1 THEN ISNULL(COMPARE_DATA.OB_M7, 0) ELSE 0 END)  AS OB_FC_M7,
      SUM(CASE WHEN BUDGET_ORDER.COST_TYPE = 2 THEN ISNULL(COMPARE_DATA.OB_M7, 0) ELSE 0 END)  AS OB_VC_M7,
      SUM(CASE WHEN BUDGET_ORDER.COST_TYPE = 1 THEN ISNULL(COMPARE_DATA.OB_M8, 0) ELSE 0 END)  AS OB_FC_M8,
      SUM(CASE WHEN BUDGET_ORDER.COST_TYPE = 2 THEN ISNULL(COMPARE_DATA.OB_M8, 0) ELSE 0 END)  AS OB_VC_M8,
      SUM(CASE WHEN BUDGET_ORDER.COST_TYPE = 1 THEN ISNULL(COMPARE_DATA.OB_M9, 0) ELSE 0 END)  AS OB_FC_M9,
      SUM(CASE WHEN BUDGET_ORDER.COST_TYPE = 2 THEN ISNULL(COMPARE_DATA.OB_M9, 0) ELSE 0 END)  AS OB_VC_M9,
      SUM(CASE WHEN BUDGET_ORDER.COST_TYPE = 1 THEN ISNULL(COMPARE_DATA.OB_M10, 0) ELSE 0 END) AS OB_FC_M10,
      SUM(CASE WHEN BUDGET_ORDER.COST_TYPE = 2 THEN ISNULL(COMPARE_DATA.OB_M10, 0) ELSE 0 END) AS OB_VC_M10,
      SUM(CASE WHEN BUDGET_ORDER.COST_TYPE = 1 THEN ISNULL(COMPARE_DATA.OB_M11, 0) ELSE 0 END) AS OB_FC_M11,
      SUM(CASE WHEN BUDGET_ORDER.COST_TYPE = 2 THEN ISNULL(COMPARE_DATA.OB_M11, 0) ELSE 0 END) AS OB_VC_M11,
      SUM(CASE WHEN BUDGET_ORDER.COST_TYPE = 1 THEN ISNULL(COMPARE_DATA.OB_M12, 0) ELSE 0 END) AS OB_FC_M12,
      SUM(CASE WHEN BUDGET_ORDER.COST_TYPE = 2 THEN ISNULL(COMPARE_DATA.OB_M12, 0) ELSE 0 END) AS OB_VC_M12,

      -- ACTUAL FIXED + VARIABLE
      SUM(CASE WHEN BUDGET_ORDER.COST_TYPE = 1 THEN ISNULL(COMPARE_DATA.AC_M1, 0) ELSE 0 END) AS AC_FC_M1,
      SUM(CASE WHEN BUDGET_ORDER.COST_TYPE = 2 THEN ISNULL(COMPARE_DATA.AC_M1, 0) ELSE 0 END) AS AC_VC_M1,
      SUM(CASE WHEN BUDGET_ORDER.COST_TYPE = 1 THEN ISNULL(COMPARE_DATA.AC_M2, 0) ELSE 0 END) AS AC_FC_M2,
      SUM(CASE WHEN BUDGET_ORDER.COST_TYPE = 2 THEN ISNULL(COMPARE_DATA.AC_M2, 0) ELSE 0 END) AS AC_VC_M2,
      SUM(CASE WHEN BUDGET_ORDER.COST_TYPE = 1 THEN ISNULL(COMPARE_DATA.AC_M3, 0) ELSE 0 END) AS AC_FC_M3,
      SUM(CASE WHEN BUDGET_ORDER.COST_TYPE = 2 THEN ISNULL(COMPARE_DATA.AC_M3, 0) ELSE 0 END) AS AC_VC_M3,
      SUM(CASE WHEN BUDGET_ORDER.COST_TYPE = 1 THEN ISNULL(COMPARE_DATA.AC_M4, 0) ELSE 0 END) AS AC_FC_M4,
      SUM(CASE WHEN BUDGET_ORDER.COST_TYPE = 2 THEN ISNULL(COMPARE_DATA.AC_M4, 0) ELSE 0 END) AS AC_VC_M4,
      SUM(CASE WHEN BUDGET_ORDER.COST_TYPE = 1 THEN ISNULL(COMPARE_DATA.AC_M5, 0) ELSE 0 END) AS AC_FC_M5,
      SUM(CASE WHEN BUDGET_ORDER.COST_TYPE = 2 THEN ISNULL(COMPARE_DATA.AC_M5, 0) ELSE 0 END) AS AC_VC_M5,
      SUM(CASE WHEN BUDGET_ORDER.COST_TYPE = 1 THEN ISNULL(COMPARE_DATA.AC_M6, 0) ELSE 0 END) AS AC_FC_M6,
      SUM(CASE WHEN BUDGET_ORDER.COST_TYPE = 2 THEN ISNULL(COMPARE_DATA.AC_M6, 0) ELSE 0 END) AS AC_VC_M6,

      SUM(CASE WHEN BUDGET_ORDER.COST_TYPE = 1 THEN ISNULL(COMPARE_DATA.AC_M7, 0) ELSE 0 END) AS AC_FC_M7,
      SUM(CASE WHEN BUDGET_ORDER.COST_TYPE = 2 THEN ISNULL(COMPARE_DATA.AC_M7, 0) ELSE 0 END) AS AC_VC_M7,
      SUM(CASE WHEN BUDGET_ORDER.COST_TYPE = 1 THEN ISNULL(COMPARE_DATA.AC_M8, 0) ELSE 0 END) AS AC_FC_M8,
      SUM(CASE WHEN BUDGET_ORDER.COST_TYPE = 2 THEN ISNULL(COMPARE_DATA.AC_M8, 0) ELSE 0 END) AS AC_VC_M8,
      SUM(CASE WHEN BUDGET_ORDER.COST_TYPE = 1 THEN ISNULL(COMPARE_DATA.AC_M9, 0) ELSE 0 END) AS AC_FC_M9,
      SUM(CASE WHEN BUDGET_ORDER.COST_TYPE = 2 THEN ISNULL(COMPARE_DATA.AC_M9, 0) ELSE 0 END) AS AC_VC_M9,
      SUM(CASE WHEN BUDGET_ORDER.COST_TYPE = 1 THEN ISNULL(COMPARE_DATA.AC_M10, 0) ELSE 0 END) AS AC_FC_M10,
      SUM(CASE WHEN BUDGET_ORDER.COST_TYPE = 2 THEN ISNULL(COMPARE_DATA.AC_M10, 0) ELSE 0 END) AS AC_VC_M10,
      SUM(CASE WHEN BUDGET_ORDER.COST_TYPE = 1 THEN ISNULL(COMPARE_DATA.AC_M11, 0) ELSE 0 END) AS AC_FC_M11,
      SUM(CASE WHEN BUDGET_ORDER.COST_TYPE = 2 THEN ISNULL(COMPARE_DATA.AC_M11, 0) ELSE 0 END) AS AC_VC_M11,
      SUM(CASE WHEN BUDGET_ORDER.COST_TYPE = 1 THEN ISNULL(COMPARE_DATA.AC_M12, 0) ELSE 0 END) AS AC_FC_M12,
      SUM(CASE WHEN BUDGET_ORDER.COST_TYPE = 2 THEN ISNULL(COMPARE_DATA.AC_M12, 0) ELSE 0 END) AS AC_VC_M12,

      -- ACCUMULATE ORIGINAL
      SUM(ISNULL(COMPARE_DATA.OB_M1, 0)) AS ACC_OB_M1,
      SUM(ISNULL(COMPARE_DATA.OB_M1, 0) + ISNULL(COMPARE_DATA.OB_M2, 0)) AS ACC_OB_M2,
      SUM(ISNULL(COMPARE_DATA.OB_M1, 0) + ISNULL(COMPARE_DATA.OB_M2, 0) + ISNULL(COMPARE_DATA.OB_M3, 0)) AS ACC_OB_M3,
      SUM(ISNULL(COMPARE_DATA.OB_M1, 0) + ISNULL(COMPARE_DATA.OB_M2, 0) + ISNULL(COMPARE_DATA.OB_M3, 0) + ISNULL(COMPARE_DATA.OB_M4, 0)) AS ACC_OB_M4,
      SUM(ISNULL(COMPARE_DATA.OB_M1, 0) + ISNULL(COMPARE_DATA.OB_M2, 0) + ISNULL(COMPARE_DATA.OB_M3, 0) + ISNULL(COMPARE_DATA.OB_M4, 0) + ISNULL(COMPARE_DATA.OB_M5, 0)) AS ACC_OB_M5,
      SUM(ISNULL(COMPARE_DATA.OB_M1, 0) + ISNULL(COMPARE_DATA.OB_M2, 0) + ISNULL(COMPARE_DATA.OB_M3, 0) + ISNULL(COMPARE_DATA.OB_M4, 0) + ISNULL(COMPARE_DATA.OB_M5, 0) + ISNULL(COMPARE_DATA.OB_M6, 0)) AS ACC_OB_M6,

      SUM(ISNULL(COMPARE_DATA.OB_M7, 0)) AS ACC_OB_M7,
      SUM(ISNULL(COMPARE_DATA.OB_M7, 0) + ISNULL(COMPARE_DATA.OB_M8, 0)) AS ACC_OB_M8,
      SUM(ISNULL(COMPARE_DATA.OB_M7, 0) + ISNULL(COMPARE_DATA.OB_M8, 0) + ISNULL(COMPARE_DATA.OB_M9, 0)) AS ACC_OB_M9,
      SUM(ISNULL(COMPARE_DATA.OB_M7, 0) + ISNULL(COMPARE_DATA.OB_M8, 0) + ISNULL(COMPARE_DATA.OB_M9, 0) + ISNULL(COMPARE_DATA.OB_M10, 0)) AS ACC_OB_M10,
      SUM(ISNULL(COMPARE_DATA.OB_M7, 0) + ISNULL(COMPARE_DATA.OB_M8, 0) + ISNULL(COMPARE_DATA.OB_M9, 0) + ISNULL(COMPARE_DATA.OB_M10, 0) + ISNULL(COMPARE_DATA.OB_M11, 0)) AS ACC_OB_M11,
      SUM(ISNULL(COMPARE_DATA.OB_M7, 0) + ISNULL(COMPARE_DATA.OB_M8, 0) + ISNULL(COMPARE_DATA.OB_M9, 0) + ISNULL(COMPARE_DATA.OB_M10, 0) + ISNULL(COMPARE_DATA.OB_M11, 0) + ISNULL(COMPARE_DATA.OB_M12, 0)) AS ACC_OB_M12,

      -- ACCUMULATE ACTUAL
      SUM(ISNULL(COMPARE_DATA.AC_M1, 0)) AS ACC_AC_M1,
      SUM(ISNULL(COMPARE_DATA.AC_M1, 0) + ISNULL(COMPARE_DATA.AC_M2, 0)) AS ACC_AC_M2,
      SUM(ISNULL(COMPARE_DATA.AC_M1, 0) + ISNULL(COMPARE_DATA.AC_M2, 0) + ISNULL(COMPARE_DATA.AC_M3, 0)) AS ACC_AC_M3,
      SUM(ISNULL(COMPARE_DATA.AC_M1, 0) + ISNULL(COMPARE_DATA.AC_M2, 0) + ISNULL(COMPARE_DATA.AC_M3, 0) + ISNULL(COMPARE_DATA.AC_M4, 0)) AS ACC_AC_M4,
      SUM(ISNULL(COMPARE_DATA.AC_M1, 0) + ISNULL(COMPARE_DATA.AC_M2, 0) + ISNULL(COMPARE_DATA.AC_M3, 0) + ISNULL(COMPARE_DATA.AC_M4, 0) + ISNULL(COMPARE_DATA.AC_M5, 0)) AS ACC_AC_M5,
      SUM(ISNULL(COMPARE_DATA.AC_M1, 0) + ISNULL(COMPARE_DATA.AC_M2, 0) + ISNULL(COMPARE_DATA.AC_M3, 0) + ISNULL(COMPARE_DATA.AC_M4, 0) + ISNULL(COMPARE_DATA.AC_M5, 0) + ISNULL(COMPARE_DATA.AC_M6, 0)) AS ACC_AC_M6,

      SUM(ISNULL(COMPARE_DATA.AC_M7, 0)) AS ACC_AC_M7,
      SUM(ISNULL(COMPARE_DATA.AC_M7, 0) + ISNULL(COMPARE_DATA.AC_M8, 0)) AS ACC_AC_M8,
      SUM(ISNULL(COMPARE_DATA.AC_M7, 0) + ISNULL(COMPARE_DATA.AC_M8, 0) + ISNULL(COMPARE_DATA.AC_M9, 0)) AS ACC_AC_M9,
      SUM(ISNULL(COMPARE_DATA.AC_M7, 0) + ISNULL(COMPARE_DATA.AC_M8, 0) + ISNULL(COMPARE_DATA.AC_M9, 0) + ISNULL(COMPARE_DATA.AC_M10, 0)) AS ACC_AC_M10,
      SUM(ISNULL(COMPARE_DATA.AC_M7, 0) + ISNULL(COMPARE_DATA.AC_M8, 0) + ISNULL(COMPARE_DATA.AC_M9, 0) + ISNULL(COMPARE_DATA.AC_M10, 0) + ISNULL(COMPARE_DATA.AC_M11, 0)) AS ACC_AC_M11,
      SUM(ISNULL(COMPARE_DATA.AC_M7, 0) + ISNULL(COMPARE_DATA.AC_M8, 0) + ISNULL(COMPARE_DATA.AC_M9, 0) + ISNULL(COMPARE_DATA.AC_M10, 0) + ISNULL(COMPARE_DATA.AC_M11, 0) + ISNULL(COMPARE_DATA.AC_M12, 0)) AS ACC_AC_M12,

      -- ACCUMULATE ORIGINAL VARIABLE
      SUM(CASE WHEN BUDGET_ORDER.COST_TYPE = 2 THEN ISNULL(COMPARE_DATA.OB_M1, 0) ELSE 0 END) AS ACC_OB_VC_M1,
      SUM(CASE WHEN BUDGET_ORDER.COST_TYPE = 2 THEN ISNULL(COMPARE_DATA.OB_M1, 0) + ISNULL(COMPARE_DATA.OB_M2, 0) ELSE 0 END) AS ACC_OB_VC_M2,
      SUM(CASE WHEN BUDGET_ORDER.COST_TYPE = 2 THEN ISNULL(COMPARE_DATA.OB_M1, 0) + ISNULL(COMPARE_DATA.OB_M2, 0) + ISNULL(COMPARE_DATA.OB_M3, 0) ELSE 0 END) AS ACC_OB_VC_M3,
      SUM(CASE WHEN BUDGET_ORDER.COST_TYPE = 2 THEN ISNULL(COMPARE_DATA.OB_M1, 0) + ISNULL(COMPARE_DATA.OB_M2, 0) + ISNULL(COMPARE_DATA.OB_M3, 0) + ISNULL(COMPARE_DATA.OB_M4, 0) ELSE 0 END) AS ACC_OB_VC_M4,
      SUM(CASE WHEN BUDGET_ORDER.COST_TYPE = 2 THEN ISNULL(COMPARE_DATA.OB_M1, 0) + ISNULL(COMPARE_DATA.OB_M2, 0) + ISNULL(COMPARE_DATA.OB_M3, 0) + ISNULL(COMPARE_DATA.OB_M4, 0) + ISNULL(COMPARE_DATA.OB_M5, 0) ELSE 0 END) AS ACC_OB_VC_M5,
      SUM(CASE WHEN BUDGET_ORDER.COST_TYPE = 2 THEN ISNULL(COMPARE_DATA.OB_M1, 0) + ISNULL(COMPARE_DATA.OB_M2, 0) + ISNULL(COMPARE_DATA.OB_M3, 0) + ISNULL(COMPARE_DATA.OB_M4, 0) + ISNULL(COMPARE_DATA.OB_M5, 0) + ISNULL(COMPARE_DATA.OB_M6, 0) ELSE 0 END) AS ACC_OB_VC_M6,

      SUM(CASE WHEN BUDGET_ORDER.COST_TYPE = 2 THEN ISNULL(COMPARE_DATA.OB_M7, 0) ELSE 0 END) AS ACC_OB_VC_M7,
      SUM(CASE WHEN BUDGET_ORDER.COST_TYPE = 2 THEN ISNULL(COMPARE_DATA.OB_M7, 0) + ISNULL(COMPARE_DATA.OB_M8, 0) ELSE 0 END) AS ACC_OB_VC_M8,
      SUM(CASE WHEN BUDGET_ORDER.COST_TYPE = 2 THEN ISNULL(COMPARE_DATA.OB_M7, 0) + ISNULL(COMPARE_DATA.OB_M8, 0) + ISNULL(COMPARE_DATA.OB_M9, 0) ELSE 0 END) AS ACC_OB_VC_M9,
      SUM(CASE WHEN BUDGET_ORDER.COST_TYPE = 2 THEN ISNULL(COMPARE_DATA.OB_M7, 0) + ISNULL(COMPARE_DATA.OB_M8, 0) + ISNULL(COMPARE_DATA.OB_M9, 0) + ISNULL(COMPARE_DATA.OB_M10, 0) ELSE 0 END) AS ACC_OB_VC_M10,
      SUM(CASE WHEN BUDGET_ORDER.COST_TYPE = 2 THEN ISNULL(COMPARE_DATA.OB_M7, 0) + ISNULL(COMPARE_DATA.OB_M8, 0) + ISNULL(COMPARE_DATA.OB_M9, 0) + ISNULL(COMPARE_DATA.OB_M10, 0) + ISNULL(COMPARE_DATA.OB_M11, 0) ELSE 0 END) AS ACC_OB_VC_M11,
      SUM(CASE WHEN BUDGET_ORDER.COST_TYPE = 2 THEN ISNULL(COMPARE_DATA.OB_M7, 0) + ISNULL(COMPARE_DATA.OB_M8, 0) + ISNULL(COMPARE_DATA.OB_M9, 0) + ISNULL(COMPARE_DATA.OB_M10, 0) + ISNULL(COMPARE_DATA.OB_M11, 0) + ISNULL(COMPARE_DATA.OB_M12, 0) ELSE 0 END) AS ACC_OB_VC_M12,

      -- ACCUMULATE ORIGINAL FIXED
      SUM(CASE WHEN BUDGET_ORDER.COST_TYPE = 1 THEN ISNULL(COMPARE_DATA.OB_M1, 0) ELSE 0 END) AS ACC_OB_FC_M1,
      SUM(CASE WHEN BUDGET_ORDER.COST_TYPE = 1 THEN ISNULL(COMPARE_DATA.OB_M1, 0) + ISNULL(COMPARE_DATA.OB_M2, 0) ELSE 0 END) AS ACC_OB_FC_M2,
      SUM(CASE WHEN BUDGET_ORDER.COST_TYPE = 1 THEN ISNULL(COMPARE_DATA.OB_M1, 0) + ISNULL(COMPARE_DATA.OB_M2, 0) + ISNULL(COMPARE_DATA.OB_M3, 0) ELSE 0 END) AS ACC_OB_FC_M3,
      SUM(CASE WHEN BUDGET_ORDER.COST_TYPE = 1 THEN ISNULL(COMPARE_DATA.OB_M1, 0) + ISNULL(COMPARE_DATA.OB_M2, 0) + ISNULL(COMPARE_DATA.OB_M3, 0) + ISNULL(COMPARE_DATA.OB_M4, 0) ELSE 0 END) AS ACC_OB_FC_M4,
      SUM(CASE WHEN BUDGET_ORDER.COST_TYPE = 1 THEN ISNULL(COMPARE_DATA.OB_M1, 0) + ISNULL(COMPARE_DATA.OB_M2, 0) + ISNULL(COMPARE_DATA.OB_M3, 0) + ISNULL(COMPARE_DATA.OB_M4, 0) + ISNULL(COMPARE_DATA.OB_M5, 0) ELSE 0 END) AS ACC_OB_FC_M5,
      SUM(CASE WHEN BUDGET_ORDER.COST_TYPE = 1 THEN ISNULL(COMPARE_DATA.OB_M1, 0) + ISNULL(COMPARE_DATA.OB_M2, 0) + ISNULL(COMPARE_DATA.OB_M3, 0) + ISNULL(COMPARE_DATA.OB_M4, 0) + ISNULL(COMPARE_DATA.OB_M5, 0) + ISNULL(COMPARE_DATA.OB_M6, 0) ELSE 0 END) AS ACC_OB_FC_M6,

      SUM(CASE WHEN BUDGET_ORDER.COST_TYPE = 1 THEN ISNULL(COMPARE_DATA.OB_M7, 0) ELSE 0 END) AS ACC_OB_FC_M7,
      SUM(CASE WHEN BUDGET_ORDER.COST_TYPE = 1 THEN ISNULL(COMPARE_DATA.OB_M7, 0) + ISNULL(COMPARE_DATA.OB_M8, 0) ELSE 0 END) AS ACC_OB_FC_M8,
      SUM(CASE WHEN BUDGET_ORDER.COST_TYPE = 1 THEN ISNULL(COMPARE_DATA.OB_M7, 0) + ISNULL(COMPARE_DATA.OB_M8, 0) + ISNULL(COMPARE_DATA.OB_M9, 0) ELSE 0 END) AS ACC_OB_FC_M9,
      SUM(CASE WHEN BUDGET_ORDER.COST_TYPE = 1 THEN ISNULL(COMPARE_DATA.OB_M7, 0) + ISNULL(COMPARE_DATA.OB_M8, 0) + ISNULL(COMPARE_DATA.OB_M9, 0) + ISNULL(COMPARE_DATA.OB_M10, 0) ELSE 0 END) AS ACC_OB_FC_M10,
      SUM(CASE WHEN BUDGET_ORDER.COST_TYPE = 1 THEN ISNULL(COMPARE_DATA.OB_M7, 0) + ISNULL(COMPARE_DATA.OB_M8, 0) + ISNULL(COMPARE_DATA.OB_M9, 0) + ISNULL(COMPARE_DATA.OB_M10, 0) + ISNULL(COMPARE_DATA.OB_M11, 0) ELSE 0 END) AS ACC_OB_FC_M11,
      SUM(CASE WHEN BUDGET_ORDER.COST_TYPE = 1 THEN ISNULL(COMPARE_DATA.OB_M7, 0) + ISNULL(COMPARE_DATA.OB_M8, 0) + ISNULL(COMPARE_DATA.OB_M9, 0) + ISNULL(COMPARE_DATA.OB_M10, 0) + ISNULL(COMPARE_DATA.OB_M11, 0) + ISNULL(COMPARE_DATA.OB_M12, 0) ELSE 0 END) AS ACC_OB_FC_M12,

      -- ACCUMULATE ACTUAL VARIABLE
      SUM(CASE WHEN BUDGET_ORDER.COST_TYPE = 2 THEN ISNULL(COMPARE_DATA.AC_M1, 0) ELSE 0 END) AS ACC_AC_VC_M1,
      SUM(CASE WHEN BUDGET_ORDER.COST_TYPE = 2 THEN ISNULL(COMPARE_DATA.AC_M1, 0) + ISNULL(COMPARE_DATA.AC_M2, 0) ELSE 0 END) AS ACC_AC_VC_M2,
      SUM(CASE WHEN BUDGET_ORDER.COST_TYPE = 2 THEN ISNULL(COMPARE_DATA.AC_M1, 0) + ISNULL(COMPARE_DATA.AC_M2, 0) + ISNULL(COMPARE_DATA.AC_M3, 0) ELSE 0 END) AS ACC_AC_VC_M3,
      SUM(CASE WHEN BUDGET_ORDER.COST_TYPE = 2 THEN ISNULL(COMPARE_DATA.AC_M1, 0) + ISNULL(COMPARE_DATA.AC_M2, 0) + ISNULL(COMPARE_DATA.AC_M3, 0) + ISNULL(COMPARE_DATA.AC_M4, 0) ELSE 0 END) AS ACC_AC_VC_M4,
      SUM(CASE WHEN BUDGET_ORDER.COST_TYPE = 2 THEN ISNULL(COMPARE_DATA.AC_M1, 0) + ISNULL(COMPARE_DATA.AC_M2, 0) + ISNULL(COMPARE_DATA.AC_M3, 0) + ISNULL(COMPARE_DATA.AC_M4, 0) + ISNULL(COMPARE_DATA.AC_M5, 0) ELSE 0 END) AS ACC_AC_VC_M5,
      SUM(CASE WHEN BUDGET_ORDER.COST_TYPE = 2 THEN ISNULL(COMPARE_DATA.AC_M1, 0) + ISNULL(COMPARE_DATA.AC_M2, 0) + ISNULL(COMPARE_DATA.AC_M3, 0) + ISNULL(COMPARE_DATA.AC_M4, 0) + ISNULL(COMPARE_DATA.AC_M5, 0) + ISNULL(COMPARE_DATA.AC_M6, 0) ELSE 0 END) AS ACC_AC_VC_M6,

      SUM(CASE WHEN BUDGET_ORDER.COST_TYPE = 2 THEN ISNULL(COMPARE_DATA.AC_M7, 0) ELSE 0 END) AS ACC_AC_VC_M7,
      SUM(CASE WHEN BUDGET_ORDER.COST_TYPE = 2 THEN ISNULL(COMPARE_DATA.AC_M7, 0) + ISNULL(COMPARE_DATA.AC_M8, 0) ELSE 0 END) AS ACC_AC_VC_M8,
      SUM(CASE WHEN BUDGET_ORDER.COST_TYPE = 2 THEN ISNULL(COMPARE_DATA.AC_M7, 0) + ISNULL(COMPARE_DATA.AC_M8, 0) + ISNULL(COMPARE_DATA.AC_M9, 0) ELSE 0 END) AS ACC_AC_VC_M9,
      SUM(CASE WHEN BUDGET_ORDER.COST_TYPE = 2 THEN ISNULL(COMPARE_DATA.AC_M7, 0) + ISNULL(COMPARE_DATA.AC_M8, 0) + ISNULL(COMPARE_DATA.AC_M9, 0) + ISNULL(COMPARE_DATA.AC_M10, 0) ELSE 0 END) AS ACC_AC_VC_M10,
      SUM(CASE WHEN BUDGET_ORDER.COST_TYPE = 2 THEN ISNULL(COMPARE_DATA.AC_M7, 0) + ISNULL(COMPARE_DATA.AC_M8, 0) + ISNULL(COMPARE_DATA.AC_M9, 0) + ISNULL(COMPARE_DATA.AC_M10, 0) + ISNULL(COMPARE_DATA.AC_M11, 0) ELSE 0 END) AS ACC_AC_VC_M11,
      SUM(CASE WHEN BUDGET_ORDER.COST_TYPE = 2 THEN ISNULL(COMPARE_DATA.AC_M7, 0) + ISNULL(COMPARE_DATA.AC_M8, 0) + ISNULL(COMPARE_DATA.AC_M9, 0) + ISNULL(COMPARE_DATA.AC_M10, 0) + ISNULL(COMPARE_DATA.AC_M11, 0) + ISNULL(COMPARE_DATA.AC_M12, 0) ELSE 0 END) AS ACC_AC_VC_M12,

      -- ACCUMULATE ACTUAL FIXED
      SUM(CASE WHEN BUDGET_ORDER.COST_TYPE = 1 THEN ISNULL(COMPARE_DATA.AC_M1, 0) ELSE 0 END) AS ACC_AC_FC_M1,
      SUM(CASE WHEN BUDGET_ORDER.COST_TYPE = 1 THEN ISNULL(COMPARE_DATA.AC_M1, 0) + ISNULL(COMPARE_DATA.AC_M2, 0) ELSE 0 END) AS ACC_AC_FC_M2,
      SUM(CASE WHEN BUDGET_ORDER.COST_TYPE = 1 THEN ISNULL(COMPARE_DATA.AC_M1, 0) + ISNULL(COMPARE_DATA.AC_M2, 0) + ISNULL(COMPARE_DATA.AC_M3, 0) ELSE 0 END) AS ACC_AC_FC_M3,
      SUM(CASE WHEN BUDGET_ORDER.COST_TYPE = 1 THEN ISNULL(COMPARE_DATA.AC_M1, 0) + ISNULL(COMPARE_DATA.AC_M2, 0) + ISNULL(COMPARE_DATA.AC_M3, 0) + ISNULL(COMPARE_DATA.AC_M4, 0) ELSE 0 END) AS ACC_AC_FC_M4,
      SUM(CASE WHEN BUDGET_ORDER.COST_TYPE = 1 THEN ISNULL(COMPARE_DATA.AC_M1, 0) + ISNULL(COMPARE_DATA.AC_M2, 0) + ISNULL(COMPARE_DATA.AC_M3, 0) + ISNULL(COMPARE_DATA.AC_M4, 0) + ISNULL(COMPARE_DATA.AC_M5, 0) ELSE 0 END) AS ACC_AC_FC_M5,
      SUM(CASE WHEN BUDGET_ORDER.COST_TYPE = 1 THEN ISNULL(COMPARE_DATA.AC_M1, 0) + ISNULL(COMPARE_DATA.AC_M2, 0) + ISNULL(COMPARE_DATA.AC_M3, 0) + ISNULL(COMPARE_DATA.AC_M4, 0) + ISNULL(COMPARE_DATA.AC_M5, 0) + ISNULL(COMPARE_DATA.AC_M6, 0) ELSE 0 END) AS ACC_AC_FC_M6,

      SUM(CASE WHEN BUDGET_ORDER.COST_TYPE = 1 THEN ISNULL(COMPARE_DATA.AC_M7, 0) ELSE 0 END) AS ACC_AC_FC_M7,
      SUM(CASE WHEN BUDGET_ORDER.COST_TYPE = 1 THEN ISNULL(COMPARE_DATA.AC_M7, 0) + ISNULL(COMPARE_DATA.AC_M8, 0) ELSE 0 END) AS ACC_AC_FC_M8,
      SUM(CASE WHEN BUDGET_ORDER.COST_TYPE = 1 THEN ISNULL(COMPARE_DATA.AC_M7, 0) + ISNULL(COMPARE_DATA.AC_M8, 0) + ISNULL(COMPARE_DATA.AC_M9, 0) ELSE 0 END) AS ACC_AC_FC_M9,
      SUM(CASE WHEN BUDGET_ORDER.COST_TYPE = 1 THEN ISNULL(COMPARE_DATA.AC_M7, 0) + ISNULL(COMPARE_DATA.AC_M8, 0) + ISNULL(COMPARE_DATA.AC_M9, 0) + ISNULL(COMPARE_DATA.AC_M10, 0) ELSE 0 END) AS ACC_AC_FC_M10,
      SUM(CASE WHEN BUDGET_ORDER.COST_TYPE = 1 THEN ISNULL(COMPARE_DATA.AC_M7, 0) + ISNULL(COMPARE_DATA.AC_M8, 0) + ISNULL(COMPARE_DATA.AC_M9, 0) + ISNULL(COMPARE_DATA.AC_M10, 0) + ISNULL(COMPARE_DATA.AC_M11, 0) ELSE 0 END) AS ACC_AC_FC_M11,
      SUM(CASE WHEN BUDGET_ORDER.COST_TYPE = 1 THEN ISNULL(COMPARE_DATA.AC_M7, 0) + ISNULL(COMPARE_DATA.AC_M8, 0) + ISNULL(COMPARE_DATA.AC_M9, 0) + ISNULL(COMPARE_DATA.AC_M10, 0) + ISNULL(COMPARE_DATA.AC_M11, 0) + ISNULL(COMPARE_DATA.AC_M12, 0) ELSE 0 END) AS ACC_AC_FC_M12

      FROM
      (
      SELECT
      CP.BUDGET_ORDER_NO,
      CP.BUDGET_YEAR,

      SUM(CP.OB_H1) AS OB_H1,
      SUM(CP.OB_M1) AS OB_M1,
      SUM(CP.OB_M2) AS OB_M2,
      SUM(CP.OB_M3) AS OB_M3,
      SUM(CP.OB_M4) AS OB_M4,
      SUM(CP.OB_M5) AS OB_M5,
      SUM(CP.OB_M6) AS OB_M6,

      SUM(CP.OB_H2) AS OB_H2,
      SUM(CP.OB_M7) AS OB_M7,
      SUM(CP.OB_M8) AS OB_M8,
      SUM(CP.OB_M9) AS OB_M9,
      SUM(CP.OB_M10) AS OB_M10,
      SUM(CP.OB_M11) AS OB_M11,
      SUM(CP.OB_M12) AS OB_M12,

      SUM(CP.AC_H1) AS AC_H1,
      SUM(CP.AC_M1) AS AC_M1,
      SUM(CP.AC_M2) AS AC_M2,
      SUM(CP.AC_M3) AS AC_M3,
      SUM(CP.AC_M4) AS AC_M4,
      SUM(CP.AC_M5) AS AC_M5,
      SUM(CP.AC_M6) AS AC_M6,

      SUM(CP.AC_H2) AS AC_H2,
      SUM(CP.AC_M7) AS AC_M7,
      SUM(CP.AC_M8) AS AC_M8,
      SUM(CP.AC_M9) AS AC_M9,
      SUM(CP.AC_M10) AS AC_M10,
      SUM(CP.AC_M11) AS AC_M11,
      SUM(CP.AC_M12) AS AC_M12

      FROM
      (
      SELECT BUDGET.BUDGET_ORDER_NO,
      BUDGET.BUDGET_YEAR,

      ISNULL(BUDGET.H1,0) AS OB_H1,
      ISNULL(BUDGET.M1,0) AS OB_M1,
      ISNULL(BUDGET.M2,0) AS OB_M2,
      ISNULL(BUDGET.M3,0) AS OB_M3,
      ISNULL(BUDGET.M4,0) AS OB_M4,
      ISNULL(BUDGET.M5,0) AS OB_M5,
      ISNULL(BUDGET.M6,0) AS OB_M6,

      ISNULL(ACTUAL.H1,0) AS AC_H1,
      ISNULL(ACTUAL.M1,0) AS AC_M1,
      ISNULL(ACTUAL.M2,0) AS AC_M2,
      ISNULL(ACTUAL.M3,0) AS AC_M3,
      ISNULL(ACTUAL.M4,0) AS AC_M4,
      ISNULL(ACTUAL.M5,0) AS AC_M5,
      ISNULL(ACTUAL.M6,0) AS AC_M6,

      0 AS OB_H2,
      0 AS OB_M7,
      0 AS OB_M8,
      0 AS OB_M9,
      0 AS OB_M10,
      0 AS OB_M11,
      0 AS OB_M12,

      0 AS AC_H2,
      0 AS AC_M7,
      0 AS AC_M8,
      0 AS AC_M9,
      0 AS AC_M10,
      0 AS AC_M11,
      0 AS AC_M12

      FROM BG_T_UPLOAD_DATA AS BUDGET

      LEFT OUTER JOIN BG_T_UPLOAD_DATA AS ACTUAL
      ON ACTUAL.BUDGET_ORDER_NO = BUDGET.BUDGET_ORDER_NO
      AND ACTUAL.BUDGET_YEAR = BUDGET.BUDGET_YEAR
      AND ACTUAL.PERIOD_TYPE = BUDGET.PERIOD_TYPE
      AND ACTUAL.PROJECT_NO = BUDGET.PROJECT_NO
      AND ACTUAL.DATA_TYPE = 2

      WHERE BUDGET.BUDGET_YEAR = @BudgetYear
      AND BUDGET.PERIOD_TYPE = @PeriodType1
      AND BUDGET.PROJECT_NO = 1
      AND BUDGET.DATA_TYPE = 1

      UNION

      SELECT BUDGET.BUDGET_ORDER_NO,
      BUDGET.BUDGET_YEAR,

      0 AS OB_H1,
      0 AS OB_M1,
      0 AS OB_M2,
      0 AS OB_M3,
      0 AS OB_M4,
      0 AS OB_M5,
      0 AS OB_M6,

      0 AS AC_H1,
      0 AS AC_M1,
      0 AS AC_M2,
      0 AS AC_M3,
      0 AS AC_M4,
      0 AS AC_M5,
      0 AS AC_M6,

      ISNULL(BUDGET.H2,0) AS OB_H2,
      ISNULL(BUDGET.M7,0) AS OB_M7,
      ISNULL(BUDGET.M8,0) AS OB_M8,
      ISNULL(BUDGET.M9,0) AS OB_M9,
      ISNULL(BUDGET.M10,0) AS OB_M10,
      ISNULL(BUDGET.M11,0) AS OB_M11,
      ISNULL(BUDGET.M12,0) AS OB_M12,

      ISNULL(ACTUAL.H2,0) AS AC_H2,
      ISNULL(ACTUAL.M7,0) AS AC_M7,
      ISNULL(ACTUAL.M8,0) AS AC_M8,
      ISNULL(ACTUAL.M9,0) AS AC_M9,
      ISNULL(ACTUAL.M10,0) AS AC_M10,
      ISNULL(ACTUAL.M11,0) AS AC_M11,
      ISNULL(ACTUAL.M12,0) AS AC_M12

      FROM BG_T_UPLOAD_DATA AS BUDGET

      LEFT OUTER JOIN BG_T_UPLOAD_DATA AS ACTUAL
      ON ACTUAL.BUDGET_ORDER_NO = BUDGET.BUDGET_ORDER_NO
      AND ACTUAL.BUDGET_YEAR = BUDGET.BUDGET_YEAR
      AND ACTUAL.PERIOD_TYPE = BUDGET.PERIOD_TYPE
      AND ACTUAL.PROJECT_NO = BUDGET.PROJECT_NO
      AND ACTUAL.DATA_TYPE = 2

      WHERE BUDGET.BUDGET_YEAR = @BudgetYear
      AND BUDGET.PERIOD_TYPE = 12
      AND BUDGET.PROJECT_NO = 1
      AND BUDGET.DATA_TYPE = 1
      ) AS CP
      GROUP BY CP.BUDGET_ORDER_NO,CP.BUDGET_YEAR

      ) AS COMPARE_DATA

      INNER JOIN BG_M_BUDGET_ORDER AS BUDGET_ORDER
      ON BUDGET_ORDER.BUDGET_ORDER_NO = COMPARE_DATA.BUDGET_ORDER_NO
      AND BUDGET_ORDER.BUDGET_TYPE = 'E'
      AND BUDGET_ORDER.ACTIVE_FLAG = 1
      AND BUDGET_ORDER.BUDGET_ORDER_NO NOT IN ('JZZZZC4910', 'JZZZZC5910')

      INNER JOIN BG_M_PERSON_IN_CHARGE AS PIC
      ON PIC.PERSON_IN_CHARGE_NO = BUDGET_ORDER.PERSON_IN_CHARGE_NO

      GROUP BY BUDGET_ORDER.PIC_SHOW_FLAG,
      PIC.PERSON_IN_CHARGE_NO,
      PIC.PERSON_IN_CHARGE_NAME
    </SELECT004>
    <SELECT005>
      -- EXPENSE
      SELECT BUDGET_ORDER.ACCOUNT_NO,
      ACC.ACCOUNT_NAME,
      BUDGET_ORDER.BUDGET_TYPE,
      BUDGET_ORDER.EXPENSE_TYPE,

      -- ORIGINAL
      SUM(ISNULL(COMPARE_DATA.OB_M1, 0)) AS OB_M1,
      SUM(ISNULL(COMPARE_DATA.OB_M2, 0)) AS OB_M2,
      SUM(ISNULL(COMPARE_DATA.OB_M3, 0)) AS OB_M3,
      SUM(ISNULL(COMPARE_DATA.OB_M4, 0)) AS OB_M4,
      SUM(ISNULL(COMPARE_DATA.OB_M5, 0)) AS OB_M5,
      SUM(ISNULL(COMPARE_DATA.OB_M6, 0)) AS OB_M6,

      SUM(ISNULL(COMPARE_DATA.OB_M7, 0)) AS OB_M7,
      SUM(ISNULL(COMPARE_DATA.OB_M8, 0)) AS OB_M8,
      SUM(ISNULL(COMPARE_DATA.OB_M9, 0)) AS OB_M9,
      SUM(ISNULL(COMPARE_DATA.OB_M10, 0)) AS OB_M10,
      SUM(ISNULL(COMPARE_DATA.OB_M11, 0)) AS OB_M11,
      SUM(ISNULL(COMPARE_DATA.OB_M12, 0)) AS OB_M12,

      -- ACTUAL
      SUM(ISNULL(COMPARE_DATA.AC_M1, 0)) AS AC_M1,
      SUM(ISNULL(COMPARE_DATA.AC_M2, 0)) AS AC_M2,
      SUM(ISNULL(COMPARE_DATA.AC_M3, 0)) AS AC_M3,
      SUM(ISNULL(COMPARE_DATA.AC_M4, 0)) AS AC_M4,
      SUM(ISNULL(COMPARE_DATA.AC_M5, 0)) AS AC_M5,
      SUM(ISNULL(COMPARE_DATA.AC_M6, 0)) AS AC_M6,

      SUM(ISNULL(COMPARE_DATA.AC_M7, 0)) AS AC_M7,
      SUM(ISNULL(COMPARE_DATA.AC_M8, 0)) AS AC_M8,
      SUM(ISNULL(COMPARE_DATA.AC_M9, 0)) AS AC_M9,
      SUM(ISNULL(COMPARE_DATA.AC_M10, 0)) AS AC_M10,
      SUM(ISNULL(COMPARE_DATA.AC_M11, 0)) AS AC_M11,
      SUM(ISNULL(COMPARE_DATA.AC_M12, 0)) AS AC_M12,

      -- ACCUMULATE ORIGINAL
      SUM(ISNULL(COMPARE_DATA.OB_M1, 0)) AS ACC_OB_M1,
      SUM(ISNULL(COMPARE_DATA.OB_M1, 0) + ISNULL(COMPARE_DATA.OB_M2, 0)) AS ACC_OB_M2,
      SUM(ISNULL(COMPARE_DATA.OB_M1, 0) + ISNULL(COMPARE_DATA.OB_M2, 0) + ISNULL(COMPARE_DATA.OB_M3, 0)) AS ACC_OB_M3,
      SUM(ISNULL(COMPARE_DATA.OB_M1, 0) + ISNULL(COMPARE_DATA.OB_M2, 0) + ISNULL(COMPARE_DATA.OB_M3, 0) + ISNULL(COMPARE_DATA.OB_M4, 0)) AS ACC_OB_M4,
      SUM(ISNULL(COMPARE_DATA.OB_M1, 0) + ISNULL(COMPARE_DATA.OB_M2, 0) + ISNULL(COMPARE_DATA.OB_M3, 0) + ISNULL(COMPARE_DATA.OB_M4, 0) + ISNULL(COMPARE_DATA.OB_M5, 0)) AS ACC_OB_M5,
      SUM(ISNULL(COMPARE_DATA.OB_M1, 0) + ISNULL(COMPARE_DATA.OB_M2, 0) + ISNULL(COMPARE_DATA.OB_M3, 0) + ISNULL(COMPARE_DATA.OB_M4, 0) + ISNULL(COMPARE_DATA.OB_M5, 0) + ISNULL(COMPARE_DATA.OB_M6, 0)) AS ACC_OB_M6,

      SUM(ISNULL(COMPARE_DATA.OB_M7, 0)) AS ACC_OB_M7,
      SUM(ISNULL(COMPARE_DATA.OB_M7, 0) + ISNULL(COMPARE_DATA.OB_M8, 0)) AS ACC_OB_M8,
      SUM(ISNULL(COMPARE_DATA.OB_M7, 0) + ISNULL(COMPARE_DATA.OB_M8, 0) + ISNULL(COMPARE_DATA.OB_M9, 0)) AS ACC_OB_M9,
      SUM(ISNULL(COMPARE_DATA.OB_M7, 0) + ISNULL(COMPARE_DATA.OB_M8, 0) + ISNULL(COMPARE_DATA.OB_M9, 0) + ISNULL(COMPARE_DATA.OB_M10, 0)) AS ACC_OB_M10,
      SUM(ISNULL(COMPARE_DATA.OB_M7, 0) + ISNULL(COMPARE_DATA.OB_M8, 0) + ISNULL(COMPARE_DATA.OB_M9, 0) + ISNULL(COMPARE_DATA.OB_M10, 0) + ISNULL(COMPARE_DATA.OB_M11, 0)) AS ACC_OB_M11,
      SUM(ISNULL(COMPARE_DATA.OB_M7, 0) + ISNULL(COMPARE_DATA.OB_M8, 0) + ISNULL(COMPARE_DATA.OB_M9, 0) + ISNULL(COMPARE_DATA.OB_M10, 0) + ISNULL(COMPARE_DATA.OB_M11, 0) + ISNULL(COMPARE_DATA.OB_M12, 0)) AS ACC_OB_M12,

      -- ACCUMULATE ACTUAL
      SUM(ISNULL(COMPARE_DATA.AC_M1, 0)) AS ACC_AC_M1,
      SUM(ISNULL(COMPARE_DATA.AC_M1, 0) + ISNULL(COMPARE_DATA.AC_M2, 0)) AS ACC_AC_M2,
      SUM(ISNULL(COMPARE_DATA.AC_M1, 0) + ISNULL(COMPARE_DATA.AC_M2, 0) + ISNULL(COMPARE_DATA.AC_M3, 0)) AS ACC_AC_M3,
      SUM(ISNULL(COMPARE_DATA.AC_M1, 0) + ISNULL(COMPARE_DATA.AC_M2, 0) + ISNULL(COMPARE_DATA.AC_M3, 0) + ISNULL(COMPARE_DATA.AC_M4, 0)) AS ACC_AC_M4,
      SUM(ISNULL(COMPARE_DATA.AC_M1, 0) + ISNULL(COMPARE_DATA.AC_M2, 0) + ISNULL(COMPARE_DATA.AC_M3, 0) + ISNULL(COMPARE_DATA.AC_M4, 0) + ISNULL(COMPARE_DATA.AC_M5, 0)) AS ACC_AC_M5,
      SUM(ISNULL(COMPARE_DATA.AC_M1, 0) + ISNULL(COMPARE_DATA.AC_M2, 0) + ISNULL(COMPARE_DATA.AC_M3, 0) + ISNULL(COMPARE_DATA.AC_M4, 0) + ISNULL(COMPARE_DATA.AC_M5, 0) + ISNULL(COMPARE_DATA.AC_M6, 0)) AS ACC_AC_M6,

      SUM(ISNULL(COMPARE_DATA.AC_M7, 0)) AS ACC_AC_M7,
      SUM(ISNULL(COMPARE_DATA.AC_M7, 0) + ISNULL(COMPARE_DATA.AC_M8, 0)) AS ACC_AC_M8,
      SUM(ISNULL(COMPARE_DATA.AC_M7, 0) + ISNULL(COMPARE_DATA.AC_M8, 0) + ISNULL(COMPARE_DATA.AC_M9, 0)) AS ACC_AC_M9,
      SUM(ISNULL(COMPARE_DATA.AC_M7, 0) + ISNULL(COMPARE_DATA.AC_M8, 0) + ISNULL(COMPARE_DATA.AC_M9, 0) + ISNULL(COMPARE_DATA.AC_M10, 0)) AS ACC_AC_M10,
      SUM(ISNULL(COMPARE_DATA.AC_M7, 0) + ISNULL(COMPARE_DATA.AC_M8, 0) + ISNULL(COMPARE_DATA.AC_M9, 0) + ISNULL(COMPARE_DATA.AC_M10, 0) + ISNULL(COMPARE_DATA.AC_M11, 0)) AS ACC_AC_M11,
      SUM(ISNULL(COMPARE_DATA.AC_M7, 0) + ISNULL(COMPARE_DATA.AC_M8, 0) + ISNULL(COMPARE_DATA.AC_M9, 0) + ISNULL(COMPARE_DATA.AC_M10, 0) + ISNULL(COMPARE_DATA.AC_M11, 0) + ISNULL(COMPARE_DATA.AC_M12, 0)) AS ACC_AC_M12

      FROM
      (
      SELECT
      CP.BUDGET_ORDER_NO,
      CP.BUDGET_YEAR,

      SUM(CP.OB_H1) AS OB_H1,
      SUM(CP.OB_M1) AS OB_M1,
      SUM(CP.OB_M2) AS OB_M2,
      SUM(CP.OB_M3) AS OB_M3,
      SUM(CP.OB_M4) AS OB_M4,
      SUM(CP.OB_M5) AS OB_M5,
      SUM(CP.OB_M6) AS OB_M6,

      SUM(CP.OB_H2) AS OB_H2,
      SUM(CP.OB_M7) AS OB_M7,
      SUM(CP.OB_M8) AS OB_M8,
      SUM(CP.OB_M9) AS OB_M9,
      SUM(CP.OB_M10) AS OB_M10,
      SUM(CP.OB_M11) AS OB_M11,
      SUM(CP.OB_M12) AS OB_M12,

      SUM(CP.AC_H1) AS AC_H1,
      SUM(CP.AC_M1) AS AC_M1,
      SUM(CP.AC_M2) AS AC_M2,
      SUM(CP.AC_M3) AS AC_M3,
      SUM(CP.AC_M4) AS AC_M4,
      SUM(CP.AC_M5) AS AC_M5,
      SUM(CP.AC_M6) AS AC_M6,

      SUM(CP.AC_H2) AS AC_H2,
      SUM(CP.AC_M7) AS AC_M7,
      SUM(CP.AC_M8) AS AC_M8,
      SUM(CP.AC_M9) AS AC_M9,
      SUM(CP.AC_M10) AS AC_M10,
      SUM(CP.AC_M11) AS AC_M11,
      SUM(CP.AC_M12) AS AC_M12

      FROM
      (
      SELECT BUDGET.BUDGET_ORDER_NO,
      BUDGET.BUDGET_YEAR,

      ISNULL(BUDGET.H1,0) AS OB_H1,
      ISNULL(BUDGET.M1,0) AS OB_M1,
      ISNULL(BUDGET.M2,0) AS OB_M2,
      ISNULL(BUDGET.M3,0) AS OB_M3,
      ISNULL(BUDGET.M4,0) AS OB_M4,
      ISNULL(BUDGET.M5,0) AS OB_M5,
      ISNULL(BUDGET.M6,0) AS OB_M6,

      ISNULL(ACTUAL.H1,0) AS AC_H1,
      ISNULL(ACTUAL.M1,0) AS AC_M1,
      ISNULL(ACTUAL.M2,0) AS AC_M2,
      ISNULL(ACTUAL.M3,0) AS AC_M3,
      ISNULL(ACTUAL.M4,0) AS AC_M4,
      ISNULL(ACTUAL.M5,0) AS AC_M5,
      ISNULL(ACTUAL.M6,0) AS AC_M6,

      0 AS OB_H2,
      0 AS OB_M7,
      0 AS OB_M8,
      0 AS OB_M9,
      0 AS OB_M10,
      0 AS OB_M11,
      0 AS OB_M12,

      0 AS AC_H2,
      0 AS AC_M7,
      0 AS AC_M8,
      0 AS AC_M9,
      0 AS AC_M10,
      0 AS AC_M11,
      0 AS AC_M12

      FROM BG_T_UPLOAD_DATA AS BUDGET

      LEFT OUTER JOIN BG_T_UPLOAD_DATA AS ACTUAL
      ON ACTUAL.BUDGET_ORDER_NO = BUDGET.BUDGET_ORDER_NO
      AND ACTUAL.BUDGET_YEAR = BUDGET.BUDGET_YEAR
      AND ACTUAL.PERIOD_TYPE = BUDGET.PERIOD_TYPE
      AND ACTUAL.PROJECT_NO = BUDGET.PROJECT_NO
      AND ACTUAL.DATA_TYPE = 2

      WHERE BUDGET.BUDGET_YEAR = @BudgetYear
      AND BUDGET.PERIOD_TYPE = @PeriodType1
      AND BUDGET.PROJECT_NO = 1
      AND BUDGET.DATA_TYPE = 1

      UNION

      SELECT BUDGET.BUDGET_ORDER_NO,
      BUDGET.BUDGET_YEAR,

      0 AS OB_H1,
      0 AS OB_M1,
      0 AS OB_M2,
      0 AS OB_M3,
      0 AS OB_M4,
      0 AS OB_M5,
      0 AS OB_M6,

      0 AS AC_H1,
      0 AS AC_M1,
      0 AS AC_M2,
      0 AS AC_M3,
      0 AS AC_M4,
      0 AS AC_M5,
      0 AS AC_M6,

      ISNULL(BUDGET.H2,0) AS OB_H2,
      ISNULL(BUDGET.M7,0) AS OB_M7,
      ISNULL(BUDGET.M8,0) AS OB_M8,
      ISNULL(BUDGET.M9,0) AS OB_M9,
      ISNULL(BUDGET.M10,0) AS OB_M10,
      ISNULL(BUDGET.M11,0) AS OB_M11,
      ISNULL(BUDGET.M12,0) AS OB_M12,

      ISNULL(ACTUAL.H2,0) AS AC_H2,
      ISNULL(ACTUAL.M7,0) AS AC_M7,
      ISNULL(ACTUAL.M8,0) AS AC_M8,
      ISNULL(ACTUAL.M9,0) AS AC_M9,
      ISNULL(ACTUAL.M10,0) AS AC_M10,
      ISNULL(ACTUAL.M11,0) AS AC_M11,
      ISNULL(ACTUAL.M12,0) AS AC_M12

      FROM BG_T_UPLOAD_DATA AS BUDGET

      LEFT OUTER JOIN BG_T_UPLOAD_DATA AS ACTUAL
      ON ACTUAL.BUDGET_ORDER_NO = BUDGET.BUDGET_ORDER_NO
      AND ACTUAL.BUDGET_YEAR = BUDGET.BUDGET_YEAR
      AND ACTUAL.PERIOD_TYPE = BUDGET.PERIOD_TYPE
      AND ACTUAL.PROJECT_NO = BUDGET.PROJECT_NO
      AND ACTUAL.DATA_TYPE = 2

      WHERE BUDGET.BUDGET_YEAR = @BudgetYear
      AND BUDGET.PERIOD_TYPE = 12
      AND BUDGET.PROJECT_NO = 1
      AND BUDGET.DATA_TYPE = 1
      ) AS CP
      GROUP BY CP.BUDGET_ORDER_NO,CP.BUDGET_YEAR

      ) AS COMPARE_DATA

      INNER JOIN BG_M_BUDGET_ORDER AS BUDGET_ORDER
      ON BUDGET_ORDER.BUDGET_ORDER_NO = COMPARE_DATA.BUDGET_ORDER_NO
      AND BUDGET_ORDER.BUDGET_TYPE = 'E'
      AND BUDGET_ORDER.ACTIVE_FLAG = 1
      AND BUDGET_ORDER.BUDGET_ORDER_NO NOT LIKE 'J%Z'
      --AND BUDGET_ORDER.BUDGET_ORDER_NO &lt;&gt; 'J0000C9999'
      AND BUDGET_ORDER.BUDGET_ORDER_NO NOT IN ('JZZZZC4910', 'JZZZZC5910')

      INNER JOIN BG_M_PERSON_IN_CHARGE AS PIC
      ON PIC.PERSON_IN_CHARGE_NO = BUDGET_ORDER.PERSON_IN_CHARGE_NO

      LEFT OUTER JOIN BG_M_ACCOUNT AS ACC
      ON BUDGET_ORDER.ACCOUNT_NO = ACC.ACCOUNT_NO

      GROUP BY BUDGET_ORDER.ACCOUNT_NO,
      ACC.ACCOUNT_NAME,
      BUDGET_ORDER.BUDGET_TYPE,
      BUDGET_ORDER.EXPENSE_TYPE

      UNION
      -- INVESTMENT
      SELECT BUDGET_ORDER.ACCOUNT_NO,
      ACC.ACCOUNT_NAME,
      BUDGET_ORDER.BUDGET_TYPE,
      BUDGET_ORDER.EXPENSE_TYPE,

      -- ORIGINAL
      SUM(ISNULL(COMPARE_DATA.OB_M1, 0)) AS OB_M1,
      SUM(ISNULL(COMPARE_DATA.OB_M2, 0)) AS OB_M2,
      SUM(ISNULL(COMPARE_DATA.OB_M3, 0)) AS OB_M3,
      SUM(ISNULL(COMPARE_DATA.OB_M4, 0)) AS OB_M4,
      SUM(ISNULL(COMPARE_DATA.OB_M5, 0)) AS OB_M5,
      SUM(ISNULL(COMPARE_DATA.OB_M6, 0)) AS OB_M6,

      SUM(ISNULL(COMPARE_DATA.OB_M7, 0)) AS OB_M7,
      SUM(ISNULL(COMPARE_DATA.OB_M8, 0)) AS OB_M8,
      SUM(ISNULL(COMPARE_DATA.OB_M9, 0)) AS OB_M9,
      SUM(ISNULL(COMPARE_DATA.OB_M10, 0)) AS OB_M10,
      SUM(ISNULL(COMPARE_DATA.OB_M11, 0)) AS OB_M11,
      SUM(ISNULL(COMPARE_DATA.OB_M12, 0)) AS OB_M12,

      -- ACTUAL
      SUM(ISNULL(COMPARE_DATA.AC_M1, 0)) AS AC_M1,
      SUM(ISNULL(COMPARE_DATA.AC_M2, 0)) AS AC_M2,
      SUM(ISNULL(COMPARE_DATA.AC_M3, 0)) AS AC_M3,
      SUM(ISNULL(COMPARE_DATA.AC_M4, 0)) AS AC_M4,
      SUM(ISNULL(COMPARE_DATA.AC_M5, 0)) AS AC_M5,
      SUM(ISNULL(COMPARE_DATA.AC_M6, 0)) AS AC_M6,

      SUM(ISNULL(COMPARE_DATA.AC_M7, 0)) AS AC_M7,
      SUM(ISNULL(COMPARE_DATA.AC_M8, 0)) AS AC_M8,
      SUM(ISNULL(COMPARE_DATA.AC_M9, 0)) AS AC_M9,
      SUM(ISNULL(COMPARE_DATA.AC_M10, 0)) AS AC_M10,
      SUM(ISNULL(COMPARE_DATA.AC_M11, 0)) AS AC_M11,
      SUM(ISNULL(COMPARE_DATA.AC_M12, 0)) AS AC_M12,

      -- ACCUMULATE ORIGINAL
      SUM(ISNULL(COMPARE_DATA.OB_M1, 0)) AS ACC_OB_M1,
      SUM(ISNULL(COMPARE_DATA.OB_M1, 0) + ISNULL(COMPARE_DATA.OB_M2, 0)) AS ACC_OB_M2,
      SUM(ISNULL(COMPARE_DATA.OB_M1, 0) + ISNULL(COMPARE_DATA.OB_M2, 0) + ISNULL(COMPARE_DATA.OB_M3, 0)) AS ACC_OB_M3,
      SUM(ISNULL(COMPARE_DATA.OB_M1, 0) + ISNULL(COMPARE_DATA.OB_M2, 0) + ISNULL(COMPARE_DATA.OB_M3, 0) + ISNULL(COMPARE_DATA.OB_M4, 0)) AS ACC_OB_M4,
      SUM(ISNULL(COMPARE_DATA.OB_M1, 0) + ISNULL(COMPARE_DATA.OB_M2, 0) + ISNULL(COMPARE_DATA.OB_M3, 0) + ISNULL(COMPARE_DATA.OB_M4, 0) + ISNULL(COMPARE_DATA.OB_M5, 0)) AS ACC_OB_M5,
      SUM(ISNULL(COMPARE_DATA.OB_M1, 0) + ISNULL(COMPARE_DATA.OB_M2, 0) + ISNULL(COMPARE_DATA.OB_M3, 0) + ISNULL(COMPARE_DATA.OB_M4, 0) + ISNULL(COMPARE_DATA.OB_M5, 0) + ISNULL(COMPARE_DATA.OB_M6, 0)) AS ACC_OB_M6,

      SUM(ISNULL(COMPARE_DATA.OB_M7, 0)) AS ACC_OB_M7,
      SUM(ISNULL(COMPARE_DATA.OB_M7, 0) + ISNULL(COMPARE_DATA.OB_M8, 0)) AS ACC_OB_M8,
      SUM(ISNULL(COMPARE_DATA.OB_M7, 0) + ISNULL(COMPARE_DATA.OB_M8, 0) + ISNULL(COMPARE_DATA.OB_M9, 0)) AS ACC_OB_M9,
      SUM(ISNULL(COMPARE_DATA.OB_M7, 0) + ISNULL(COMPARE_DATA.OB_M8, 0) + ISNULL(COMPARE_DATA.OB_M9, 0) + ISNULL(COMPARE_DATA.OB_M10, 0)) AS ACC_OB_M10,
      SUM(ISNULL(COMPARE_DATA.OB_M7, 0) + ISNULL(COMPARE_DATA.OB_M8, 0) + ISNULL(COMPARE_DATA.OB_M9, 0) + ISNULL(COMPARE_DATA.OB_M10, 0) + ISNULL(COMPARE_DATA.OB_M11, 0)) AS ACC_OB_M11,
      SUM(ISNULL(COMPARE_DATA.OB_M7, 0) + ISNULL(COMPARE_DATA.OB_M8, 0) + ISNULL(COMPARE_DATA.OB_M9, 0) + ISNULL(COMPARE_DATA.OB_M10, 0) + ISNULL(COMPARE_DATA.OB_M11, 0) + ISNULL(COMPARE_DATA.OB_M12, 0)) AS ACC_OB_M12,

      -- ACCUMULATE ACTUAL
      SUM(ISNULL(COMPARE_DATA.AC_M1, 0)) AS ACC_AC_M1,
      SUM(ISNULL(COMPARE_DATA.AC_M1, 0) + ISNULL(COMPARE_DATA.AC_M2, 0)) AS ACC_AC_M2,
      SUM(ISNULL(COMPARE_DATA.AC_M1, 0) + ISNULL(COMPARE_DATA.AC_M2, 0) + ISNULL(COMPARE_DATA.AC_M3, 0)) AS ACC_AC_M3,
      SUM(ISNULL(COMPARE_DATA.AC_M1, 0) + ISNULL(COMPARE_DATA.AC_M2, 0) + ISNULL(COMPARE_DATA.AC_M3, 0) + ISNULL(COMPARE_DATA.AC_M4, 0)) AS ACC_AC_M4,
      SUM(ISNULL(COMPARE_DATA.AC_M1, 0) + ISNULL(COMPARE_DATA.AC_M2, 0) + ISNULL(COMPARE_DATA.AC_M3, 0) + ISNULL(COMPARE_DATA.AC_M4, 0) + ISNULL(COMPARE_DATA.AC_M5, 0)) AS ACC_AC_M5,
      SUM(ISNULL(COMPARE_DATA.AC_M1, 0) + ISNULL(COMPARE_DATA.AC_M2, 0) + ISNULL(COMPARE_DATA.AC_M3, 0) + ISNULL(COMPARE_DATA.AC_M4, 0) + ISNULL(COMPARE_DATA.AC_M5, 0) + ISNULL(COMPARE_DATA.AC_M6, 0)) AS ACC_AC_M6,

      SUM(ISNULL(COMPARE_DATA.AC_M7, 0)) AS ACC_AC_M7,
      SUM(ISNULL(COMPARE_DATA.AC_M7, 0) + ISNULL(COMPARE_DATA.AC_M8, 0)) AS ACC_AC_M8,
      SUM(ISNULL(COMPARE_DATA.AC_M7, 0) + ISNULL(COMPARE_DATA.AC_M8, 0) + ISNULL(COMPARE_DATA.AC_M9, 0)) AS ACC_AC_M9,
      SUM(ISNULL(COMPARE_DATA.AC_M7, 0) + ISNULL(COMPARE_DATA.AC_M8, 0) + ISNULL(COMPARE_DATA.AC_M9, 0) + ISNULL(COMPARE_DATA.AC_M10, 0)) AS ACC_AC_M10,
      SUM(ISNULL(COMPARE_DATA.AC_M7, 0) + ISNULL(COMPARE_DATA.AC_M8, 0) + ISNULL(COMPARE_DATA.AC_M9, 0) + ISNULL(COMPARE_DATA.AC_M10, 0) + ISNULL(COMPARE_DATA.AC_M11, 0)) AS ACC_AC_M11,
      SUM(ISNULL(COMPARE_DATA.AC_M7, 0) + ISNULL(COMPARE_DATA.AC_M8, 0) + ISNULL(COMPARE_DATA.AC_M9, 0) + ISNULL(COMPARE_DATA.AC_M10, 0) + ISNULL(COMPARE_DATA.AC_M11, 0) + ISNULL(COMPARE_DATA.AC_M12, 0)) AS ACC_AC_M12

      FROM
      (
      SELECT
      CP.BUDGET_ORDER_NO,
      CP.BUDGET_YEAR,

      SUM(CP.OB_H1) AS OB_H1,
      SUM(CP.OB_M1) AS OB_M1,
      SUM(CP.OB_M2) AS OB_M2,
      SUM(CP.OB_M3) AS OB_M3,
      SUM(CP.OB_M4) AS OB_M4,
      SUM(CP.OB_M5) AS OB_M5,
      SUM(CP.OB_M6) AS OB_M6,

      SUM(CP.OB_H2) AS OB_H2,
      SUM(CP.OB_M7) AS OB_M7,
      SUM(CP.OB_M8) AS OB_M8,
      SUM(CP.OB_M9) AS OB_M9,
      SUM(CP.OB_M10) AS OB_M10,
      SUM(CP.OB_M11) AS OB_M11,
      SUM(CP.OB_M12) AS OB_M12,

      SUM(CP.AC_H1) AS AC_H1,
      SUM(CP.AC_M1) AS AC_M1,
      SUM(CP.AC_M2) AS AC_M2,
      SUM(CP.AC_M3) AS AC_M3,
      SUM(CP.AC_M4) AS AC_M4,
      SUM(CP.AC_M5) AS AC_M5,
      SUM(CP.AC_M6) AS AC_M6,

      SUM(CP.AC_H2) AS AC_H2,
      SUM(CP.AC_M7) AS AC_M7,
      SUM(CP.AC_M8) AS AC_M8,
      SUM(CP.AC_M9) AS AC_M9,
      SUM(CP.AC_M10) AS AC_M10,
      SUM(CP.AC_M11) AS AC_M11,
      SUM(CP.AC_M12) AS AC_M12

      FROM
      (
      SELECT BUDGET.BUDGET_ORDER_NO,
      BUDGET.BUDGET_YEAR,

      ISNULL(BUDGET.H1,0) AS OB_H1,
      ISNULL(BUDGET.M1,0) AS OB_M1,
      ISNULL(BUDGET.M2,0) AS OB_M2,
      ISNULL(BUDGET.M3,0) AS OB_M3,
      ISNULL(BUDGET.M4,0) AS OB_M4,
      ISNULL(BUDGET.M5,0) AS OB_M5,
      ISNULL(BUDGET.M6,0) AS OB_M6,

      ISNULL(ACTUAL.H1,0) AS AC_H1,
      ISNULL(ACTUAL.M1,0) AS AC_M1,
      ISNULL(ACTUAL.M2,0) AS AC_M2,
      ISNULL(ACTUAL.M3,0) AS AC_M3,
      ISNULL(ACTUAL.M4,0) AS AC_M4,
      ISNULL(ACTUAL.M5,0) AS AC_M5,
      ISNULL(ACTUAL.M6,0) AS AC_M6,

      0 AS OB_H2,
      0 AS OB_M7,
      0 AS OB_M8,
      0 AS OB_M9,
      0 AS OB_M10,
      0 AS OB_M11,
      0 AS OB_M12,

      0 AS AC_H2,
      0 AS AC_M7,
      0 AS AC_M8,
      0 AS AC_M9,
      0 AS AC_M10,
      0 AS AC_M11,
      0 AS AC_M12

      FROM BG_T_UPLOAD_DATA AS BUDGET

      LEFT OUTER JOIN BG_T_UPLOAD_DATA AS ACTUAL
      ON ACTUAL.BUDGET_ORDER_NO = BUDGET.BUDGET_ORDER_NO
      AND ACTUAL.BUDGET_YEAR = BUDGET.BUDGET_YEAR
      AND ACTUAL.PERIOD_TYPE = BUDGET.PERIOD_TYPE
      AND ACTUAL.PROJECT_NO = BUDGET.PROJECT_NO
      AND ACTUAL.DATA_TYPE = 2

      WHERE BUDGET.BUDGET_YEAR = @BudgetYear
      AND BUDGET.PERIOD_TYPE = @PeriodType1
      AND BUDGET.PROJECT_NO = 1
      AND BUDGET.DATA_TYPE = 1

      UNION

      SELECT BUDGET.BUDGET_ORDER_NO,
      BUDGET.BUDGET_YEAR,

      0 AS OB_H1,
      0 AS OB_M1,
      0 AS OB_M2,
      0 AS OB_M3,
      0 AS OB_M4,
      0 AS OB_M5,
      0 AS OB_M6,

      0 AS AC_H1,
      0 AS AC_M1,
      0 AS AC_M2,
      0 AS AC_M3,
      0 AS AC_M4,
      0 AS AC_M5,
      0 AS AC_M6,

      ISNULL(BUDGET.H2,0) AS OB_H2,
      ISNULL(BUDGET.M7,0) AS OB_M7,
      ISNULL(BUDGET.M8,0) AS OB_M8,
      ISNULL(BUDGET.M9,0) AS OB_M9,
      ISNULL(BUDGET.M10,0) AS OB_M10,
      ISNULL(BUDGET.M11,0) AS OB_M11,
      ISNULL(BUDGET.M12,0) AS OB_M12,

      ISNULL(ACTUAL.H2,0) AS AC_H2,
      ISNULL(ACTUAL.M7,0) AS AC_M7,
      ISNULL(ACTUAL.M8,0) AS AC_M8,
      ISNULL(ACTUAL.M9,0) AS AC_M9,
      ISNULL(ACTUAL.M10,0) AS AC_M10,
      ISNULL(ACTUAL.M11,0) AS AC_M11,
      ISNULL(ACTUAL.M12,0) AS AC_M12

      FROM BG_T_UPLOAD_DATA AS BUDGET

      LEFT OUTER JOIN BG_T_UPLOAD_DATA AS ACTUAL
      ON ACTUAL.BUDGET_ORDER_NO = BUDGET.BUDGET_ORDER_NO
      AND ACTUAL.BUDGET_YEAR = BUDGET.BUDGET_YEAR
      AND ACTUAL.PERIOD_TYPE = BUDGET.PERIOD_TYPE
      AND ACTUAL.PROJECT_NO = BUDGET.PROJECT_NO
      AND ACTUAL.DATA_TYPE = 2

      WHERE BUDGET.BUDGET_YEAR = @BudgetYear
      AND BUDGET.PERIOD_TYPE = 12
      AND BUDGET.PROJECT_NO = 1
      AND BUDGET.DATA_TYPE = 1
      ) AS CP
      GROUP BY CP.BUDGET_ORDER_NO,CP.BUDGET_YEAR

      ) AS COMPARE_DATA

      INNER JOIN BG_M_BUDGET_ORDER AS BUDGET_ORDER
      ON BUDGET_ORDER.BUDGET_ORDER_NO = COMPARE_DATA.BUDGET_ORDER_NO
      AND BUDGET_ORDER.BUDGET_TYPE = 'A'
      AND BUDGET_ORDER.ACTIVE_FLAG = 1

      INNER JOIN BG_M_PERSON_IN_CHARGE AS PIC
      ON PIC.PERSON_IN_CHARGE_NO = BUDGET_ORDER.PERSON_IN_CHARGE_NO

      LEFT OUTER JOIN BG_M_ACCOUNT AS ACC
      ON BUDGET_ORDER.ACCOUNT_NO = ACC.ACCOUNT_NO

      GROUP BY BUDGET_ORDER.ACCOUNT_NO,
      ACC.ACCOUNT_NAME,
      BUDGET_ORDER.BUDGET_TYPE,
      BUDGET_ORDER.EXPENSE_TYPE

      UNION

      -- WORKING BUDGET
      SELECT BUDGET_ORDER.ACCOUNT_NO,
      ACC.ACCOUNT_NAME,
      'W' AS BUDGET_TYPE,
      BUDGET_ORDER.EXPENSE_TYPE,

      -- ORIGINAL
      SUM(ISNULL(COMPARE_DATA.OB_M1, 0)) AS OB_M1,
      SUM(ISNULL(COMPARE_DATA.OB_M2, 0)) AS OB_M2,
      SUM(ISNULL(COMPARE_DATA.OB_M3, 0)) AS OB_M3,
      SUM(ISNULL(COMPARE_DATA.OB_M4, 0)) AS OB_M4,
      SUM(ISNULL(COMPARE_DATA.OB_M5, 0)) AS OB_M5,
      SUM(ISNULL(COMPARE_DATA.OB_M6, 0)) AS OB_M6,

      SUM(ISNULL(COMPARE_DATA.OB_M7, 0)) AS OB_M7,
      SUM(ISNULL(COMPARE_DATA.OB_M8, 0)) AS OB_M8,
      SUM(ISNULL(COMPARE_DATA.OB_M9, 0)) AS OB_M9,
      SUM(ISNULL(COMPARE_DATA.OB_M10, 0)) AS OB_M10,
      SUM(ISNULL(COMPARE_DATA.OB_M11, 0)) AS OB_M11,
      SUM(ISNULL(COMPARE_DATA.OB_M12, 0)) AS OB_M12,

      -- ACTUAL
      SUM(ISNULL(COMPARE_DATA.AC_M1, 0)) AS AC_M1,
      SUM(ISNULL(COMPARE_DATA.AC_M2, 0)) AS AC_M2,
      SUM(ISNULL(COMPARE_DATA.AC_M3, 0)) AS AC_M3,
      SUM(ISNULL(COMPARE_DATA.AC_M4, 0)) AS AC_M4,
      SUM(ISNULL(COMPARE_DATA.AC_M5, 0)) AS AC_M5,
      SUM(ISNULL(COMPARE_DATA.AC_M6, 0)) AS AC_M6,

      SUM(ISNULL(COMPARE_DATA.AC_M7, 0)) AS AC_M7,
      SUM(ISNULL(COMPARE_DATA.AC_M8, 0)) AS AC_M8,
      SUM(ISNULL(COMPARE_DATA.AC_M9, 0)) AS AC_M9,
      SUM(ISNULL(COMPARE_DATA.AC_M10, 0)) AS AC_M10,
      SUM(ISNULL(COMPARE_DATA.AC_M11, 0)) AS AC_M11,
      SUM(ISNULL(COMPARE_DATA.AC_M12, 0)) AS AC_M12,

      -- ACCUMULATE ORIGINAL
      SUM(ISNULL(COMPARE_DATA.OB_M1, 0)) AS ACC_OB_M1,
      SUM(ISNULL(COMPARE_DATA.OB_M1, 0) + ISNULL(COMPARE_DATA.OB_M2, 0)) AS ACC_OB_M2,
      SUM(ISNULL(COMPARE_DATA.OB_M1, 0) + ISNULL(COMPARE_DATA.OB_M2, 0) + ISNULL(COMPARE_DATA.OB_M3, 0)) AS ACC_OB_M3,
      SUM(ISNULL(COMPARE_DATA.OB_M1, 0) + ISNULL(COMPARE_DATA.OB_M2, 0) + ISNULL(COMPARE_DATA.OB_M3, 0) + ISNULL(COMPARE_DATA.OB_M4, 0)) AS ACC_OB_M4,
      SUM(ISNULL(COMPARE_DATA.OB_M1, 0) + ISNULL(COMPARE_DATA.OB_M2, 0) + ISNULL(COMPARE_DATA.OB_M3, 0) + ISNULL(COMPARE_DATA.OB_M4, 0) + ISNULL(COMPARE_DATA.OB_M5, 0)) AS ACC_OB_M5,
      SUM(ISNULL(COMPARE_DATA.OB_M1, 0) + ISNULL(COMPARE_DATA.OB_M2, 0) + ISNULL(COMPARE_DATA.OB_M3, 0) + ISNULL(COMPARE_DATA.OB_M4, 0) + ISNULL(COMPARE_DATA.OB_M5, 0) + ISNULL(COMPARE_DATA.OB_M6, 0)) AS ACC_OB_M6,

      SUM(ISNULL(COMPARE_DATA.OB_M7, 0)) AS ACC_OB_M7,
      SUM(ISNULL(COMPARE_DATA.OB_M7, 0) + ISNULL(COMPARE_DATA.OB_M8, 0)) AS ACC_OB_M8,
      SUM(ISNULL(COMPARE_DATA.OB_M7, 0) + ISNULL(COMPARE_DATA.OB_M8, 0) + ISNULL(COMPARE_DATA.OB_M9, 0)) AS ACC_OB_M9,
      SUM(ISNULL(COMPARE_DATA.OB_M7, 0) + ISNULL(COMPARE_DATA.OB_M8, 0) + ISNULL(COMPARE_DATA.OB_M9, 0) + ISNULL(COMPARE_DATA.OB_M10, 0)) AS ACC_OB_M10,
      SUM(ISNULL(COMPARE_DATA.OB_M7, 0) + ISNULL(COMPARE_DATA.OB_M8, 0) + ISNULL(COMPARE_DATA.OB_M9, 0) + ISNULL(COMPARE_DATA.OB_M10, 0) + ISNULL(COMPARE_DATA.OB_M11, 0)) AS ACC_OB_M11,
      SUM(ISNULL(COMPARE_DATA.OB_M7, 0) + ISNULL(COMPARE_DATA.OB_M8, 0) + ISNULL(COMPARE_DATA.OB_M9, 0) + ISNULL(COMPARE_DATA.OB_M10, 0) + ISNULL(COMPARE_DATA.OB_M11, 0) + ISNULL(COMPARE_DATA.OB_M12, 0)) AS ACC_OB_M12,

      -- ACCUMULATE ACTUAL
      SUM(ISNULL(COMPARE_DATA.AC_M1, 0)) AS ACC_AC_M1,
      SUM(ISNULL(COMPARE_DATA.AC_M1, 0) + ISNULL(COMPARE_DATA.AC_M2, 0)) AS ACC_AC_M2,
      SUM(ISNULL(COMPARE_DATA.AC_M1, 0) + ISNULL(COMPARE_DATA.AC_M2, 0) + ISNULL(COMPARE_DATA.AC_M3, 0)) AS ACC_AC_M3,
      SUM(ISNULL(COMPARE_DATA.AC_M1, 0) + ISNULL(COMPARE_DATA.AC_M2, 0) + ISNULL(COMPARE_DATA.AC_M3, 0) + ISNULL(COMPARE_DATA.AC_M4, 0)) AS ACC_AC_M4,
      SUM(ISNULL(COMPARE_DATA.AC_M1, 0) + ISNULL(COMPARE_DATA.AC_M2, 0) + ISNULL(COMPARE_DATA.AC_M3, 0) + ISNULL(COMPARE_DATA.AC_M4, 0) + ISNULL(COMPARE_DATA.AC_M5, 0)) AS ACC_AC_M5,
      SUM(ISNULL(COMPARE_DATA.AC_M1, 0) + ISNULL(COMPARE_DATA.AC_M2, 0) + ISNULL(COMPARE_DATA.AC_M3, 0) + ISNULL(COMPARE_DATA.AC_M4, 0) + ISNULL(COMPARE_DATA.AC_M5, 0) + ISNULL(COMPARE_DATA.AC_M6, 0)) AS ACC_AC_M6,

      SUM(ISNULL(COMPARE_DATA.AC_M7, 0)) AS ACC_AC_M7,
      SUM(ISNULL(COMPARE_DATA.AC_M7, 0) + ISNULL(COMPARE_DATA.AC_M8, 0)) AS ACC_AC_M8,
      SUM(ISNULL(COMPARE_DATA.AC_M7, 0) + ISNULL(COMPARE_DATA.AC_M8, 0) + ISNULL(COMPARE_DATA.AC_M9, 0)) AS ACC_AC_M9,
      SUM(ISNULL(COMPARE_DATA.AC_M7, 0) + ISNULL(COMPARE_DATA.AC_M8, 0) + ISNULL(COMPARE_DATA.AC_M9, 0) + ISNULL(COMPARE_DATA.AC_M10, 0)) AS ACC_AC_M10,
      SUM(ISNULL(COMPARE_DATA.AC_M7, 0) + ISNULL(COMPARE_DATA.AC_M8, 0) + ISNULL(COMPARE_DATA.AC_M9, 0) + ISNULL(COMPARE_DATA.AC_M10, 0) + ISNULL(COMPARE_DATA.AC_M11, 0)) AS ACC_AC_M11,
      SUM(ISNULL(COMPARE_DATA.AC_M7, 0) + ISNULL(COMPARE_DATA.AC_M8, 0) + ISNULL(COMPARE_DATA.AC_M9, 0) + ISNULL(COMPARE_DATA.AC_M10, 0) + ISNULL(COMPARE_DATA.AC_M11, 0) + ISNULL(COMPARE_DATA.AC_M12, 0)) AS ACC_AC_M12

      FROM
      (
      SELECT
      CP.BUDGET_ORDER_NO,
      CP.BUDGET_YEAR,

      SUM(CP.OB_H1) AS OB_H1,
      SUM(CP.OB_M1) AS OB_M1,
      SUM(CP.OB_M2) AS OB_M2,
      SUM(CP.OB_M3) AS OB_M3,
      SUM(CP.OB_M4) AS OB_M4,
      SUM(CP.OB_M5) AS OB_M5,
      SUM(CP.OB_M6) AS OB_M6,

      SUM(CP.OB_H2) AS OB_H2,
      SUM(CP.OB_M7) AS OB_M7,
      SUM(CP.OB_M8) AS OB_M8,
      SUM(CP.OB_M9) AS OB_M9,
      SUM(CP.OB_M10) AS OB_M10,
      SUM(CP.OB_M11) AS OB_M11,
      SUM(CP.OB_M12) AS OB_M12,

      SUM(CP.AC_H1) AS AC_H1,
      SUM(CP.AC_M1) AS AC_M1,
      SUM(CP.AC_M2) AS AC_M2,
      SUM(CP.AC_M3) AS AC_M3,
      SUM(CP.AC_M4) AS AC_M4,
      SUM(CP.AC_M5) AS AC_M5,
      SUM(CP.AC_M6) AS AC_M6,

      SUM(CP.AC_H2) AS AC_H2,
      SUM(CP.AC_M7) AS AC_M7,
      SUM(CP.AC_M8) AS AC_M8,
      SUM(CP.AC_M9) AS AC_M9,
      SUM(CP.AC_M10) AS AC_M10,
      SUM(CP.AC_M11) AS AC_M11,
      SUM(CP.AC_M12) AS AC_M12

      FROM
      (
      -- WB OB (1-6) //////////////////////////////////////////
      SELECT BUDGET.BUDGET_ORDER_NO,
      BUDGET.BUDGET_YEAR,

      ISNULL(BUDGET.H1,0) AS OB_H1,
      ISNULL(BUDGET.M1,0) AS OB_M1,
      ISNULL(BUDGET.M2,0) AS OB_M2,
      ISNULL(BUDGET.M3,0) AS OB_M3,
      ISNULL(BUDGET.M4,0) AS OB_M4,
      ISNULL(BUDGET.M5,0) AS OB_M5,
      ISNULL(BUDGET.M6,0) AS OB_M6,

      0 AS AC_H1,
      0 AS AC_M1,
      0 AS AC_M2,
      0 AS AC_M3,
      0 AS AC_M4,
      0 AS AC_M5,
      0 AS AC_M6,

      0 AS OB_H2,
      0 AS OB_M7,
      0 AS OB_M8,
      0 AS OB_M9,
      0 AS OB_M10,
      0 AS OB_M11,
      0 AS OB_M12,

      0 AS AC_H2,
      0 AS AC_M7,
      0 AS AC_M8,
      0 AS AC_M9,
      0 AS AC_M10,
      0 AS AC_M11,
      0 AS AC_M12

      FROM BG_T_UPLOAD_DATA AS BUDGET

      WHERE BUDGET.BUDGET_YEAR = @BudgetYear
      AND BUDGET.PERIOD_TYPE = @PeriodType1
      AND BUDGET.PROJECT_NO = 1
      AND BUDGET.DATA_TYPE = 1
      --AND BUDGET.BUDGET_ORDER_NO = 'J0000C9999'
      AND BUDGET.BUDGET_ORDER_NO IN ('JZZZZC4910', 'JZZZZC5910')

      -- WB AC (1-6) //////////////////////////////////////////
      UNION
      SELECT ACTUAL.BUDGET_ORDER_NO,
      ACTUAL.BUDGET_YEAR,

      0 AS OB_H1,
      0 AS OB_M1,
      0 AS OB_M2,
      0 AS OB_M3,
      0 AS OB_M4,
      0 AS OB_M5,
      0 AS OB_M6,

      ISNULL(ACTUAL.H1,0) AS AC_H1,
      ISNULL(ACTUAL.M1,0) AS AC_M1,
      ISNULL(ACTUAL.M2,0) AS AC_M2,
      ISNULL(ACTUAL.M3,0) AS AC_M3,
      ISNULL(ACTUAL.M4,0) AS AC_M4,
      ISNULL(ACTUAL.M5,0) AS AC_M5,
      ISNULL(ACTUAL.M6,0) AS AC_M6,

      0 AS OB_H2,
      0 AS OB_M7,
      0 AS OB_M8,
      0 AS OB_M9,
      0 AS OB_M10,
      0 AS OB_M11,
      0 AS OB_M12,

      0 AS AC_H2,
      0 AS AC_M7,
      0 AS AC_M8,
      0 AS AC_M9,
      0 AS AC_M10,
      0 AS AC_M11,
      0 AS AC_M12

      FROM BG_T_UPLOAD_DATA AS ACTUAL

      WHERE ACTUAL.BUDGET_YEAR = @BudgetYear
      AND ACTUAL.PERIOD_TYPE = @PeriodType1
      AND ACTUAL.PROJECT_NO = 1
      AND ACTUAL.DATA_TYPE = 2
      AND ACTUAL.BUDGET_ORDER_NO LIKE 'J%Z'

      -- WB OB (7-12) //////////////////////////////////////////
      UNION

      SELECT BUDGET.BUDGET_ORDER_NO,
      BUDGET.BUDGET_YEAR,

      0 AS OB_H1,
      0 AS OB_M1,
      0 AS OB_M2,
      0 AS OB_M3,
      0 AS OB_M4,
      0 AS OB_M5,
      0 AS OB_M6,

      0 AS AC_H1,
      0 AS AC_M1,
      0 AS AC_M2,
      0 AS AC_M3,
      0 AS AC_M4,
      0 AS AC_M5,
      0 AS AC_M6,

      ISNULL(BUDGET.H2,0) AS OB_H2,
      ISNULL(BUDGET.M7,0) AS OB_M7,
      ISNULL(BUDGET.M8,0) AS OB_M8,
      ISNULL(BUDGET.M9,0) AS OB_M9,
      ISNULL(BUDGET.M10,0) AS OB_M10,
      ISNULL(BUDGET.M11,0) AS OB_M11,
      ISNULL(BUDGET.M12,0) AS OB_M12,

      0 AS AC_H2,
      0 AS AC_M7,
      0 AS AC_M8,
      0 AS AC_M9,
      0 AS AC_M10,
      0 AS AC_M11,
      0 AS AC_M12

      FROM BG_T_UPLOAD_DATA AS BUDGET

      WHERE BUDGET.BUDGET_YEAR = @BudgetYear
      AND BUDGET.PERIOD_TYPE = 12
      AND BUDGET.PROJECT_NO = 1
      AND BUDGET.DATA_TYPE = 1
      --AND BUDGET.BUDGET_ORDER_NO = 'J0000C9999'
      AND BUDGET.BUDGET_ORDER_NO IN ('JZZZZC4910', 'JZZZZC5910')
      -- WB AC (7-12) //////////////////////////////////////////
      UNION

      SELECT ACTUAL.BUDGET_ORDER_NO,
      ACTUAL.BUDGET_YEAR,

      0 AS OB_H1,
      0 AS OB_M1,
      0 AS OB_M2,
      0 AS OB_M3,
      0 AS OB_M4,
      0 AS OB_M5,
      0 AS OB_M6,

      0 AS AC_H1,
      0 AS AC_M1,
      0 AS AC_M2,
      0 AS AC_M3,
      0 AS AC_M4,
      0 AS AC_M5,
      0 AS AC_M6,

      0 AS OB_H2,
      0 AS OB_M7,
      0 AS OB_M8,
      0 AS OB_M9,
      0 AS OB_M10,
      0 AS OB_M11,
      0 AS OB_M12,

      ISNULL(ACTUAL.H2,0) AS AC_H2,
      ISNULL(ACTUAL.M7,0) AS AC_M7,
      ISNULL(ACTUAL.M8,0) AS AC_M8,
      ISNULL(ACTUAL.M9,0) AS AC_M9,
      ISNULL(ACTUAL.M10,0) AS AC_M10,
      ISNULL(ACTUAL.M11,0) AS AC_M11,
      ISNULL(ACTUAL.M12,0) AS AC_M12

      FROM BG_T_UPLOAD_DATA AS ACTUAL

      WHERE ACTUAL.BUDGET_YEAR = @BudgetYear
      AND ACTUAL.PERIOD_TYPE = 12
      AND ACTUAL.PROJECT_NO = 1
      AND ACTUAL.DATA_TYPE = 2
      AND ACTUAL.BUDGET_ORDER_NO LIKE 'J%Z'
      ) AS CP
      GROUP BY CP.BUDGET_ORDER_NO,CP.BUDGET_YEAR

      ) AS COMPARE_DATA

      INNER JOIN BG_M_BUDGET_ORDER AS BUDGET_ORDER
      ON BUDGET_ORDER.BUDGET_ORDER_NO = COMPARE_DATA.BUDGET_ORDER_NO
      AND BUDGET_ORDER.BUDGET_TYPE = 'E'
      AND BUDGET_ORDER.ACTIVE_FLAG = 1

      INNER JOIN BG_M_PERSON_IN_CHARGE AS PIC
      ON PIC.PERSON_IN_CHARGE_NO = BUDGET_ORDER.PERSON_IN_CHARGE_NO

      LEFT OUTER JOIN BG_M_ACCOUNT AS ACC
      ON BUDGET_ORDER.ACCOUNT_NO = ACC.ACCOUNT_NO

      GROUP BY BUDGET_ORDER.ACCOUNT_NO,
      ACC.ACCOUNT_NAME,
      BUDGET_ORDER.BUDGET_TYPE,
      BUDGET_ORDER.EXPENSE_TYPE
    </SELECT005>
    <SELECT006>
      SELECT ASSET_GROUP.ASSET_GROUP_NO,
      ASSET_GROUP.ASSET_GROUP_NAME,
      ASSET_GROUP.ASSET_PROJECT,
      ASSET_PROJECT.ASSET_PROJECT_TXT,
      ASSET_GROUP.ASSET_CATEGORY,
      CATEGORY.ASSET_CATEGORY_TXT,
      BUDGET_ORDER.BUDGET_ORDER_NO,
      BUDGET_ORDER.COST_CENTER,
      BUDGET_ORDER.BUDGET_ORDER_NAME,
      BUDGET_ORDER.DEPT_NO,
      BUDGET_ORDER.PERSON_IN_CHARGE_NO,

      COMPARE_DATA.OB_M1,
      COMPARE_DATA.OB_M2,
      COMPARE_DATA.OB_M3,
      COMPARE_DATA.OB_M4,
      COMPARE_DATA.OB_M5,
      COMPARE_DATA.OB_M6,

      COMPARE_DATA.OB_M7,
      COMPARE_DATA.OB_M8,
      COMPARE_DATA.OB_M9,
      COMPARE_DATA.OB_M10,
      COMPARE_DATA.OB_M11,
      COMPARE_DATA.OB_M12,

      COMPARE_DATA.AC_M1,
      COMPARE_DATA.AC_M2,
      COMPARE_DATA.AC_M3,
      COMPARE_DATA.AC_M4,
      COMPARE_DATA.AC_M5,
      COMPARE_DATA.AC_M6,

      COMPARE_DATA.AC_M7,
      COMPARE_DATA.AC_M8,
      COMPARE_DATA.AC_M9,
      COMPARE_DATA.AC_M10,
      COMPARE_DATA.AC_M11,
      COMPARE_DATA.AC_M12,

      COMPARE_DATA.OB_M1 AS ACC_OB_M1,
      COMPARE_DATA.OB_M1 + COMPARE_DATA.OB_M2 AS ACC_OB_M2,
      COMPARE_DATA.OB_M1 + COMPARE_DATA.OB_M2 + COMPARE_DATA.OB_M3 AS ACC_OB_M3,
      COMPARE_DATA.OB_M1 + COMPARE_DATA.OB_M2 + COMPARE_DATA.OB_M3 + COMPARE_DATA.OB_M4 AS ACC_OB_M4,
      COMPARE_DATA.OB_M1 + COMPARE_DATA.OB_M2 + COMPARE_DATA.OB_M3 + COMPARE_DATA.OB_M4 + COMPARE_DATA.OB_M5 AS ACC_OB_M5,
      COMPARE_DATA.OB_M1 + COMPARE_DATA.OB_M2 + COMPARE_DATA.OB_M3 + COMPARE_DATA.OB_M4 + COMPARE_DATA.OB_M5 + COMPARE_DATA.OB_M6 AS ACC_OB_M6,

      COMPARE_DATA.OB_M7  AS ACC_OB_M7 ,
      COMPARE_DATA.OB_M7 + COMPARE_DATA.OB_M8 AS ACC_OB_M8 ,
      COMPARE_DATA.OB_M7 + COMPARE_DATA.OB_M8 + COMPARE_DATA.OB_M9 AS ACC_OB_M9 ,
      COMPARE_DATA.OB_M7 + COMPARE_DATA.OB_M8 + COMPARE_DATA.OB_M9 + COMPARE_DATA.OB_M10 AS ACC_OB_M10,
      COMPARE_DATA.OB_M7 + COMPARE_DATA.OB_M8 + COMPARE_DATA.OB_M9 + COMPARE_DATA.OB_M10 + COMPARE_DATA.OB_M11 AS ACC_OB_M11,
      COMPARE_DATA.OB_M7 + COMPARE_DATA.OB_M8 + COMPARE_DATA.OB_M9 + COMPARE_DATA.OB_M10 + COMPARE_DATA.OB_M11 + COMPARE_DATA.OB_M12 AS ACC_OB_M12,

      COMPARE_DATA.AC_M1 AS ACC_AC_M1,
      COMPARE_DATA.AC_M1 + COMPARE_DATA.AC_M2 AS ACC_AC_M2,
      COMPARE_DATA.AC_M1 + COMPARE_DATA.AC_M2 + COMPARE_DATA.AC_M3 AS ACC_AC_M3,
      COMPARE_DATA.AC_M1 + COMPARE_DATA.AC_M2 + COMPARE_DATA.AC_M3 + COMPARE_DATA.AC_M4 AS ACC_AC_M4,
      COMPARE_DATA.AC_M1 + COMPARE_DATA.AC_M2 + COMPARE_DATA.AC_M3 + COMPARE_DATA.AC_M4 + COMPARE_DATA.AC_M5 AS ACC_AC_M5,
      COMPARE_DATA.AC_M1 + COMPARE_DATA.AC_M2 + COMPARE_DATA.AC_M3 + COMPARE_DATA.AC_M4 + COMPARE_DATA.AC_M5 + COMPARE_DATA.AC_M6 AS ACC_AC_M6,

      COMPARE_DATA.AC_M7 AS ACC_AC_M7 ,
      COMPARE_DATA.AC_M7 + COMPARE_DATA.AC_M8 AS ACC_AC_M8 ,
      COMPARE_DATA.AC_M7 + COMPARE_DATA.AC_M8 + COMPARE_DATA.AC_M9  AS ACC_AC_M9 ,
      COMPARE_DATA.AC_M7 + COMPARE_DATA.AC_M8 + COMPARE_DATA.AC_M9  + COMPARE_DATA.AC_M10 AS ACC_AC_M10,
      COMPARE_DATA.AC_M7 + COMPARE_DATA.AC_M8 + COMPARE_DATA.AC_M9  + COMPARE_DATA.AC_M10 + COMPARE_DATA.AC_M11 AS ACC_AC_M11,
      COMPARE_DATA.AC_M7 + COMPARE_DATA.AC_M8 + COMPARE_DATA.AC_M9  + COMPARE_DATA.AC_M10 + COMPARE_DATA.AC_M11 + COMPARE_DATA.AC_M12 AS ACC_AC_M12,

      -- ACCUMULATE YEAR
      COMPARE_DATA.OB_M1 AS ACC_OB_Y1,
      COMPARE_DATA.OB_M1 + COMPARE_DATA.OB_M2 AS ACC_OB_Y2,
      COMPARE_DATA.OB_M1 + COMPARE_DATA.OB_M2 + COMPARE_DATA.OB_M3 AS ACC_OB_Y3,
      COMPARE_DATA.OB_M1 + COMPARE_DATA.OB_M2 + COMPARE_DATA.OB_M3 + COMPARE_DATA.OB_M4 AS ACC_OB_Y4,
      COMPARE_DATA.OB_M1 + COMPARE_DATA.OB_M2 + COMPARE_DATA.OB_M3 + COMPARE_DATA.OB_M4 + COMPARE_DATA.OB_M5 AS ACC_OB_Y5,
      COMPARE_DATA.OB_M1 + COMPARE_DATA.OB_M2 + COMPARE_DATA.OB_M3 + COMPARE_DATA.OB_M4 + COMPARE_DATA.OB_M5 + COMPARE_DATA.OB_M6 AS ACC_OB_Y6,

      COMPARE_DATA.OB_M1 + COMPARE_DATA.OB_M2 + COMPARE_DATA.OB_M3 + COMPARE_DATA.OB_M4 + COMPARE_DATA.OB_M5 + COMPARE_DATA.OB_M6 + COMPARE_DATA.OB_M7  AS ACC_OB_Y7 ,
      COMPARE_DATA.OB_M1 + COMPARE_DATA.OB_M2 + COMPARE_DATA.OB_M3 + COMPARE_DATA.OB_M4 + COMPARE_DATA.OB_M5 + COMPARE_DATA.OB_M6 + COMPARE_DATA.OB_M7 + COMPARE_DATA.OB_M8 AS ACC_OB_Y8 ,
      COMPARE_DATA.OB_M1 + COMPARE_DATA.OB_M2 + COMPARE_DATA.OB_M3 + COMPARE_DATA.OB_M4 + COMPARE_DATA.OB_M5 + COMPARE_DATA.OB_M6 + COMPARE_DATA.OB_M7 + COMPARE_DATA.OB_M8 + COMPARE_DATA.OB_M9 AS ACC_OB_Y9 ,
      COMPARE_DATA.OB_M1 + COMPARE_DATA.OB_M2 + COMPARE_DATA.OB_M3 + COMPARE_DATA.OB_M4 + COMPARE_DATA.OB_M5 + COMPARE_DATA.OB_M6 + COMPARE_DATA.OB_M7 + COMPARE_DATA.OB_M8 + COMPARE_DATA.OB_M9 + COMPARE_DATA.OB_M10 AS ACC_OB_Y10,
      COMPARE_DATA.OB_M1 + COMPARE_DATA.OB_M2 + COMPARE_DATA.OB_M3 + COMPARE_DATA.OB_M4 + COMPARE_DATA.OB_M5 + COMPARE_DATA.OB_M6 + COMPARE_DATA.OB_M7 + COMPARE_DATA.OB_M8 + COMPARE_DATA.OB_M9 + COMPARE_DATA.OB_M10 + COMPARE_DATA.OB_M11 AS ACC_OB_Y11,
      COMPARE_DATA.OB_M1 + COMPARE_DATA.OB_M2 + COMPARE_DATA.OB_M3 + COMPARE_DATA.OB_M4 + COMPARE_DATA.OB_M5 + COMPARE_DATA.OB_M6 + COMPARE_DATA.OB_M7 + COMPARE_DATA.OB_M8 + COMPARE_DATA.OB_M9 + COMPARE_DATA.OB_M10 + COMPARE_DATA.OB_M11 + COMPARE_DATA.OB_M12 AS ACC_OB_Y12,

      COMPARE_DATA.AC_M1 AS ACC_AC_Y1,
      COMPARE_DATA.AC_M1 + COMPARE_DATA.AC_M2 AS ACC_AC_Y2,
      COMPARE_DATA.AC_M1 + COMPARE_DATA.AC_M2 + COMPARE_DATA.AC_M3 AS ACC_AC_Y3,
      COMPARE_DATA.AC_M1 + COMPARE_DATA.AC_M2 + COMPARE_DATA.AC_M3 + COMPARE_DATA.AC_M4 AS ACC_AC_Y4,
      COMPARE_DATA.AC_M1 + COMPARE_DATA.AC_M2 + COMPARE_DATA.AC_M3 + COMPARE_DATA.AC_M4 + COMPARE_DATA.AC_M5 AS ACC_AC_Y5,
      COMPARE_DATA.AC_M1 + COMPARE_DATA.AC_M2 + COMPARE_DATA.AC_M3 + COMPARE_DATA.AC_M4 + COMPARE_DATA.AC_M5 + COMPARE_DATA.AC_M6 AS ACC_AC_Y6,

      COMPARE_DATA.AC_M1 + COMPARE_DATA.AC_M2 + COMPARE_DATA.AC_M3 + COMPARE_DATA.AC_M4 + COMPARE_DATA.AC_M5 + COMPARE_DATA.AC_M6 + COMPARE_DATA.AC_M7  AS ACC_AC_Y7 ,
      COMPARE_DATA.AC_M1 + COMPARE_DATA.AC_M2 + COMPARE_DATA.AC_M3 + COMPARE_DATA.AC_M4 + COMPARE_DATA.AC_M5 + COMPARE_DATA.AC_M6 + COMPARE_DATA.AC_M7 + COMPARE_DATA.AC_M8 AS ACC_AC_Y8 ,
      COMPARE_DATA.AC_M1 + COMPARE_DATA.AC_M2 + COMPARE_DATA.AC_M3 + COMPARE_DATA.AC_M4 + COMPARE_DATA.AC_M5 + COMPARE_DATA.AC_M6 + COMPARE_DATA.AC_M7 + COMPARE_DATA.AC_M8 + COMPARE_DATA.AC_M9 AS ACC_AC_Y9 ,
      COMPARE_DATA.AC_M1 + COMPARE_DATA.AC_M2 + COMPARE_DATA.AC_M3 + COMPARE_DATA.AC_M4 + COMPARE_DATA.AC_M5 + COMPARE_DATA.AC_M6 + COMPARE_DATA.AC_M7 + COMPARE_DATA.AC_M8 + COMPARE_DATA.AC_M9 + COMPARE_DATA.AC_M10 AS ACC_AC_Y10,
      COMPARE_DATA.AC_M1 + COMPARE_DATA.AC_M2 + COMPARE_DATA.AC_M3 + COMPARE_DATA.AC_M4 + COMPARE_DATA.AC_M5 + COMPARE_DATA.AC_M6 + COMPARE_DATA.AC_M7 + COMPARE_DATA.AC_M8 + COMPARE_DATA.AC_M9 + COMPARE_DATA.AC_M10 + COMPARE_DATA.AC_M11 AS ACC_AC_Y11,
      COMPARE_DATA.AC_M1 + COMPARE_DATA.AC_M2 + COMPARE_DATA.AC_M3 + COMPARE_DATA.AC_M4 + COMPARE_DATA.AC_M5 + COMPARE_DATA.AC_M6 + COMPARE_DATA.AC_M7 + COMPARE_DATA.AC_M8 + COMPARE_DATA.AC_M9 + COMPARE_DATA.AC_M10 + COMPARE_DATA.AC_M11 + COMPARE_DATA.AC_M12 AS ACC_AC_Y12

      FROM
      (
      SELECT
      CP.BUDGET_ORDER_NO,
      CP.BUDGET_YEAR,

      SUM(CP.OB_H1) AS OB_H1,
      SUM(CP.OB_M1) AS OB_M1,
      SUM(CP.OB_M2) AS OB_M2,
      SUM(CP.OB_M3) AS OB_M3,
      SUM(CP.OB_M4) AS OB_M4,
      SUM(CP.OB_M5) AS OB_M5,
      SUM(CP.OB_M6) AS OB_M6,

      SUM(CP.OB_H2) AS OB_H2,
      SUM(CP.OB_M7) AS OB_M7,
      SUM(CP.OB_M8) AS OB_M8,
      SUM(CP.OB_M9) AS OB_M9,
      SUM(CP.OB_M10) AS OB_M10,
      SUM(CP.OB_M11) AS OB_M11,
      SUM(CP.OB_M12) AS OB_M12,

      SUM(CP.AC_H1) AS AC_H1,
      SUM(CP.AC_M1) AS AC_M1,
      SUM(CP.AC_M2) AS AC_M2,
      SUM(CP.AC_M3) AS AC_M3,
      SUM(CP.AC_M4) AS AC_M4,
      SUM(CP.AC_M5) AS AC_M5,
      SUM(CP.AC_M6) AS AC_M6,

      SUM(CP.AC_H2) AS AC_H2,
      SUM(CP.AC_M7) AS AC_M7,
      SUM(CP.AC_M8) AS AC_M8,
      SUM(CP.AC_M9) AS AC_M9,
      SUM(CP.AC_M10) AS AC_M10,
      SUM(CP.AC_M11) AS AC_M11,
      SUM(CP.AC_M12) AS AC_M12

      FROM
      (
      SELECT BUDGET.BUDGET_ORDER_NO,
      BUDGET.BUDGET_YEAR,

      ISNULL(BUDGET.H1,0) AS OB_H1,
      ISNULL(BUDGET.M1,0) AS OB_M1,
      ISNULL(BUDGET.M2,0) AS OB_M2,
      ISNULL(BUDGET.M3,0) AS OB_M3,
      ISNULL(BUDGET.M4,0) AS OB_M4,
      ISNULL(BUDGET.M5,0) AS OB_M5,
      ISNULL(BUDGET.M6,0) AS OB_M6,

      ISNULL(ACTUAL.H1,0) AS AC_H1,
      ISNULL(ACTUAL.M1,0) AS AC_M1,
      ISNULL(ACTUAL.M2,0) AS AC_M2,
      ISNULL(ACTUAL.M3,0) AS AC_M3,
      ISNULL(ACTUAL.M4,0) AS AC_M4,
      ISNULL(ACTUAL.M5,0) AS AC_M5,
      ISNULL(ACTUAL.M6,0) AS AC_M6,

      0 AS OB_H2,
      0 AS OB_M7,
      0 AS OB_M8,
      0 AS OB_M9,
      0 AS OB_M10,
      0 AS OB_M11,
      0 AS OB_M12,

      0 AS AC_H2,
      0 AS AC_M7,
      0 AS AC_M8,
      0 AS AC_M9,
      0 AS AC_M10,
      0 AS AC_M11,
      0 AS AC_M12

      FROM BG_T_UPLOAD_DATA AS BUDGET

      LEFT OUTER JOIN BG_T_UPLOAD_DATA AS ACTUAL
      ON ACTUAL.BUDGET_ORDER_NO = BUDGET.BUDGET_ORDER_NO
      AND ACTUAL.BUDGET_YEAR = BUDGET.BUDGET_YEAR
      AND ACTUAL.PERIOD_TYPE = BUDGET.PERIOD_TYPE
      AND ACTUAL.PROJECT_NO = BUDGET.PROJECT_NO
      AND ACTUAL.DATA_TYPE = 2

      WHERE BUDGET.BUDGET_YEAR = @BudgetYear
      AND BUDGET.PERIOD_TYPE = @PeriodType1
      AND BUDGET.PROJECT_NO = 1
      AND BUDGET.DATA_TYPE = 1

      UNION

      SELECT BUDGET.BUDGET_ORDER_NO,
      BUDGET.BUDGET_YEAR,

      0 AS OB_H1,
      0 AS OB_M1,
      0 AS OB_M2,
      0 AS OB_M3,
      0 AS OB_M4,
      0 AS OB_M5,
      0 AS OB_M6,

      0 AS AC_H1,
      0 AS AC_M1,
      0 AS AC_M2,
      0 AS AC_M3,
      0 AS AC_M4,
      0 AS AC_M5,
      0 AS AC_M6,

      ISNULL(BUDGET.H2,0) AS OB_H2,
      ISNULL(BUDGET.M7,0) AS OB_M7,
      ISNULL(BUDGET.M8,0) AS OB_M8,
      ISNULL(BUDGET.M9,0) AS OB_M9,
      ISNULL(BUDGET.M10,0) AS OB_M10,
      ISNULL(BUDGET.M11,0) AS OB_M11,
      ISNULL(BUDGET.M12,0) AS OB_M12,

      ISNULL(ACTUAL.H2,0) AS AC_H2,
      ISNULL(ACTUAL.M7,0) AS AC_M7,
      ISNULL(ACTUAL.M8,0) AS AC_M8,
      ISNULL(ACTUAL.M9,0) AS AC_M9,
      ISNULL(ACTUAL.M10,0) AS AC_M10,
      ISNULL(ACTUAL.M11,0) AS AC_M11,
      ISNULL(ACTUAL.M12,0) AS AC_M12

      FROM BG_T_UPLOAD_DATA AS BUDGET

      LEFT OUTER JOIN BG_T_UPLOAD_DATA AS ACTUAL
      ON ACTUAL.BUDGET_ORDER_NO = BUDGET.BUDGET_ORDER_NO
      AND ACTUAL.BUDGET_YEAR = BUDGET.BUDGET_YEAR
      AND ACTUAL.PERIOD_TYPE = BUDGET.PERIOD_TYPE
      AND ACTUAL.PROJECT_NO = BUDGET.PROJECT_NO
      AND ACTUAL.DATA_TYPE = 2

      WHERE BUDGET.BUDGET_YEAR = @BudgetYear
      AND BUDGET.PERIOD_TYPE = 12
      AND BUDGET.PROJECT_NO = 1
      AND BUDGET.DATA_TYPE = 1
      ) AS CP
      GROUP BY CP.BUDGET_ORDER_NO,CP.BUDGET_YEAR

      ) AS COMPARE_DATA
      INNER JOIN BG_M_BUDGET_ORDER AS BUDGET_ORDER
      ON BUDGET_ORDER.BUDGET_ORDER_NO = COMPARE_DATA.BUDGET_ORDER_NO
      AND BUDGET_ORDER.BUDGET_TYPE = 'A' AND BUDGET_ORDER.ACTIVE_FLAG = 1

      INNER JOIN BG_M_ASSET_GROUP AS ASSET_GROUP
      ON ASSET_GROUP.ASSET_GROUP_NO = BUDGET_ORDER.ASSET_GROUP_NO

      INNER JOIN BG_M_ASSET_PROJECT AS ASSET_PROJECT
      ON ASSET_GROUP.ASSET_PROJECT = ASSET_PROJECT.ASSET_PROJECT

      INNER JOIN BG_M_ASSET_CATEGORY AS CATEGORY
      ON ASSET_GROUP.ASSET_CATEGORY = CATEGORY.ASSET_CATEGORY

      WHERE (COMPARE_DATA.OB_M1 &lt;&gt; 0 OR
      COMPARE_DATA.OB_M2 &lt;&gt; 0 OR
      COMPARE_DATA.OB_M3 &lt;&gt; 0 OR
      COMPARE_DATA.OB_M4 &lt;&gt; 0 OR
      COMPARE_DATA.OB_M5 &lt;&gt; 0 OR
      COMPARE_DATA.OB_M6 &lt;&gt; 0 OR
      COMPARE_DATA.OB_M7 &lt;&gt; 0 OR
      COMPARE_DATA.OB_M8 &lt;&gt; 0 OR
      COMPARE_DATA.OB_M9 &lt;&gt; 0 OR
      COMPARE_DATA.OB_M10 &lt;&gt; 0 OR
      COMPARE_DATA.OB_M11 &lt;&gt; 0 OR
      COMPARE_DATA.OB_M12 &lt;&gt; 0 OR
      COMPARE_DATA.AC_M1  &lt;&gt; 0 OR
      COMPARE_DATA.AC_M2  &lt;&gt; 0 OR
      COMPARE_DATA.AC_M3 &lt;&gt; 0 OR
      COMPARE_DATA.AC_M4 &lt;&gt; 0 OR
      COMPARE_DATA.AC_M5 &lt;&gt; 0 OR
      COMPARE_DATA.AC_M6 &lt;&gt; 0 OR
      COMPARE_DATA.AC_M7 &lt;&gt; 0 OR
      COMPARE_DATA.AC_M8 &lt;&gt; 0 OR
      COMPARE_DATA.AC_M9 &lt;&gt; 0 OR
      COMPARE_DATA.AC_M10 &lt;&gt; 0 OR
      COMPARE_DATA.AC_M11 &lt;&gt; 0 OR
      COMPARE_DATA.AC_M12 &lt;&gt; 0  )
      @PICCondition

    </SELECT006>
    <INSERT001>
      INSERT INTO BG_T_UPLOAD_DATA (BUDGET_YEAR, PERIOD_TYPE, BUDGET_ORDER_NO, DATA_TYPE,
      M1, M2, M3, M4, M5, M6, M7, M8, M9, M10, M11, M12, H1, H2,
      CREATE_USER_ID, CREATE_DATE, UPDATE_USER_ID, UPDATE_DATE, PROJECT_NO)
      VALUES (@BudgetYear, @PeriodType, '@BudgetOrder', @DataType,
      @M01, @M02, @M03, @M04, @M05, @M06, @M07, @M08, @M09, @M10, @M11, @M12, @H01, @H02,
      '@UserId', GETDATE(), '@UserId', GETDATE(), @ProjectNo)
    </INSERT001>
    <UPDATE001>
      UPDATE BG_T_UPLOAD_DATA SET
      M1 = @M01, M2 = @M02, M3 = @M03, M4 = @M04, M5 = @M05, M6 = @M06, M7 = @M07,
      M8 = @M08, M9 = @M09, M10 = @M10, M11 = @M11, M12 = @M12, H1 = @H01, H2 = @H02,
      UPDATE_USER_ID = '@UserId', UPDATE_DATE = GETDATE()
      WHERE BUDGET_YEAR = @BudgetYear AND PERIOD_TYPE = @PeriodType AND
      BUDGET_ORDER_NO = '@BudgetOrder' AND DATA_TYPE = @DataType AND PROJECT_NO = @ProjectNo
    </UPDATE001>
  </BG_T_UPLOAD_DATA>

  <!--// Table: BG_M_TRANSFER_MASTER -->
  <BG_M_TRANSFER_MASTER>
    <SELECT001>
      SELECT
      TM.BUDGET_YEAR
      , TM.PERIOD_TYPE
      , TM.PROJECT_NO
      , TM.BUDGET_ORDER_NO
      , BO0.BUDGET_ORDER_NAME
      , BO0.ACCOUNT_NO
      , CASE BO0.COST WHEN '2' THEN 'Admin'
      WHEN '1' THEN 'FC'
      ELSE NULL END [COST_TEXT]
      , BO0.COST
      , BO0.DEPT_NO [DEPT_NO]
      , CASE TM.TRANSFER_TYPE WHEN 1 THEN 'FC to Admin'
      WHEN 2 THEN 'Admin to FC'
      ELSE NULL END [TRANSFER_TYPE_TEXT]
      , TM.TRANSFER_TYPE
      , TM.TRANSFER_RATE
      , TM.FROM_ORDER_NO
      , CASE BO1.COST WHEN '2' THEN 'Admin'
      WHEN '1' THEN 'FC'
      ELSE NULL END [FROM_COST_TEXT]
      , BO1.COST [FROM_COST]
      , TM.TO_ORDER_NO
      , CASE BO2.COST WHEN '2' THEN 'Admin'
      WHEN '1' THEN 'FC'
      ELSE NULL END [TO_COST_TEXT]
      , BO2.COST [TO_COST]
      , TM.CREATE_USER_ID
      , CONVERT(VARCHAR(19), TM.CREATE_DATE, 120) [CREATE_DATE]
      , TM.UPDATE_USER_ID
      , CONVERT(VARCHAR(19), TM.UPDATE_DATE, 120) [UPDATE_DATE]
      FROM BG_M_TRANSFER_MASTER TM
      LEFT JOIN BG_M_BUDGET_ORDER BO0 ON TM.BUDGET_ORDER_NO = BO0.BUDGET_ORDER_NO
      LEFT JOIN BG_M_BUDGET_ORDER BO1 ON TM.FROM_ORDER_NO = BO1.BUDGET_ORDER_NO
      LEFT JOIN BG_M_BUDGET_ORDER BO2 ON TM.TO_ORDER_NO = BO2.BUDGET_ORDER_NO
      LEFT JOIN BG_M_ACCOUNT ACC ON ACC.ACCOUNT_NO = BO0.ACCOUNT_NO
      WHERE BO0.BUDGET_TYPE = 'E'
      AND TM.BUDGET_YEAR = @P_BUDGET_YEAR
      AND TM.PERIOD_TYPE = @P_PERIOD_TYPE
      AND TM.PROJECT_NO = @P_PROJECT_NO
      @Where
      ORDER BY TM.PERIOD_TYPE, TM.BUDGET_ORDER_NO ASC
    </SELECT001>
    <SELECT002>
      SELECT COUNT(*)
      FROM BG_M_TRANSFER_MASTER TM
      LEFT JOIN BG_M_BUDGET_ORDER BO0 ON TM.BUDGET_ORDER_NO = BO0.BUDGET_ORDER_NO
      LEFT JOIN BG_M_BUDGET_ORDER BO1 ON TM.FROM_ORDER_NO = BO1.BUDGET_ORDER_NO
      LEFT JOIN BG_M_BUDGET_ORDER BO2 ON TM.TO_ORDER_NO = BO2.BUDGET_ORDER_NO
      WHERE BO0.BUDGET_TYPE = 'E'
      AND TM.BUDGET_ORDER_NO = '@P_BUDGET_ORDER_NO'
      AND TM.BUDGET_YEAR = @P_BUDGET_YEAR
      AND TM.PERIOD_TYPE = @P_PERIOD_TYPE
      AND TM.PROJECT_NO = @P_PROJECT_NO
    </SELECT002>
    <SELECT003>
      SELECT * FROM BG_M_TRANSFER_MASTER
      WHERE BUDGET_YEAR = @BudgetYear AND PERIOD_TYPE = @PeriodType AND PROJECT_NO = @ProjectNo
      ORDER BY BUDGET_YEAR, PERIOD_TYPE, BUDGET_ORDER_NO
    </SELECT003>
    <SELECT004>
      SELECT TM.TRANSFER_RATE, TM.FROM_ORDER_NO, TM.TO_ORDER_NO, TM.BUDGET_ORDER_NO as MAIN_BUDGET_ORDER_NO,BD.*, 0 AS CAL_FROM_FLG, 0 AS CAL_TO_FLG
      FROM BG_M_TRANSFER_MASTER AS TM LEFT JOIN BG_T_BUDGET_DATA AS BD ON
      TM.BUDGET_YEAR = BD.BUDGET_YEAR AND TM.PERIOD_TYPE = BD.PERIOD_TYPE AND TM.PROJECT_NO = BD.PROJECT_NO AND
      TM.BUDGET_ORDER_NO = BD.BUDGET_ORDER_NO AND BD.REV_NO = @RevNo
      WHERE TM.BUDGET_YEAR = @BudgetYear AND TM.PERIOD_TYPE = @PeriodType AND TM.PROJECT_NO = @ProjectNo
    </SELECT004>
    <INSERT001>
      INSERT INTO [BG_M_TRANSFER_MASTER]
      ([BUDGET_YEAR],[PERIOD_TYPE],[BUDGET_ORDER_NO]
      ,[TRANSFER_TYPE],[TRANSFER_RATE],[FROM_ORDER_NO]
      ,[TO_ORDER_NO],[CREATE_USER_ID],[CREATE_DATE]
      ,[UPDATE_USER_ID],[UPDATE_DATE],[PROJECT_NO])
      VALUES(@P_BUDGET_YEAR,@P_PERIOD_TYPE,'@P_BUDGET_ORDER_NO'
      ,'@P_TRANSFER_TYPE','@P_TRANSFER_RATE','@P_FROM_ORDER_NO'
      ,'@P_TO_ORDER_NO','@P_CREATE_USER_ID', @P_CREATE_DATE
      ,'@P_UPDATE_USER_ID', GETDATE(), @P_PROJECT_NO)
    </INSERT001>
    <UPDATE001>
      UPDATE [BG_M_TRANSFER_MASTER]
      SET [TRANSFER_TYPE] = '@P_TRANSFER_TYPE'
      ,[TRANSFER_RATE] = '@P_TRANSFER_RATE'
      ,[FROM_ORDER_NO] = '@P_FROM_ORDER_NO'
      ,[TO_ORDER_NO] = '@P_TO_ORDER_NO'
      ,[UPDATE_USER_ID] = '@P_UPDATE_USER_ID'
      ,[UPDATE_DATE] = GETDATE()
      WHERE [BUDGET_YEAR] = @P_BUDGET_YEAR
      AND [PERIOD_TYPE] = @P_PERIOD_TYPE
      AND [BUDGET_ORDER_NO] = '@P_BUDGET_ORDER_NO'
      AND [PROJECT_NO] = @P_PROJECT_NO
    </UPDATE001>
    <DELETE001>
      DELETE FROM [BG_M_TRANSFER_MASTER]
      WHERE [BUDGET_YEAR] = @P_BUDGET_YEAR
      AND [PERIOD_TYPE] = @P_PERIOD_TYPE
      AND [BUDGET_ORDER_NO] = '@P_BUDGET_ORDER_NO'
      AND [PROJECT_NO] = @P_PROJECT_NO
    </DELETE001>
  </BG_M_TRANSFER_MASTER>

  <!--// Table: BG_T_BUDGET_ADJUST -->
  <BG_T_BUDGET_ADJUST>
    <SELECT001>
      SELECT BUDGET_YEAR FROM
      BG_T_BUDGET_ADJUST
      GROUP BY BUDGET_YEAR
    </SELECT001>
    <SELECT002>
      SELECT PERIOD_TYPE,
      CASE
      WHEN PERIOD_TYPE = 1 THEN 'Original Budget'
      WHEN PERIOD_TYPE = 2 THEN 'Estimate Budget'
      WHEN PERIOD_TYPE = 3 THEN 'Revise Budget'
      WHEN PERIOD_TYPE = 10 THEN 'MTP Budget'
      END AS PERIOD_NAME
      FROM BG_T_BUDGET_ADJUST
      WHERE BUDGET_YEAR = @YEAR
      GROUP BY PERIOD_TYPE
    </SELECT002>
    <SELECT003>
      SELECT REV_NO FROM BG_T_BUDGET_ADJUST
      WHERE BUDGET_YEAR = @YEAR AND PERIOD_TYPE = @PERIOD AND PROJECT_NO = @PROJECTNO
      GROUP BY REV_NO
    </SELECT003>
    <SELECT004>
      SELECT RRT0,RRT1, RRT2, RRT3, RRT4, RRT5, WORKING_BG1, WORKING_BG2
      FROM BG_T_BUDGET_ADJUST
      WHERE BUDGET_YEAR = @YEAR AND PERIOD_TYPE = @PERIOD AND REV_NO = @REV AND PROJECT_NO = @ProjectNo
    </SELECT004>
    <SELECT005>
      SELECT WKH1, WKH2, WKRRT1, WKRRT2, WKRRT3, WKRRT4, WKRRT5, MTPWB
      FROM BG_T_BUDGET_ADJUST
      WHERE BUDGET_YEAR = @YEAR AND PERIOD_TYPE = @PERIOD AND REV_NO = @REV AND PROJECT_NO = @ProjectNo
    </SELECT005>
    <SELECT006>
      SELECT MTP_SUM1, MTP_SUM2, MTP_SUM3, MTP_SUM4, MTP_SUM5
      FROM BG_T_BUDGET_ADJUST2
      WHERE BUDGET_YEAR = @YEAR AND PERIOD_TYPE = @PERIOD AND REV_NO = @REV AND PROJECT_NO = @ProjectNo
    </SELECT006>
    <SELECT007>
      SELECT PROJECT_NO FROM BG_T_BUDGET_ADJUST
      WHERE BUDGET_YEAR = @YEAR AND PERIOD_TYPE = @PERIOD
      GROUP BY PROJECT_NO
    </SELECT007>
    <SELECT008>
      SELECT MTP_SUM1, MTP_SUM2, MTP_SUM3, MTP_SUM4, MTP_SUM5, MTP_PY_SUM1, MTP_PY_SUM2, MTP_PY_SUM3, MTP_PY_SUM4, MTP_PY_SUM5
      FROM BG_T_BUDGET_ADJUST2
      WHERE BUDGET_YEAR = @YEAR AND PERIOD_TYPE = @PERIOD AND REV_NO = @REV AND PROJECT_NO = @ProjectNo
    </SELECT008>
    <SELECT009>
      SELECT ISNULL(REF_BUDGET_YEAR,1)AS REF_BUDGET_YEAR,
      ISNULL(REF_PERIOD_TYPE,1)AS REF_PERIOD_TYPE,
      ISNULL(REF_REV_NO,1)AS REF_REV_NO,
      ISNULL(REF_PROJECT_NO,1)AS  REF_PROJECT_NO
      FROM BG_T_BUDGET_ADJUST
      WHERE BUDGET_YEAR = @BudgetYear
      AND PERIOD_TYPE = @PeriodType
      AND REV_NO = @RevNo
      AND PROJECT_NO = @ProjectNo
    </SELECT009>
    <UPDATE001>
      UPDATE BG_T_BUDGET_ADJUST
      SET RRT0 = @RRT0, RRT1 = @RRT1, RRT2 = @RRT2, RRT3 = @RRT3, RRT4 = @RRT4, RRT5 = @RRT5,
      WORKING_BG1 = @WORKING_BG1, WORKING_BG2 = @WORKING_BG2, UPDATE_USER_ID = '@UPDATE_USER_ID', UPDATE_DATE = GetDate()
      WHERE BUDGET_YEAR = @YEAR AND PERIOD_TYPE = @PERIOD AND REV_NO = @REV AND PROJECT_NO = @PROJECTNO
    </UPDATE001>
    <UPDATE002>
      UPDATE BG_T_BUDGET_ADJUST
      SET WKH1 = @WKH1, WKH2 = @WKH2, UPDATE_USER_ID = '@UPDATE_USER_ID', UPDATE_DATE = GetDate(),
      WKRRT1 = @WKRRT1, WKRRT2 = @WKRRT2, WKRRT3 = @WKRRT3, WKRRT4 = @WKRRT4, WKRRT5 = @WKRRT5, MTPWB = @MTPWB
      WHERE BUDGET_YEAR = @YEAR AND PERIOD_TYPE = @PERIOD AND REV_NO = @REV AND PROJECT_NO = @ProjectNo
    </UPDATE002>
    <UPDATE003>
      UPDATE BG_T_BUDGET_ADJUST2
      SET MTP_SUM1 = @MTP_SUM1, MTP_SUM2 = @MTP_SUM2, MTP_SUM3 = @MTP_SUM3, MTP_SUM4 = @MTP_SUM4, MTP_SUM5 = @MTP_SUM5,
      UPDATE_USER_ID = '@UPDATE_USER_ID', UPDATE_DATE = GetDate()
      WHERE BUDGET_YEAR = @YEAR AND PERIOD_TYPE = @PERIOD AND REV_NO = @REV AND PROJECT_NO = @ProjectNo
    </UPDATE003>
    <UPDATE004>
      UPDATE BG_T_BUDGET_ADJUST2
      SET MTP_SUM1 = @MTP_SUM1, MTP_SUM2 = @MTP_SUM2, MTP_SUM3 = @MTP_SUM3, MTP_SUM4 = @MTP_SUM4, MTP_SUM5 = @MTP_SUM5,
      MTP_PY_SUM1 = @MTP_PY_SUM1, MTP_PY_SUM2 = @MTP_PY_SUM2, MTP_PY_SUM3 = @MTP_PY_SUM3, MTP_PY_SUM4 = @MTP_PY_SUM4, MTP_PY_SUM5 = @MTP_PY_SUM5,
      UPDATE_USER_ID = '@UPDATE_USER_ID', UPDATE_DATE = GetDate()
      WHERE BUDGET_YEAR = @YEAR AND PERIOD_TYPE = @PERIOD AND REV_NO = @REV AND PROJECT_NO = @ProjectNo
    </UPDATE004>
    <INSERT001>
      INSERT INTO BG_T_BUDGET_ADJUST(BUDGET_YEAR,PERIOD_TYPE,REV_NO,RRT0,RRT1,RRT2,RRT3,RRT4,RRT5,WORKING_BG1,WORKING_BG2,CREATE_USER_ID,UPDATE_USER_ID, PROJECT_NO)
      VALUES(@YEAR,@PERIOD,@REV,@RRT0,@RRT1,@RRT2,@RRT3,@RRT4,@RRT5,@WORKING_BG1,@WORKING_BG2,'@CREATE_USER_ID','@UPDATE_USER_ID', @ProjectNo)
    </INSERT001>
    <INSERT002>
      INSERT INTO BG_T_BUDGET_ADJUST2 (BUDGET_YEAR,PERIOD_TYPE,REV_NO,
      MTP_SUM1, MTP_SUM2, MTP_SUM3, MTP_SUM4, MTP_SUM5,CREATE_USER_ID,UPDATE_USER_ID,PROJECT_NO)
      VALUES(@YEAR,@PERIOD,@REV,@MTP_SUM1,@MTP_SUM2,@MTP_SUM3,@MTP_SUM4,@MTP_SUM5,'@CREATE_USER_ID','@UPDATE_USER_ID',@ProjectNo)
    </INSERT002>
    <INSERT003>
      INSERT INTO BG_T_BUDGET_ADJUST2 (BUDGET_YEAR,PERIOD_TYPE,REV_NO,
      MTP_SUM1, MTP_SUM2, MTP_SUM3, MTP_SUM4, MTP_SUM5,
      MTP_PY_SUM1, MTP_PY_SUM2, MTP_PY_SUM3, MTP_PY_SUM4, MTP_PY_SUM5,
      CREATE_USER_ID,UPDATE_USER_ID,PROJECT_NO)
      VALUES(@YEAR,@PERIOD,@REV,
      @MTP_SUM1,@MTP_SUM2,@MTP_SUM3,@MTP_SUM4,@MTP_SUM5,
      @MTP_PY_SUM1, @MTP_PY_SUM2, @MTP_PY_SUM3, @MTP_PY_SUM4, @MTP_PY_SUM5,
      '@CREATE_USER_ID','@UPDATE_USER_ID',@ProjectNo)
    </INSERT003>
    <DELETE001>
      DELETE FROM BG_T_BUDGET_ADJUST
      WHERE BUDGET_YEAR = @YEAR AND PERIOD_TYPE = @PERIOD AND REV_NO = @REV AND PROJECT_NO = @ProjectNo
    </DELETE001>
    <DELETE002>
      DELETE FROM BG_T_BUDGET_ADJUST2
      WHERE BUDGET_YEAR = @YEAR AND PERIOD_TYPE = @PERIOD AND REV_NO = @REV AND PROJECT_NO = @ProjectNo
    </DELETE002>
  </BG_T_BUDGET_ADJUST>

  <!--// Table: BG_T_BUDGET_REFERENCE -->
  <BG_T_BUDGET_REFERENCE>
    <SELECT001>
      SELECT ISNULL(REF_BUDGET_YEAR,1)AS REF_BUDGET_YEAR,
      ISNULL(REF_PERIOD_TYPE,1)AS REF_PERIOD_TYPE,
      ISNULL(REF_REV_NO,1)AS REF_REV_NO,
      ISNULL(REF_PROJECT_NO,1)AS  REF_PROJECT_NO
      FROM BG_T_BUDGET_REFERENCE
      WHERE BUDGET_YEAR = @BudgetYear
      AND PERIOD_TYPE = @PeriodType
      AND REV_NO = @RevNo
      AND PROJECT_NO = @ProjectNo
      AND REF_PERIOD_TYPE = @RefPeriodType
    </SELECT001>
    <SELECT002>
      SELECT ISNULL(REF_BUDGET_YEAR,1)AS REF_BUDGET_YEAR,
      ISNULL(REF_PERIOD_TYPE,1)AS REF_PERIOD_TYPE,
      ISNULL(REF_REV_NO,1)AS REF_REV_NO,
      ISNULL(REF_PROJECT_NO,1)AS  REF_PROJECT_NO
      FROM BG_T_BUDGET_REFERENCE
      WHERE BUDGET_YEAR = @BudgetYear
      AND PERIOD_TYPE = @PeriodType
      AND PROJECT_NO = @ProjectNo
      AND REF_PERIOD_TYPE = @RefPeriodType
      AND REV_NO = (SELECT MAX(REV_NO) FROM BG_T_BUDGET_REFERENCE
      WHERE BUDGET_YEAR = @BudgetYear
      AND PERIOD_TYPE = @PeriodType
      AND PROJECT_NO = @ProjectNo
      AND REF_PERIOD_TYPE = @RefPeriodType)
    </SELECT002>
    <INSERT001>
      INSERT INTO BG_T_BUDGET_REFERENCE
      (BUDGET_YEAR
      ,PERIOD_TYPE
      ,REV_NO
      ,PROJECT_NO
      ,REF_PERIOD_TYPE
      ,REF_BUDGET_YEAR
      ,REF_REV_NO
      ,REF_PROJECT_NO
      ,CREATE_USER_ID
      ,UPDATE_USER_ID)
      VALUES
      (@BudgetYear
      ,@PeriodType
      ,@RevNo
      ,@ProjectNo
      ,@RefPeriodType
      ,@RefBudgetYear
      ,@RefRevNo
      ,@RefProjectNo
      ,'@CreateUserID'
      ,'@UpdateUserID')
    </INSERT001>
    <UPDATE001>
      UPDATE BG_T_BUDGET_REFERENCE
      SET REF_BUDGET_YEAR = @RefBudgetYear
      ,REF_REV_NO = @RefRevNo
      ,REF_PROJECT_NO = @RefProjectNo
      ,UPDATE_USER_ID = '@UpdateUserID'
      ,UPDATE_DATE = GETDATE()
      WHERE
      BUDGET_YEAR = @BudgetYear
      AND PERIOD_TYPE = @PeriodType
      AND REV_NO = @RevNo
      AND PROJECT_NO = @ProjectNo
      AND REF_PERIOD_TYPE = @RefPeriodType
    </UPDATE001>

  </BG_T_BUDGET_REFERENCE>

  <!--// Table: BG_M_CHILD_PIC -->
  <BG_M_CHILD_PIC>
    <SELECT001>
      SELECT CHI.PIC_PARENT_NO, PER_PARENT.PERSON_IN_CHARGE_NAME AS PERSON_IN_CHARGE_NAME_P,
      CHI.PIC_CHILD_NO, PER_CHILD.PERSON_IN_CHARGE_NAME AS PERSON_IN_CHARGE_NAME_C,
      CHI.CREATE_USER_ID, CHI.CREATE_DATE, CHI.UPDATE_USER_ID, CHI.UPDATE_DATE
      FROM
      BG_M_CHILD_PIC AS CHI INNER JOIN
      BG_M_PERSON_IN_CHARGE AS PER_PARENT ON
      CHI.PIC_PARENT_NO = PER_PARENT.PERSON_IN_CHARGE_NO
      INNER JOIN BG_M_PERSON_IN_CHARGE AS PER_CHILD ON
      CHI.PIC_CHILD_NO = PER_CHILD.PERSON_IN_CHARGE_NO
      @Where
    </SELECT001>
    <SELECT002>
      SELECT * FROM BG_M_CHILD_PIC
      WHERE PIC_PARENT_NO = '@ParentNo' AND PIC_CHILD_NO = '@ChildNo'
    </SELECT002>
    <SELECT003>
      SELECT * FROM BG_M_CHILD_PIC
      WHERE PIC_PARENT_NO = '@ParentNo'
    </SELECT003>
    <UPDATE001>
      UPDATE [BG_M_CHILD_PIC]
      SET [PIC_CHILD_NO] = '@P_PIC_CHILD_NO'
      ,[UPDATE_USER_ID] = '@P_UPDATE_USER_ID'
      ,[UPDATE_DATE] = GETDATE()
      WHERE [PIC_PARENT_NO] = '@P_PIC_PARENT_NO' AND [PIC_CHILD_NO] = '@P_PIC_OLD_CHILD_NO'
    </UPDATE001>
    <INSERT001>
      INSERT INTO [BG_M_CHILD_PIC]
      ([PIC_PARENT_NO],[PIC_CHILD_NO],[CREATE_USER_ID]
      ,[CREATE_DATE],[UPDATE_USER_ID],[UPDATE_DATE])
      VALUES('@P_PIC_PARENT_NO', '@P_PIC_CHILD_NO'
      ,'@P_UPDATE_USER_ID',GETDATE()
      ,'@P_UPDATE_USER_ID',GETDATE())
    </INSERT001>
    <DELETE001>
      DELETE FROM BG_M_CHILD_PIC
      WHERE PIC_PARENT_NO = '@P_PIC_PARENT_NO' AND PIC_CHILD_NO = '@P_PIC_CHILD_NO'
    </DELETE001>
    <DELETE002>
      DELETE FROM BG_M_CHILD_PIC
    </DELETE002>
  </BG_M_CHILD_PIC>

  <!--// Table: BG_T_TRANS_LOG -->
  <BG_T_TRANS_LOG>
    <SELECT001>
      SELECT TL.*,
      CONVERT(VARCHAR(19), TL.LOG_DATE, 120) [LOG_DATE2],
      CASE [OPERATION_CD]
      WHEN 1 THEN 'View Budget'
      WHEN 2 THEN 'Input Budget'
      WHEN 3 THEN 'Approve Budget'
      WHEN 4 THEN 'Adjust Budget'
      WHEN 5 THEN 'Authorize (AD)'
      WHEN 6 THEN 'Authorize (MD)'
      WHEN 7 THEN 'Submit Budget'
      WHEN 8 THEN 'Reject Budget (Submitted budget)'
      WHEN 9 THEN 'Reject Budget (Approved budget)'
      WHEN 10 THEN 'Up Revision'
      WHEN 11 THEN 'Delete Revision'
      WHEN 12 THEN 'Reject Budget (Authorize budget)'
      WHEN 33 THEN 'Re-Input'
      WHEN 34 THEN 'Direct Input'
      WHEN 35 THEN 'Re-Input by Order'
      END  AS OPERATION_NAME,
      CASE [PERIOD_TYPE]
      WHEN 1 THEN 'Original Budget'
      WHEN 2 THEN 'Estimate Budget'
      WHEN 3 THEN 'Revise Budget'
      WHEN 10 THEN 'MTP Budget'
      END  AS PERIOD_TYPE_NAME,
      CASE TL.PERSON_IN_CHARGE_NO
      WHEN '0000' THEN 'ALL'
      ELSE TL.PERSON_IN_CHARGE_NO + ' : ' + PIC.PERSON_IN_CHARGE_NAME
      END  AS PIC_NAME,
      CASE [BUDGET_TYPE]
      WHEN 'E' THEN 'Expense'
      WHEN 'A' THEN 'Investment'
      END  AS BUDGET_TYPE_NAME,
      CASE WHEN TL.REV_NO > 0 THEN TL.REV_NO END AS REV_NO2
      FROM BG_T_TRANS_LOG TL LEFT JOIN BG_M_PERSON_IN_CHARGE PIC ON TL.PERSON_IN_CHARGE_NO = PIC.PERSON_IN_CHARGE_NO
      WHERE BUDGET_YEAR = @BudgetYear AND PERIOD_TYPE = @PeriodType AND OPERATION_CD IN (1,2,3,4,5,6,7,8,9,10,11,12,33,34,35) AND PROJECT_NO = @ProjectNo
      ORDER BY TL.LOG_DATE DESC, TL.OPERATION_CD, TL.PERSON_IN_CHARGE_NO, TL.BUDGET_TYPE, TL.REV_NO, TL.USER_ID
    </SELECT001>
    <SELECT002>
      SELECT TL.*,
      CONVERT(VARCHAR(19), TL.LOG_DATE, 120) [LOG_DATE2],
      CASE [OPERATION_CD]
      WHEN 13 THEN 'Open New Period'
      WHEN 14 THEN 'Close Period'
      WHEN 15 THEN 'Reopen Period'
      WHEN 16 THEN 'Import Data'
      WHEN 17 THEN 'Export Data'
      WHEN 18 THEN 'Edit Information'
      WHEN 19 THEN 'Edit Master Data'
      WHEN 20 THEN 'Edit User Master'
      WHEN 21 THEN 'Edit Budget Order Master'
      WHEN 22 THEN 'Edit Account Master'
      WHEN 23 THEN 'Edit Department Master'
      WHEN 24 THEN 'Edit Person In Charge Master'
      WHEN 25 THEN 'Edit Transfer Cost Master'
      WHEN 26 THEN 'Edit Budget Adjust Master'
      WHEN 27 THEN 'Edit Asset Group Master'
      WHEN 28 THEN 'Edit Child PIC Master'
      WHEN 29 THEN 'Reopen Account Master'
      WHEN 30 THEN 'Edit Asset Category Master'
      WHEN 31 THEN 'Edit Asset Project Master'
      WHEN 32 THEN 'Edit View Budget Peroid'
      END  AS OPERATION_NAME,
      CASE [PERIOD_TYPE]
      WHEN 1 THEN 'Original Budget'
      WHEN 2 THEN 'Estimate Budget'
      WHEN 3 THEN 'Revise Budget'
      WHEN 10 THEN 'MTP Budget'
      END  AS PERIOD_TYPE_NAME,
      CASE TL.PERSON_IN_CHARGE_NO
      WHEN '0000' THEN 'ALL'
      ELSE TL.PERSON_IN_CHARGE_NO + ' : ' + PIC.PERSON_IN_CHARGE_NAME
      END  AS PIC_NAME,
      CASE [BUDGET_TYPE]
      WHEN 'E' THEN 'Expense'
      WHEN 'A' THEN 'Investment'
      END  AS BUDGET_TYPE_NAME,
      CASE WHEN TL.REV_NO > 0 THEN TL.REV_NO END AS REV_NO2
      FROM BG_T_TRANS_LOG TL LEFT JOIN BG_M_PERSON_IN_CHARGE PIC ON TL.PERSON_IN_CHARGE_NO = PIC.PERSON_IN_CHARGE_NO
      WHERE OPERATION_CD IN (13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32) AND LOG_DATE BETWEEN @FromDate AND @ToDate
      ORDER BY TL.LOG_DATE DESC, TL.OPERATION_CD, TL.PERSON_IN_CHARGE_NO, TL.BUDGET_TYPE, TL.REV_NO, TL.USER_ID
    </SELECT002>
    <INSERT001>
      INSERT INTO [BG_T_TRANS_LOG]([LOG_DATE],[USER_ID],[OPERATION_CD],[BUDGET_YEAR],[PERIOD_TYPE],[PERSON_IN_CHARGE_NO],[BUDGET_TYPE],[REV_NO],[PROJECT_NO])
      VALUES(GETDATE(),@UserId,@OperationCd,@BudgetYear,@PeriodType,@UserPIC,@BudgetType,@RevNo,@ProjectNo)
    </INSERT001>
  </BG_T_TRANS_LOG>

  <!--// Table: BG_T_ACCOUNT_REOPEN -->
  <BG_T_ACCOUNT_REOPEN>
    <SELECT001>
      SELECT
      AO.BUDGET_YEAR,
      CASE AO.PERIOD_TYPE
      WHEN 1 THEN 'Original Budget'
      WHEN 2 THEN 'Estimate Budget'
      WHEN 3 THEN 'Revise Budget'
      WHEN 10 THEN 'MTP Budget'
      END AS PERIOD_NAME,
      AO.ACCOUNT_NO, AC.ACCOUNT_NAME,
      AO.PERSON_IN_CHARGE_NO, PIC.PERSON_IN_CHARGE_NAME,
      AO.CREATE_USER_ID, AO.CREATE_DATE,
      AO.UPDATE_USER_ID, AO.UPDATE_DATE
      FROM BG_T_ACCOUNT_REOPEN AS AO
      LEFT JOIN BG_M_ACCOUNT AS AC ON AO.ACCOUNT_NO = AC.ACCOUNT_NO
      LEFT JOIN BG_M_PERSON_IN_CHARGE AS PIC ON AO.PERSON_IN_CHARGE_NO = PIC.PERSON_IN_CHARGE_NO
      WHERE AO.BUDGET_YEAR = @BudgetYear AND AO.PERIOD_TYPE = @PeriodType AND AO.PROJECT_NO = @ProjectNo
      ORDER BY AO.ACCOUNT_NO, AO.PERSON_IN_CHARGE_NO
    </SELECT001>
    <INSERT001>
      INSERT INTO BG_T_ACCOUNT_REOPEN (BUDGET_YEAR, PERIOD_TYPE, ACCOUNT_NO, PERSON_IN_CHARGE_NO, CREATE_USER_ID, UPDATE_USER_ID, PROJECT_NO)
      VALUES (@BudgetYear,@PeriodType,'@AccountNo','@PicNo','@UserId','@UserId', @ProjectNo)
    </INSERT001>
    <DELETE001>
      DELETE FROM BG_T_ACCOUNT_REOPEN
      WHERE BUDGET_YEAR = @BudgetYear AND PERIOD_TYPE = @PeriodType AND ACCOUNT_NO = '@AccountNo' AND PERSON_IN_CHARGE_NO = '@PicNo' AND PROJECT_NO = @ProjectNo
    </DELETE001>
    <DELETE002>
      DELETE FROM BG_T_ACCOUNT_REOPEN
      WHERE BUDGET_YEAR = @BudgetYear AND PERIOD_TYPE = @PeriodType AND PROJECT_NO = @ProjectNo
    </DELETE002>
    <DELETE003>
      DELETE FROM BG_T_ACCOUNT_REOPEN
      WHERE BUDGET_YEAR = @BudgetYear AND PERIOD_TYPE = @PeriodType AND ACCOUNT_NO = '@AccountNo' AND PROJECT_NO = @ProjectNo
    </DELETE003>
    <DELETE004>
      DELETE FROM BG_T_ACCOUNT_REOPEN
      WHERE BUDGET_YEAR = @BudgetYear AND PERIOD_TYPE = @PeriodType AND PERSON_IN_CHARGE_NO = '@PicNo' AND PROJECT_NO = @ProjectNo
    </DELETE004>
  </BG_T_ACCOUNT_REOPEN>

  <!--// Table: BG_M_PERIOD -->
  <BG_M_PERIOD>
    <SELECT001>
      SELECT [PERIOD_TYPE_ID]
      ,[PERIOD_TYPE_NAME]
      ,[OPEN_FLG]
      ,[CREATE_USER_ID]
      ,[CREATE_DATE]
      ,[UPDATE_USER_ID]
      ,[UPDATE_DATE]
      FROM BG_M_PERIOD
    </SELECT001>
    <SELECT002>
      SELECT [PERIOD_TYPE_ID]
      ,[PERIOD_TYPE_NAME]
      ,[OPEN_FLG]
      ,[CREATE_USER_ID]
      ,[CREATE_DATE]
      ,[UPDATE_USER_ID]
      ,[UPDATE_DATE]
      FROM BG_M_PERIOD
      WHERE OPEN_FLG = @openflg
    </SELECT002>

  </BG_M_PERIOD>

  <BG_T_BUDGET_DATA_REINPUT>
    <INSERT001>
      INSERT INTO [BG_T_BUDGET_DATA_REINPUT]
      ([BUDGET_YEAR],[PERIOD_TYPE],[REV_NO]
      ,[PROJECT_NO],[BUDGET_ORDER_NO],[ITEM_STATUS]
      ,[CREATE_USER_ID],[CREATE_DATE]
      ,[UPDATE_USER_ID],[UPDATE_DATE])
      VALUES('@P_BUDGET_YEAR', '@P_PERIOD_TYPE','@P_REV_NO'
      ,'@P_PROJECT_NO','@P_BUDGET_ORDER_NO',@P_ITEM_STATUS
      ,'@P_CREATE_USER_ID',GETDATE()
      ,'@P_CREATE_USER_ID',GETDATE())
    </INSERT001>

    <UPDATE001>
      UPDATE BG_T_BUDGET_DATA_REINPUT SET
      ITEM_STATUS = @Status, UPDATE_USER_ID = '@UserId', UPDATE_DATE = GetDate()
      WHERE  BUDGET_YEAR = @BudgetYear
      AND PERIOD_TYPE = @PeriodType
      AND REV_NO = @RevNo
      AND PROJECT_NO = @ProjectNo
      AND BUDGET_ORDER_NO IN
      (
      SELECT BUDGET_ORDER_NO  FROM  BG_M_BUDGET_ORDER
      WHERE PERSON_IN_CHARGE_NO = '@UserPIC'
      AND BUDGET_TYPE = '@BudgetType'
      )
    </UPDATE001>
    <DELETE001>
      DELETE FROM BG_T_BUDGET_DATA_REINPUT
      WHERE  BUDGET_YEAR = @BudgetYear
      AND PERIOD_TYPE = @PeriodType
      AND REV_NO = @RevNo
      AND PROJECT_NO = @ProjectNo
      AND BUDGET_ORDER_NO = '@BudgetOrderNo'
      AND ITEM_STATUS =@STATUS
    </DELETE001>

    <DELETE002>
      DELETE  FROM BG_T_BUDGET_DATA_REINPUT
      WHERE  BUDGET_YEAR = @BudgetYear
      AND PERIOD_TYPE = @PeriodType
      AND REV_NO = @RevNo
      AND PROJECT_NO = @ProjectNo
      AND BUDGET_ORDER_NO IN
      (
      SELECT BUDGET_ORDER_NO FROM dbo.BG_M_BUDGET_ORDER
      WHERE  BUDGET_TYPE = '@BudgetType'
      )
    </DELETE002>

    <DELETE003>
      DELETE  FROM BG_T_BUDGET_DATA_REINPUT
      WHERE  BUDGET_YEAR = @BudgetYear
      AND PERIOD_TYPE = @PeriodType
      AND REV_NO = @RevNo
      AND PROJECT_NO = @ProjectNo
      AND BUDGET_ORDER_NO IN
      (
      SELECT BUDGET_ORDER_NO FROM dbo.BG_M_BUDGET_ORDER
      WHERE
      PERSON_IN_CHARGE_NO=  '@UserPIC' AND BUDGET_TYPE = '@BudgetType'
      )
    </DELETE003>

    <SELECT001>
      SELECT RE.* FROM  dbo.BG_T_BUDGET_DATA_REINPUT  RE
      RIGHT JOIN  dbo.BG_M_BUDGET_ORDER  OD ON OD.BUDGET_ORDER_NO =  RE.BUDGET_ORDER_NO AND OD.PERSON_IN_CHARGE_NO = @P_PERSON_IN_CHARGE_NO
      WHERE RE.BUDGET_YEAR = @P_BUDGET_YEAR
      AND  RE.PERIOD_TYPE =@P_PERIOD_TYPE
      AND RE.REV_NO =@P_REV_NO
      AND RE.PROJECT_NO =@P_PROJECT_NO
    </SELECT001>
    <SELECT002>
      SELECT PU.* from  dbo.BG_T_BUDGET_DATA_REINPUT PU
      INNER JOIN
      (
      SELECT BUDGET_ORDER_NO FROM dbo.BG_M_BUDGET_ORDER
      WHERE BUDGET_TYPE = '@P_BUDGET_TYPE'
      )  AS ORN ON ORN.BUDGET_ORDER_NO=PU.BUDGET_ORDER_NO
      WHERE BUDGET_YEAR = @P_BUDGET_YEAR
      AND PERIOD_TYPE = @P_PERIOD_TYPE
      AND REV_NO = @P_REV_NO
      AND ITEM_STATUS = @P_ITEM_STATUS
      AND PROJECT_NO = @P_PROJECT_NO
    </SELECT002>
    <SELECT003>
      SELECT PU.* from  dbo.BG_T_BUDGET_DATA_REINPUT PU
      INNER JOIN
      (
      SELECT BUDGET_ORDER_NO FROM dbo.BG_M_BUDGET_ORDER
      WHERE BUDGET_TYPE = '@P_BUDGET_TYPE'
      AND PERSON_IN_CHARGE_NO = '@P_PERSON_IN_CHARGE_NO'
      )  AS ORN ON ORN.BUDGET_ORDER_NO=PU.BUDGET_ORDER_NO
      WHERE BUDGET_YEAR = @P_BUDGET_YEAR
      AND PERIOD_TYPE = @P_PERIOD_TYPE
      AND REV_NO = @P_REV_NO
      AND ITEM_STATUS = @P_ITEM_STATUS
      AND PROJECT_NO = @P_PROJECT_NO
    </SELECT003>
    <SELECT004>
      SELECT PU.* from  dbo.BG_T_BUDGET_DATA_REINPUT PU
      INNER JOIN
      (
      SELECT BUDGET_ORDER_NO FROM dbo.BG_M_BUDGET_ORDER
      WHERE BUDGET_TYPE = '@P_BUDGET_TYPE'
      )  AS ORN ON ORN.BUDGET_ORDER_NO=PU.BUDGET_ORDER_NO
      WHERE BUDGET_YEAR = @P_BUDGET_YEAR
      AND PERIOD_TYPE = @P_PERIOD_TYPE
      AND REV_NO = @P_REV_NO
      AND PROJECT_NO = @P_PROJECT_NO
    </SELECT004>
    <SELECT005>
      SELECT PU.* from  dbo.BG_T_BUDGET_DATA_REINPUT PU
      INNER JOIN
      (
      SELECT BUDGET_ORDER_NO FROM dbo.BG_M_BUDGET_ORDER
      WHERE BUDGET_TYPE = '@P_BUDGET_TYPE'
      AND PERSON_IN_CHARGE_NO = '@P_PERSON_IN_CHARGE_NO'
      )  AS ORN ON ORN.BUDGET_ORDER_NO=PU.BUDGET_ORDER_NO
      WHERE BUDGET_YEAR = @P_BUDGET_YEAR
      AND PERIOD_TYPE = @P_PERIOD_TYPE
      AND REV_NO = @P_REV_NO
      AND PROJECT_NO = @P_PROJECT_NO
    </SELECT005>


  </BG_T_BUDGET_DATA_REINPUT>

  <!--// Table: BG_T_BUDGET_COMMENT -->
  <BG_T_BUDGET_COMMENT>
    <SELECT001>
    SELECT * FROM  dbo.BG_T_BUDGET_COMMENT
    WHERE BUDGET_YEAR = @BudgetYear
    AND  PERIOD_TYPE =@PeriodType
    AND BUDGET_ORDER_NO ='@BudgetOrderNo'
    AND REV_NO =@RevNo
    AND PROJECT_NO =@ProjectNo
    </SELECT001>

    <SELECT002>
      SELECT BC.BUDGET_YEAR,
      BC.PERIOD_TYPE,
      BC.BUDGET_ORDER_NO,
      BO.BUDGET_ORDER_NAME,
      BO.PERSON_IN_CHARGE_NO,
      PIC.PERSON_IN_CHARGE_NAME,
      BC.M1,
      BC.M2,
      BC.M3,
      BC.M4,
      BC.M5,
      BC.M6,
      BC.M7,
      BC.M8,
      BC.M9,
      BC.M10,
      BC.M11,
      BC.M12,
      BC.RRT1,
      BC.RRT2,
      BC.RRT3,
      BC.RRT4,
      BC.RRT5
      FROM  BG_T_BUDGET_COMMENT BC
      LEFT JOIN BG_M_BUDGET_ORDER BO ON BC.BUDGET_ORDER_NO = BO.BUDGET_ORDER_NO
      LEFT JOIN BG_M_PERSON_IN_CHARGE PIC ON BO.PERSON_IN_CHARGE_NO = PIC.PERSON_IN_CHARGE_NO
      WHERE BC.BUDGET_YEAR = @YEAR
      AND BC.PERIOD_TYPE =@PERIOD
      AND BO.BUDGET_TYPE ='@BUDGETTYPE'
      AND BC.PROJECT_NO = @PROJECTNO
      @REVNOCONDITION
      @PICCONDITION
    </SELECT002>

    <INSERT001>
      INSERT INTO BG_T_BUDGET_COMMENT (BUDGET_YEAR, PERIOD_TYPE, BUDGET_ORDER_NO, REV_NO, PROJECT_NO, CREATE_USER_ID, CREATE_DATE, UPDATE_USER_ID, UPDATE_DATE, @Condition)
      VALUES (@BudgetYear, @PeriodType, '@BudgetOrderNo', @RevNo, @ProjectNo,  '@UserId', GetDate(), '@UserId', GetDate(), '@Value')
    </INSERT001>

    <INSERT002>
      INSERT INTO BG_T_BUDGET_COMMENT (BUDGET_YEAR, PERIOD_TYPE, BUDGET_ORDER_NO, REV_NO, M1, M2, M3, M4, M5, M6, M7, M8, M9, M10, M11, M12, RRT1, RRT2, RRT3, RRT4, RRT5, CREATE_USER_ID, CREATE_DATE, UPDATE_USER_ID, UPDATE_DATE, PROJECT_NO)
      VALUES (@BudgetYear,@PeriodType,'@BudgetOrderNo',@RevNo, '@M01', '@M02', '@M03', '@M04', '@M05', '@M06', '@M07', '@M08', '@M09', '@M10', '@M11', '@M12', '@RRT1', '@RRT2', '@RRT3', '@RRT4', '@RRT5', '@UserId', GetDate(), '@UserId', GetDate(), @ProjectNo)
    </INSERT002>

    <UPDATE001>
      UPDATE BG_T_BUDGET_COMMENT SET @comment, UPDATE_USER_ID = '@UserId', UPDATE_DATE = GetDate()
      WHERE BUDGET_YEAR = @BudgetYear
      AND  PERIOD_TYPE =@PeriodType
      AND BUDGET_ORDER_NO ='@BudgetOrderNo'
      AND REV_NO =@RevNo
      AND PROJECT_NO =@ProjectNo
    </UPDATE001>

    <DELETE001>
      DELETE FROM BG_T_BUDGET_COMMENT
      WHERE BUDGET_YEAR = @BudgetYear AND PERIOD_TYPE = @PeriodType AND PROJECT_NO = @ProjectNo AND
      REV_NO = @RevNo AND BUDGET_ORDER_NO IN (SELECT BUDGET_ORDER_NO FROM BG_M_BUDGET_ORDER WHERE BUDGET_TYPE = '@BudgetType')
    </DELETE001>
      
  </BG_T_BUDGET_COMMENT>
 

</SqlCmd>